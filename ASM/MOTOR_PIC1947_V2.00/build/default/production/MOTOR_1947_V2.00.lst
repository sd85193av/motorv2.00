

Microchip MPLAB XC8 Assembler V2.40 build 20220703182018 
                                                                                                           Wed Oct 04 17:08:43 2023


     1                           	processor	16F1947
     2                           	pagewidth 132
     3                           	psect	udata_shr,global,class=COMMON,space=1,delta=1,noexec
     4                           	psect	udata,global,class=RAM,space=1,delta=1,noexec
     5                           	psect	udata_bank0,global,class=BANK0,space=1,delta=1,noexec
     6                           	psect	udata_bank1,global,class=BANK1,space=1,delta=1,noexec
     7                           	psect	udata_bank2,global,class=BANK2,space=1,delta=1,noexec
     8                           	psect	udata_bank3,global,class=BANK3,space=1,delta=1,noexec
     9                           	psect	udata_bank4,global,class=BANK4,space=1,delta=1,noexec
    10                           	psect	udata_bank5,global,class=BANK5,space=1,delta=1,noexec
    11                           	psect	udata_bank6,global,class=BANK6,space=1,delta=1,noexec
    12                           	psect	udata_bank7,global,class=BANK7,space=1,delta=1,noexec
    13                           	psect	udata_bank8,global,class=BANK8,space=1,delta=1,noexec
    14                           	psect	udata_bank9,global,class=BANK9,space=1,delta=1,noexec
    15                           	psect	udata_bank10,global,class=BANK10,space=1,delta=1,noexec
    16                           	psect	udata_bank11,global,class=BANK11,space=1,delta=1,noexec
    17                           	psect	udata_bank12,global,class=BANK12,space=1,delta=1,noexec
    18                           	psect	code,global,class=CODE,delta=2
    19                           	psect	data,global,class=STRCODE,delta=2,noexec
    20                           	psect	edata,global,class=EEDATA,space=3,delta=2,noexec
    21                           	psect	main,global,size=2048,class=CODE,delta=2
    22                           	psect	config,global,abs,ovrld,class=CONFIG,space=4,delta=2,noexec
    23                           
    24                           ;========================================================
    25                           ;================ Project Information ===================
    26                           ;========================================================
    27                           ;Project Name : MOTOR-MODULE_V2.00
    28                           ;Project Version:
    29                           ;Project object :
    30                           ;Project number :
    31                           ;Edit Date :
    32                           ;--------------------------------------------------------
    33                           ;========================================================
    34                           ;========================================================
    35                           ;========================================================
    36                           ;========================================================
    37                           ;======== PIC16F1947 Configuration Bit Settings =========
    38                           ;========================================================
    39                           ; PIC16F1947 Configuration Bit Settings
    40                           ; Assembly source line config statements
    41                           ; CONFIG1
    42                           ; CONFIG2
    43                           ;** ***************************************************************************************
    44                           ;==========================================================================
    45                           ; MPASM PIC16LF1947 processor include
    46                           ;
    47                           ; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
    48                           ;==========================================================================
    49                           ;==========================================================================
    50                           ; This header file defines configurations, registers, and other useful
    51                           ; bits of information for the PIC16LF1947 microcontroller. These names
    52                           ; are taken to match the data sheets as closely as possible.
    53                           ;
    54                           ; Note that the processor must be selected before this file is included.
    55                           ; The processor may be selected the following ways:
    56                           ;
    57                           ; 1. Command line switch:
    58                           ; C:\MPASM MYFILE.ASM /PIC16LF1947
    59                           ; 2. LIST directive in the source file
    60                           ; LIST P=PIC16LF1947
    61                           ; 3. Processor Type entry in the MPASM full-screen interface
    62                           ; 4. Setting the processor in the MPLAB Project Dialog
    63                           ;==========================================================================
    64                           ;==========================================================================
    65                           ;
    66                           ; Verify Processor
    67                           ;
    68                           ;==========================================================================
    69                           ; IFNDEF __16LF1947
    70                           ; MESSG "Processor-header file mismatch.  Verify selected processor."
    71                           ; ENDIF
    72                           ;==========================================================================
    73                           ;
    74                           ; Register Definitions
    75                           ;
    76                           ;==========================================================================
    77                           ;W EQU 0000H
    78                           ;F EQU 0001H
    79                           ;----- Register Files -----------------------------------------------------
    80                           ;-----Bank0------------------
    81     0003                     
    82                           ;FSR0 EQU 0004H
    83     0005                     
    84                           ;FSR1 EQU 0006H
    85     001F                     
    86                           ;-----Bank1------------------
    87     009E                     
    88                           ;-----Bank2------------------
    89     011F                     
    90                           ;-----Bank3------------------
    91     019F                     
    92                           ;-----Bank4------------------
    93     021F                     
    94                           ;-----Bank5------------------
    95     029F                     
    96                           ;-----Bank6------------------
    97     031E                     
    98                           ;-----Bank7------------------
    99     0396                     
   100                           ;-----Bank8------------------
   101     041E                     
   102                           ;-----Bank9------------------
   103     0497                     
   104                           ;-----Bank15------------------
   105     07B7                     
   106                           ;-----Bank31------------------
   107     0FEF                     
   108                           ;----- STATUS Bits -----------------------------------------------------
   109     0004                     
   110                           ;----- BSR Bits -----------------------------------------------------
   111     0004                     
   112                           ;----- INTCON Bits -----------------------------------------------------
   113     0005                     
   114                           ;----- PORTA Bits -----------------------------------------------------
   115     0007                     
   116                           ;----- PORTB Bits -----------------------------------------------------
   117     0000                     
   118                           ;----- PORTC Bits -----------------------------------------------------
   119     0002                     
   120                           ;----- PORTD Bits -----------------------------------------------------
   121     0006                     
   122                           ;----- PORTE Bits -----------------------------------------------------
   123     0007                     
   124                           ;----- PIR1 Bits -----------------------------------------------------
   125     0005                     
   126                           ;----- PIR2 Bits -----------------------------------------------------
   127     0007                     
   128                           ;----- PIR3 Bits -----------------------------------------------------
   129     0006                     
   130                           ;----- PIR4 Bits -----------------------------------------------------
   131     0005                     
   132                           ;----- T1CON Bits -----------------------------------------------------
   133     0007                     
   134                           ;----- T1GCON Bits -----------------------------------------------------
   135     0003                     
   136                           ;----- T2CON Bits -----------------------------------------------------
   137     0006                     
   138                           ;----- CPSCON0 Bits -----------------------------------------------------
   139     0007                     
   140                           ;----- CPSCON1 Bits -----------------------------------------------------
   141     0004                     
   142                           ;----- TRISA Bits -----------------------------------------------------
   143     0007                     
   144                           ;----- TRISB Bits -----------------------------------------------------
   145     0007                     
   146                           ;----- TRISC Bits -----------------------------------------------------
   147     0007                     
   148                           ;----- TRISD Bits -----------------------------------------------------
   149     0007                     
   150                           ;----- TRISE Bits -----------------------------------------------------
   151     0007                     
   152                           ;----- PIE1 Bits -----------------------------------------------------
   153     0005                     
   154                           ;----- PIE2 Bits -----------------------------------------------------
   155     0007                     
   156                           ;----- PIE3 Bits -----------------------------------------------------
   157     0006                     
   158                           ;----- PIE4 Bits -----------------------------------------------------
   159     0005                     
   160                           ;----- OPTION_REG Bits -----------------------------------------------------
   161     0005                     
   162                           ;----- PCON Bits -----------------------------------------------------
   163     0007                     
   164                           ;----- WDTCON Bits -----------------------------------------------------
   165     0005                     
   166                           ;----- OSCTUNE Bits -----------------------------------------------------
   167     0005                     
   168                           ;----- OSCCON Bits -----------------------------------------------------
   169     0007                     
   170                           ;----- OSCSTAT Bits -----------------------------------------------------
   171     0007                     
   172                           ;----- ADCON0 Bits -----------------------------------------------------
   173     0001                     
   174                           ;----- ADCON1 Bits -----------------------------------------------------
   175     0007                     
   176                           ;----- LATA Bits -----------------------------------------------------
   177     0007                     
   178                           ;----- LATB Bits -----------------------------------------------------
   179     0007                     
   180                           ;----- LATC Bits -----------------------------------------------------
   181     0007                     
   182                           ;----- LATD Bits -----------------------------------------------------
   183     0007                     
   184                           ;----- LATE Bits -----------------------------------------------------
   185     0007                     
   186                           ;----- CM1CON0 Bits -----------------------------------------------------
   187     0007                     
   188                           ;----- CM1CON1 Bits -----------------------------------------------------
   189     0007                     
   190                           ;----- CM2CON0 Bits -----------------------------------------------------
   191     0007                     
   192                           ;----- CM2CON1 Bits -----------------------------------------------------
   193     0007                     
   194                           ;----- CMOUT Bits -----------------------------------------------------
   195     0002                     
   196                           ;----- BORCON Bits -----------------------------------------------------
   197     0007                     
   198                           ;----- FVRCON Bits -----------------------------------------------------
   199     0007                     
   200                           ;----- DACCON0 Bits -----------------------------------------------------
   201     0007                     
   202                           ;----- DACCON1 Bits -----------------------------------------------------
   203     0004                     
   204                           ;----- SRCON0 Bits -----------------------------------------------------
   205     0007                     
   206                           ;----- SRCON1 Bits -----------------------------------------------------
   207     0007                     
   208                           ;----- APFCON Bits -----------------------------------------------------
   209     0007                     
   210                           ;----- CM3CON0 Bits -----------------------------------------------------
   211     0007                     
   212                           ;----- CM3CON1 Bits -----------------------------------------------------
   213     0007                     
   214                           ;----- ANSELA Bits -----------------------------------------------------
   215     0005                     
   216                           ;----- ANSELE Bits -----------------------------------------------------
   217     0002                     
   218                           ;----- EECON1 Bits -----------------------------------------------------
   219     0007                     
   220                           ;----- RC1STA Bits -----------------------------------------------------
   221     0007                     
   222                           ;----- RCSTA Bits -----------------------------------------------------
   223     0007                     
   224                           ;----- TX1STA Bits -----------------------------------------------------
   225     0007                     
   226                           ;----- TXSTA Bits -----------------------------------------------------
   227     0007                     
   228                           ;----- BAUD1CON Bits -----------------------------------------------------
   229     0007                     
   230                           ;----- WPUB Bits -----------------------------------------------------
   231     0007                     
   232                           ;----- SSP1STAT Bits -----------------------------------------------------
   233     0007                     
   234                           ;----- SSPSTAT Bits -----------------------------------------------------
   235     0007                     
   236                           ;----- SSP1CON1 Bits -----------------------------------------------------
   237     0007                     
   238                           ;----- SSPCON Bits -----------------------------------------------------
   239     0007                     
   240                           ;----- SSPCON1 Bits -----------------------------------------------------
   241     0007                     
   242                           ;----- SSP1CON2 Bits -----------------------------------------------------
   243     0007                     
   244                           ;----- SSPCON2 Bits -----------------------------------------------------
   245     0007                     
   246                           ;----- SSP1CON3 Bits -----------------------------------------------------
   247     0007                     
   248                           ;----- SSPCON3 Bits -----------------------------------------------------
   249     0007                     
   250                           ;----- SSP2STAT Bits -----------------------------------------------------
   251     0007                     
   252                           ;----- SSP2CON1 Bits -----------------------------------------------------
   253     0007                     
   254                           ;----- SSP2CON2 Bits -----------------------------------------------------
   255     0007                     
   256                           ;----- SSP2CON3 Bits -----------------------------------------------------
   257     0007                     
   258                           ;----- PORTF Bits -----------------------------------------------------
   259     0007                     
   260                           ;----- PORTG Bits -----------------------------------------------------
   261     0004                     
   262                           ;----- CCP1CON Bits -----------------------------------------------------
   263     0007                     
   264                           ;----- PWM1CON Bits -----------------------------------------------------
   265     0007                     
   266                           ;----- CCP1AS Bits -----------------------------------------------------
   267     0007                     
   268                           ;----- ECCP1AS Bits -----------------------------------------------------
   269     0007                     
   270                           ;----- PSTR1CON Bits -----------------------------------------------------
   271     0004                     
   272                           ;----- CCP2CON Bits -----------------------------------------------------
   273     0007                     
   274                           ;----- PWM2CON Bits -----------------------------------------------------
   275     0007                     
   276                           ;----- CCP2AS Bits -----------------------------------------------------
   277     0007                     
   278                           ;----- ECCP2AS Bits -----------------------------------------------------
   279     0007                     
   280                           ;----- PSTR2CON Bits -----------------------------------------------------
   281     0004                     
   282                           ;----- CCPTMRS0 Bits -----------------------------------------------------
   283     0007                     
   284                           ;----- CCPTMRS1 Bits -----------------------------------------------------
   285     0001                     
   286                           ;----- TRISF Bits -----------------------------------------------------
   287     0007                     
   288                           ;----- TRISG Bits -----------------------------------------------------
   289     0005                     
   290                           ;----- CCP3CON Bits -----------------------------------------------------
   291     0007                     
   292                           ;----- PWM3CON Bits -----------------------------------------------------
   293     0007                     
   294                           ;----- CCP3AS Bits -----------------------------------------------------
   295     0007                     
   296                           ;----- ECCP3AS Bits -----------------------------------------------------
   297     0007                     
   298                           ;----- PSTR3CON Bits -----------------------------------------------------
   299     0004                     
   300                           ;----- CCP4CON Bits -----------------------------------------------------
   301     0005                     
   302                           ;----- CCP5CON Bits -----------------------------------------------------
   303     0005                     
   304                           ;----- LATF Bits -----------------------------------------------------
   305     0007                     
   306                           ;----- LATG Bits -----------------------------------------------------
   307     0005                     
   308                           ;----- IOCBP Bits -----------------------------------------------------
   309     0007                     
   310                           ;----- IOCBN Bits -----------------------------------------------------
   311     0007                     
   312                           ;----- IOCBF Bits -----------------------------------------------------
   313     0007                     
   314                           ;----- ANSELF Bits -----------------------------------------------------
   315     0007                     
   316                           ;----- ANSELG Bits -----------------------------------------------------
   317     0004                     
   318                           ;----- T4CON Bits -----------------------------------------------------
   319     0006                     
   320                           ;----- T6CON Bits -----------------------------------------------------
   321     0006                     
   322                           ;----- WPUG Bits -----------------------------------------------------
   323     0005                     
   324                           ;----- RC2STA Bits -----------------------------------------------------
   325     0007                     
   326                           ;----- TX2STA Bits -----------------------------------------------------
   327     0007                     
   328                           ;----- BAUD2CON Bits -----------------------------------------------------
   329     0007                     
   330                           ;----- LCDCON Bits -----------------------------------------------------
   331     0007                     
   332                           ;----- LCDPS Bits -----------------------------------------------------
   333     0007                     
   334                           ;----- LCDREF Bits -----------------------------------------------------
   335     0007                     
   336                           ;----- LCDCST Bits -----------------------------------------------------
   337     0002                     
   338                           ;----- LCDRL Bits -----------------------------------------------------
   339     0007                     
   340                           ;----- LCDSE0 Bits -----------------------------------------------------
   341     0007                     
   342                           ;----- LCDSE1 Bits -----------------------------------------------------
   343     0007                     
   344                           ;----- LCDSE2 Bits -----------------------------------------------------
   345     0007                     
   346                           ;----- LCDSE3 Bits -----------------------------------------------------
   347     0007                     
   348                           ;----- LCDSE4 Bits -----------------------------------------------------
   349     0007                     
   350                           ;----- LCDSE5 Bits -----------------------------------------------------
   351     0005                     
   352                           ;----- LCDDATA0 Bits -----------------------------------------------------
   353     0007                     
   354                           ;----- LCDDATA1 Bits -----------------------------------------------------
   355     0007                     
   356                           ;----- LCDDATA2 Bits -----------------------------------------------------
   357     0007                     
   358                           ;----- LCDDATA3 Bits -----------------------------------------------------
   359     0007                     
   360                           ;----- LCDDATA4 Bits -----------------------------------------------------
   361     0007                     
   362                           ;----- LCDDATA5 Bits -----------------------------------------------------
   363     0007                     
   364                           ;----- LCDDATA6 Bits -----------------------------------------------------
   365     0007                     
   366                           ;----- LCDDATA7 Bits -----------------------------------------------------
   367     0007                     
   368                           ;----- LCDDATA8 Bits -----------------------------------------------------
   369     0007                     
   370                           ;----- LCDDATA9 Bits -----------------------------------------------------
   371     0007                     
   372                           ;----- LCDDATA10 Bits -----------------------------------------------------
   373     0007                     
   374                           ;----- LCDDATA11 Bits -----------------------------------------------------
   375     0007                     
   376                           ;----- LCDDATA12 Bits -----------------------------------------------------
   377     0007                     
   378                           ;----- LCDDATA13 Bits -----------------------------------------------------
   379     0007                     
   380                           ;----- LCDDATA14 Bits -----------------------------------------------------
   381     0005                     
   382                           ;----- LCDDATA15 Bits -----------------------------------------------------
   383     0007                     
   384                           ;----- LCDDATA16 Bits -----------------------------------------------------
   385     0007                     
   386                           ;----- LCDDATA17 Bits -----------------------------------------------------
   387     0005                     
   388                           ;----- LCDDATA18 Bits -----------------------------------------------------
   389     0007                     
   390                           ;----- LCDDATA19 Bits -----------------------------------------------------
   391     0007                     
   392                           ;----- LCDDATA20 Bits -----------------------------------------------------
   393     0005                     
   394                           ;----- LCDDATA21 Bits -----------------------------------------------------
   395     0007                     
   396                           ;----- LCDDATA22 Bits -----------------------------------------------------
   397     0007                     
   398                           ;----- LCDDATA23 Bits -----------------------------------------------------
   399     0005                     
   400                           ;----- STATUS_SHAD Bits -----------------------------------------------------
   401     0002                     
   402                           	psect	edata
   403                           
   404                           ;==========================================================================
   405                           ;
   406                           ; Configuration Bits
   407                           ;
   408                           ; NAME Address
   409                           ; CONFIG1 8007h
   410                           ; CONFIG2 8008h
   411                           ;
   412                           ;==========================================================================
   413                           ;========================================================
   414                           ;================ Project Information ===================
   415                           ;========================================================
   416                           ;Pin Assignment :
   417                           ;Project Name :
   418                           ;Project Version: V2.00 (Bate00)
   419                           ;Project object :
   420                           ;Project number :
   421                           ;Edit Date : 2023/04/18
   422                           ;--------------------------------------------------------
   423                           ;========================================================
   424                           ;========================================================
   425                           ;INCLUDE TITLE
   426                           ;========================================================
   427                           ;================ Project Information ===================
   428                           ;========================================================
   429                           ;Project Name : MODBUS RTU BASE
   430                           ;-------------------------------------------------------
   431                           ;Project Version: 2.00
   432                           ;Edit Date : 2023/09/28
   433                           ;Function Info :
   434                           ;-------------------------------------------------------
   435                           ;Description of Register Informatione (use FSR)
   436                           ;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
   437                           ;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
   438                           ;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
   439                           ;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
   440                           ;MODBUS_DAT_BUF_ADRL+4 : CRC counter
   441                           ;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
   442                           ;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
   443                           ;MODBUS_DAT_BUF_ADRL+7 : time out count
   444                           ;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG
   445                           ;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
   446                           ;-------------------------------------------------------
   447                           ;-------------------------------------------------------
   448                           ;-------------------------------------------------------
   449                           ;須被定義的部分
   450     0003                     
   451                           ;-------------------------------------------------------
   452     00B0                     
   453                           ;========================================================
   454                           ;========================================================
   455     0074                     
   456                           ;-------------------------------------------------------
   457     038C                     
   458                           ;-------------------------------------------------------
   459                           ;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
   460     00B0                     	;存放從485送進來的資料
   461     0040                     	;將485送的資料複製出來，之後的判斷都使用這個地方
   462                           
   463                           ;這邊主要是因為有4個馬達，可以直接選擇要使用哪個資料
   464                           ;注射泵2.00來說，轉向馬達是MOTOR1 活塞馬達是MOTOR2
   465     0090                     
   466                           ;MOTOR1 0X2190-0X21AF
   467                           ;CW:4BYTE
   468                           ;CCW:4BYTE
   469                           ;-----------------------------------------------
   470                           ;MOTOR2 0X21B0-0X21CF
   471                           ;MOTOR3 0X21D0-0X21EF
   472                           ;MOTOR4 0X21F0-0X220F
   473                           ;0X21 0X40-0X21 0X54 MOTOR1
   474                           ;0X21 0X55-0X21 0X69 MOTOR2
   475                           ;0X21 0X6A-0X21 0X7E MOTOR3
   476                           ;0X21 0X7F-0X21 0X93 MOTOR4
   477                           ;-------------------------------------------------------
   478                           ;--------------------------------------------------------
   479                           ;WATCH用的暫存器設定
   480     0006                     
   481                           ;--------------------------------------------------------
   482                           ;--------------------------------------------------------
   483                           ;mcu腳位定義
   484                           ;Pin assignment definition
   485     0003                     	;0->往光遮端方向 1->反方向
   486     0005                     	;0->表示電源沒有進入 1->表示有電源
   487     0002                     
   488                           ;--------------------------------------------------------
   489                           ;--------------------------------------------------------
   490                           ;========================================================
   491                           ;==================== 0X20 ~ 0X2F =======================
   492                           ;========================================================
   493                           ;Register definition
   494     002A                     	;用來計算MODBUS RTU
   495     002D                     	;整理UART TX傳送的資料數量
   496     002F                     
   497                           ;========================================================
   498                           ;==================== 0X30 ~ 0X3F =======================
   499                           ;========================================================
   500                           ;Register definition
   501                           ;--------------------------------------
   502     0000                     	;可以回傳資料FLAG
   503     0001                     	;表示目前馬達可以動作
   504     0002                     	;RX資料有錯誤
   505     0003                     	;強制命令執行後SET
   506     0004                     	;表示INT地一次觸發啟動INT_TIMER功能
   507                           
   508                           ;--------------------------------------------------------
   509                           ;馬達1為轉向馬達(目前使用在注射泵)
   510     0001                     	;馬達1收到指令可以進行運作
   511     0002                     	;馬達1順時針
   512     0003                     	;馬達1逆時針
   513     0038                     
   514                           ;--------------------------------------------------------馬達參數設定
   515     0039                     	;在通訊判斷使用哪個馬達的情況下使用
   516     0003                     
   517                           ;--------------------------------------------------------
   518     0004                     	;CMD 0X83全部停止動作
   519                           
   520                           ;--------------------------------------------------------
   521     0001                     	;0表示沒有在功能碼03/1表示有在
   522     0002                     	;0表示沒有在功能碼06/1表示有在
   523     003D                     	;FLAG6_BANK0，為MODBUS動作前FLAG
   524     0000                     	;恢復出廠設定
   525     0001                     	;整機初始化
   526     0002                     	;換向閥初始化
   527     0003                     	;活塞初始化
   528     0004                     	;進入醒目提示_F
   529     0000                     	;未初始化
   530     0001                     	;設備在線
   531     0002                     	;安全模式
   532     0003                     	;設備異常
   533     0004                     	;醒目提示
   534                           
   535                           ; 0X3F
   536                           ;========================================================
   537                           ;==================== 0X40 ~ 0X4F =======================
   538                           ;========================================================
   539                           ;Register definition
   540     0040                     	;每次一個PWM就+1
   541     0041                     	;每次一個PWM就+1
   542     0045                     
   543                           ;-----------------------------------------------
   544     004D                     	;用來暫存MODBUS中運算的資料
   545     00A0                     
   546                           ;--------------------------------------------------------------
   547                           ;------------------------BANK7參數設定-------------------------
   548                           ;--------------------------------------------------------------
   549     00A9                     
   550                           	psect	main
   551     0000                     	org	0
   552     0000  2805               	goto	BOOTLOADER_LOOP
   553     0004                     	org	4
   554     0004  2806               	goto	INTERRUPT_SUB_AREA
   555     0005                     BOOTLOADER_LOOP:	
   556                           ;* ****************************************************************************************
   557                           ;* Label Start
   558                           ;*
   559                           ;========================================================
   560                           ;================== BOOTLOADER副程式 ====================
   561                           ;========================================================
   562                           
   563     0005  29F7               	goto	SYSTEM_START_SETTING
   564     0006                     INTERRUPT_SUB_AREA:	
   565                           ;========================================================
   566                           ;================== 中斷副程式起始位址 ==================
   567                           ;========================================================
   568                           
   569     0006  3180               	pagesel	0
   570     0007  0020               	banksel	12
   571                           
   572                           ;--------------------------
   573     0008  1A94               	btfsc	20,5
   574     0009  2988               	goto	RC2IF_FUNCTION_LOOP	;硬體UART2收資料
   575                           
   576                           ;--------------------------
   577     000A  1891               	btfsc	17,1
   578     000B  298C               	goto	TMR2IF_FUNCTION_LOOP	;TIMER2基準為1mS
   579                           
   580                           ;--------------------------
   581                           ; BTFSC INTCON,INTF
   582                           ; GOTO INT_INTF_FUNCTION ;PWM INT
   583 ;;-----------
   584                           ; BTFSC INTCON,IOCIF
   585                           ; GOTO IOC_INT_FUNCTION ;光遮斷器觸發
   586     000C  0009               	retfie
   587     000D                     MODBUS_ADR_FUNCTION:	
   588                           ;******************************************************************************
   589                           ;****************************TABLE表區域***************************************
   590                           ;******************************************************************************
   591                           ;========================================================
   592                           ;==================中斷UART2 FUNCTION====================
   593                           ;========================================================
   594                           
   595     000D  3000               	movlw	0
   596     000E  008A               	movwf	10
   597     000F  084A               	movf	74,w
   598     0010  000B               	brw
   599     0011  2861               	goto	MODBUS_ADR_A0_FUNCTION	;00
   600     0012  2878               	goto	MODBUS_ADR_A1_FUNCTION	;01
   601     0013  288E               	goto	MODBUS_ADR_A2_FUNCTION	;02
   602     0014  28A4               	goto	MODBUS_ADR_A3_FUNCTION	;03
   603     0015  28BA               	goto	MODBUS_ADR_A4_FUNCTION	;04
   604     0016  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;05
   605     0017  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;06
   606     0018  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;07
   607     0019  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;08
   608     001A  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;09
   609     001B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0A
   610     001C  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0B
   611     001D  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0C
   612     001E  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0D
   613     001F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0E
   614     0020  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;0F
   615                           
   616                           ;-----------------------------
   617     0021  28D1               	goto	MODBUS_ADR_B0_FUNCTION	;10
   618     0022  28F3               	goto	MODBUS_ADR_B1_FUNCTION	;11
   619     0023  28F3               	goto	MODBUS_ADR_B2_FUNCTION	;12
   620     0024  28F3               	goto	MODBUS_ADR_B3_FUNCTION	;13
   621     0025  28F3               	goto	MODBUS_ADR_B4_FUNCTION	;14
   622     0026  28F3               	goto	MODBUS_ADR_B5_FUNCTION	;15
   623     0027  28F3               	goto	MODBUS_ADR_B6_FUNCTION	;16
   624     0028  28F3               	goto	MODBUS_ADR_B7_FUNCTION	;17
   625     0029  28F3               	goto	MODBUS_ADR_B8_FUNCTION	;18
   626     002A  28F3               	goto	MODBUS_ADR_B9_FUNCTION	;19
   627     002B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1A
   628     002C  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1B
   629     002D  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1C
   630     002E  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1D
   631     002F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1E
   632     0030  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;1F
   633                           
   634                           ;-----------------------------
   635     0031  28F3               	goto	MODBUS_ADR_C0_FUNCTION	;20
   636     0032  28F3               	goto	MODBUS_ADR_C1_FUNCTION	;21
   637     0033  28F3               	goto	MODBUS_ADR_C2_FUNCTION	;22
   638     0034  28F3               	goto	MODBUS_ADR_C3_FUNCTION	;23
   639     0035  28F3               	goto	MODBUS_ADR_C4_FUNCTION	;24
   640     0036  28F3               	goto	MODBUS_ADR_C5_FUNCTION	;25
   641     0037  28F3               	goto	MODBUS_ADR_C6_FUNCTION	;26
   642     0038  28F3               	goto	MODBUS_ADR_C7_FUNCTION	;27
   643     0039  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;28
   644     003A  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;29
   645     003B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2A
   646     003C  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2B
   647     003D  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2C
   648     003E  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2D
   649     003F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2E
   650     0040  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;2F
   651                           
   652                           ;-----------------------------
   653     0041  28F3               	goto	MODBUS_ADR_D0_FUNCTION	;30
   654     0042  28F3               	goto	MODBUS_ADR_D1_FUNCTION	;31
   655     0043  28F3               	goto	MODBUS_ADR_D2_FUNCTION	;32
   656     0044  28F3               	goto	MODBUS_ADR_D3_FUNCTION	;33
   657     0045  28F3               	goto	MODBUS_ADR_D4_FUNCTION	;34
   658     0046  28F3               	goto	MODBUS_ADR_D5_FUNCTION	;35
   659     0047  28F3               	goto	MODBUS_ADR_D6_FUNCTION	;36
   660     0048  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;37
   661     0049  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;38
   662     004A  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;39
   663     004B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3A
   664     004C  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3B
   665     004D  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3C
   666     004E  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3D
   667     004F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3E
   668     0050  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;3F
   669                           
   670                           ;-----------------------------
   671     0051  28F3               	goto	MODBUS_ADR_E0_FUNCTION	;40
   672     0052  28F3               	goto	MODBUS_ADR_E1_FUNCTION	;41
   673     0053  28F3               	goto	MODBUS_ADR_E2_FUNCTION	;42
   674     0054  28F3               	goto	MODBUS_ADR_E3_FUNCTION	;43
   675     0055  28F3               	goto	MODBUS_ADR_E4_FUNCTION	;44
   676     0056  28F3               	goto	MODBUS_ADR_E5_FUNCTION	;45
   677     0057  28F3               	goto	MODBUS_ADR_E6_FUNCTION	;46
   678     0058  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;47
   679     0059  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;48
   680     005A  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;49
   681     005B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4A
   682     005C  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4B
   683     005D  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4C
   684     005E  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4D
   685     005F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4E
   686     0060  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;4F
   687     0061                     MODBUS_ADR_A0_FUNCTION:	
   688                           ;-----------------------------
   689                           ;******************************************************************
   690                           ;******************************************************************
   691                           ;========================================================
   692                           ;==================MODBUS 恢復出廠設定===================
   693                           ;========================================================
   694                           
   695     0061  18BC               	btfsc	60,1
   696     0062  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   697                           
   698                           ;--------------------------------
   699     0063  1D3C               	btfss	60,2
   700     0064  2938               	goto	MODBUS_BUS_01_ERROR_LOOP	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
   701                           
   702                           ;--------------------------------
   703                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   704     0065  0020               	banksel	12
   705     0066  3021               	movlw	33	;21
   706     0067  0087               	movwf	7
   707     0068  3040               	movlw	64	;E0
   708     0069  0086               	movwf	6
   709     006A  3004               	movlw	4
   710     006B  0786               	addwf	6,f
   711     006C  0801               	movf	1,w
   712     006D  1D03               	btfss	3,2
   713     006E  2873               	goto	MODBUS_ADR_A0_LV1	;資料不為0
   714                           
   715                           ;-----------------------
   716     006F  0A86               	incf	6,f
   717     0070  0801               	movf	1,w
   718     0071  1903               	btfsc	3,2
   719     0072  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00表示異常
   720     0073                     MODBUS_ADR_A0_LV1:
   721                           
   722                           ;將所有參數設定為預設值
   723                           ;直接設定TX輸出暫存器就直接使用RX陣列
   724     0073  1430               	bsf	48,0
   725     0074  3008               	movlw	8
   726     0075  00AD               	movwf	45
   727                           
   728                           ;------------------------------------------
   729                           ;實際要做的事:
   730     0076  143D               	bsf	61,0
   731     0077  0009               	retfie
   732     0078                     MODBUS_ADR_A1_FUNCTION:	
   733                           ;========================================================
   734                           ;==================MODBUS 整機初始化=====================
   735                           ;========================================================
   736                           
   737     0078  18BC               	btfsc	60,1
   738     0079  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   739                           
   740                           ;--------------------------------
   741     007A  1D3C               	btfss	60,2
   742     007B  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;如果功能碼不是06表示異常
   743                           
   744                           ;--------------------------------
   745                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   746     007C  0020               	banksel	12
   747     007D  3021               	movlw	33	;21
   748     007E  0087               	movwf	7
   749     007F  3040               	movlw	64	;E0
   750     0080  0086               	movwf	6
   751     0081  3004               	movlw	4
   752     0082  0786               	addwf	6,f
   753     0083  0801               	movf	1,w
   754     0084  1D03               	btfss	3,2
   755     0085  288A               	goto	MODBUS_ADR_A1_LV1	;資料不為0
   756                           
   757                           ;-----------------------
   758     0086  0A86               	incf	6,f
   759     0087  0801               	movf	1,w
   760     0088  1903               	btfsc	3,2
   761     0089  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   762     008A                     MODBUS_ADR_A1_LV1:
   763                           
   764                           ;將所有參數設定為預設值
   765     008A  1430               	bsf	48,0
   766     008B  3008               	movlw	8
   767     008C  00AD               	movwf	45
   768                           
   769                           ;------------------------------------------
   770                           ;實際要做的事:
   771     008D  0009               	retfie
   772     008E                     MODBUS_ADR_A2_FUNCTION:	
   773                           ;========================================================
   774                           ;==================MODBUS 換向閥初始化===================
   775                           ;========================================================
   776                           
   777     008E  18BC               	btfsc	60,1
   778     008F  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   779                           
   780                           ;--------------------------------
   781     0090  1D3C               	btfss	60,2
   782     0091  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   783                           
   784                           ;--------------------------------
   785                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   786     0092  0020               	banksel	12
   787     0093  3021               	movlw	33	;21
   788     0094  0087               	movwf	7
   789     0095  3040               	movlw	64	;E0
   790     0096  0086               	movwf	6
   791     0097  3004               	movlw	4
   792     0098  0786               	addwf	6,f
   793     0099  0801               	movf	1,w
   794     009A  1D03               	btfss	3,2
   795     009B  28A0               	goto	MODBUS_ADR_A2_LV1
   796                           
   797                           ;-----------------------
   798     009C  0A86               	incf	6,f
   799     009D  0801               	movf	1,w
   800     009E  1903               	btfsc	3,2
   801     009F  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   802     00A0                     MODBUS_ADR_A2_LV1:
   803                           
   804                           ;將所有參數設定為預設值
   805     00A0  1430               	bsf	48,0
   806     00A1  3008               	movlw	8
   807     00A2  00AD               	movwf	45
   808                           
   809                           ;------------------------------------------
   810                           ;實際要做的事:
   811     00A3  0009               	retfie
   812     00A4                     MODBUS_ADR_A3_FUNCTION:	
   813                           ;========================================================
   814                           ;==================MODBUS 活塞初始化=====================
   815                           ;========================================================
   816                           
   817     00A4  18BC               	btfsc	60,1
   818     00A5  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   819                           
   820                           ;--------------------------------
   821     00A6  1D3C               	btfss	60,2
   822     00A7  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   823                           
   824                           ;--------------------------------
   825                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   826     00A8  0020               	banksel	12
   827     00A9  3021               	movlw	33	;21
   828     00AA  0087               	movwf	7
   829     00AB  3040               	movlw	64	;E0
   830     00AC  0086               	movwf	6
   831     00AD  3004               	movlw	4
   832     00AE  0786               	addwf	6,f
   833     00AF  0801               	movf	1,w
   834     00B0  1D03               	btfss	3,2
   835     00B1  28B6               	goto	MODBUS_ADR_A3_LV1
   836                           
   837                           ;-----------------------
   838     00B2  0A86               	incf	6,f
   839     00B3  0801               	movf	1,w
   840     00B4  1903               	btfsc	3,2
   841     00B5  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   842     00B6                     MODBUS_ADR_A3_LV1:
   843                           
   844                           ;將所有參數設定為預設值
   845     00B6  1430               	bsf	48,0
   846     00B7  3008               	movlw	8
   847     00B8  00AD               	movwf	45
   848                           
   849                           ;------------------------------------------
   850                           ;實際要做的事:
   851     00B9  0009               	retfie
   852     00BA                     MODBUS_ADR_A4_FUNCTION:	
   853                           ;========================================================
   854                           ;==================MODBUS 醒目提示=======================
   855                           ;========================================================
   856                           
   857     00BA  18BC               	btfsc	60,1
   858     00BB  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   859                           
   860                           ;--------------------------------
   861     00BC  1D3C               	btfss	60,2
   862     00BD  293A               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   863                           
   864                           ;--------------------------------
   865                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   866     00BE  0020               	banksel	12
   867     00BF  3021               	movlw	33	;21
   868     00C0  0087               	movwf	7
   869     00C1  3040               	movlw	64	;E0
   870     00C2  0086               	movwf	6
   871     00C3  3004               	movlw	4
   872     00C4  0786               	addwf	6,f
   873     00C5  0801               	movf	1,w
   874     00C6  1D03               	btfss	3,2
   875     00C7  293C               	goto	MODBUS_BUS_03_ERROR_LOOP
   876                           
   877                           ;-----------------------
   878     00C8  0A86               	incf	6,f
   879     00C9  3001               	movlw	1
   880     00CA  0601               	xorwf	1,w
   881     00CB  1D03               	btfss	3,2
   882     00CC  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   883     00CD                     MODBUS_ADR_A4_LV1:
   884                           
   885                           ;將所有參數設定為預設值
   886     00CD  1430               	bsf	48,0
   887     00CE  3008               	movlw	8
   888     00CF  00AD               	movwf	45
   889                           
   890                           ;------------------------------------------
   891                           ;實際要做的事:
   892     00D0  0009               	retfie
   893     00D1                     MODBUS_ADR_B0_FUNCTION:	
   894                           ;========================================================
   895                           ;==================MODBUS 閥換向=========================
   896                           ;========================================================
   897                           
   898     00D1  18BC               	btfsc	60,1
   899     00D2  28F2               	goto	MODBUS_ADR_B0_03_LOOP	;ADR 為閥換向，使用READ 1 BYTE 功能碼
   900                           
   901                           ;--------------------------------
   902     00D3  1D3C               	btfss	60,2
   903     00D4  28D7               	goto	MODBUS_ADR_B0_06_LOOP	;ADR 為閥換向，使用WRITE 1 BYTE 功能碼
   904                           
   905                           ;--------------------------------
   906     00D5  2938               	goto	MODBUS_BUS_01_ERROR_LOOP	;表示功能碼都不是
   907     00D6  0009               	retfie
   908     00D7                     MODBUS_ADR_B0_06_LOOP:	
   909                           ;-----------------------------------------------------------
   910                           ;--------------------MODBUS B0 寫1BYTE----------------------
   911                           ;-----------------------------------------------------------
   912                           
   913                           
   914                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   915     00D7  0020               	banksel	12
   916     00D8  3021               	movlw	33	;21
   917     00D9  0087               	movwf	7
   918     00DA  3040               	movlw	64	;E0
   919     00DB  0086               	movwf	6
   920     00DC  3004               	movlw	4
   921     00DD  0786               	addwf	6,f
   922     00DE  0801               	movf	1,w
   923     00DF  1D03               	btfss	3,2
   924     00E0  293C               	goto	MODBUS_BUS_03_ERROR_LOOP
   925                           
   926                           ;-----------------------
   927     00E1  0A86               	incf	6,f
   928     00E2  30FE               	movlw	254
   929     00E3  0701               	addwf	1,w
   930     00E4  1803               	btfsc	3,0
   931     00E5  293C               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料不是0X00就是0X01，超過範圍就算是異常碼03
   932                           
   933                           ;------------------------
   934                           ;資料範圍正確，將資料存放到相應的馬達模組存放資料地方，並回覆485
   935     00E6  3021               	movlw	33
   936     00E7  0085               	movwf	5
   937     00E8  3090               	movlw	144
   938     00E9  0084               	movwf	4
   939     00EA  3004               	movlw	4
   940     00EB  0784               	addwf	4,f
   941     00EC  0801               	movf	1,w
   942     00ED  0080               	movwf	0
   943                           
   944                           ;------------------------
   945     00EE  1430               	bsf	48,0
   946     00EF  3008               	movlw	8
   947     00F0  00AD               	movwf	45
   948     00F1  0009               	retfie
   949     00F2                     MODBUS_ADR_B0_03_LOOP:	
   950                           ;-----------------------------------------------------------
   951                           ;--------------------MODBUS B0 讀1BYTE----------------------
   952                           ;-----------------------------------------------------------
   953                           
   954                           
   955                           ;設定好要讀取的位置之後用485功能碼0X03就可以了
   956                           ; MOVLW MODBUS_DAT_REAL_ADRH
   957                           ; MOVWF FSR0H
   958                           ; MOVLW MODBUS_DAT_REAL_ADRL
   959                           ; MOVWF FSR0L
   960     00F2  0009               	retfie
   961     00F3                     MODBUS_ADR_B1_FUNCTION:	
   962                           ;========================================================
   963                           ;==================MODBUS 活塞移動-絕對位置==============
   964                           ;========================================================
   965                           ;這邊的資料主要是4個BYTE，所以要執行動作的話，需要等到ADR_B2被寫入才會動作
   966                           
   967     00F3                     MODBUS_ADR_B2_FUNCTION:
   968     00F3                     MODBUS_ADR_B3_FUNCTION:	
   969                           ;========================================================
   970                           ;==================MODBUS 活塞移動-相對位置==============
   971                           ;========================================================
   972                           
   973     00F3                     MODBUS_ADR_B4_FUNCTION:
   974     00F3                     MODBUS_ADR_B5_FUNCTION:	
   975                           ;========================================================
   976                           ;==================MODBUS 活塞移動-向量-CW===============
   977                           ;========================================================
   978                           
   979     00F3                     MODBUS_ADR_B6_FUNCTION:
   980     00F3                     MODBUS_ADR_B7_FUNCTION:	
   981                           ;========================================================
   982                           ;==================MODBUS 活塞移動-向量-CCW==============
   983                           ;========================================================
   984                           
   985     00F3                     MODBUS_ADR_B8_FUNCTION:
   986     00F3                     MODBUS_ADR_B9_FUNCTION:	
   987                           ;========================================================
   988                           ;==================MODBUS 活塞移動-極限==================
   989                           ;========================================================
   990                           
   991     00F3                     MODBUS_ADR_C0_FUNCTION:	
   992                           ;========================================================
   993                           ;==================MODBUS 零點偏移量設定=================
   994                           ;========================================================
   995                           
   996     00F3                     MODBUS_ADR_C1_FUNCTION:	
   997                           ;========================================================
   998                           ;==================MODBUS 累計步數=======================
   999                           ;========================================================
  1000                           
  1001     00F3                     MODBUS_ADR_C2_FUNCTION:
  1002     00F3                     MODBUS_ADR_C3_FUNCTION:	
  1003                           ;========================================================
  1004                           ;==================MODBUS 相對零點設定===================
  1005                           ;========================================================
  1006                           
  1007     00F3                     MODBUS_ADR_C4_FUNCTION:
  1008     00F3                     MODBUS_ADR_C5_FUNCTION:	
  1009                           ;========================================================
  1010                           ;==================MODBUS 反向間隙設定-CW===============
  1011                           ;========================================================
  1012                           
  1013     00F3                     MODBUS_ADR_C6_FUNCTION:	
  1014                           ;========================================================
  1015                           ;==================MODBUS 反向間隙設定-CCW==============
  1016                           ;========================================================
  1017                           
  1018     00F3                     MODBUS_ADR_C7_FUNCTION:	
  1019                           ;========================================================
  1020                           ;==================MODBUS 自動校正反向間隙==============
  1021                           ;========================================================
  1022                           
  1023     00F3                     MODBUS_ADR_D0_FUNCTION:	
  1024                           ;========================================================
  1025                           ;==================MODBUS 安全模式======================
  1026                           ;========================================================
  1027                           
  1028     00F3                     MODBUS_ADR_D1_FUNCTION:	
  1029                           ;========================================================
  1030                           ;==================MODBUS 設備狀態======================
  1031                           ;========================================================
  1032                           
  1033     00F3                     MODBUS_ADR_D2_FUNCTION:	
  1034                           ;========================================================
  1035                           ;==================MODBUS 設備辨識資料==================
  1036                           ;========================================================
  1037                           
  1038     00F3                     MODBUS_ADR_D3_FUNCTION:	
  1039                           ;========================================================
  1040                           ;==================MODBUS 溫度檢測======================
  1041                           ;========================================================
  1042                           
  1043     00F3                     MODBUS_ADR_D4_FUNCTION:	
  1044                           ;========================================================
  1045                           ;==================MODBUS 電流檢測======================
  1046                           ;========================================================
  1047                           
  1048     00F3                     MODBUS_ADR_D5_FUNCTION:	
  1049                           ;========================================================
  1050                           ;==================MODBUS 電壓檢測======================
  1051                           ;========================================================
  1052                           
  1053     00F3                     MODBUS_ADR_D6_FUNCTION:	
  1054                           ;========================================================
  1055                           ;==================MODBUS 上電初始化設定================
  1056                           ;========================================================
  1057                           
  1058     00F3                     MODBUS_ADR_E0_FUNCTION:	
  1059                           ;========================================================
  1060                           ;==================MODBUS 開發人員權限啟動==============
  1061                           ;========================================================
  1062                           
  1063     00F3                     MODBUS_ADR_E1_FUNCTION:	
  1064                           ;========================================================
  1065                           ;==================MODBUS 活塞最大行程設定==============
  1066                           ;========================================================
  1067                           
  1068     00F3                     MODBUS_ADR_E2_FUNCTION:
  1069     00F3                     MODBUS_ADR_E3_FUNCTION:	
  1070                           ;========================================================
  1071                           ;==================MODBUS 微步進模式====================
  1072                           ;========================================================
  1073                           
  1074     00F3                     MODBUS_ADR_E4_FUNCTION:	
  1075                           ;========================================================
  1076                           ;==================MODBUS 活塞移動-光耦合===============
  1077                           ;========================================================
  1078                           
  1079     00F3                     MODBUS_ADR_E5_FUNCTION:	
  1080                           ;========================================================
  1081                           ;==================MODBUS 速度設定======================
  1082                           ;========================================================
  1083                           
  1084     00F3                     MODBUS_ADR_E6_FUNCTION:	
  1085                           ;========================================================
  1086                           ;==================MODBUS 速度==========================
  1087                           ;========================================================
  1088                           
  1089     00F3  0009               	retfie
  1090     00F4                     MODBUS_TIMEOUT_IS_FINISH_LOOP:	
  1091                           ;========================================================
  1092                           ;=============MODBUS TIMEOUT到要進行分析的動作===========
  1093                           ;========================================================
  1094                           ;表示TIMEOUT到了，可以進行分析的動作
  1095                           
  1096     00F4  3004               	movlw	4
  1097     00F5  00A3               	movwf	35
  1098     00F6  0029               	banksel	1173
  1099     00F7  1215               	bcf	1173,4	;要進行分析資料前，先把UART RX關閉確保資料不會錯誤
  1100     00F8  0020               	banksel	12
  1101     00F9  3020               	movlw	32	;20B0
  1102     00FA  0087               	movwf	7
  1103     00FB  30B0               	movlw	176
  1104     00FC  0086               	movwf	6
  1105     00FD  3008               	movlw	8	;MODBUS_FLAG
  1106     00FE  0786               	addwf	6,f
  1107     00FF  0181               	clrf	1
  1108                           
  1109                           ;----------------------------------------------------------
  1110     0100  3020               	movlw	32
  1111     0101  0087               	movwf	7
  1112     0102  30B0               	movlw	176
  1113     0103  0086               	movwf	6
  1114     0104  3003               	movlw	3	;MODBUS的DATA OFFSET
  1115     0105  0786               	addwf	6,f
  1116     0106  0801               	movf	1,w
  1117     0107  00AA               	movwf	42	;得到這次MODBUS所有的資料數量
  1118     0108  00AF               	movwf	47
  1119     0109  00C9               	movwf	73
  1120     010A  3002               	movlw	2
  1121     010B  02AA               	subwf	42,f
  1122     010C  0181               	clrf	1
  1123                           
  1124                           ;----------------------------------------------------------
  1125                           ; GOTO CHECK_CRC16_IS_RIGHT ;驗證收到CRC-16是否正確
  1126     010D  2921               	goto	MODBUS_CRC16_CHECK_IS_OK
  1127     010E                     COPY_485_DATA_LOOP:	
  1128                           ;===================================================
  1129                           ;============複製485傳送的資料一份參考參考==========OK
  1130                           ;===================================================
  1131                           
  1132     010E  3020               	movlw	32
  1133     010F  0087               	movwf	7
  1134     0110  30B0               	movlw	176
  1135     0111  0086               	movwf	6
  1136     0112  300A               	movlw	10
  1137     0113  0786               	addwf	6,f
  1138                           
  1139                           ;-------------------------
  1140     0114  3021               	movlw	33
  1141     0115  0085               	movwf	5
  1142     0116  3040               	movlw	64
  1143     0117  0084               	movwf	4
  1144     0118  082F               	movf	47,w
  1145     0119  00AA               	movwf	42	;確認資料總數量
  1146     011A                     COPY_485_DATA_LV1:	
  1147                           ;-------------------------
  1148                           
  1149     011A  0801               	movf	1,w
  1150     011B  0080               	movwf	0
  1151     011C  0A86               	incf	6,f
  1152     011D  0A84               	incf	4,f
  1153     011E  0BAA               	decfsz	42,f
  1154     011F  291A               	goto	COPY_485_DATA_LV1
  1155     0120  0008               	return
  1156     0121                     MODBUS_CRC16_CHECK_IS_OK:	
  1157                           ;===================================================
  1158                           ;============MODBUS的CRC16驗證正確==================OK
  1159                           ;===================================================
  1160                           ;這段的CRC16驗證已經通過了，先把資料做個複製的動作
  1161                           
  1162     0121  210E               	call	COPY_485_DATA_LOOP
  1163     0122  0020               	banksel	12
  1164     0123  3021               	movlw	33	;21
  1165     0124  0087               	movwf	7
  1166     0125  3040               	movlw	64	;E0
  1167     0126  0086               	movwf	6
  1168                           
  1169                           ;----------------------------------------------------------
  1170     0127  0801               	movf	1,w
  1171     0128  0625               	xorwf	37,w
  1172     0129  1D03               	btfss	3,2
  1173     012A  2944               	goto	MODBUS_BUS_ID_ERROR_LOOP
  1174                           
  1175                           ;----------------------------------------------------------表示DEVICE ID 不對
  1176     012B  3008               	movlw	8
  1177     012C  062F               	xorwf	47,w
  1178     012D  1D03               	btfss	3,2
  1179     012E  2944               	goto	MODBUS_BUS_ID_ERROR_LOOP	;當今天收到的資料數量大於8表示異常
  1180                           
  1181                           ;---------------
  1182     012F  0A86               	incf	6,f	;資料為功能碼
  1183     0130  3003               	movlw	3
  1184     0131  0601               	xorwf	1,w
  1185     0132  1903               	btfsc	3,2
  1186     0133  296C               	goto	ANAY_MODBUS_CMD_03_LOOP	;功能碼是READ ONE BYTE
  1187                           
  1188                           ;---------------
  1189     0134  3006               	movlw	6
  1190     0135  0601               	xorwf	1,w
  1191     0136  1903               	btfsc	3,2
  1192     0137  2971               	goto	ANAY_MODBUS_CMD_06_LOOP	;功能碼是WRITE ONE BYTE
  1193     0138                     MODBUS_BUS_01_ERROR_LOOP:	
  1194                           ;目前功能碼只有接0X03 0X06，其他的算是ERROR CODE 0X01
  1195                           ;===================================================
  1196                           ;============MODBUS的功能碼錯誤=====================OK
  1197                           ;===================================================
  1198                           ;MODBUS RTU ERROR CODE 01
  1199                           ;非法功能，表示非授權的功能碼
  1200                           
  1201     0138  143B               	bsf	59,0
  1202     0139  0009               	retfie
  1203     013A                     MODBUS_BUS_02_ERROR_LOOP:	
  1204                           ;----------------------------------------
  1205                           ;MODBUS RTU ERROR CODE 02
  1206                           ;非法暫存器地址
  1207                           
  1208     013A  14BB               	bsf	59,1
  1209     013B  0009               	retfie
  1210     013C                     MODBUS_BUS_03_ERROR_LOOP:	
  1211                           ;----------------------------------------
  1212                           ;MODBUS RTU ERROR CODE 03
  1213                           ;非法資料數值
  1214                           
  1215     013C  153B               	bsf	59,2
  1216     013D  0009               	retfie
  1217     013E                     MODBUS_BUS_04_ERROR_LOOP:	
  1218                           ;----------------------------------------
  1219                           ;MODBUS RTU ERROR CODE 04
  1220                           ;裝置故障，像是自我檢測出現異常
  1221                           
  1222     013E  15BB               	bsf	59,3
  1223     013F  0009               	retfie
  1224     0140                     MODBUS_BUS_05_ERROR_LOOP:	
  1225                           ;----------------------------------------
  1226                           ;MODBUS RTU ERROR CODE 05
  1227                           ;確認，有收到指令並且立即執行
  1228                           
  1229     0140  163B               	bsf	59,4
  1230     0141  0009               	retfie
  1231     0142                     MODBUS_BUS_06_ERROR_LOOP:	
  1232                           ;----------------------------------------
  1233                           ;MODBUS RTU ERROR CODE 06
  1234                           ;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
  1235                           
  1236     0142  16BB               	bsf	59,5
  1237     0143  0009               	retfie
  1238     0144                     MODBUS_BUS_ID_ERROR_LOOP:	
  1239                           ;===================================================
  1240                           ;============MODBUS的ID或是資料數錯誤===============OK
  1241                           ;===================================================
  1242                           ;將RX存放資料的空間清空
  1243                           
  1244     0144  3020               	movlw	32
  1245     0145  0087               	movwf	7
  1246     0146  30B0               	movlw	176
  1247     0147  0086               	movwf	6
  1248     0148  300A               	movlw	10
  1249     0149  0786               	addwf	6,f
  1250     014A                     MODBUS_BUS_ID_ERROR_LV1:
  1251     014A  0181               	clrf	1
  1252     014B  0A86               	incf	6,f
  1253     014C  0BC9               	decfsz	73,f
  1254     014D  294A               	goto	MODBUS_BUS_ID_ERROR_LV1
  1255     014E  0029               	banksel	1173
  1256     014F  1615               	bsf	1173,4	;重新啟動UART RX功能
  1257     0150  0009               	retfie
  1258     0151                     CHECK_CRC16_IS_RIGHT:	
  1259                           ;===================================================
  1260                           ;================驗證CRC16是否正確?=================OK
  1261                           ;===================================================
  1262                           ;這段驗證CRC的時間大約為380uS
  1263                           
  1264     0151  0020               	banksel	12
  1265     0152  30FF               	movlw	255
  1266     0153  00A8               	movwf	40
  1267     0154  30FF               	movlw	255
  1268     0155  00A9               	movwf	41
  1269     0156  3020               	movlw	32	;0X20
  1270     0157  0087               	movwf	7
  1271     0158  30B0               	movlw	176	;0XB0
  1272     0159  0086               	movwf	6
  1273     015A  300A               	movlw	10
  1274     015B  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1275     015C                     CHECK_CRC16_IS_RIGHT_LV1:
  1276     015C  0801               	movf	1,w
  1277     015D  00A7               	movwf	39
  1278     015E  25C4               	call	CRC_16_FUNCTION_LOOP
  1279     015F  0A86               	incf	6,f
  1280     0160  0BAA               	decfsz	42,f
  1281     0161  295C               	goto	CHECK_CRC16_IS_RIGHT_LV1
  1282                           
  1283                           ;----------------------------
  1284     0162  0829               	movf	41,w
  1285     0163  0601               	xorwf	1,w
  1286     0164  1D03               	btfss	3,2
  1287     0165  2944               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
  1288                           
  1289                           ;----------------------------
  1290     0166  0A86               	incf	6,f
  1291     0167  0828               	movf	40,w
  1292     0168  0601               	xorwf	1,w
  1293     0169  1D03               	btfss	3,2
  1294     016A  2944               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
  1295     016B  2921               	goto	MODBUS_CRC16_CHECK_IS_OK	;CRC16驗證正確
  1296     016C                     ANAY_MODBUS_CMD_03_LOOP:	
  1297                           ;========================================================
  1298                           ;=============MODBUS 功能碼為0X03========================
  1299                           ;========================================================
  1300                           ;功能碼:0X03表示要READ
  1301                           ;先確認ADR是否對應的合法
  1302                           
  1303     016C  0020               	banksel	12
  1304     016D  30F9               	movlw	249
  1305     016E  05BC               	andwf	60,f
  1306     016F  14BC               	bsf	60,1
  1307     0170  2975               	goto	ANAY_MODBUS_CMD_COMMON_LOOP
  1308     0171                     ANAY_MODBUS_CMD_06_LOOP:	
  1309                           ;========================================================
  1310                           ;=============MODBUS 功能碼為0X06========================
  1311                           ;========================================================
  1312                           ;功能碼:0X06表示要WRITE
  1313                           ;先確認ADR是否對應的合法
  1314                           
  1315     0171  0020               	banksel	12
  1316     0172  30F9               	movlw	249
  1317     0173  05BC               	andwf	60,f
  1318     0174  153C               	bsf	60,2	;先將MODBUS FLAG重新設定為功能碼06
  1319     0175                     ANAY_MODBUS_CMD_COMMON_LOOP:	
  1320                           ;GOTO ANAY_MODBUS_CMD_COMMON_LOOP
  1321                           
  1322                           
  1323                           ;----------------
  1324     0175  0020               	banksel	12
  1325     0176  3021               	movlw	33	;21
  1326     0177  0087               	movwf	7
  1327     0178  3040               	movlw	64	;E0
  1328     0179  0086               	movwf	6	;這裡是第一筆資料的位置
  1329     017A  3002               	movlw	2	;位置的HBYTE
  1330     017B  0786               	addwf	6,f
  1331                           
  1332                           ;---------------------------------------------------
  1333     017C  0801               	movf	1,w
  1334     017D  00CC               	movwf	76
  1335     017E  0A86               	incf	6,f
  1336     017F  0801               	movf	1,w
  1337     0180  00CD               	movwf	77
  1338                           
  1339                           ;---------------------------------------------------- 將位置資料先複製出來
  1340     0181  30A0               	movlw	160
  1341     0182  02CD               	subwf	77,f
  1342     0183  3000               	movlw	0
  1343     0184  3BCC               	subwfb	76,f
  1344                           
  1345                           ;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
  1346     0185  084D               	movf	77,w
  1347     0186  00CA               	movwf	74
  1348     0187  280D               	goto	MODBUS_ADR_FUNCTION	;MODBUS ADR TABLE
  1349     0188                     RC2IF_FUNCTION_LOOP:	
  1350                           ;---------------------------------------------------------------------------------------------------
      +                          -
  1351                           ;
  1352 ;;------------------------------------------------
  1353                           ; MOVLW 0X09
  1354                           ; XORWF CAL_TEMP_LBYTE,W
  1355                           ; BTFSC STATUS,Z
  1356                           ; GOTO STRONG_STOP_FUNCTION
  1357 ;;------------------------
  1358                           ; MOVLW 0X00
  1359                           ; XORWF CAL_TEMP_LBYTE,W
  1360                           ; BTFSC STATUS,Z
  1361                           ; GOTO CW_STEP_FUNCTION
  1362 ;;------------------------
  1363                           ; MOVLW 0X01
  1364                           ; XORWF CAL_TEMP_LBYTE,W
  1365                           ; BTFSC STATUS,Z
  1366                           ; GOTO CCW_STEP_FUNCTION
  1367 ;;------------------------
  1368                           ; MOVLW 0X04
  1369                           ; XORWF CAL_TEMP_LBYTE,W
  1370                           ; BTFSC STATUS,Z
  1371                           ; GOTO RESET_STEP_FUNCTION
  1372                           ;
  1373 ;;------------------------------------------------
  1374                           ;ANAY_MODBUS_CMD_06_EXIT:
  1375                           ; BCF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1376                           ; BCF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1377                           ; BCF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  1378                           ; BCF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  1379                           ; RETFIE
  1380                           ;
  1381                           ;
  1382                           ;
  1383 ;;-------------------------------------------
  1384 ;;-------------0X80以上的WRITE CMD-----------
  1385 ;;-------------------------------------------
  1386                           ;ANAY_MODBUS_WRITE_0X80_LOOP:
  1387                           ; MOVLW 0X08
  1388                           ; MOVWF TX_DATA_COUNTER
  1389                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
  1390                           ; MOVLW 0X83
  1391                           ; XORWF INDF1,W
  1392                           ; BTFSC STATUS,Z
  1393                           ; CALL COMMON_CMD_0X83_LOOP
  1394                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1395                           ;COMMON_CMD_0X83_LOOP:
  1396                           ; INCF FSR1L,F
  1397                           ; INCF FSR1L,F
  1398                           ; MOVF INDF1,W
  1399                           ; BTFSC STATUS,Z
  1400                           ; GOTO RECOVER_MODULE_LOOP
  1401                           ;BANKSEL BANK7
  1402                           ; MOVLW 0X02
  1403                           ; MOVWF ADR_83_L_DAT
  1404                           ; MOVLW 0X02
  1405                           ; MOVWF ADR_81_L_DAT
  1406                           ;
  1407                           ;
  1408                           ;RECOVER_MODULE_LOOP_LV1:
  1409                           ;BANKSEL MOTOR_CONTROL_PORT
  1410                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  1411                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  1412                           ;BANKSEL PORTA
  1413                           ; BSF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1414                           ; BCF MOTOR2_FLAG0,MOTOR_2_RESET
  1415                           ; BCF MOTOR1_FLAG0,MOTOR_1_RESET
  1416                           ; BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
  1417                           ; BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
  1418                           ; BCF FLAG1_BANK0,CAN_WORK_FLAG
  1419                           ;
  1420                           ; BCF MOTOR2_FLAG0,MOTOR_2_WORK
  1421                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
  1422                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
  1423                           ; BCF FLAG3_BANK0,TEN_TIME_EN
  1424                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  1425                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  1426                           ; BCF MOTOR1_FLAG0,MOTOR_1_WORK
  1427                           ;
  1428                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1429                           ; MOVWF FSR0H
  1430                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1431                           ; MOVWF FSR0L
  1432                           ; MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
  1433                           ; ADDWF FSR0L,F
  1434                           ; MOVLW 0X00
  1435                           ; MOVWF INDF0
  1436                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1437                           ; MOVWF FSR0H
  1438                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1439                           ; MOVWF FSR0L
  1440                           ; MOVLW 0X15
  1441                           ; ADDWF FSR0L,F
  1442                           ; MOVLW 0X07
  1443                           ; ADDWF FSR0L,F
  1444                           ; MOVLW 0X00
  1445                           ; MOVWF INDF0
  1446 ;;---------------------------------------------------------------------------
  1447                           ;
  1448                           ;
  1449                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1450                           ; MOVWF FSR0H
  1451                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1452                           ; MOVWF FSR0L
  1453                           ; CLRF INDF0
  1454                           ; INCF FSR0L,F
  1455 ;;-------------
  1456                           ; CLRF INDF0
  1457                           ; INCF FSR0L,F
  1458 ;;-------------
  1459                           ; CLRF INDF0
  1460                           ; INCF FSR0L,F
  1461 ;;-------------
  1462                           ; CLRF INDF0
  1463                           ; INCF FSR0L,F
  1464 ;;-------------
  1465 ;;=============================================
  1466                           ;
  1467                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1468                           ; MOVWF FSR0H
  1469                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1470                           ; MOVWF FSR0L
  1471                           ; MOVLW 0X15
  1472                           ; ADDWF FSR0L,F
  1473                           ; CLRF INDF0
  1474                           ; INCF FSR0L,F
  1475 ;;-------------
  1476                           ; CLRF INDF0
  1477                           ; INCF FSR0L,F
  1478 ;;-------------
  1479                           ; CLRF INDF0
  1480                           ; INCF FSR0L,F
  1481 ;;-------------
  1482                           ; CLRF INDF0
  1483                           ; INCF FSR0L,F
  1484 ;;-------------
  1485                           ; RETURN
  1486 ;;-----------------------------------------------------
  1487 ;;停止動作
  1488                           ;RECOVER_MODULE_LOOP:
  1489                           ;BANKSEL BANK7
  1490                           ; MOVLW 0X00
  1491                           ; MOVWF ADR_83_L_DAT
  1492                           ; MOVLW 0X00
  1493                           ; MOVWF ADR_81_L_DAT
  1494                           ;BANKSEL PORTA
  1495                           ;CALL RECOVER_MODULE_LOOP_LV1
  1496                           ; BCF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1497                           ; RETURN
  1498                           ;
  1499                           ;
  1500                           ;
  1501                           ;
  1502                           ;
  1503 ;;--------------------------------------------------------------------------
  1504 ;;---------------------------------------------------------------------------
  1505 ;;---------------------------------------------------------------------------
  1506 ;;========================================================
  1507 ;;=============ADDR IS 0X04===============================
  1508 ;;========================================================
  1509                           ;RESET_STEP_FUNCTION:
  1510                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1511                           ; CALL STRONG_RESET_MOTOR_1_FUNC
  1512                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1513                           ; CALL STRONG_RESET_MOTOR_2_FUNC
  1514                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1515                           ;STRONG_RESET_MOTOR_1_FUNC:
  1516                           ;BANKSEL MOTOR_CONTROL_PORT
  1517                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1518                           ;BANKSEL PORTA
  1519                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1520                           ; RETURN
  1521                           ;STRONG_RESET_MOTOR_2_FUNC:
  1522                           ; BSF MOTOR2_FLAG0,MOTOR_2_RESET
  1523                           ; RETURN
  1524                           ;
  1525                           ;
  1526 ;;========================================================
  1527 ;;=============ADDR IS 0X00===============================
  1528 ;;========================================================
  1529                           ;CW_STEP_FUNCTION:
  1530                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1531                           ; CALL STRONG_CW_MOTOR_1_FUNC
  1532                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1533                           ; CALL STRONG_CW_MOTOR_2_FUNC
  1534                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1535                           ;STRONG_CW_MOTOR_1_FUNC:
  1536                           ;BANKSEL MOTOR_CONTROL_PORT
  1537                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1538                           ;BANKSEL PORTA
  1539                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1540                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1541                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1542                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1543                           ; RETURN
  1544                           ;STRONG_CW_MOTOR_2_FUNC:
  1545                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1546                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1547                           ; RETURN
  1548 ;;========================================================
  1549 ;;=============ADDR IS 0X01===============================
  1550 ;;========================================================
  1551                           ;CCW_STEP_FUNCTION:
  1552                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1553                           ; CALL STRONG_CCW_MOTOR_1_FUNC
  1554                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1555                           ; CALL STRONG_CCW_MOTOR_2_FUNC
  1556                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1557                           ;STRONG_CCW_MOTOR_1_FUNC:
  1558                           ;BANKSEL MOTOR_CONTROL_PORT
  1559                           ;BSF MOTOR_CONTROL_PORT,M1_FR
  1560                           ;BANKSEL PORTA
  1561                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1562                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1563                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1564                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1565                           ; RETURN
  1566                           ;STRONG_CCW_MOTOR_2_FUNC:
  1567                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1568                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1569                           ; RETURN
  1570 ;;========================================================
  1571 ;;=============ADDR IS 0X09===============================
  1572 ;;========================================================
  1573                           ;STRONG_STOP_FUNCTION:
  1574                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1575                           ; CALL STRONG_STOP_MOTOR_1_FUNC
  1576                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1577                           ; CALL STRONG_STOP_MOTOR_2_FUNC
  1578 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1579 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1580 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1581 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1582                           ;
  1583                           ;
  1584                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1585                           ;
  1586                           ;STRONG_STOP_MOTOR_1_FUNC:
  1587                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1588                           ; MOVWF FSR0H
  1589                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1590                           ; MOVWF FSR0L
  1591                           ; MOVLW 0X07
  1592                           ; ADDWF FSR0L,F
  1593                           ; MOVLW 0X04
  1594                           ; MOVWF INDF0
  1595 ;;----------
  1596                           ; MOVLW 0X01
  1597                           ; MOVWF STRONG_STOP_TEMP1
  1598                           ;BANKSEL MOTOR_CONTROL_PORT
  1599                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  1600                           ;BANKSEL PORTA
  1601                           ; RETURN
  1602                           ;STRONG_STOP_MOTOR_2_FUNC:
  1603                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1604                           ; MOVWF FSR0H
  1605                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1606                           ; MOVWF FSR0L
  1607                           ; MOVLW 0X15
  1608                           ; ADDWF FSR0L,F
  1609                           ; MOVLW 0X07
  1610                           ; ADDWF FSR0L,F
  1611                           ; MOVLW 0X04
  1612                           ; MOVWF INDF0
  1613 ;;----------
  1614                           ; MOVLW 0X01
  1615                           ; MOVWF STRONG_STOP_TEMP2
  1616                           ;BANKSEL MOTOR_CONTROL_PORT
  1617                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  1618                           ;BANKSEL PORTA
  1619                           ; RETURN
  1620                           ;
  1621                           ;
  1622                           ;
  1623                           ;
  1624                           ;
  1625                           ;
  1626                           ;
  1627 ;;----------------------------------------------------------
  1628                           ;WRITE_MOTOR_1_SOME_DATA:
  1629                           ; BSF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1630                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1631                           ; MOVWF FSR0H
  1632                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1633                           ; MOVWF FSR0L
  1634                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1635                           ;WRITE_MOTOR_2_SOME_DATA:
  1636                           ; BSF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1637                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1638                           ; MOVWF FSR0H
  1639                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1640                           ; MOVWF FSR0L
  1641                           ; MOVLW 0X15
  1642                           ; ADDWF FSR0L,F
  1643                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1644                           ;WRITE_MOTOR_3_SOME_DATA:
  1645                           ; BSF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  1646                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1647                           ; MOVWF FSR0H
  1648                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1649                           ; MOVWF FSR0L
  1650                           ; MOVLW 0X2A
  1651                           ; ADDWF FSR0L,F
  1652                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1653                           ;WRITE_MOTOR_4_SOME_DATA:
  1654                           ; BSF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  1655                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1656                           ; MOVWF FSR0H
  1657                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1658                           ; MOVWF FSR0L
  1659                           ; MOVLW 0X3F
  1660                           ; ADDWF FSR0L,F
  1661                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1662                           ;
  1663                           ;
  1664                           ;
  1665                           ;
  1666                           ;
  1667                           ;
  1668                           ;
  1669                           ;
  1670                           ;
  1671                           ;
  1672                           ;
  1673                           ;
  1674                           ;
  1675                           ;
  1676                           ;
  1677                           ;******************************************************************************
  1678                           ;******************************************************************************
  1679                           ;========================================================
  1680                           ;==================中斷UART2 FUNCTION====================
  1681                           ;========================================================
  1682                           
  1683     0188  3188               	pagesel	2048
  1684     0189  
                 warning: (2090) fixup overflow storing 0xD1F in 2 bytes
                 251F               	call	MODBUS_INTPUT_FUNCTION	;將資料存在INDF1
  1685     018A  3180               	pagesel	0
  1686     018B  0009               	retfie
  1687     018C                     TMR2IF_FUNCTION_LOOP:	
  1688                           ;========================================================
  1689                           ;==================中斷TIMER2 FUNCTION===================
  1690                           ;========================================================
  1691                           ;TIMER2 BASE IS 1mS
  1692                           
  1693     018C  1091               	bcf	17,1
  1694                           
  1695                           ;---------------------
  1696     018D  1CBA               	btfss	58,1
  1697     018E  2993               	goto	TMR2IF_FUNCTION_LV0
  1698     018F  0848               	movf	72,w
  1699     0190  1903               	btfsc	3,2
  1700     0191  21C6               	call	TEN_MS_FUNCTION_LOOP
  1701     0192  03C8               	decf	72,f
  1702     0193                     TMR2IF_FUNCTION_LV0:
  1703     0193  1E30               	btfss	48,4
  1704     0194  2999               	goto	TMR2IF_FUNC_LV1
  1705                           
  1706                           ;---------
  1707     0195  0824               	movf	36,w
  1708     0196  1903               	btfsc	3,2
  1709     0197  29B0               	goto	TIMER2_INT_LV1
  1710     0198  03A4               	decf	36,f
  1711     0199                     TMR2IF_FUNC_LV1:
  1712                           
  1713                           ;判斷是否MODBUS RTU TIMEOUT 要啟動
  1714     0199  3020               	movlw	32
  1715     019A  0087               	movwf	7
  1716     019B  30B0               	movlw	176
  1717     019C  0086               	movwf	6
  1718     019D  3008               	movlw	8
  1719     019E  0786               	addwf	6,f
  1720     019F  1C01               	btfss	1,0
  1721     01A0  0009               	retfie
  1722     01A1  0020               	banksel	12
  1723                           
  1724                           ;-----------------------------------
  1725     01A2  0386               	decf	6,f
  1726     01A3  0801               	movf	1,w
  1727     01A4  1D03               	btfss	3,2
  1728     01A5  29AC               	goto	RESET_MODBUS_TIMEOUT_FUNCTION
  1729                           
  1730                           ;-----------------------------------
  1731     01A6  0020               	banksel	12
  1732     01A7  0823               	movf	35,w
  1733     01A8  1903               	btfsc	3,2
  1734     01A9  28F4               	goto	MODBUS_TIMEOUT_IS_FINISH_LOOP
  1735                           
  1736                           ;----------------------------------=
  1737     01AA  03A3               	decf	35,f
  1738     01AB  0009               	retfie
  1739     01AC                     RESET_MODBUS_TIMEOUT_FUNCTION:	
  1740                           ;-------------------------------------------------------
  1741                           
  1742                           
  1743                           ;表示還是持續有收到資料，TIME OUT 資料重製
  1744     01AC  0181               	clrf	1
  1745     01AD  3004               	movlw	4
  1746     01AE  00A3               	movwf	35
  1747     01AF  0009               	retfie
  1748     01B0                     TIMER2_INT_LV1:	
  1749                           ;------------------------------------------------------
  1750                           ;INT 時間
  1751                           
  1752     01B0  3004               	movlw	4
  1753     01B1  00A4               	movwf	36
  1754     01B2  0AC1               	incf	65,f
  1755     01B3  1230               	bcf	48,4
  1756     01B4  108B               	bcf	11,1
  1757     01B5  160B               	bsf	11,4
  1758     01B6  1EB2               	btfss	50,5
  1759     01B7  0009               	retfie
  1760     01B8  3021               	movlw	33
  1761     01B9  0085               	movwf	5
  1762     01BA  3090               	movlw	144
  1763     01BB  0084               	movwf	4
  1764     01BC  3015               	movlw	21
  1765     01BD  0784               	addwf	4,f
  1766     01BE  3005               	movlw	5
  1767     01BF  0784               	addwf	4,f
  1768     01C0  3001               	movlw	1
  1769     01C1  0280               	subwf	0,f
  1770     01C2  0384               	decf	4,f
  1771     01C3  3000               	movlw	0
  1772     01C4  3B80               	subwfb	0,f
  1773     01C5  0009               	retfie
  1774     01C6                     TEN_MS_FUNCTION_LOOP:
  1775     01C6  3002               	movlw	2
  1776     01C7  00C8               	movwf	72
  1777     01C8  3001               	movlw	1
  1778     01C9  07C7               	addwf	71,f
  1779     01CA  3000               	movlw	0
  1780     01CB  3DC6               	addwfc	70,f
  1781     01CC  0008               	return
  1782     01CD                     IOC_INT_FUNCTION:	
  1783                           ;========================================================
  1784                           ;==================中斷IOC FUNCTION====================
  1785                           ;========================================================
  1786                           
  1787     01CD  100B               	bcf	11,0
  1788     01CE  0027               	banksel	918
  1789     01CF  1896               	btfsc	918,1
  1790     01D0  21D4               	call	IOCBF1_INT_LOOP
  1791                           
  1792                           ;--------
  1793     01D1  1916               	btfsc	918,2
  1794     01D2  21D7               	call	IOCBF2_INT_LOOP
  1795     01D3  0009               	retfie
  1796     01D4                     IOCBF1_INT_LOOP:	
  1797                           ;----------------------------------------------------------
  1798                           
  1799     01D4  1096               	bcf	918,1
  1800     01D5  0027               	banksel	918
  1801     01D6  0008               	return
  1802     01D7                     IOCBF2_INT_LOOP:
  1803     01D7  1116               	bcf	918,2
  1804     01D8  0020               	banksel	12
  1805     01D9  0008               	return
  1806     01DA                     INT_INTF_FUNCTION:	
  1807                           ;========================================================
  1808                           ;==================中斷INT FUNCTION====================
  1809                           ;========================================================
  1810                           
  1811     01DA  108B               	bcf	11,1
  1812     01DB  1A30               	btfsc	48,4
  1813     01DC  0009               	retfie
  1814     01DD  1630               	bsf	48,4
  1815     01DE  120B               	bcf	11,4
  1816     01DF  0009               	retfie
  1817     01E0                     MODBUS_RTU_READ_LV2:	
  1818                           ;========================================================
  1819                           ;=============MODBUS 計算其CRC 功能======================
  1820                           ;========================================================
  1821                           
  1822     01E0  0020               	banksel	12
  1823     01E1  30FF               	movlw	255
  1824     01E2  00A8               	movwf	40
  1825     01E3  30FF               	movlw	255
  1826     01E4  00A9               	movwf	41
  1827                           
  1828                           ;---------
  1829     01E5  3020               	movlw	32
  1830     01E6  0087               	movwf	7
  1831     01E7  30B0               	movlw	176
  1832     01E8  0086               	movwf	6
  1833     01E9  300A               	movlw	10
  1834     01EA  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1835     01EB                     MODBUS_RTU_READ_CRC_LOOP:	
  1836                           ;---------
  1837                           
  1838     01EB  0801               	movf	1,w
  1839     01EC  00A7               	movwf	39
  1840     01ED  25C4               	call	CRC_16_FUNCTION_LOOP
  1841     01EE  0A86               	incf	6,f
  1842     01EF  0BAA               	decfsz	42,f
  1843     01F0  29EB               	goto	MODBUS_RTU_READ_CRC_LOOP
  1844     01F1  0829               	movf	41,w
  1845     01F2  0081               	movwf	1
  1846     01F3  0A86               	incf	6,f
  1847     01F4  0828               	movf	40,w
  1848     01F5  0081               	movwf	1
  1849     01F6  0008               	return
  1850     01F7                     SYSTEM_START_SETTING:	
  1851                           ;========================================================
  1852                           ;================== 主程序前參數設定 ====================
  1853                           ;========================================================
  1854                           
  1855                           
  1856                           ;========================================================
  1857                           ;=====================振盪器設定=========================
  1858                           ;========================================================
  1859     01F7  0021               	banksel	153
  1860     01F8  3072               	movlw	114
  1861     01F9  0099               	movwf	153	;8MHZ
  1862     01FA  3000               	movlw	0
  1863     01FB  0098               	movwf	152	;校正後頻率
  1864     01FC  3011               	movlw	17
  1865     01FD  009A               	movwf	154	;高頻振盪精度0.5%
  1866                           
  1867                           ;========================================================
  1868                           ;=====================OPTION設定=========================
  1869                           ;========================================================
  1870     01FE  30C8               	movlw	200
  1871     01FF  0095               	movwf	149	;BIT6 0->rising 1->falling
  1872                           
  1873                           ;========================================================
  1874                           ;======================中斷設定==========================
  1875                           ;========================================================
  1876     0200  3040               	movlw	64
  1877     0201  008B               	movwf	11
  1878     0202  0021               	banksel	145
  1879     0203  3000               	movlw	0
  1880     0204  0091               	movwf	145	;BIT 3 = MSSP 1 INTERRUPT, BIT 5 = USART 1 RECIEVE INTERRUPT
  1881     0205  3000               	movlw	0
  1882     0206  0092               	movwf	146
  1883     0207  3000               	movlw	0
  1884     0208  0093               	movwf	147
  1885     0209  3000               	movlw	0
  1886     020A  0094               	movwf	148
  1887                           
  1888                           ;========================================================
  1889                           ;========================ADC設定=========================
  1890                           ;========================================================
  1891     020B  0021               	banksel	157
  1892     020C  3000               	movlw	0
  1893     020D  009D               	movwf	157
  1894     020E  3000               	movlw	0
  1895     020F  009E               	movwf	158
  1896     0210  0023               	banksel	396
  1897     0211  018C               	clrf	396
  1898     0212  0190               	clrf	400
  1899     0213  0028               	banksel	1036
  1900     0214  018C               	clrf	1036
  1901     0215  018D               	clrf	1037
  1902     0216  0020               	banksel	12
  1903                           
  1904                           ;========================================================
  1905                           ;=====================I/O設定============================
  1906                           ;========================================================
  1907     0217  0021               	banksel	140
  1908     0218  30C0               	movlw	192
  1909     0219  008C               	movwf	140
  1910     021A  30FF               	movlw	255
  1911     021B  008D               	movwf	141
  1912     021C  3000               	movlw	0
  1913     021D  008E               	movwf	142
  1914     021E  300F               	movlw	15
  1915     021F  008F               	movwf	143
  1916     0220  30FF               	movlw	255
  1917     0221  0090               	movwf	144
  1918     0222  0026               	banksel	780
  1919     0223  3000               	movlw	0
  1920     0224  008C               	movwf	780
  1921     0225  30F6               	movlw	246
  1922     0226  008D               	movwf	781
  1923                           
  1924                           ;---------------
  1925     0227  0022               	banksel	268
  1926     0228  3000               	movlw	0
  1927     0229  008C               	movwf	268
  1928     022A  3000               	movlw	0
  1929     022B  008D               	movwf	269
  1930     022C  3000               	movlw	0
  1931     022D  008E               	movwf	270
  1932     022E  3000               	movlw	0
  1933     022F  008F               	movwf	271
  1934     0230  3000               	movlw	0
  1935     0231  0090               	movwf	272
  1936     0232  0027               	banksel	908
  1937     0233  018C               	clrf	908
  1938     0234  018D               	clrf	909
  1939                           
  1940                           ;---------------
  1941     0235  0020               	banksel	12
  1942     0236  018C               	clrf	12
  1943     0237  018D               	clrf	13
  1944     0238  018E               	clrf	14
  1945     0239  018F               	clrf	15
  1946     023A  0190               	clrf	16
  1947                           
  1948                           ;---------------
  1949     023B  0025               	banksel	652
  1950     023C  018C               	clrf	652
  1951     023D  018D               	clrf	653
  1952     023E  0020               	banksel	12
  1953     023F  2631               	call	DELAY_1000ms
  1954                           
  1955                           ;========================================================
  1956                           ;=====================暫存器設定=========================
  1957                           ;========================================================
  1958     0240  25FA               	call	CLEAN_ALL_REGISTER
  1959     0241  3188               	pagesel	2048
  1960     0242  
                 warning: (2090) fixup overflow storing 0xD08 in 2 bytes
                 2508               	call	SET_MODBUS_MODE_ENABLE	;設定uart2硬體
  1961     0243  3180               	pagesel	0
  1962                           
  1963                           ;========================================================
  1964                           ;=====================TIMER2設定=========================
  1965                           ;========================================================
  1966     0244  25E9               	call	SET_TMR2_BASE_TIME	;設定TIMER2基礎時間
  1967     0245  25F2               	call	SET_TMR2_INT_EN	;TIMER2中斷啟動
  1968     0246  25F6               	call	SET_TMR2_ON	;啟動TIMER2功能
  1969     0247                     ADC_HW_SETTING:	
  1970                           ;========================================================
  1971                           ;=====================ADC設定============================
  1972                           ;========================================================
  1973                           
  1974     0247  0028               	banksel	1037
  1975     0248  3010               	movlw	16
  1976     0249  008D               	movwf	1037
  1977                           
  1978                           ;-------------------------ADC_OPEN-------------------------
  1979     024A  0021               	banksel	158
  1980     024B  3031               	movlw	49	;AN12啟動
  1981     024C  009D               	movwf	157
  1982     024D  30C0               	movlw	192
  1983     024E  009E               	movwf	158
  1984     024F  0020               	banksel	12
  1985     0250  2636               	call	DELAY_100ms
  1986     0251                     SETTING_PWM_HW_LOOP:	
  1987                           ;========================================================
  1988                           ;=====================PWM輸出設定========================
  1989                           ;========================================================
  1990                           
  1991                           
  1992                           ;-------------------------------------設定相對應接腳TIMER
  1993     0251  0025               	banksel	670
  1994     0252  30DF               	movlw	223
  1995     0253  009E               	movwf	670
  1996     0254  300F               	movlw	15
  1997     0255  009F               	movwf	671
  1998                           
  1999                           ;-------------------------------------決定週期
  2000     0256  0028               	banksel	1046
  2001     0257  309C               	movlw	156
  2002     0258  0096               	movwf	1046
  2003                           
  2004                           ;-------------------------------------啟動TIMER
  2005     0259  0028               	banksel	1047
  2006     025A  307F               	movlw	127
  2007     025B  0097               	movwf	1047
  2008                           
  2009                           ;-------------------------------------決定DUTY CYCLE
  2010     025C  0026               	banksel	785
  2011     025D  3032               	movlw	50
  2012     025E  0091               	movwf	785
  2013                           
  2014                           ;-------------------------------------啟動PWM
  2015     025F  0026               	banksel	787
  2016     0260  300C               	movlw	12
  2017     0261  0093               	movwf	787
  2018     0262                     IOC_HW_SETTING:	
  2019                           ;========================================================
  2020                           ;=====================IOC設定============================
  2021                           ;========================================================
  2022                           
  2023     0262  0027               	banksel	916
  2024     0263  3000               	movlw	0
  2025     0264  0095               	movwf	917
  2026     0265  3000               	movlw	0
  2027     0266  0094               	movwf	916	;正緣觸發
  2028     0267                     CHECK_PWM_FREQ_FUCNTION:	
  2029 ;;========================================================
  2030 ;;=====================DIP SWITCH判斷=====================
  2031 ;;========================================================
  2032                           ;DIP_SWITCH_ADR_FUNCTION:
  2033                           ;BANKSEL ADDR_0_1_2_3_PORT
  2034                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_0
  2035                           ; BSF MOTOR1_FLAG0,MOTOR_1_EN
  2036 ;;---------
  2037                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_1
  2038                           ; BSF MOTOR2_FLAG0,MOTOR_2_EN
  2039 ;;---------
  2040                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_2
  2041                           ; BSF MOTOR3_FLAG0,MOTOR_3_EN
  2042 ;;---------
  2043                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_3
  2044                           ; BSF MOTOR4_FLAG0,MOTOR_4_EN
  2045                           ;---------
  2046                           ;========================================================
  2047                           ;=====================PWM頻率偵測========================
  2048                           ;========================================================
  2049                           
  2050     0267                     ID_SELECT_LOOP:	
  2051                           ;CALL ADC_TAKE_DATA_FUNCTION
  2052                           ;========================================================
  2053                           ;=====================ID SELECT==========================
  2054                           ;========================================================
  2055                           ;這邊判斷ID的條件是由ADC RF0的數值來判斷
  2056                           
  2057     0267  0020               	banksel	12
  2058     0268  01A5               	clrf	37
  2059     0269                     POWER_LED_OUTPUT_FUNCTION:	
  2060                           ;========================================================
  2061                           ;===================POWER LED輸出========================
  2062                           ;========================================================
  2063                           
  2064     0269  0020               	banksel	13
  2065     026A  1E8D               	btfss	13,5
  2066     026B  2A6E               	goto	POWER_LED_OUTPUT_EXIT
  2067     026C  0027               	banksel	908
  2068     026D  140C               	bsf	908,0
  2069     026E                     POWER_LED_OUTPUT_EXIT:
  2070     026E  0020               	banksel	12
  2071     026F                     INT_HW_SETTING:	
  2072                           ;--------------------------------------------------------
  2073                           ;--------------------------------------------------------
  2074                           ;========================================================
  2075                           ;=====================INT設定============================
  2076                           ;========================================================
  2077                           
  2078     026F  0027               	banksel	909
  2079     0270  118D               	bcf	909,3	;將MAX485設定為RX模式
  2080     0271  160B               	bsf	11,4
  2081     0272  158B               	bsf	11,3
  2082     0273  0021               	banksel	148
  2083     0274  1694               	bsf	148,5
  2084     0275  1491               	bsf	145,1
  2085     0276  178B               	bsf	11,7
  2086     0277  0020               	banksel	12
  2087     0278  3002               	movlw	2
  2088     0279  00C8               	movwf	72
  2089     027A  3004               	movlw	4
  2090     027B  00A4               	movwf	36
  2091                           
  2092                           ; MOVLW 0X06
  2093                           ;MOVWF MODULE_ID_DAT
  2094     027C  0022               	banksel	268
  2095     027D  160C               	bsf	268,4
  2096     027E  168C               	bsf	268,5
  2097     027F  100E               	bcf	270,0
  2098     0280  110E               	bcf	270,2
  2099     0281  108E               	bcf	270,1
  2100     0282  118E               	bcf	270,3
  2101     0283  0020               	banksel	12
  2102     0284  3004               	movlw	4
  2103     0285  00A5               	movwf	37
  2104     0286  2A87               	goto	SYSTEM_START
  2105     0287                     SYSTEM_START:	
  2106                           ;********************************************************************************
  2107                           ;********************************************************************************
  2108                           ;========================================================
  2109                           ;=====================主程序迴圈=========================
  2110                           ;========================================================
  2111                           
  2112     0287  0020               	banksel	12
  2113     0288                     SYSTEM_START_LV1:	
  2114                           ; BTFSC PORTE,0X00
  2115                           ; GOTO MOTOR_2_WORK1
  2116                           ; GOTO MOTOR_2_STOP
  2117                           ;BANKSEL PORTA
  2118                           
  2119                           
  2120                           ;------------------------------------------- 傳送ERROR CODE的地方
  2121     0288  183B               	btfsc	59,0
  2122     0289  234F               	call	MODBUS_ERROR_CODE_01_LOOP
  2123     028A  18BB               	btfsc	59,1
  2124     028B  2363               	call	MODBUS_ERROR_CODE_02_LOOP
  2125     028C  193B               	btfsc	59,2
  2126     028D  2371               	call	MODBUS_ERROR_CODE_03_LOOP
  2127     028E  19BB               	btfsc	59,3
  2128     028F  237F               	call	MODBUS_ERROR_CODE_04_LOOP
  2129     0290  1A3B               	btfsc	59,4
  2130     0291  238D               	call	MODBUS_ERROR_CODE_05_LOOP
  2131     0292  1ABB               	btfsc	59,5
  2132     0293  239B               	call	MODBUS_ERROR_CODE_06_LOOP
  2133                           
  2134                           ;-------------------------------------------
  2135     0294  1830               	btfsc	48,0
  2136     0295  2572               	call	PREPARE_TX_DATA_LOOP	;UART TX傳送資料
  2137                           
  2138                           ;-------------------------------------------
  2139     0296  2A87               	goto	SYSTEM_START
  2140     0297                     CHECK_MOTOR2_ZERO_LOOP:	
  2141 ;;-----------
  2142                           ; BTFSC FLAG1_BANK0,CAN_WORK_FLAG
  2143                           ; CALL MODULE_WORK_LOOP ;順逆轉馬達動作
  2144 ;;-----------
  2145                           ;
  2146                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_RESET
  2147                           ; CALL MOTOR_2_ZERO_FUNCTION
  2148                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_ING_ZERO
  2149                           ; CALL CHECK_MOTOR2_ZERO_LOOP
  2150 ;;--------------------------------------
  2151                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_RESET
  2152                           ; CALL MOTOR_1_ZERO_FUNCTION
  2153                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_HI_ZERO
  2154                           ; CALL MOTOR1_ZERO_IN_HI_LOOP
  2155                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_ING_ZERO
  2156                           ; CALL MOTOR1_ZERO_IN_LO_LOOP
  2157                           ; GOTO SYSTEM_START
  2158 ;;--------------------------------------
  2159                           ;MOTOR_2_WORK1:
  2160                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2161                           ; MOVWF FSR0H
  2162                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2163                           ; MOVWF FSR0L
  2164                           ; MOVLW 0X15
  2165                           ; ADDWF FSR0L,F
  2166                           ; MOVLW 0X0F
  2167                           ; ADDWF FSR0L,F
  2168                           ; MOVLW 0X00
  2169                           ; MOVWF INDF0
  2170                           ; GOTO SYSTEM_START_LV1
  2171                           ;MOTOR_2_STOP:
  2172                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2173                           ; MOVWF FSR0H
  2174                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2175                           ; MOVWF FSR0L
  2176                           ; MOVLW 0X15
  2177                           ; ADDWF FSR0L,F
  2178                           ; MOVLW 0X0F
  2179                           ; ADDWF FSR0L,F
  2180                           ; MOVLW 0XFF
  2181                           ; MOVWF INDF0
  2182                           ; GOTO SYSTEM_START_LV1
  2183                           ;========================================================
  2184                           ;=====================注射馬達復位完成===================
  2185                           ;========================================================
  2186                           
  2187     0297  1A3A               	btfsc	58,4
  2188     0298  0008               	return
  2189     0299  18B6               	btfsc	54,1
  2190     029A  0008               	return
  2191     029B  1810               	btfsc	16,0
  2192     029C  0008               	return
  2193     029D  0022               	banksel	270
  2194     029E  110E               	bcf	270,2
  2195     029F  0020               	banksel	12
  2196     02A0  01C3               	clrf	67
  2197     02A1  0020               	banksel	12
  2198     02A2  12B2               	bcf	50,5
  2199     02A3  1036               	bcf	54,0
  2200                           
  2201                           ;-----------------------------
  2202     02A4  3021               	movlw	33
  2203     02A5  0085               	movwf	5
  2204     02A6  3090               	movlw	144
  2205     02A7  0084               	movwf	4
  2206     02A8  3015               	movlw	21
  2207     02A9  0784               	addwf	4,f
  2208     02AA  3004               	movlw	4
  2209     02AB  0784               	addwf	4,f
  2210     02AC  0180               	clrf	0
  2211     02AD  0A84               	incf	4,f
  2212     02AE  0180               	clrf	0
  2213                           
  2214                           ;---------------------------------------------清除累加步數
  2215     02AF  3021               	movlw	33
  2216     02B0  0085               	movwf	5
  2217     02B1  3090               	movlw	144
  2218     02B2  0084               	movwf	4
  2219     02B3  3015               	movlw	21
  2220     02B4  0784               	addwf	4,f
  2221     02B5  3007               	movlw	7
  2222     02B6  0784               	addwf	4,f
  2223     02B7  3000               	movlw	0
  2224     02B8  0080               	movwf	0
  2225     02B9  0027               	banksel	908
  2226     02BA  3000               	movlw	0
  2227     02BB  00A3               	movwf	163
  2228     02BC  0020               	banksel	12
  2229     02BD  0008               	return
  2230     02BE                     MOTOR1_ZERO_IN_LO_LOOP:	
  2231                           ;--------------------------------------------
  2232                           
  2233     02BE  1A3A               	btfsc	58,4
  2234     02BF  0008               	return
  2235     02C0  18B5               	btfsc	53,1
  2236     02C1  0008               	return
  2237     02C2  1D0D               	btfss	13,2
  2238     02C3  2AFD               	goto	MOTOR1_TIME_ZERO_LOOP
  2239     02C4  3001               	movlw	1
  2240     02C5  07D1               	addwf	81,f
  2241     02C6  3000               	movlw	0
  2242     02C7  3DD0               	addwfc	80,f
  2243     02C8  30FD               	movlw	253
  2244     02C9  0750               	addwf	80,w
  2245     02CA  1C03               	btfss	3,0
  2246     02CB  0008               	return
  2247     02CC  300C               	movlw	12
  2248     02CD  0751               	addwf	81,w
  2249     02CE  1C03               	btfss	3,0
  2250     02CF  0008               	return
  2251     02D0                     MOTOR1_ZERO_IN_LO_LOOP_LV1:	
  2252                           ; MOVF IOC_COUNTER_HBYTE,W
  2253                           ; BTFSS STATUS,Z
  2254                           ; GOTO MOTOR1_ZERO_IN_LO_LOOP_LV1
  2255 ;;------
  2256                           ; MOVLW 0XFE
  2257                           ; ADDWF IOC_COUNTER_LBYTE,W
  2258                           ; BTFSS STATUS,C
  2259                           ; RETURN
  2260                           
  2261     02D0  0022               	banksel	270
  2262     02D1  100E               	bcf	270,0
  2263     02D2  0020               	banksel	12
  2264     02D3  13B1               	bcf	49,7
  2265     02D4  12B1               	bcf	49,5
  2266     02D5  10BA               	bcf	58,1
  2267     02D6  3021               	movlw	33
  2268     02D7  0085               	movwf	5
  2269     02D8  3090               	movlw	144
  2270     02D9  0084               	movwf	4
  2271     02DA  3007               	movlw	7
  2272     02DB  0784               	addwf	4,f
  2273     02DC  3000               	movlw	0
  2274     02DD  0080               	movwf	0
  2275                           
  2276                           ;----------
  2277     02DE  3000               	movlw	0
  2278     02DF  00C2               	movwf	66
  2279     02E0  1035               	bcf	53,0
  2280     02E1  0027               	banksel	908
  2281     02E2  3000               	movlw	0
  2282     02E3  00A3               	movwf	163
  2283     02E4  0020               	banksel	12
  2284     02E5  183C               	btfsc	60,0
  2285     02E6  2BCA               	goto	RESET_END_IN_NORMAL_LOOP
  2286                           
  2287                           ;BANKSEL IOCBN
  2288                           ; BSF IOCBN,0X02
  2289                           ; BCF IOCBP,0X02
  2290                           ;BANKSEL PORTA
  2291     02E7  0008               	return
  2292     02E8                     MOTOR1_ZERO_IN_HI_LOOP:	
  2293                           ;-------------------------------------------------------------
  2294                           ;-------------------------------------------------------------
  2295                           
  2296     02E8  1A3A               	btfsc	58,4
  2297     02E9  0008               	return
  2298     02EA  18B5               	btfsc	53,1
  2299     02EB  0008               	return
  2300     02EC  190D               	btfsc	13,2
  2301     02ED  2AFD               	goto	MOTOR1_TIME_ZERO_LOOP
  2302     02EE  3001               	movlw	1
  2303     02EF  07D1               	addwf	81,f
  2304     02F0  3000               	movlw	0
  2305     02F1  3DD0               	addwfc	80,f
  2306     02F2  30FD               	movlw	253
  2307     02F3  0750               	addwf	80,w
  2308     02F4  1C03               	btfss	3,0
  2309     02F5  0008               	return
  2310     02F6  300C               	movlw	12
  2311     02F7  0751               	addwf	81,w
  2312     02F8  1C03               	btfss	3,0
  2313     02F9  0008               	return
  2314     02FA                     MOTOR1_ZERO_IN_HI_LOOP_LV1:	
  2315                           ; MOVF IOC_COUNTER_HBYTE,W
  2316                           ; BTFSS STATUS,Z
  2317                           ; GOTO MOTOR1_ZERO_IN_HI_LOOP_LV1
  2318 ;;------
  2319                           ; MOVLW 0XFE
  2320                           ; ADDWF IOC_COUNTER_LBYTE,W
  2321                           ; BTFSS STATUS,C
  2322                           ; RETURN
  2323                           
  2324     02FA  13B1               	bcf	49,7
  2325     02FB  1331               	bcf	49,6
  2326     02FC  2B1F               	goto	MOTOR_1_NOW_IS_LO
  2327     02FD                     MOTOR1_TIME_ZERO_LOOP:
  2328                           
  2329                           ;CLRF IOC_COUNTER_HBYTE
  2330                           ;CLRF IOC_COUNTER_LBYTE
  2331     02FD  0AD3               	incf	83,f
  2332     02FE  309C               	movlw	156
  2333     02FF  0753               	addwf	83,w
  2334     0300  1C03               	btfss	3,0
  2335     0301  0008               	return
  2336     0302  01D3               	clrf	83
  2337     0303  01D1               	clrf	81
  2338     0304  01D0               	clrf	80
  2339     0305  0008               	return
  2340     0306                     MOTOR_1_ZERO_FUNCTION:	
  2341                           ;========================================================
  2342                           ;=====================轉向馬達復位=======================
  2343                           ;========================================================
  2344                           
  2345     0306  1A3A               	btfsc	58,4
  2346     0307  0008               	return
  2347     0308  18B5               	btfsc	53,1
  2348     0309  0008               	return
  2349     030A  1435               	bsf	53,0
  2350     030B  0027               	banksel	908
  2351     030C  3001               	movlw	1
  2352     030D  00A3               	movwf	163
  2353     030E  0020               	banksel	12
  2354     030F  1231               	bcf	49,4
  2355                           
  2356                           ;-----------
  2357     0310  3021               	movlw	33
  2358     0311  0085               	movwf	5
  2359     0312  3090               	movlw	144
  2360     0313  0084               	movwf	4
  2361     0314  3007               	movlw	7
  2362     0315  0784               	addwf	4,f
  2363     0316  3004               	movlw	4
  2364     0317  0080               	movwf	0
  2365                           
  2366                           ;----------
  2367     0318  3001               	movlw	1
  2368     0319  00C2               	movwf	66
  2369     031A  0022               	banksel	270
  2370     031B  140E               	bsf	270,0
  2371                           
  2372                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  2373                           ; BSF MOTOR_CONTROL_PORT,M1_FR
  2374     031C  0020               	banksel	12
  2375     031D  190D               	btfsc	13,2
  2376     031E  2B29               	goto	MOTOR_1_NOW_IS_HI	;目前是HI
  2377     031F                     MOTOR_1_NOW_IS_LO:
  2378                           
  2379                           ;目前是LO
  2380     031F  0020               	banksel	12
  2381     0320  16B1               	bsf	49,5
  2382     0321  1331               	bcf	49,6
  2383     0322  14BA               	bsf	58,1
  2384     0323  01C6               	clrf	70
  2385     0324  01C7               	clrf	71
  2386     0325  01D0               	clrf	80
  2387     0326  01D1               	clrf	81
  2388     0327  01D3               	clrf	83
  2389     0328  0008               	return
  2390     0329                     MOTOR_1_NOW_IS_HI:
  2391     0329  0020               	banksel	12
  2392     032A  1731               	bsf	49,6
  2393     032B  12B1               	bcf	49,5
  2394     032C  14BA               	bsf	58,1
  2395     032D  01C6               	clrf	70
  2396     032E  01C7               	clrf	71
  2397     032F  01D0               	clrf	80
  2398     0330  01D1               	clrf	81
  2399     0331  01D3               	clrf	83
  2400     0332  0008               	return
  2401     0333                     MOTOR_2_ZERO_FUNCTION:	
  2402                           ;========================================================
  2403                           ;=====================注射馬達復位進行中=================
  2404                           ;========================================================
  2405                           
  2406     0333  1A3A               	btfsc	58,4
  2407     0334  0008               	return
  2408     0335  18B6               	btfsc	54,1
  2409     0336  0008               	return
  2410     0337  1232               	bcf	50,4
  2411     0338  1C10               	btfss	16,0
  2412     0339  0008               	return
  2413     033A  0027               	banksel	908
  2414     033B  3001               	movlw	1
  2415     033C  00A3               	movwf	163
  2416     033D  0020               	banksel	12
  2417     033E  1436               	bsf	54,0
  2418                           
  2419                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2420                           ; MOVWF FSR0H
  2421                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2422                           ; MOVWF FSR0L
  2423                           ; MOVLW 0X15
  2424                           ; ADDWF FSR0L,F
  2425                           ; MOVLW 0X0F
  2426                           ; ADDWF FSR0L,F
  2427                           ; MOVLW 0X00
  2428                           ; MOVWF INDF0
  2429                           ;------------------------------------
  2430     033F  3021               	movlw	33
  2431     0340  0085               	movwf	5
  2432     0341  3090               	movlw	144
  2433     0342  0084               	movwf	4
  2434     0343  3015               	movlw	21
  2435     0344  0784               	addwf	4,f
  2436     0345  3007               	movlw	7
  2437     0346  0784               	addwf	4,f
  2438     0347  3001               	movlw	1
  2439     0348  0080               	movwf	0
  2440     0349  0022               	banksel	270
  2441     034A  118E               	bcf	270,3
  2442     034B  150E               	bsf	270,2
  2443     034C  0020               	banksel	12
  2444     034D  16B2               	bsf	50,5
  2445     034E  0008               	return
  2446     034F                     MODBUS_ERROR_CODE_01_LOOP:	
  2447                           ;========================================================
  2448                           ;===============MODBUS ERROR CODE IS 01==================
  2449                           ;========================================================
  2450                           
  2451     034F  103B               	bcf	59,0
  2452     0350  3020               	movlw	32
  2453     0351  0087               	movwf	7
  2454     0352  30B0               	movlw	176
  2455     0353  0086               	movwf	6
  2456     0354  300A               	movlw	10
  2457     0355  0786               	addwf	6,f
  2458                           
  2459                           ;---------------------
  2460     0356  0A86               	incf	6,f
  2461     0357  3080               	movlw	128
  2462     0358  0481               	iorwf	1,f
  2463     0359  0A86               	incf	6,f
  2464     035A  3001               	movlw	1
  2465     035B  0081               	movwf	1
  2466     035C                     MODBUS_ERROR_CODE_END:	
  2467                           ;--------------------
  2468                           
  2469     035C  3003               	movlw	3
  2470     035D  00AA               	movwf	42
  2471     035E  21E0               	call	MODBUS_RTU_READ_LV2
  2472     035F  3005               	movlw	5
  2473     0360  00AD               	movwf	45
  2474     0361  1430               	bsf	48,0
  2475     0362  0008               	return
  2476     0363                     MODBUS_ERROR_CODE_02_LOOP:	
  2477                           ;========================================================
  2478                           ;===============MODBUS ERROR CODE IS 02==================
  2479                           ;========================================================
  2480                           
  2481     0363  10BB               	bcf	59,1
  2482     0364  3020               	movlw	32
  2483     0365  0087               	movwf	7
  2484     0366  30B0               	movlw	176
  2485     0367  0086               	movwf	6
  2486     0368  300A               	movlw	10
  2487     0369  0786               	addwf	6,f
  2488                           
  2489                           ;---------------------
  2490     036A  0A86               	incf	6,f
  2491     036B  3080               	movlw	128
  2492     036C  0481               	iorwf	1,f
  2493     036D  0A86               	incf	6,f
  2494     036E  3002               	movlw	2
  2495     036F  0081               	movwf	1
  2496                           
  2497                           ;--------------------
  2498     0370  2B5C               	goto	MODBUS_ERROR_CODE_END
  2499     0371                     MODBUS_ERROR_CODE_03_LOOP:	
  2500                           ;========================================================
  2501                           ;===============MODBUS ERROR CODE IS 03==================
  2502                           ;========================================================
  2503                           
  2504     0371  113B               	bcf	59,2
  2505     0372  3020               	movlw	32
  2506     0373  0087               	movwf	7
  2507     0374  30B0               	movlw	176
  2508     0375  0086               	movwf	6
  2509     0376  300A               	movlw	10
  2510     0377  0786               	addwf	6,f
  2511                           
  2512                           ;---------------------
  2513     0378  0A86               	incf	6,f
  2514     0379  3080               	movlw	128
  2515     037A  0481               	iorwf	1,f
  2516     037B  0A86               	incf	6,f
  2517     037C  3003               	movlw	3
  2518     037D  0081               	movwf	1
  2519                           
  2520                           ;--------------------
  2521     037E  2B5C               	goto	MODBUS_ERROR_CODE_END
  2522     037F                     MODBUS_ERROR_CODE_04_LOOP:	
  2523                           ;========================================================
  2524                           ;===============MODBUS ERROR CODE IS 04==================
  2525                           ;========================================================
  2526                           
  2527     037F  11BB               	bcf	59,3
  2528     0380  3020               	movlw	32
  2529     0381  0087               	movwf	7
  2530     0382  30B0               	movlw	176
  2531     0383  0086               	movwf	6
  2532     0384  300A               	movlw	10
  2533     0385  0786               	addwf	6,f
  2534                           
  2535                           ;---------------------
  2536     0386  0A86               	incf	6,f
  2537     0387  3080               	movlw	128
  2538     0388  0481               	iorwf	1,f
  2539     0389  0A86               	incf	6,f
  2540     038A  3004               	movlw	4
  2541     038B  0081               	movwf	1
  2542                           
  2543                           ;--------------------
  2544     038C  2B5C               	goto	MODBUS_ERROR_CODE_END
  2545     038D                     MODBUS_ERROR_CODE_05_LOOP:	
  2546                           ;========================================================
  2547                           ;===============MODBUS ERROR CODE IS 05==================
  2548                           ;========================================================
  2549                           
  2550     038D  123B               	bcf	59,4
  2551     038E  3020               	movlw	32
  2552     038F  0087               	movwf	7
  2553     0390  30B0               	movlw	176
  2554     0391  0086               	movwf	6
  2555     0392  300A               	movlw	10
  2556     0393  0786               	addwf	6,f
  2557                           
  2558                           ;---------------------
  2559     0394  0A86               	incf	6,f
  2560     0395  3080               	movlw	128
  2561     0396  0481               	iorwf	1,f
  2562     0397  0A86               	incf	6,f
  2563     0398  3005               	movlw	5
  2564     0399  0081               	movwf	1
  2565                           
  2566                           ;--------------------
  2567     039A  2B5C               	goto	MODBUS_ERROR_CODE_END
  2568     039B                     MODBUS_ERROR_CODE_06_LOOP:	
  2569                           ;========================================================
  2570                           ;===============MODBUS ERROR CODE IS 06==================
  2571                           ;========================================================
  2572                           
  2573     039B  12BB               	bcf	59,5
  2574     039C  3020               	movlw	32
  2575     039D  0087               	movwf	7
  2576     039E  30B0               	movlw	176
  2577     039F  0086               	movwf	6
  2578     03A0  300A               	movlw	10
  2579     03A1  0786               	addwf	6,f
  2580                           
  2581                           ;---------------------
  2582     03A2  0A86               	incf	6,f
  2583     03A3  3080               	movlw	128
  2584     03A4  0481               	iorwf	1,f
  2585     03A5  0A86               	incf	6,f
  2586     03A6  3006               	movlw	6
  2587     03A7  0081               	movwf	1
  2588                           
  2589                           ;--------------------
  2590     03A8  2B5C               	goto	MODBUS_ERROR_CODE_END
  2591     03A9                     MODULE_WORK_LOOP:	
  2592                           ;********************************************************************************
  2593                           ;********************************************************************************
  2594                           ;========================================================
  2595                           ;================執行MODULE動作副程式====================
  2596                           ;========================================================
  2597                           
  2598     03A9  1A3A               	btfsc	58,4
  2599     03AA  0008               	return
  2600                           
  2601                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_EN
  2602                           ; CALL MOTOR_1_WORKING_LOOP
  2603 ;;-----
  2604                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_EN
  2605                           ; CALL MOTOR_2_WORKING_LOOP
  2606                           ;-----
  2607                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2608                           ; CALL MOTOR_1_WORKING_LOOP
  2609 ;;-----
  2610                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2611                           ; CALL MOTOR_1_WORKING_LOOP
  2612                           ;-----
  2613     03AB  0008               	return
  2614     03AC                     MOTOR_1_WORKING_LOOP:	
  2615                           ;========================================================
  2616                           ;================馬達1動作副程式=========================
  2617                           ;========================================================
  2618                           
  2619                           
  2620                           ;BTFSC MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  2621                           ;RETURN
  2622     03AC  1CB1               	btfss	49,1
  2623     03AD  0008               	return
  2624                           
  2625                           ;BSF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  2626     03AE  0027               	banksel	908
  2627     03AF  3001               	movlw	1
  2628     03B0  00A3               	movwf	163
  2629     03B1  0020               	banksel	12
  2630     03B2  0008               	return
  2631     03B3  1931               	btfsc	49,2
  2632     03B4  2BF3               	goto	MOTOR_1_WORK_CW_LV1
  2633     03B5  19B1               	btfsc	49,3
  2634     03B6  2C5C               	goto	MOTOR_1_WORK_CCW_LV1
  2635                           
  2636                           ;----------------------------------
  2637     03B7  3021               	movlw	33
  2638     03B8  0085               	movwf	5
  2639     03B9  3090               	movlw	144
  2640     03BA  0084               	movwf	4
  2641     03BB  0800               	movf	0,w
  2642     03BC  1D03               	btfss	3,2
  2643     03BD  2BDC               	goto	MOTOR_1_WORK_CW_LOOP
  2644                           
  2645                           ;-------------
  2646     03BE  0A84               	incf	4,f
  2647     03BF  0800               	movf	0,w
  2648     03C0  1D03               	btfss	3,2
  2649     03C1  2BDC               	goto	MOTOR_1_WORK_CW_LOOP
  2650                           
  2651                           ;-------------
  2652     03C2  0A84               	incf	4,f
  2653     03C3  0800               	movf	0,w
  2654     03C4  1D03               	btfss	3,2
  2655     03C5  2C46               	goto	MOTOR_1_WORK_CCW_LOOP
  2656                           
  2657                           ;-------------
  2658     03C6  0A84               	incf	4,f
  2659     03C7  0800               	movf	0,w
  2660     03C8  1D03               	btfss	3,2
  2661     03C9  2C46               	goto	MOTOR_1_WORK_CCW_LOOP
  2662     03CA                     RESET_END_IN_NORMAL_LOOP:	
  2663                           ;-------------
  2664                           
  2665     03CA  10B1               	bcf	49,1
  2666     03CB  10BA               	bcf	58,1
  2667     03CC  01C6               	clrf	70
  2668     03CD  01C7               	clrf	71
  2669     03CE  3021               	movlw	33
  2670     03CF  0085               	movwf	5
  2671     03D0  3090               	movlw	144
  2672     03D1  0084               	movwf	4
  2673     03D2  3007               	movlw	7	;CMD 0X13詢問目前MOTOR1狀態
  2674     03D3  0784               	addwf	4,f
  2675     03D4  3000               	movlw	0
  2676     03D5  0080               	movwf	0
  2677     03D6  10B5               	bcf	53,1
  2678     03D7  0027               	banksel	908
  2679     03D8  3000               	movlw	0
  2680     03D9  00A3               	movwf	163
  2681     03DA  0020               	banksel	12
  2682                           
  2683                           ;----------
  2684     03DB  0008               	return
  2685     03DC                     MOTOR_1_WORK_CW_LOOP:	
  2686                           ;========================================================
  2687                           ;================馬達1順時針副程式=======================
  2688                           ;========================================================
  2689                           
  2690     03DC  0020               	banksel	13
  2691     03DD  1D0D               	btfss	13,2
  2692     03DE  0008               	return
  2693     03DF  0022               	banksel	270
  2694     03E0  140E               	bsf	270,0
  2695     03E1  108E               	bcf	270,1
  2696     03E2  0020               	banksel	12
  2697     03E3  3021               	movlw	33
  2698     03E4  0085               	movwf	5
  2699     03E5  3090               	movlw	144
  2700     03E6  0084               	movwf	4
  2701     03E7  3007               	movlw	7
  2702     03E8  0784               	addwf	4,f
  2703     03E9  3001               	movlw	1
  2704     03EA  0080               	movwf	0
  2705                           
  2706                           ;----------
  2707     03EB  01C0               	clrf	64
  2708     03EC  1531               	bsf	49,2
  2709     03ED  14BA               	bsf	58,1
  2710     03EE  01C6               	clrf	70
  2711     03EF  01C7               	clrf	71
  2712     03F0  190D               	btfsc	13,2
  2713     03F1  2C2B               	goto	MOTOR_1_CW_IOC_SET_HI
  2714     03F2  11BA               	bcf	58,3
  2715     03F3                     MOTOR_1_WORK_CW_LV1:	
  2716                           ;BTFSC PORTB,0X02
  2717                           ;GOTO MOTOR_1_CW_IOC_SET_HI
  2718                           ;BANKSEL IOCBN
  2719                           ; BCF IOCBN,0X02
  2720                           ; BSF IOCBP,0X02
  2721                           ;BANKSEL PORTA
  2722                           
  2723     03F3  3021               	movlw	33
  2724     03F4  0085               	movwf	5
  2725     03F5  3090               	movlw	144
  2726     03F6  0084               	movwf	4
  2727                           
  2728                           ;----------------------------------
  2729     03F7  0800               	movf	0,w
  2730     03F8  1D03               	btfss	3,2
  2731     03F9  2BFF               	goto	MOTOR_1_WORK_CW_LV3
  2732     03FA  0A84               	incf	4,f
  2733     03FB  0800               	movf	0,w
  2734     03FC  1D03               	btfss	3,2
  2735     03FD  2BFF               	goto	MOTOR_1_WORK_CW_LV3
  2736     03FE  2C0F               	goto	MOTOR_1_WORK_CW_FINISH
  2737     03FF                     MOTOR_1_WORK_CW_LV3:
  2738                           
  2739                           ;BANKSEL PORTF
  2740                           ;BSF PORTF,0X01
  2741                           ;BCF PORTF,0X01
  2742                           ;BANKSEL PORTA
  2743                           ; MOVF PWM_1_COUNT_DAT,W
  2744                           ; BTFSC STATUS,Z
  2745                           ; RETURN
  2746     03FF  1DBA               	btfss	58,3
  2747     0400  2C3C               	goto	CHECK_IOC_IS_LO
  2748     0401  2C2D               	goto	CHECK_IOC_IS_HI
  2749     0402                     MOTOR_1_WORK_CW_LV4:
  2750                           
  2751                           ;BANKSEL PORTF
  2752                           ;BSF PORTF,0X01
  2753                           ;BCF PORTF,0X01
  2754     0402  0020               	banksel	12
  2755     0403  01C0               	clrf	64
  2756     0404  3021               	movlw	33
  2757     0405  0085               	movwf	5
  2758     0406  3090               	movlw	144
  2759     0407  0084               	movwf	4
  2760                           
  2761                           ;----------------------------------
  2762     0408  0800               	movf	0,w
  2763     0409  1D03               	btfss	3,2
  2764     040A  2C14               	goto	MOTOR_1_WORK_CW_LV2
  2765     040B  0A84               	incf	4,f
  2766     040C  0800               	movf	0,w
  2767     040D  1D03               	btfss	3,2
  2768     040E  2C14               	goto	MOTOR_1_WORK_CW_LV2
  2769     040F                     MOTOR_1_WORK_CW_FINISH:
  2770                           
  2771                           ;BANKSEL PORTF
  2772                           ;BSF PORTF,0X00
  2773                           ;BCF PORTF,0X00
  2774                           ;BANKSEL PORTA
  2775     040F  0022               	banksel	270
  2776     0410  100E               	bcf	270,0
  2777     0411  0020               	banksel	12
  2778     0412  1131               	bcf	49,2
  2779     0413  0008               	return
  2780     0414                     MOTOR_1_WORK_CW_LV2:
  2781     0414  0020               	banksel	12
  2782     0415  3021               	movlw	33
  2783     0416  0085               	movwf	5
  2784     0417  3090               	movlw	144
  2785     0418  0084               	movwf	4
  2786     0419  0A84               	incf	4,f
  2787     041A  3001               	movlw	1
  2788     041B  0280               	subwf	0,f
  2789     041C  0384               	decf	4,f
  2790     041D  3000               	movlw	0
  2791     041E  3B80               	subwfb	0,f
  2792                           
  2793                           ;----------------------------------------------------------
  2794     041F  3021               	movlw	33
  2795     0420  0085               	movwf	5
  2796     0421  3090               	movlw	144
  2797     0422  0084               	movwf	4
  2798     0423  3005               	movlw	5
  2799     0424  0784               	addwf	4,f
  2800     0425  3001               	movlw	1
  2801     0426  0780               	addwf	0,f
  2802     0427  0384               	decf	4,f
  2803     0428  3000               	movlw	0
  2804     0429  3D80               	addwfc	0,f
  2805     042A  0008               	return
  2806     042B                     MOTOR_1_CW_IOC_SET_HI:	
  2807                           ;----------------------------------------------------------
  2808                           
  2809     042B  15BA               	bsf	58,3
  2810     042C  2BF3               	goto	MOTOR_1_WORK_CW_LV1
  2811     042D                     CHECK_IOC_IS_HI:
  2812     042D  190D               	btfsc	13,2
  2813     042E  0008               	return
  2814     042F  0846               	movf	70,w
  2815     0430  1D03               	btfss	3,2
  2816     0431  2C37               	goto	MOTOR_1_WORK_CW_LV5
  2817                           
  2818                           ;------
  2819     0432  30FE               	movlw	254
  2820     0433  0747               	addwf	71,w
  2821     0434  1C03               	btfss	3,0
  2822     0435  0008               	return
  2823     0436  2C37               	goto	MOTOR_1_WORK_CW_LV5
  2824     0437                     MOTOR_1_WORK_CW_LV5:
  2825                           
  2826                           ;BANKSEL PORTF
  2827                           ;BSF PORTF,0X00
  2828                           ;BCF PORTF,0X00
  2829     0437  0020               	banksel	12
  2830     0438  01C6               	clrf	70
  2831     0439  01C7               	clrf	71
  2832     043A  11BA               	bcf	58,3
  2833     043B  0008               	return
  2834     043C                     CHECK_IOC_IS_LO:	
  2835                           ;-----------------------------------------------
  2836                           
  2837     043C  1D0D               	btfss	13,2
  2838     043D  0008               	return
  2839     043E  0846               	movf	70,w
  2840     043F  1D03               	btfss	3,2
  2841     0440  2C02               	goto	MOTOR_1_WORK_CW_LV4
  2842                           
  2843                           ;------
  2844     0441  30FE               	movlw	254
  2845     0442  0747               	addwf	71,w
  2846     0443  1C03               	btfss	3,0
  2847     0444  0008               	return
  2848     0445  2C02               	goto	MOTOR_1_WORK_CW_LV4
  2849     0446                     MOTOR_1_WORK_CCW_LOOP:	
  2850                           ;========================================================
  2851                           ;================馬達1逆時針副程式=======================
  2852                           ;========================================================
  2853                           
  2854     0446  0022               	banksel	270
  2855     0447  140E               	bsf	270,0
  2856     0448  148E               	bsf	270,1
  2857     0449  0020               	banksel	12
  2858     044A  3021               	movlw	33
  2859     044B  0085               	movwf	5
  2860     044C  3090               	movlw	144
  2861     044D  0084               	movwf	4
  2862     044E  3007               	movlw	7
  2863     044F  0784               	addwf	4,f
  2864     0450  3001               	movlw	1
  2865     0451  0080               	movwf	0
  2866                           
  2867                           ;----------
  2868     0452  1D0D               	btfss	13,2
  2869     0453  0008               	return
  2870     0454  01C0               	clrf	64
  2871     0455  15B1               	bsf	49,3
  2872     0456  14BA               	bsf	58,1
  2873     0457  01C6               	clrf	70
  2874     0458  01C7               	clrf	71
  2875     0459  190D               	btfsc	13,2
  2876     045A  2C98               	goto	MOTOR_1_CCW_IOC_SET_HI
  2877     045B  11BA               	bcf	58,3
  2878     045C                     MOTOR_1_WORK_CCW_LV1:
  2879     045C  3021               	movlw	33
  2880     045D  0085               	movwf	5
  2881     045E  3090               	movlw	144
  2882     045F  0084               	movwf	4
  2883     0460  3002               	movlw	2
  2884     0461  0784               	addwf	4,f
  2885                           
  2886                           ;----------------------------------
  2887     0462  0800               	movf	0,w
  2888     0463  1D03               	btfss	3,2
  2889     0464  2C6A               	goto	MOTOR_1_WORK_CCW_LV3
  2890     0465  0A84               	incf	4,f
  2891     0466  0800               	movf	0,w
  2892     0467  1D03               	btfss	3,2
  2893     0468  2C6A               	goto	MOTOR_1_WORK_CCW_LV3
  2894     0469  2C7B               	goto	MOTOR_1_WORK_CCW_FINISH
  2895     046A                     MOTOR_1_WORK_CCW_LV3:	
  2896                           ;----------------------------------
  2897                           
  2898                           
  2899                           ; MOVF PWM_1_COUNT_DAT,W
  2900                           ; BTFSC STATUS,Z
  2901                           ; RETURN
  2902     046A  1DBA               	btfss	58,3
  2903     046B  2CA6               	goto	CHECKC_IOC_IS_LO
  2904     046C  2C9A               	goto	CHECKC_IOC_IS_HI
  2905     046D                     MOTOR_1_WORK_CCW_LV4:
  2906     046D  01C0               	clrf	64
  2907     046E  3021               	movlw	33
  2908     046F  0085               	movwf	5
  2909     0470  3090               	movlw	144
  2910     0471  0084               	movwf	4
  2911     0472  3002               	movlw	2
  2912     0473  0784               	addwf	4,f
  2913                           
  2914                           ;----------------------------------
  2915     0474  0800               	movf	0,w
  2916     0475  1D03               	btfss	3,2
  2917     0476  2C80               	goto	MOTOR_1_WORK_CCW_LV2
  2918     0477  0A84               	incf	4,f
  2919     0478  0800               	movf	0,w
  2920     0479  1D03               	btfss	3,2
  2921     047A  2C80               	goto	MOTOR_1_WORK_CCW_LV2
  2922     047B                     MOTOR_1_WORK_CCW_FINISH:
  2923     047B  0022               	banksel	270
  2924     047C  100E               	bcf	270,0
  2925     047D  0020               	banksel	12
  2926     047E  11B1               	bcf	49,3
  2927     047F  0008               	return
  2928     0480                     MOTOR_1_WORK_CCW_LV2:
  2929     0480  0020               	banksel	12
  2930     0481  3021               	movlw	33
  2931     0482  0085               	movwf	5
  2932     0483  3090               	movlw	144
  2933     0484  0084               	movwf	4
  2934     0485  3003               	movlw	3
  2935     0486  0784               	addwf	4,f
  2936     0487  3001               	movlw	1
  2937     0488  0280               	subwf	0,f
  2938     0489  0384               	decf	4,f
  2939     048A  3000               	movlw	0
  2940     048B  3B80               	subwfb	0,f
  2941                           
  2942                           ;----------------------------------------------
  2943     048C  3021               	movlw	33
  2944     048D  0085               	movwf	5
  2945     048E  3090               	movlw	144
  2946     048F  0084               	movwf	4
  2947     0490  3005               	movlw	5
  2948     0491  0784               	addwf	4,f
  2949     0492  3001               	movlw	1
  2950     0493  0280               	subwf	0,f
  2951     0494  0384               	decf	4,f
  2952     0495  3000               	movlw	0
  2953     0496  3B80               	subwfb	0,f
  2954     0497  0008               	return
  2955     0498                     MOTOR_1_CCW_IOC_SET_HI:
  2956     0498  15BA               	bsf	58,3
  2957     0499  2C5C               	goto	MOTOR_1_WORK_CCW_LV1
  2958     049A                     CHECKC_IOC_IS_HI:
  2959     049A  190D               	btfsc	13,2
  2960     049B  0008               	return
  2961     049C  0846               	movf	70,w
  2962     049D  1D03               	btfss	3,2
  2963     049E  2CA4               	goto	MOTOR_1_WORK_CCW_LV5
  2964                           
  2965                           ;------
  2966     049F  30FE               	movlw	254
  2967     04A0  0747               	addwf	71,w
  2968     04A1  1C03               	btfss	3,0
  2969     04A2  0008               	return
  2970     04A3  2CA4               	goto	MOTOR_1_WORK_CCW_LV5
  2971     04A4                     MOTOR_1_WORK_CCW_LV5:
  2972     04A4  11BA               	bcf	58,3
  2973     04A5  0008               	return
  2974     04A6                     CHECKC_IOC_IS_LO:
  2975     04A6  1D0D               	btfss	13,2
  2976     04A7  0008               	return
  2977     04A8  0846               	movf	70,w
  2978     04A9  1D03               	btfss	3,2
  2979     04AA  2C6D               	goto	MOTOR_1_WORK_CCW_LV4
  2980                           
  2981                           ;------
  2982     04AB  30FE               	movlw	254
  2983     04AC  0747               	addwf	71,w
  2984     04AD  1C03               	btfss	3,0
  2985     04AE  0008               	return
  2986     04AF  2C6D               	goto	MOTOR_1_WORK_CCW_LV4
  2987     04B0                     MOTOR_2_WORKING_LOOP:	
  2988                           ;========================================================
  2989                           ;================馬達2動作副程式=========================
  2990                           ;========================================================
  2991                           
  2992     04B0  1836               	btfsc	54,0
  2993     04B1  0008               	return
  2994     04B2  1CB2               	btfss	50,1
  2995     04B3  0008               	return
  2996     04B4  0027               	banksel	908
  2997     04B5  3001               	movlw	1
  2998     04B6  00A3               	movwf	163
  2999     04B7  0020               	banksel	12
  3000     04B8  14B6               	bsf	54,1
  3001     04B9  1932               	btfsc	50,2
  3002     04BA  2CF4               	goto	MOTOR_2_WORK_CW_LV1
  3003     04BB  19B2               	btfsc	50,3
  3004     04BC  2D3F               	goto	MOTOR_2_WORK_CCW_LV1
  3005                           
  3006                           ;----------------------------------
  3007     04BD  3021               	movlw	33
  3008     04BE  0085               	movwf	5
  3009     04BF  3090               	movlw	144
  3010     04C0  0084               	movwf	4
  3011     04C1  3015               	movlw	21
  3012     04C2  0784               	addwf	4,f
  3013                           
  3014                           ;----------
  3015     04C3  0800               	movf	0,w
  3016     04C4  1D03               	btfss	3,2
  3017     04C5  2CE4               	goto	MOTOR_2_WORK_CW_LOOP
  3018                           
  3019                           ;-------------
  3020     04C6  0A84               	incf	4,f
  3021     04C7  0800               	movf	0,w
  3022     04C8  1D03               	btfss	3,2
  3023     04C9  2CE4               	goto	MOTOR_2_WORK_CW_LOOP
  3024                           
  3025                           ;-------------
  3026     04CA  0A84               	incf	4,f
  3027     04CB  0800               	movf	0,w
  3028     04CC  1D03               	btfss	3,2
  3029     04CD  2D2F               	goto	MOTOR_2_WORK_CCW_LOOP
  3030                           
  3031                           ;-------------
  3032     04CE  0A84               	incf	4,f
  3033     04CF  0800               	movf	0,w
  3034     04D0  1D03               	btfss	3,2
  3035     04D1  2D2F               	goto	MOTOR_2_WORK_CCW_LOOP
  3036     04D2                     MOTOR_2_IOC_STOP_LOOP:	
  3037                           ;-------------
  3038                           
  3039     04D2  0020               	banksel	12
  3040     04D3  10B2               	bcf	50,1
  3041     04D4  3021               	movlw	33
  3042     04D5  0085               	movwf	5
  3043     04D6  3090               	movlw	144
  3044     04D7  0084               	movwf	4
  3045     04D8  3015               	movlw	21
  3046     04D9  0784               	addwf	4,f
  3047     04DA  3007               	movlw	7
  3048     04DB  0784               	addwf	4,f
  3049     04DC  3000               	movlw	0
  3050     04DD  0080               	movwf	0
  3051                           
  3052                           ;----------
  3053     04DE  10B6               	bcf	54,1
  3054     04DF  0027               	banksel	908
  3055     04E0  3000               	movlw	0
  3056     04E1  00A3               	movwf	163
  3057     04E2  0020               	banksel	12
  3058     04E3  0008               	return
  3059     04E4                     MOTOR_2_WORK_CW_LOOP:	
  3060                           ;========================================================
  3061                           ;================馬達2順時針副程式=======================
  3062                           ;========================================================
  3063                           
  3064     04E4  0022               	banksel	270
  3065     04E5  150E               	bsf	270,2
  3066     04E6  118E               	bcf	270,3
  3067     04E7  0020               	banksel	12
  3068     04E8  3021               	movlw	33
  3069     04E9  0085               	movwf	5
  3070     04EA  3090               	movlw	144
  3071     04EB  0084               	movwf	4
  3072     04EC  3015               	movlw	21
  3073     04ED  0784               	addwf	4,f
  3074     04EE  3007               	movlw	7
  3075     04EF  0784               	addwf	4,f
  3076     04F0  3001               	movlw	1	;MOTOR 2 IS WORKING
  3077     04F1  0080               	movwf	0
  3078                           
  3079                           ;----------
  3080     04F2  01C1               	clrf	65
  3081     04F3  1532               	bsf	50,2
  3082     04F4                     MOTOR_2_WORK_CW_LV1:
  3083     04F4  1C10               	btfss	16,0
  3084     04F5  2D07               	goto	MOTOR_2_WORK_CW_FINISH
  3085     04F6  0841               	movf	65,w
  3086     04F7  1903               	btfsc	3,2
  3087     04F8  0008               	return
  3088     04F9  01C1               	clrf	65
  3089     04FA  3021               	movlw	33
  3090     04FB  0085               	movwf	5
  3091     04FC  3090               	movlw	144
  3092     04FD  0084               	movwf	4
  3093     04FE  3015               	movlw	21
  3094     04FF  0784               	addwf	4,f
  3095                           
  3096                           ;----------------------------------
  3097     0500  0800               	movf	0,w
  3098     0501  1D03               	btfss	3,2
  3099     0502  2D15               	goto	MOTOR_2_WORK_CW_LV2
  3100     0503  0A84               	incf	4,f
  3101     0504  0800               	movf	0,w
  3102     0505  1D03               	btfss	3,2
  3103     0506  2D15               	goto	MOTOR_2_WORK_CW_LV2
  3104     0507                     MOTOR_2_WORK_CW_FINISH:
  3105     0507  3021               	movlw	33
  3106     0508  0085               	movwf	5
  3107     0509  3090               	movlw	144
  3108     050A  0084               	movwf	4
  3109     050B  3015               	movlw	21
  3110     050C  0784               	addwf	4,f
  3111                           
  3112                           ;----------
  3113     050D  0180               	clrf	0
  3114     050E  0A84               	incf	4,f
  3115     050F  0180               	clrf	0
  3116                           
  3117                           ;-------------------------------
  3118     0510  0022               	banksel	270
  3119     0511  110E               	bcf	270,2
  3120     0512  0020               	banksel	12
  3121     0513  1132               	bcf	50,2
  3122     0514  0008               	return
  3123     0515                     MOTOR_2_WORK_CW_LV2:
  3124     0515  3021               	movlw	33
  3125     0516  0085               	movwf	5
  3126     0517  3090               	movlw	144
  3127     0518  0084               	movwf	4
  3128     0519  3015               	movlw	21
  3129     051A  0784               	addwf	4,f
  3130                           
  3131                           ;------------
  3132     051B  0A84               	incf	4,f
  3133     051C  3001               	movlw	1
  3134     051D  0280               	subwf	0,f
  3135     051E  0384               	decf	4,f
  3136     051F  3000               	movlw	0
  3137     0520  3B80               	subwfb	0,f
  3138                           
  3139                           ;------------------
  3140     0521  3021               	movlw	33
  3141     0522  0085               	movwf	5
  3142     0523  3090               	movlw	144
  3143     0524  0084               	movwf	4
  3144     0525  3015               	movlw	21
  3145     0526  0784               	addwf	4,f
  3146     0527  3005               	movlw	5
  3147     0528  0784               	addwf	4,f
  3148     0529  3001               	movlw	1
  3149     052A  0280               	subwf	0,f
  3150     052B  0384               	decf	4,f
  3151     052C  3000               	movlw	0
  3152     052D  3B80               	subwfb	0,f
  3153     052E  0008               	return
  3154     052F                     MOTOR_2_WORK_CCW_LOOP:	
  3155                           ;========================================================
  3156                           ;================馬達2逆時針副程式=======================
  3157                           ;========================================================
  3158                           
  3159     052F  0022               	banksel	270
  3160     0530  150E               	bsf	270,2
  3161     0531  158E               	bsf	270,3
  3162     0532  0020               	banksel	12
  3163     0533  3021               	movlw	33
  3164     0534  0085               	movwf	5
  3165     0535  3090               	movlw	144
  3166     0536  0084               	movwf	4
  3167     0537  3015               	movlw	21
  3168     0538  0784               	addwf	4,f
  3169     0539  3007               	movlw	7
  3170     053A  0784               	addwf	4,f
  3171     053B  3001               	movlw	1	;馬達正在運作中
  3172     053C  0080               	movwf	0
  3173                           
  3174                           ;----------
  3175     053D  01C1               	clrf	65
  3176     053E  15B2               	bsf	50,3
  3177     053F                     MOTOR_2_WORK_CCW_LV1:
  3178     053F  0841               	movf	65,w
  3179     0540  1903               	btfsc	3,2
  3180     0541  0008               	return
  3181     0542  01C1               	clrf	65
  3182     0543  3021               	movlw	33
  3183     0544  0085               	movwf	5
  3184     0545  3090               	movlw	144
  3185     0546  0084               	movwf	4
  3186     0547  3015               	movlw	21
  3187     0548  0784               	addwf	4,f
  3188     0549  3002               	movlw	2
  3189     054A  0784               	addwf	4,f
  3190                           
  3191                           ;----------------------------------
  3192     054B  0800               	movf	0,w
  3193     054C  1D03               	btfss	3,2
  3194     054D  2D57               	goto	MOTOR_2_WORK_CCW_LV2
  3195     054E  0A84               	incf	4,f
  3196     054F  0800               	movf	0,w
  3197     0550  1D03               	btfss	3,2
  3198     0551  2D57               	goto	MOTOR_2_WORK_CCW_LV2
  3199     0552                     MOTOR_2_WORK_CCW_FINISH:
  3200     0552  0022               	banksel	270
  3201     0553  110E               	bcf	270,2
  3202     0554  0020               	banksel	12
  3203     0555  11B2               	bcf	50,3
  3204     0556  0008               	return
  3205     0557                     MOTOR_2_WORK_CCW_LV2:
  3206     0557  3021               	movlw	33
  3207     0558  0085               	movwf	5
  3208     0559  3090               	movlw	144
  3209     055A  0084               	movwf	4
  3210     055B  3015               	movlw	21
  3211     055C  0784               	addwf	4,f
  3212                           
  3213                           ;INCF FSR0L,F
  3214     055D  3003               	movlw	3
  3215     055E  0784               	addwf	4,f
  3216     055F  3001               	movlw	1
  3217     0560  0280               	subwf	0,f
  3218     0561  0384               	decf	4,f
  3219     0562  3000               	movlw	0
  3220     0563  3B80               	subwfb	0,f
  3221                           
  3222                           ;-------------------------
  3223     0564  3021               	movlw	33
  3224     0565  0085               	movwf	5
  3225     0566  3090               	movlw	144
  3226     0567  0084               	movwf	4
  3227     0568  3015               	movlw	21
  3228     0569  0784               	addwf	4,f
  3229     056A  3005               	movlw	5
  3230     056B  0784               	addwf	4,f
  3231     056C  3001               	movlw	1
  3232     056D  0780               	addwf	0,f
  3233     056E  0384               	decf	4,f
  3234     056F  3000               	movlw	0
  3235     0570  3D80               	addwfc	0,f
  3236     0571  0008               	return
  3237     0572                     PREPARE_TX_DATA_LOOP:	
  3238                           ;========================================================
  3239                           ;====================準備TX資料副程式====================
  3240                           ;========================================================
  3241                           
  3242     0572  0020               	banksel	12
  3243     0573  263A               	call	DELAY_10ms
  3244     0574  3020               	movlw	32
  3245     0575  0087               	movwf	7
  3246     0576  30B0               	movlw	176
  3247     0577  0086               	movwf	6
  3248     0578  300A               	movlw	10
  3249     0579  0786               	addwf	6,f
  3250     057A  0027               	banksel	909
  3251     057B  158D               	bsf	909,3
  3252     057C  0020               	banksel	12
  3253     057D                     TEST_MAX485_LOOP1:	
  3254                           ;---------------------------------------------
  3255                           
  3256     057D  0029               	banksel	1174
  3257     057E  1C96               	btfss	1174,1
  3258     057F  2D7D               	goto	TEST_MAX485_LOOP1
  3259     0580  0029               	banksel	1170
  3260     0581  0801               	movf	1,w
  3261     0582  0092               	movwf	1170
  3262     0583  0020               	banksel	12
  3263     0584  0A86               	incf	6,f
  3264     0585  0BAD               	decfsz	45,f
  3265     0586  2D7D               	goto	TEST_MAX485_LOOP1
  3266     0587                     TEST_MAX485_LOOP1_LV1:
  3267     0587  0029               	banksel	1174
  3268     0588  1C96               	btfss	1174,1
  3269     0589  2D87               	goto	TEST_MAX485_LOOP1_LV1
  3270     058A  0027               	banksel	909
  3271     058B  118D               	bcf	909,3
  3272     058C  0029               	banksel	1173
  3273     058D  1615               	bsf	1173,4	;啟動UART RX功能
  3274     058E  0020               	banksel	12
  3275     058F  1030               	bcf	48,0
  3276     0590  0008               	return
  3277     0591                     ADC_TAKE_DATA_FUNCTION:	
  3278                           ;========================================================
  3279                           ;=====================ADC取資料副程式====================
  3280                           ;========================================================
  3281                           
  3282     0591  0021               	banksel	158
  3283     0592  3031               	movlw	49	;AN12啟動
  3284     0593  009D               	movwf	157
  3285     0594  30C0               	movlw	192
  3286     0595  009E               	movwf	158
  3287     0596  01FC               	clrf	124
  3288     0597  01FD               	clrf	125
  3289     0598  0020               	banksel	12
  3290     0599  2652               	call	DELAY_100us
  3291     059A  2652               	call	DELAY_100us
  3292     059B  2652               	call	DELAY_100us
  3293     059C  0021               	banksel	157
  3294                           
  3295 ;;------------------------ADC_RUN-------------------------------
  3296     059D  149D               	bsf	157,1
  3297     059E                     ADC_WORK:
  3298     059E  189D               	btfsc	157,1
  3299     059F  2D9E               	goto	ADC_WORK
  3300     05A0  0021               	banksel	156
  3301     05A1  081C               	movf	156,w
  3302     05A2  00FC               	movwf	124
  3303     05A3  081B               	movf	155,w
  3304     05A4  00FD               	movwf	125
  3305     05A5  0020               	banksel	12
  3306     05A6  0008               	return
  3307     05A7                     WATCH_SUB_FUNCTION:	
  3308                           ;========================================================
  3309                           ;====================測試用將資料送出====================OK
  3310                           ;========================================================
  3311                           ;這個部分是顯示內部資料的副程式
  3312                           
  3313     05A7  3020               	movlw	32
  3314     05A8  0085               	movwf	5
  3315     05A9  30BA               	movlw	186
  3316     05AA  0084               	movwf	4
  3317     05AB  3008               	movlw	8
  3318     05AC  00F1               	movwf	113
  3319     05AD  0800               	movf	0,w
  3320     05AE  00F2               	movwf	114
  3321     05AF                     WATCH_SUB_FUNC_LV1:
  3322     05AF  0022               	banksel	272
  3323     05B0  1310               	bcf	272,6
  3324     05B1  1BF2               	btfsc	114,7
  3325     05B2  1690               	bsf	272,5
  3326     05B3  1FF2               	btfss	114,7
  3327     05B4  1290               	bcf	272,5
  3328     05B5  1710               	bsf	272,6
  3329     05B6  0DF2               	rlf	114,f
  3330     05B7  0BF1               	decfsz	113,f
  3331     05B8  2DAF               	goto	WATCH_SUB_FUNC_LV1
  3332                           
  3333                           ;----------
  3334     05B9  3008               	movlw	8
  3335     05BA  00F1               	movwf	113
  3336     05BB  0A84               	incf	4,f
  3337     05BC  0800               	movf	0,w
  3338     05BD  00F2               	movwf	114
  3339     05BE  0BF0               	decfsz	112,f
  3340     05BF  2DAF               	goto	WATCH_SUB_FUNC_LV1
  3341     05C0  1290               	bcf	272,5
  3342     05C1  1310               	bcf	272,6
  3343     05C2  0020               	banksel	12
  3344     05C3  0008               	return
  3345     05C4                     CRC_16_FUNCTION_LOOP:	
  3346                           ;========================================================
  3347                           ;====================CRC-16運算副程式====================OK
  3348                           ;========================================================
  3349                           ;做一個BYTE大概40-50uS
  3350                           
  3351     05C4  0020               	banksel	12
  3352     05C5  0827               	movf	39,w
  3353     05C6  06A9               	xorwf	41,f
  3354                           
  3355                           ;---------
  3356     05C7  3009               	movlw	9
  3357     05C8  00A6               	movwf	38
  3358     05C9                     CRC_16_FUNCTION_LV1:
  3359     05C9  03A6               	decf	38,f
  3360     05CA  0826               	movf	38,w
  3361     05CB  1903               	btfsc	3,2
  3362     05CC  2DD7               	goto	CRC_16_END_FUNCTION
  3363                           
  3364                           ;---------------------
  3365     05CD  1003               	bcf	3,0
  3366     05CE  0CA8               	rrf	40,f
  3367     05CF  0CA9               	rrf	41,f
  3368     05D0  1C03               	btfss	3,0
  3369     05D1  2DC9               	goto	CRC_16_FUNCTION_LV1
  3370                           
  3371                           ;---------------------
  3372     05D2  30A0               	movlw	160	;CRC-16運算的參數
  3373     05D3  06A8               	xorwf	40,f
  3374     05D4  3001               	movlw	1
  3375     05D5  06A9               	xorwf	41,f
  3376     05D6  2DC9               	goto	CRC_16_FUNCTION_LV1
  3377     05D7                     CRC_16_END_FUNCTION:
  3378     05D7  0020               	banksel	12
  3379     05D8  0008               	return
  3380     05D9                     AAAA_1800:	
  3381                           ;=======================================================
  3382                           ;===============測試將收到的資料顯示出==================OK
  3383                           ;=======================================================
  3384                           
  3385     05D9  3008               	movlw	8
  3386     05DA  00F0               	movwf	112
  3387     05DB                     AAAAN:
  3388     05DB  0027               	banksel	908
  3389     05DC  120C               	bcf	908,4
  3390                           
  3391                           ;----------------
  3392     05DD  1BF1               	btfsc	113,7
  3393     05DE  168C               	bsf	908,5
  3394     05DF  1FF1               	btfss	113,7
  3395     05E0  128C               	bcf	908,5
  3396                           
  3397                           ;----------------
  3398     05E1  160C               	bsf	908,4
  3399     05E2  0DF1               	rlf	113,f
  3400     05E3  0BF0               	decfsz	112,f
  3401     05E4  2DDB               	goto	AAAAN
  3402     05E5  120C               	bcf	908,4
  3403     05E6  128C               	bcf	908,5
  3404     05E7  0020               	banksel	12
  3405     05E8  0008               	return
  3406     05E9                     SET_TMR2_BASE_TIME:	
  3407                           ;=======================================================
  3408                           ;================TIMER2基礎時間設定=====================OK
  3409                           ;=======================================================
  3410                           ;TIMER2 BASE TIME IS 1mS
  3411                           
  3412     05E9  0020               	banksel	28
  3413     05EA  3015               	movlw	21
  3414     05EB  009C               	movwf	28
  3415     05EC  30A7               	movlw	167
  3416     05ED  009B               	movwf	27
  3417                           
  3418                           ;---------------------
  3419     05EE  3004               	movlw	4
  3420     05EF  00A3               	movwf	35
  3421     05F0  0020               	banksel	12
  3422     05F1  0008               	return
  3423     05F2                     SET_TMR2_INT_EN:	
  3424                           ;=======================================================
  3425                           ;===============TIMER2中斷參數設定======================OK
  3426                           ;=======================================================
  3427                           
  3428     05F2  0021               	banksel	145
  3429     05F3  1491               	bsf	145,1
  3430     05F4  0020               	banksel	12
  3431     05F5  0008               	return
  3432     05F6                     SET_TMR2_ON:	
  3433                           ;=======================================================
  3434                           ;===================TIMER2啟動==========================OK
  3435                           ;=======================================================
  3436                           
  3437     05F6  0020               	banksel	28
  3438     05F7  151C               	bsf	28,2
  3439     05F8  0020               	banksel	12
  3440     05F9  0008               	return
  3441     05FA                     CLEAN_ALL_REGISTER:	
  3442                           ;========================================================
  3443                           ;=================將REG內資料全部清空====================OK
  3444                           ;========================================================
  3445                           
  3446     05FA  3020               	movlw	32
  3447     05FB  0087               	movwf	7
  3448     05FC  3000               	movlw	0
  3449     05FD  0086               	movwf	6
  3450     05FE  3003               	movlw	3
  3451     05FF  00F1               	movwf	113
  3452     0600  30FF               	movlw	255
  3453     0601  00F0               	movwf	112
  3454     0602                     CLEAN_ALL_REGISTER_LOOP:
  3455     0602  0181               	clrf	1
  3456     0603  1003               	bcf	3,0
  3457     0604  3001               	movlw	1
  3458     0605  0786               	addwf	6,f
  3459     0606  3000               	movlw	0
  3460     0607  3D87               	addwfc	7,f
  3461     0608  0BF0               	decfsz	112,f
  3462     0609  2E02               	goto	CLEAN_ALL_REGISTER_LOOP
  3463     060A  30FF               	movlw	255
  3464     060B  00F0               	movwf	112
  3465     060C  0BF1               	decfsz	113,f
  3466     060D  2E02               	goto	CLEAN_ALL_REGISTER_LOOP
  3467     060E  0020               	banksel	12
  3468     060F  0008               	return
  3469     0610                     READ_EEPROM:	
  3470                           ;=======================================================
  3471                           ;===================== 讀EEPROM ========================OK
  3472                           ;=======================================================
  3473                           
  3474     0610  0023               	banksel	401
  3475     0611  087E               	movf	126,w
  3476     0612  0091               	movwf	401
  3477     0613  1315               	bcf	405,6	;USER EEPROM
  3478     0614  1395               	bcf	405,7	;USER EEPROM
  3479     0615  1415               	bsf	405,0	;READ_EEPROM
  3480     0616  0813               	movf	403,w
  3481     0617  00FF               	movwf	127
  3482     0618  0020               	banksel	12
  3483     0619  0008               	return
  3484     061A                     WRITE_EEPROM:	
  3485                           ;=======================================================
  3486                           ;===================== 寫EEPROM ========================OK
  3487                           ;=======================================================
  3488                           
  3489     061A  138B               	bcf	11,7
  3490     061B  0023               	banksel	401
  3491     061C  087E               	movf	126,w
  3492     061D  0091               	movwf	401	;EEPROM ADDRESS
  3493     061E  087F               	movf	127,w
  3494     061F  0093               	movwf	403	;EEPROM DATA
  3495     0620                     WRITE_EEPROM_LOOP_1:	
  3496 ;;-----------------------
  3497                           
  3498     0620  1315               	bcf	405,6	;USER EEPROM
  3499     0621  1395               	bcf	405,7	;USER EEPROM
  3500     0622  1515               	bsf	405,2	;ENABLE WRITE
  3501     0623  3055               	movlw	85	;固定程序
  3502     0624  0096               	movwf	406
  3503     0625  30AA               	movlw	170
  3504     0626  0096               	movwf	406	;固定程序
  3505                           
  3506 ;;-----------------------
  3507     0627  1495               	bsf	405,1	;RUN WRITE EEPROM
  3508     0628                     WAIT_EEPROM_WRITE_OVER:
  3509     0628  1895               	btfsc	405,1
  3510     0629  2E28               	goto	WAIT_EEPROM_WRITE_OVER
  3511     062A  0023               	banksel	405
  3512     062B  1115               	bcf	405,2	;Disable writes
  3513     062C  0020               	banksel	12
  3514     062D  178B               	bsf	11,7
  3515     062E  0008               	return
  3516     062F                     DELAY_3000ms:	
  3517                           ;========================================================
  3518                           ;======================== DELAY =========================OK
  3519                           ;========================================================
  3520                           ;DEFINE IS 8MHZ
  3521                           
  3522     062F  2631               	call	DELAY_1000ms
  3523     0630  2631               	call	DELAY_1000ms
  3524     0631                     DELAY_1000ms:
  3525     0631  2632               	call	DELAY_500ms
  3526     0632                     DELAY_500ms:
  3527     0632  2636               	call	DELAY_100ms
  3528     0633  2636               	call	DELAY_100ms
  3529     0634  2636               	call	DELAY_100ms
  3530     0635  2636               	call	DELAY_100ms
  3531     0636                     DELAY_100ms:
  3532     0636  2639               	call	DELAY_20ms
  3533     0637  2638               	call	DELAY_40ms
  3534     0638                     DELAY_40ms:
  3535     0638  2639               	call	DELAY_20ms
  3536     0639                     DELAY_20ms:
  3537     0639  263A               	call	DELAY_10ms
  3538     063A                     DELAY_10ms:
  3539     063A  263B               	call	DELAY_5ms
  3540     063B                     DELAY_5ms:
  3541     063B  263F               	call	DELAY_1ms
  3542     063C                     DELAY_4ms:
  3543     063C  263F               	call	DELAY_1ms
  3544     063D                     DELAY_3ms:
  3545     063D  263F               	call	DELAY_1ms
  3546     063E                     DELAY_2ms:
  3547     063E  263F               	call	DELAY_1ms
  3548     063F                     DELAY_1ms:
  3549     063F  3031               	movlw	49
  3550     0640  00A0               	movwf	32	;49
  3551     0641  00A1               	movwf	33	;49
  3552     0642  300A               	movlw	10
  3553     0643  00A2               	movwf	34
  3554     0644  2E45               	goto	DELAY_LOOP_1
  3555     0645                     DELAY_LOOP_1:
  3556     0645  0000               	nop	;1
  3557     0646  0BA0               	decfsz	32,f	;2
  3558     0647  2E45               	goto	DELAY_LOOP_1	;3,4 (0.5*4*49 = 98us)
  3559     0648  0821               	movf	33,w	;4
  3560     0649  00A0               	movwf	32	;1
  3561     064A  0BA2               	decfsz	34,f	;2
  3562     064B  2E45               	goto	DELAY_LOOP_1	;3,4
  3563     064C  0008               	return
  3564     064D                     DELAY_600us:	
  3565                           ;==========================================
  3566                           
  3567     064D  2652               	call	DELAY_100us
  3568     064E                     DELAY_500us:
  3569     064E  2652               	call	DELAY_100us
  3570     064F                     DELAY_400us:
  3571     064F  2652               	call	DELAY_100us
  3572     0650                     DELAY_300us:
  3573     0650  2652               	call	DELAY_100us
  3574     0651                     DELAY_200us:
  3575     0651  2652               	call	DELAY_100us
  3576     0652                     DELAY_100us:
  3577     0652  265B               	call	DELAY_10us
  3578     0653                     DELAY_90us:
  3579     0653  265B               	call	DELAY_10us
  3580     0654  265B               	call	DELAY_10us
  3581     0655  265B               	call	DELAY_10us
  3582     0656                     DELAY_60us:
  3583     0656  265B               	call	DELAY_10us
  3584     0657                     DELAY_50us:
  3585     0657  265B               	call	DELAY_10us
  3586     0658                     DELAY_40us:
  3587     0658  265B               	call	DELAY_10us
  3588     0659                     DELAY_30us:
  3589     0659  265B               	call	DELAY_10us
  3590     065A                     DELAY_20us:
  3591     065A  265B               	call	DELAY_10us
  3592     065B                     DELAY_10us:
  3593     065B  0000               	nop
  3594     065C  0000               	nop
  3595     065D                     DELAY_9us:
  3596     065D  0000               	nop
  3597     065E  0000               	nop
  3598     065F                     DELAY_8us:
  3599     065F  0000               	nop
  3600     0660  0000               	nop
  3601     0661                     DELAY_7us:
  3602     0661  0000               	nop
  3603     0662  0000               	nop
  3604     0663                     DELAY_6us:
  3605     0663  0000               	nop
  3606     0664  0000               	nop
  3607     0665                     DELAY_5us:
  3608     0665  0000               	nop
  3609     0666  0000               	nop
  3610     0667                     DELAY_4us:
  3611     0667  0000               	nop
  3612     0668  0000               	nop
  3613     0669                     DELAY_3us:
  3614     0669  0000               	nop
  3615     066A  0000               	nop
  3616     066B                     DELAY_2us:
  3617     066B  0008               	return
  3618                           
  3619                           	psect	config
  3620                           
  3621                           ;Config register CONFIG1 @ 0x8007
  3622                           ;	Oscillator Selection
  3623                           ;	FOSC = INTOSC, INTOSC oscillator: I/O function on CLKIN pin
  3624                           ;	Watchdog Timer Enable
  3625                           ;	WDTE = OFF, WDT disabled
  3626                           ;	Power-up Timer Enable
  3627                           ;	PWRTE = OFF, PWRT disabled
  3628                           ;	MCLR Pin Function Select
  3629                           ;	MCLRE = OFF, MCLR/VPP pin function is digital input
  3630                           ;	Flash Program Memory Code Protection
  3631                           ;	CP = OFF, Program memory code protection is disabled
  3632                           ;	Data Memory Code Protection
  3633                           ;	CPD = OFF, Data memory code protection is disabled
  3634                           ;	Brown-out Reset Enable
  3635                           ;	BOREN = OFF, Brown-out Reset disabled
  3636                           ;	Clock Out Enable
  3637                           ;	CLKOUTEN = OFF, CLKOUT function is disabled. I/O or oscillator function on the CLKOUT pin
  3638                           ;	Internal/External Switchover
  3639                           ;	IESO = OFF, Internal/External Switchover mode is disabled
  3640                           ;	Fail-Safe Clock Monitor Enable
  3641                           ;	FCMEN = OFF, Fail-Safe Clock Monitor is disabled
  3642     8007                     	org	32775
  3643     8007  09A4               	dw	2468
  3644                           
  3645                           ;Config register CONFIG2 @ 0x8008
  3646                           ;	Flash Memory Self-Write Protection
  3647                           ;	WRT = OFF, Write protection off
  3648                           ;	Voltage Regulator Capacitor Enable
  3649                           ;	VCAPEN = OFF, VCAP pin functionality is disabled
  3650                           ;	PLL Enable
  3651                           ;	PLLEN = OFF, 4x PLL disabled
  3652                           ;	Stack Overflow/Underflow Reset Enable
  3653                           ;	STVREN = OFF, Stack Overflow or Underflow will not cause a Reset
  3654                           ;	Brown-out Reset Voltage Selection
  3655                           ;	BORV = HI, Brown-out Reset Voltage (Vbor), high trip point selected.
  3656                           ;	Low-Voltage Programming Enable
  3657                           ;	LVP = OFF, High-voltage on MCLR/VPP must be used for programming
  3658     8008                     	org	32776
  3659     8008  18FF               	dw	6399


Microchip Technology PIC Macro Assembler V2.40 build 20220703182018 
Symbol Table                                                                                               Wed Oct 04 17:08:43 2023

                            C 0000               CRC_COUNTER_TEMP 0026                              Z 0002  
                           RD 0000                             WR 0001                            GIE 0007  
                          PR2 001B                            PR4 0416              MODBUS_ERROR_FLAG 003B  
                         A0_F 0000                           CFGS 0006                           CREN 0004  
                         LATA 010C                           LATB 010D                           LATC 010E  
                         LATD 010F                           LATE 0110                           LATF 038C  
                         LATG 038D                           PIE1 0091                           PIE2 0092  
                         PIE3 0093                           PIE4 0094                           INTE 0004  
                         INTF 0001                           PIR1 0011                           PIR4 0014  
                         M_OE 0004                           TRMT 0001                           WREN 0002  
            STRONG_STOP_TEMP1 0042              STRONG_STOP_TEMP2 0043            CRC_16_END_FUNCTION 05D7  
                        AAAAN 05DB                          BANK7 038C                          EEPGD 0007  
                        M1_FR 0001                          M2_FR 0003                          T2CON 001C  
                        INDF0 0000                          INDF1 0001                          M1_ST 0000  
                        M2_ST 0002                          RC2IE 0005                          RC2IF 0005  
                        T4CON 0417                          IOCBF 0396                          IOCBN 0395  
                        IOCBP 0394                          FSR0H 0005                          FSR1H 0007  
                        IOCIE 0003                          IOCIF 0000                          FSR0L 0004  
                        FSR1L 0006                          PORTA 000C                          PORTB 000D  
                        PORTC 000E                          PORTD 000F                          PORTE 0010  
                        PORTF 028C                          PORTG 028D                          TRISA 008C  
                        TRISB 008D                          TRISC 008E                          TRISD 008F  
                        TRISE 0090                          TRISF 030C                          TRISG 030D  
                        M_RST 0005      MODBUS_ERROR_CODE_01_LOOP 034F      MODBUS_ERROR_CODE_02_LOOP 0363  
    MODBUS_ERROR_CODE_03_LOOP 0371      MODBUS_ERROR_CODE_04_LOOP 037F      MODBUS_ERROR_CODE_05_LOOP 038D  
    MODBUS_ERROR_CODE_06_LOOP 039B           CHECK_CRC16_IS_RIGHT 0151                         ADCON0 009D  
                       ADCON1 009E                         ADRESH 009C                         ADRESL 009B  
                       EEADRL 0191                         EEDATL 0193                         CCPR3L 0311  
                       EECON1 0195                         EECON2 0196                         ANSELA 018C  
                       ANSELE 0190                         ANSELF 040C                         ANSELG 040D  
                       RC2STA 0495                         PCLATH 000A                         INTCON 000B  
          MOTOR_1_WORK_CW_LV1 03F3            MOTOR_1_WORK_CW_LV2 0414            MOTOR_1_WORK_CW_LV3 03FF  
          MOTOR_1_WORK_CW_LV4 0402            MOTOR_1_WORK_CW_LV5 0437                         OSCCON 0099  
                       TMR2IE 0001                         TMR2IF 0001                         TMR2ON 0002  
                       TX2REG 0492                         TX2STA 0496                         STATUS 0003  
         TMR2IF_FUNCTION_LOOP 018C               RTU_COUNTER_DATA 002A              MOTOR_OE_RST_PORT 010C  
         MOTOR_1_WORKING_LOOP 03AC               SYSTEM_START_LV1 0288           MODBUS_ERROR_COUNTER 0049  
              PWM_1_COUNT_DAT 0040                        CCP3CON 0313            MOTOR_2_WORK_CW_LV1 04F4  
          MOTOR_2_WORK_CW_LV2 0515           MOTOR_1_WORK_CCW_LV1 045C           MOTOR_1_WORK_CCW_LV2 0480  
         MOTOR_1_WORK_CCW_LV3 046A           MOTOR_1_WORK_CCW_LV4 046D           MOTOR_1_WORK_CCW_LV5 04A4  
              PWM_2_COUNT_DAT 0041           MOTOR_1_WORK_CW_LOOP 03DC                        OSCSTAT 009A  
                      TP0_PIN 0000                        OSCTUNE 0098            CRC_16_FUNCTION_LV1 05C9  
       MOTOR_2_WORK_CW_FINISH 0507                     DELAY_10ms 063A                     DELAY_20ms 0639  
                   DELAY_10us 065B                     DELAY_20us 065A                     DELAY_40ms 0638  
                   DELAY_30us 0659                     DELAY_40us 0658                     DELAY_50us 0657  
                   DELAY_60us 0656                     DELAY_90us 0653            MOTOR1_IN_ROAT_FLAG 0001  
         TEN_MS_FUNCTION_LOOP 01C6         WAIT_EEPROM_WRITE_OVER 0628               CAN_SEND_TX_FLAG 0000  
      MOTOR_1_WORK_CCW_FINISH 047B          ROAT_MOTOR_IS_HI_FLAG 0003          MODBUS_DAT_EXTRA_ADRH 0020  
        MODBUS_DAT_EXTRA_ADRL 00B0             INTERRUPT_SUB_AREA 0006                     M1_ENCODER 0001  
        MOTOR_1_ZERO_FUNCTION 0306         SET_MODBUS_MODE_ENABLE 0D08                     EEPROM_ADR 007E  
          MOTOR1_IN_ZERO_FLAG 0000                     EEPROM_DAT 007F                     M2_ENCODER 0002  
          M1_NOT_COUNTER_TEMP 0053         MOTOR1_ZERO_IN_HI_LOOP 02E8                     CRC_HIBYTE 0028  
          RC2IF_FUNCTION_LOOP 0188                     CRC_LOBYTE 0029         MOTOR1_ZERO_IN_LO_LOOP 02BE  
         MOTOR_2_WORKING_LOOP 04B0          MODBUS_ERROR_CODE_END 035C              INT_INTF_FUNCTION 01DA  
                   ERROR_01_F 0000                     ERROR_02_F 0001                     ERROR_03_F 0002  
                   ERROR_04_F 0003                     ERROR_05_F 0004                     ERROR_06_F 0005  
   MOTOR1_ZERO_IN_HI_LOOP_LV1 02FA       MODBUS_RTU_READ_CRC_LOOP 01EB          MOTOR1_TIME_ZERO_LOOP 02FD  
           WATCH_SUB_FUNCTION 05A7        MOTOR_2_WORK_CCW_FINISH 0552             WATCH_SUB_FUNC_LV1 05AF  
         MOTOR_2_WORK_CCW_LV1 053F           MOTOR_2_WORK_CCW_LV2 0557                       ADC_WORK 059E  
       MODBUS_INTPUT_FUNCTION 0D1F           MOTOR_2_WORK_CW_LOOP 04E4                       CCPTMRS0 029E  
                     CCPTMRS1 029F          MOTOR_1_WORK_CCW_LOOP 0446                   MOTOR1_FLAG0 0031  
                 MOTOR1_FLAG1 0035                BOOTLOADER_LOOP 0005                   MOTOR2_FLAG0 0032  
                 MOTOR2_FLAG1 0036                    ADC_HI_DATA 007C               MODULE_WORK_LOOP 03A9  
          MOTOR2_IN_ROAT_FLAG 0001                 ID_SELECT_LOOP 0267                     MOTOR_1_CW 0002  
                   MOTOR_2_CW 0002           CRC_16_FUNCTION_LOOP 05C4                   MOTOR_1_WORK 0001  
                 MOTOR_2_WORK 0001             CLEAN_ALL_REGISTER 05FA                     WATCH_TEMP 0072  
                   OPTION_REG 0095            MOTOR2_IN_ZERO_FLAG 0000               MOTOR_1_ING_ZERO 0005  
                   TEN_MS_NUM 0002              STANDBY_HBYTE_DAT 004C               MOTOR_2_ING_ZERO 0005  
               TIMER2_INT_LV1 01B0                    DELAY_100ms 0636                    DELAY_100us 0652  
                  DELAY_200us 0651                    DELAY_300us 0650                    DELAY_400us 064F  
                  DELAY_500ms 0632                    DELAY_500us 064E                    DELAY_600us 064D  
        MOTOR_1_CW_IOC_SET_HI 042B              STANDBY_LBYTE_DAT 004D                    DELAY_TEMP1 0020  
                  DELAY_TEMP2 0021                    DELAY_TEMP3 0022              COPY_485_DATA_LV1 011A  
   MOTOR1_ZERO_IN_LO_LOOP_LV1 02D0                    FLAG1_BANK0 0030                     PWR_DECTET 0005  
                  FLAG3_BANK0 003A                    FLAG5_BANK0 003C                    FLAG6_BANK0 003D  
           MOTOR_1_IOC_FINISH 0007                  MODULE_ID_DAT 0025                  CAL_DATA_TEMP 0027  
           SET_TMR2_BASE_TIME 05E9          MODBUS_TABLE_ADR_TEMP 004A      POWER_LED_OUTPUT_FUNCTION 0269  
              SET_TMR2_INT_EN 05F2         MOTOR_1_CCW_IOC_SET_HI 0498                 IOC_HW_SETTING 0262  
     MODBUS_BUS_01_ERROR_LOOP 0138                    MAX485_PORT 038D               MODBUS_DAT_COUNT 002F  
                INT_TIMER_NUM 0004          MOTOR_2_ZERO_FUNCTION 0333          M1_ZERO_COUNTER_HBYTE 0050  
        M1_ZERO_COUNTER_LBYTE 0051        ANAY_MODBUS_CMD_03_LOOP 016C        ANAY_MODBUS_CMD_06_LOOP 0171  
     MODBUS_BUS_02_ERROR_LOOP 013A               TMR2_DIVIDER_SET 0015         MODBUS_ADR_A0_FUNCTION 0061  
       MODBUS_ADR_A1_FUNCTION 0078         CHECK_MOTOR2_ZERO_LOOP 0297    ANAY_MODBUS_CMD_COMMON_LOOP 0175  
       MODBUS_ADR_B0_FUNCTION 00D1         MODBUS_ADR_A2_FUNCTION 008E         MODBUS_ADR_B1_FUNCTION 00F3  
       MODBUS_ADR_A3_FUNCTION 00A4       MODBUS_BUS_03_ERROR_LOOP 013C          MOTOR_2_IOC_STOP_LOOP 04D2  
       MODBUS_ADR_C0_FUNCTION 00F3         MODBUS_ADR_B2_FUNCTION 00F3         MODBUS_ADR_A4_FUNCTION 00BA  
          TMR2IF_FUNCTION_LV0 0193         MODBUS_ADR_C1_FUNCTION 00F3         MODBUS_ADR_B3_FUNCTION 00F3  
              CHECK_IOC_IS_HI 042D                CHECK_IOC_IS_LO 043C           RESET_IN_NORMAL_FALG 0000  
       MODBUS_ADR_D0_FUNCTION 00F3         MODBUS_ADR_C2_FUNCTION 00F3         MODBUS_ADR_B4_FUNCTION 00F3  
                    AAAA_1800 05D9            WRITE_EEPROM_LOOP_1 0620         MODBUS_ADR_D1_FUNCTION 00F3  
       MODBUS_ADR_C3_FUNCTION 00F3         MODBUS_ADR_B5_FUNCTION 00F3         ADC_TAKE_DATA_FUNCTION 0591  
     MODBUS_BUS_04_ERROR_LOOP 013E                    READ_EEPROM 0610                IOCBF1_INT_LOOP 01D4  
       MODBUS_ADR_E0_FUNCTION 00F3         MODBUS_ADR_D2_FUNCTION 00F3         MODBUS_ADR_C4_FUNCTION 00F3  
       MODBUS_ADR_B6_FUNCTION 00F3          MOTOR_2_WORK_CCW_LOOP 052F                IOCBF2_INT_LOOP 01D7  
       MODBUS_ADR_E1_FUNCTION 00F3         MODBUS_ADR_D3_FUNCTION 00F3         MODBUS_ADR_C5_FUNCTION 00F3  
       MODBUS_ADR_B7_FUNCTION 00F3             WATCH_DAT_BUF_ADRH 0020             WATCH_DAT_BUF_ADRL 00BA  
       MODBUS_ADR_E2_FUNCTION 00F3         MODBUS_ADR_D4_FUNCTION 00F3         MODBUS_ADR_C6_FUNCTION 00F3  
       MODBUS_ADR_B8_FUNCTION 00F3                      DELAY_1ms 063F                      DELAY_2ms 063E  
                    DELAY_3ms 063D                      DELAY_4ms 063C                      DELAY_5ms 063B  
                    DELAY_2us 066B                      DELAY_3us 0669                      DELAY_4us 0667  
                    DELAY_5us 0665                      DELAY_6us 0663                      DELAY_7us 0661  
                    DELAY_8us 065F                      DELAY_9us 065D         MODBUS_ADR_E3_FUNCTION 00F3  
       MODBUS_ADR_D5_FUNCTION 00F3         MODBUS_ADR_C7_FUNCTION 00F3         MODBUS_ADR_B9_FUNCTION 00F3  
     MODBUS_BUS_05_ERROR_LOOP 0140           MODBUS_DAT_REAL_ADRH 0021           MODBUS_DAT_REAL_ADRL 0090  
               TMR2_BASE_TEMP 0023            MODBUS_RTU_READ_LV2 01E0              TEST_MAX485_LOOP1 057D  
       MODBUS_ADR_E4_FUNCTION 00F3         MODBUS_ADR_D6_FUNCTION 00F3         MODBUS_ADR_E5_FUNCTION 00F3  
       MODBUS_ADR_E6_FUNCTION 00F3                 MODBUS_IN_03_F 0001                 MODBUS_IN_06_F 0002  
               ADC_HW_SETTING 0247                   WRITE_EEPROM 061A       MODBUS_BUS_06_ERROR_LOOP 0142  
       MOTOR_1_WORK_CW_FINISH 040F                   ADC_LOW_DATA 007D           MODBUS_DAT_WORK_ADRH 0021  
         MODBUS_DAT_WORK_ADRL 0040          TEST_MAX485_LOOP1_LV1 0587                    MOTOR_1_CCW 0003  
                  MOTOR_2_CCW 0003               IOC_INT_FUNCTION 01CD                  MOTOR_1_RESET 0004  
                MOTOR_2_RESET 0004                MOTOR_1_HI_ZERO 0006                      TEST_PORT 038C  
                  WATCH_OUT_P 0110                   SYSTEM_START 0287                    TEN_TIME_EN 0001  
                  TEN_MS_TEMP 0048                   ADR_81_L_DAT 00A3        CHECK_PWM_FREQ_FUCNTION 0267  
        POWER_LED_OUTPUT_EXIT 026E                    SET_TMR2_ON 05F6          MODBUS_ADR_B0_03_LOOP 00F2  
        MODBUS_ADR_B0_06_LOOP 00D7            MODBUS_ADR_FUNCTION 000D                   DELAY_1000ms 0631  
                 DELAY_3000ms 062F                  WATCH_COUNTER 0070               POWER_CHECK_PORT 000D  
            MOTOR_1_NOW_IS_HI 0329              MOTOR_1_NOW_IS_LO 031F  MODBUS_TIMEOUT_IS_FINISH_LOOP 00F4  
                WATCH_OUT_DAT 0005                  WATCH_OUT_CLK 0006                   DELAY_LOOP_1 0645  
           COPY_485_DATA_LOOP 010E       MODBUS_CRC16_CHECK_IS_OK 0121               CHECKC_IOC_IS_HI 049A  
             CHECKC_IOC_IS_LO 04A6           PREPARE_TX_DATA_LOOP 0572       MODBUS_BUS_ID_ERROR_LOOP 0144  
                TMR2_BASE_SET 00A7                  TMR2_BASE_NUM 0004             MOTOR_CONTROL_PORT 010E  
          SETTING_PWM_HW_LOOP 0251                TX_DATA_COUNTER 002D       CHECK_CRC16_IS_RIGHT_LV1 015C  
                MAX485_SELECT 0003              IOC_COUNTER_HBYTE 0046              IOC_COUNTER_LBYTE 0047  
      CLEAN_ALL_REGISTER_LOOP 0602        MODBUS_BUS_ID_ERROR_LV1 014A       RESET_END_IN_NORMAL_LOOP 03CA  
            MODBUS_ADR_A0_LV1 0073              MODBUS_ADR_A1_LV1 008A              MODBUS_ADR_A2_LV1 00A0  
            MODBUS_ADR_A3_LV1 00B6              MODBUS_ADR_A4_LV1 00CD            ALL_MOTOR_STOP_FLAG 0004  
RESET_MODBUS_TIMEOUT_FUNCTION 01AC           SYSTEM_START_SETTING 01F7                WATCH_BIT_COUNT 0071  
               INT_TIMER_TEMP 0024                 INT_HW_SETTING 026F                TMR2IF_FUNC_LV1 0199  
           INT_TRIG_TIME_FLAG 0004  
