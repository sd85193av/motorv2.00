

Microchip MPLAB XC8 Assembler V2.40 build 20220703182018 
                                                                                                           Tue Oct 03 16:09:48 2023


     1                           	processor	16F1947
     2                           	pagewidth 132
     3                           	psect	udata_shr,global,class=COMMON,space=1,delta=1,noexec
     4                           	psect	udata,global,class=RAM,space=1,delta=1,noexec
     5                           	psect	udata_bank0,global,class=BANK0,space=1,delta=1,noexec
     6                           	psect	udata_bank1,global,class=BANK1,space=1,delta=1,noexec
     7                           	psect	udata_bank2,global,class=BANK2,space=1,delta=1,noexec
     8                           	psect	udata_bank3,global,class=BANK3,space=1,delta=1,noexec
     9                           	psect	udata_bank4,global,class=BANK4,space=1,delta=1,noexec
    10                           	psect	udata_bank5,global,class=BANK5,space=1,delta=1,noexec
    11                           	psect	udata_bank6,global,class=BANK6,space=1,delta=1,noexec
    12                           	psect	udata_bank7,global,class=BANK7,space=1,delta=1,noexec
    13                           	psect	udata_bank8,global,class=BANK8,space=1,delta=1,noexec
    14                           	psect	udata_bank9,global,class=BANK9,space=1,delta=1,noexec
    15                           	psect	udata_bank10,global,class=BANK10,space=1,delta=1,noexec
    16                           	psect	udata_bank11,global,class=BANK11,space=1,delta=1,noexec
    17                           	psect	udata_bank12,global,class=BANK12,space=1,delta=1,noexec
    18                           	psect	code,global,class=CODE,delta=2
    19                           	psect	data,global,class=STRCODE,delta=2,noexec
    20                           	psect	edata,global,class=EEDATA,space=3,delta=2,noexec
    21                           	psect	main,global,size=2048,class=CODE,delta=2
    22                           	psect	config,global,abs,ovrld,class=CONFIG,space=4,delta=2,noexec
    23                           
    24                           ;========================================================
    25                           ;================ Project Information ===================
    26                           ;========================================================
    27                           ;Project Name : MOTOR-MODULE_V2.00
    28                           ;Project Version:
    29                           ;Project object :
    30                           ;Project number :
    31                           ;Edit Date :
    32                           ;--------------------------------------------------------
    33                           ;========================================================
    34                           ;========================================================
    35                           ;========================================================
    36                           ;========================================================
    37                           ;======== PIC16F1947 Configuration Bit Settings =========
    38                           ;========================================================
    39                           ; PIC16F1947 Configuration Bit Settings
    40                           ; Assembly source line config statements
    41                           ; CONFIG1
    42                           ; CONFIG2
    43                           ;** ***************************************************************************************
    44                           ;==========================================================================
    45                           ; MPASM PIC16LF1947 processor include
    46                           ;
    47                           ; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
    48                           ;==========================================================================
    49                           ;==========================================================================
    50                           ; This header file defines configurations, registers, and other useful
    51                           ; bits of information for the PIC16LF1947 microcontroller. These names
    52                           ; are taken to match the data sheets as closely as possible.
    53                           ;
    54                           ; Note that the processor must be selected before this file is included.
    55                           ; The processor may be selected the following ways:
    56                           ;
    57                           ; 1. Command line switch:
    58                           ; C:\MPASM MYFILE.ASM /PIC16LF1947
    59                           ; 2. LIST directive in the source file
    60                           ; LIST P=PIC16LF1947
    61                           ; 3. Processor Type entry in the MPASM full-screen interface
    62                           ; 4. Setting the processor in the MPLAB Project Dialog
    63                           ;==========================================================================
    64                           ;==========================================================================
    65                           ;
    66                           ; Verify Processor
    67                           ;
    68                           ;==========================================================================
    69                           ; IFNDEF __16LF1947
    70                           ; MESSG "Processor-header file mismatch.  Verify selected processor."
    71                           ; ENDIF
    72                           ;==========================================================================
    73                           ;
    74                           ; Register Definitions
    75                           ;
    76                           ;==========================================================================
    77                           ;W EQU 0000H
    78                           ;F EQU 0001H
    79                           ;----- Register Files -----------------------------------------------------
    80                           ;-----Bank0------------------
    81     0003                     
    82                           ;FSR0 EQU 0004H
    83     0005                     
    84                           ;FSR1 EQU 0006H
    85     001F                     
    86                           ;-----Bank1------------------
    87     009E                     
    88                           ;-----Bank2------------------
    89     011F                     
    90                           ;-----Bank3------------------
    91     019F                     
    92                           ;-----Bank4------------------
    93     021F                     
    94                           ;-----Bank5------------------
    95     029F                     
    96                           ;-----Bank6------------------
    97     031E                     
    98                           ;-----Bank7------------------
    99     0396                     
   100                           ;-----Bank8------------------
   101     041E                     
   102                           ;-----Bank9------------------
   103     0497                     
   104                           ;-----Bank15------------------
   105     07B7                     
   106                           ;-----Bank31------------------
   107     0FEF                     
   108                           ;----- STATUS Bits -----------------------------------------------------
   109     0004                     
   110                           ;----- BSR Bits -----------------------------------------------------
   111     0004                     
   112                           ;----- INTCON Bits -----------------------------------------------------
   113     0005                     
   114                           ;----- PORTA Bits -----------------------------------------------------
   115     0007                     
   116                           ;----- PORTB Bits -----------------------------------------------------
   117     0000                     
   118                           ;----- PORTC Bits -----------------------------------------------------
   119     0002                     
   120                           ;----- PORTD Bits -----------------------------------------------------
   121     0006                     
   122                           ;----- PORTE Bits -----------------------------------------------------
   123     0007                     
   124                           ;----- PIR1 Bits -----------------------------------------------------
   125     0005                     
   126                           ;----- PIR2 Bits -----------------------------------------------------
   127     0007                     
   128                           ;----- PIR3 Bits -----------------------------------------------------
   129     0006                     
   130                           ;----- PIR4 Bits -----------------------------------------------------
   131     0005                     
   132                           ;----- T1CON Bits -----------------------------------------------------
   133     0007                     
   134                           ;----- T1GCON Bits -----------------------------------------------------
   135     0003                     
   136                           ;----- T2CON Bits -----------------------------------------------------
   137     0006                     
   138                           ;----- CPSCON0 Bits -----------------------------------------------------
   139     0007                     
   140                           ;----- CPSCON1 Bits -----------------------------------------------------
   141     0004                     
   142                           ;----- TRISA Bits -----------------------------------------------------
   143     0007                     
   144                           ;----- TRISB Bits -----------------------------------------------------
   145     0007                     
   146                           ;----- TRISC Bits -----------------------------------------------------
   147     0007                     
   148                           ;----- TRISD Bits -----------------------------------------------------
   149     0007                     
   150                           ;----- TRISE Bits -----------------------------------------------------
   151     0007                     
   152                           ;----- PIE1 Bits -----------------------------------------------------
   153     0005                     
   154                           ;----- PIE2 Bits -----------------------------------------------------
   155     0007                     
   156                           ;----- PIE3 Bits -----------------------------------------------------
   157     0006                     
   158                           ;----- PIE4 Bits -----------------------------------------------------
   159     0005                     
   160                           ;----- OPTION_REG Bits -----------------------------------------------------
   161     0005                     
   162                           ;----- PCON Bits -----------------------------------------------------
   163     0007                     
   164                           ;----- WDTCON Bits -----------------------------------------------------
   165     0005                     
   166                           ;----- OSCTUNE Bits -----------------------------------------------------
   167     0005                     
   168                           ;----- OSCCON Bits -----------------------------------------------------
   169     0007                     
   170                           ;----- OSCSTAT Bits -----------------------------------------------------
   171     0007                     
   172                           ;----- ADCON0 Bits -----------------------------------------------------
   173     0001                     
   174                           ;----- ADCON1 Bits -----------------------------------------------------
   175     0007                     
   176                           ;----- LATA Bits -----------------------------------------------------
   177     0007                     
   178                           ;----- LATB Bits -----------------------------------------------------
   179     0007                     
   180                           ;----- LATC Bits -----------------------------------------------------
   181     0007                     
   182                           ;----- LATD Bits -----------------------------------------------------
   183     0007                     
   184                           ;----- LATE Bits -----------------------------------------------------
   185     0007                     
   186                           ;----- CM1CON0 Bits -----------------------------------------------------
   187     0007                     
   188                           ;----- CM1CON1 Bits -----------------------------------------------------
   189     0007                     
   190                           ;----- CM2CON0 Bits -----------------------------------------------------
   191     0007                     
   192                           ;----- CM2CON1 Bits -----------------------------------------------------
   193     0007                     
   194                           ;----- CMOUT Bits -----------------------------------------------------
   195     0002                     
   196                           ;----- BORCON Bits -----------------------------------------------------
   197     0007                     
   198                           ;----- FVRCON Bits -----------------------------------------------------
   199     0007                     
   200                           ;----- DACCON0 Bits -----------------------------------------------------
   201     0007                     
   202                           ;----- DACCON1 Bits -----------------------------------------------------
   203     0004                     
   204                           ;----- SRCON0 Bits -----------------------------------------------------
   205     0007                     
   206                           ;----- SRCON1 Bits -----------------------------------------------------
   207     0007                     
   208                           ;----- APFCON Bits -----------------------------------------------------
   209     0007                     
   210                           ;----- CM3CON0 Bits -----------------------------------------------------
   211     0007                     
   212                           ;----- CM3CON1 Bits -----------------------------------------------------
   213     0007                     
   214                           ;----- ANSELA Bits -----------------------------------------------------
   215     0005                     
   216                           ;----- ANSELE Bits -----------------------------------------------------
   217     0002                     
   218                           ;----- EECON1 Bits -----------------------------------------------------
   219     0007                     
   220                           ;----- RC1STA Bits -----------------------------------------------------
   221     0007                     
   222                           ;----- RCSTA Bits -----------------------------------------------------
   223     0007                     
   224                           ;----- TX1STA Bits -----------------------------------------------------
   225     0007                     
   226                           ;----- TXSTA Bits -----------------------------------------------------
   227     0007                     
   228                           ;----- BAUD1CON Bits -----------------------------------------------------
   229     0007                     
   230                           ;----- WPUB Bits -----------------------------------------------------
   231     0007                     
   232                           ;----- SSP1STAT Bits -----------------------------------------------------
   233     0007                     
   234                           ;----- SSPSTAT Bits -----------------------------------------------------
   235     0007                     
   236                           ;----- SSP1CON1 Bits -----------------------------------------------------
   237     0007                     
   238                           ;----- SSPCON Bits -----------------------------------------------------
   239     0007                     
   240                           ;----- SSPCON1 Bits -----------------------------------------------------
   241     0007                     
   242                           ;----- SSP1CON2 Bits -----------------------------------------------------
   243     0007                     
   244                           ;----- SSPCON2 Bits -----------------------------------------------------
   245     0007                     
   246                           ;----- SSP1CON3 Bits -----------------------------------------------------
   247     0007                     
   248                           ;----- SSPCON3 Bits -----------------------------------------------------
   249     0007                     
   250                           ;----- SSP2STAT Bits -----------------------------------------------------
   251     0007                     
   252                           ;----- SSP2CON1 Bits -----------------------------------------------------
   253     0007                     
   254                           ;----- SSP2CON2 Bits -----------------------------------------------------
   255     0007                     
   256                           ;----- SSP2CON3 Bits -----------------------------------------------------
   257     0007                     
   258                           ;----- PORTF Bits -----------------------------------------------------
   259     0007                     
   260                           ;----- PORTG Bits -----------------------------------------------------
   261     0004                     
   262                           ;----- CCP1CON Bits -----------------------------------------------------
   263     0007                     
   264                           ;----- PWM1CON Bits -----------------------------------------------------
   265     0007                     
   266                           ;----- CCP1AS Bits -----------------------------------------------------
   267     0007                     
   268                           ;----- ECCP1AS Bits -----------------------------------------------------
   269     0007                     
   270                           ;----- PSTR1CON Bits -----------------------------------------------------
   271     0004                     
   272                           ;----- CCP2CON Bits -----------------------------------------------------
   273     0007                     
   274                           ;----- PWM2CON Bits -----------------------------------------------------
   275     0007                     
   276                           ;----- CCP2AS Bits -----------------------------------------------------
   277     0007                     
   278                           ;----- ECCP2AS Bits -----------------------------------------------------
   279     0007                     
   280                           ;----- PSTR2CON Bits -----------------------------------------------------
   281     0004                     
   282                           ;----- CCPTMRS0 Bits -----------------------------------------------------
   283     0007                     
   284                           ;----- CCPTMRS1 Bits -----------------------------------------------------
   285     0001                     
   286                           ;----- TRISF Bits -----------------------------------------------------
   287     0007                     
   288                           ;----- TRISG Bits -----------------------------------------------------
   289     0005                     
   290                           ;----- CCP3CON Bits -----------------------------------------------------
   291     0007                     
   292                           ;----- PWM3CON Bits -----------------------------------------------------
   293     0007                     
   294                           ;----- CCP3AS Bits -----------------------------------------------------
   295     0007                     
   296                           ;----- ECCP3AS Bits -----------------------------------------------------
   297     0007                     
   298                           ;----- PSTR3CON Bits -----------------------------------------------------
   299     0004                     
   300                           ;----- CCP4CON Bits -----------------------------------------------------
   301     0005                     
   302                           ;----- CCP5CON Bits -----------------------------------------------------
   303     0005                     
   304                           ;----- LATF Bits -----------------------------------------------------
   305     0007                     
   306                           ;----- LATG Bits -----------------------------------------------------
   307     0005                     
   308                           ;----- IOCBP Bits -----------------------------------------------------
   309     0007                     
   310                           ;----- IOCBN Bits -----------------------------------------------------
   311     0007                     
   312                           ;----- IOCBF Bits -----------------------------------------------------
   313     0007                     
   314                           ;----- ANSELF Bits -----------------------------------------------------
   315     0007                     
   316                           ;----- ANSELG Bits -----------------------------------------------------
   317     0004                     
   318                           ;----- T4CON Bits -----------------------------------------------------
   319     0006                     
   320                           ;----- T6CON Bits -----------------------------------------------------
   321     0006                     
   322                           ;----- WPUG Bits -----------------------------------------------------
   323     0005                     
   324                           ;----- RC2STA Bits -----------------------------------------------------
   325     0007                     
   326                           ;----- TX2STA Bits -----------------------------------------------------
   327     0007                     
   328                           ;----- BAUD2CON Bits -----------------------------------------------------
   329     0007                     
   330                           ;----- LCDCON Bits -----------------------------------------------------
   331     0007                     
   332                           ;----- LCDPS Bits -----------------------------------------------------
   333     0007                     
   334                           ;----- LCDREF Bits -----------------------------------------------------
   335     0007                     
   336                           ;----- LCDCST Bits -----------------------------------------------------
   337     0002                     
   338                           ;----- LCDRL Bits -----------------------------------------------------
   339     0007                     
   340                           ;----- LCDSE0 Bits -----------------------------------------------------
   341     0007                     
   342                           ;----- LCDSE1 Bits -----------------------------------------------------
   343     0007                     
   344                           ;----- LCDSE2 Bits -----------------------------------------------------
   345     0007                     
   346                           ;----- LCDSE3 Bits -----------------------------------------------------
   347     0007                     
   348                           ;----- LCDSE4 Bits -----------------------------------------------------
   349     0007                     
   350                           ;----- LCDSE5 Bits -----------------------------------------------------
   351     0005                     
   352                           ;----- LCDDATA0 Bits -----------------------------------------------------
   353     0007                     
   354                           ;----- LCDDATA1 Bits -----------------------------------------------------
   355     0007                     
   356                           ;----- LCDDATA2 Bits -----------------------------------------------------
   357     0007                     
   358                           ;----- LCDDATA3 Bits -----------------------------------------------------
   359     0007                     
   360                           ;----- LCDDATA4 Bits -----------------------------------------------------
   361     0007                     
   362                           ;----- LCDDATA5 Bits -----------------------------------------------------
   363     0007                     
   364                           ;----- LCDDATA6 Bits -----------------------------------------------------
   365     0007                     
   366                           ;----- LCDDATA7 Bits -----------------------------------------------------
   367     0007                     
   368                           ;----- LCDDATA8 Bits -----------------------------------------------------
   369     0007                     
   370                           ;----- LCDDATA9 Bits -----------------------------------------------------
   371     0007                     
   372                           ;----- LCDDATA10 Bits -----------------------------------------------------
   373     0007                     
   374                           ;----- LCDDATA11 Bits -----------------------------------------------------
   375     0007                     
   376                           ;----- LCDDATA12 Bits -----------------------------------------------------
   377     0007                     
   378                           ;----- LCDDATA13 Bits -----------------------------------------------------
   379     0007                     
   380                           ;----- LCDDATA14 Bits -----------------------------------------------------
   381     0005                     
   382                           ;----- LCDDATA15 Bits -----------------------------------------------------
   383     0007                     
   384                           ;----- LCDDATA16 Bits -----------------------------------------------------
   385     0007                     
   386                           ;----- LCDDATA17 Bits -----------------------------------------------------
   387     0005                     
   388                           ;----- LCDDATA18 Bits -----------------------------------------------------
   389     0007                     
   390                           ;----- LCDDATA19 Bits -----------------------------------------------------
   391     0007                     
   392                           ;----- LCDDATA20 Bits -----------------------------------------------------
   393     0005                     
   394                           ;----- LCDDATA21 Bits -----------------------------------------------------
   395     0007                     
   396                           ;----- LCDDATA22 Bits -----------------------------------------------------
   397     0007                     
   398                           ;----- LCDDATA23 Bits -----------------------------------------------------
   399     0005                     
   400                           ;----- STATUS_SHAD Bits -----------------------------------------------------
   401     0002                     
   402                           	psect	edata
   403                           
   404                           ;==========================================================================
   405                           ;
   406                           ; Configuration Bits
   407                           ;
   408                           ; NAME Address
   409                           ; CONFIG1 8007h
   410                           ; CONFIG2 8008h
   411                           ;
   412                           ;==========================================================================
   413                           ;========================================================
   414                           ;================ Project Information ===================
   415                           ;========================================================
   416                           ;Pin Assignment :
   417                           ;Project Name :
   418                           ;Project Version: V2.00 (Bate00)
   419                           ;Project object :
   420                           ;Project number :
   421                           ;Edit Date : 2023/04/18
   422                           ;--------------------------------------------------------
   423                           ;========================================================
   424                           ;========================================================
   425                           ;INCLUDE TITLE
   426                           ;========================================================
   427                           ;================ Project Information ===================
   428                           ;========================================================
   429                           ;Project Name : MODBUS RTU BASE
   430                           ;-------------------------------------------------------
   431                           ;Project Version: 2.00
   432                           ;Edit Date : 2023/09/28
   433                           ;Function Info :
   434                           ;-------------------------------------------------------
   435                           ;Description of Register Informatione (use FSR)
   436                           ;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
   437                           ;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
   438                           ;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
   439                           ;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
   440                           ;MODBUS_DAT_BUF_ADRL+4 : CRC counter
   441                           ;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
   442                           ;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
   443                           ;MODBUS_DAT_BUF_ADRL+7 : time out count
   444                           ;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG
   445                           ;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
   446                           ;-------------------------------------------------------
   447                           ;-------------------------------------------------------
   448                           ;-------------------------------------------------------
   449                           ;須被定義的部分
   450     0003                     
   451                           ;-------------------------------------------------------
   452     00B0                     
   453                           ;========================================================
   454                           ;========================================================
   455     0074                     
   456                           ;-------------------------------------------------------
   457     038C                     
   458                           ;-------------------------------------------------------
   459                           ;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
   460     0040                     
   461                           ;0X21 0X40-0X21 0X54 MOTOR1
   462                           ;0X21 0X55-0X21 0X69 MOTOR2
   463                           ;0X21 0X6A-0X21 0X7E MOTOR3
   464                           ;0X21 0X7F-0X21 0X93 MOTOR4
   465                           ;-------------------------------------------------------
   466                           ;--------------------------------------------------------
   467                           ;WATCH用的暫存器設定
   468     0006                     
   469                           ;--------------------------------------------------------
   470                           ;--------------------------------------------------------
   471                           ;mcu腳位定義
   472                           ;Pin assignment definition
   473     0003                     	;0->往光遮端方向 1->反方向
   474     0005                     	;0->表示電源沒有進入 1->表示有電源
   475     0002                     
   476                           ;--------------------------------------------------------
   477                           ;--------------------------------------------------------
   478                           ;========================================================
   479                           ;==================== 0X20 ~ 0X2F =======================
   480                           ;========================================================
   481                           ;Register definition
   482     002A                     	;用來計算MODBUS RTU
   483     002D                     	;整理UART TX傳送的資料數量
   484     002F                     
   485                           ;========================================================
   486                           ;==================== 0X30 ~ 0X3F =======================
   487                           ;========================================================
   488                           ;Register definition
   489                           ;--------------------------------------
   490     0000                     	;可以回傳資料FLAG
   491     0001                     	;可以動作FLAG
   492     0002                     	;RX資料有錯誤
   493     0003                     	;強制命令執行後SET
   494     0004                     	;表示INT地一次觸發啟動INT_TIMER功能
   495                           
   496                           ;--------------------------------------------------------
   497                           ;馬達1為轉向馬達(目前使用在注射泵)
   498     0001                     	;馬達1收到指令可以進行運作
   499     0002                     	;馬達1順時針
   500     0003                     	;馬達1逆時針
   501     0038                     
   502                           ;--------------------------------------------------------馬達參數設定
   503     0039                     	;在通訊判斷使用哪個馬達的情況下使用
   504     0003                     
   505                           ;--------------------------------------------------------
   506     0004                     	;CMD 0X83全部停止動作
   507                           
   508                           ;--------------------------------------------------------
   509     0001                     	;0表示沒有在功能碼03/1表示有在
   510     0002                     	;0表示沒有在功能碼06/1表示有在
   511                           
   512                           ;0X3D 0X3E 0X3F
   513                           ;========================================================
   514                           ;==================== 0X40 ~ 0X4F =======================
   515                           ;========================================================
   516                           ;Register definition
   517     0040                     	;每次一個PWM就+1
   518     0041                     	;每次一個PWM就+1
   519     0045                     
   520                           ;-----------------------------------------------
   521     004D                     	;用來暫存MODBUS中運算的資料
   522     00A0                     
   523                           ;--------------------------------------------------------------
   524                           ;------------------------BANK7參數設定-------------------------
   525                           ;--------------------------------------------------------------
   526     00A9                     
   527                           	psect	main
   528     0000                     	org	0
   529     0000  2805               	goto	BOOTLOADER_LOOP
   530     0004                     	org	4
   531     0004  2806               	goto	INTERRUPT_SUB_AREA
   532     0005                     BOOTLOADER_LOOP:	
   533                           ;* ****************************************************************************************
   534                           ;* Label Start
   535                           ;*
   536                           ;========================================================
   537                           ;================== BOOTLOADER副程式 ====================
   538                           ;========================================================
   539                           
   540     0005  29D9               	goto	SYSTEM_START_SETTING
   541     0006                     INTERRUPT_SUB_AREA:	
   542                           ;========================================================
   543                           ;================== 中斷副程式起始位址 ==================
   544                           ;========================================================
   545                           
   546     0006  3180               	pagesel	0
   547     0007  0020               	banksel	12
   548                           
   549                           ;--------------------------
   550     0008  1A94               	btfsc	20,5
   551     0009  28BA               	goto	RC2IF_FUNCTION_LOOP	;硬體UART2收資料
   552                           
   553                           ;--------------------------
   554     000A  1891               	btfsc	17,1
   555     000B  28BE               	goto	TMR2IF_FUNCTION_LOOP	;TIMER2基準為1mS
   556                           
   557                           ;--------------------------
   558     000C  188B               	btfsc	11,1
   559     000D  2927               	goto	INT_INTF_FUNCTION	;PWM INT
   560                           
   561                           ;-----------
   562     000E  180B               	btfsc	11,0
   563     000F  28FF               	goto	IOC_INT_FUNCTION	;光遮斷器觸發
   564     0010  0009               	retfie
   565     0011                     MODBUS_ADR_FUNCTION:	
   566                           ;******************************************************************************
   567                           ;****************************TABLE表區域***************************************
   568                           ;========================================================
   569                           ;==================中斷UART2 FUNCTION====================
   570                           ;========================================================
   571                           
   572     0011  3000               	movlw	0
   573     0012  008A               	movwf	10
   574     0013  084A               	movf	74,w
   575     0014  000B               	brw
   576     0015  2865               	goto	MODBUS_ADR_A0_FUNCTION	;00
   577     0016  2876               	goto	MODBUS_ADR_A1_FUNCTION	;01
   578     0017  2887               	goto	MODBUS_ADR_A2_FUNCTION	;02
   579     0018  2898               	goto	MODBUS_ADR_A3_FUNCTION	;03
   580     0019  28A9               	goto	MODBUS_ADR_A4_FUNCTION	;04
   581     001A  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;05
   582     001B  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;06
   583     001C  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;07
   584     001D  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;08
   585     001E  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;09
   586     001F  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0A
   587     0020  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0B
   588     0021  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0C
   589     0022  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0D
   590     0023  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0E
   591     0024  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;0F
   592                           
   593                           ;-----------------------------
   594     0025  28BA               	goto	MODBUS_ADR_B0_FUNCTION	;10
   595     0026  28BA               	goto	MODBUS_ADR_B1_FUNCTION	;11
   596     0027  28BA               	goto	MODBUS_ADR_B2_FUNCTION	;12
   597     0028  28BA               	goto	MODBUS_ADR_B3_FUNCTION	;13
   598     0029  28BA               	goto	MODBUS_ADR_B4_FUNCTION	;14
   599     002A  28BA               	goto	MODBUS_ADR_B5_FUNCTION	;15
   600     002B  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;16
   601     002C  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;17
   602     002D  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;18
   603     002E  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;19
   604     002F  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1A
   605     0030  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1B
   606     0031  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1C
   607     0032  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1D
   608     0033  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1E
   609     0034  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;1F
   610                           
   611                           ;-----------------------------
   612     0035  28BA               	goto	MODBUS_ADR_C0_FUNCTION	;20
   613     0036  28BA               	goto	MODBUS_ADR_C1_FUNCTION	;21
   614     0037  28BA               	goto	MODBUS_ADR_C2_FUNCTION	;22
   615     0038  28BA               	goto	MODBUS_ADR_C3_FUNCTION	;23
   616     0039  28BA               	goto	MODBUS_ADR_C4_FUNCTION	;24
   617     003A  28BA               	goto	MODBUS_ADR_C5_FUNCTION	;25
   618     003B  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;26
   619     003C  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;27
   620     003D  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;28
   621     003E  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;29
   622     003F  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2A
   623     0040  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2B
   624     0041  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2C
   625     0042  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2D
   626     0043  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2E
   627     0044  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;2F
   628                           
   629                           ;-----------------------------
   630     0045  28BA               	goto	MODBUS_ADR_D0_FUNCTION	;30
   631     0046  28BA               	goto	MODBUS_ADR_D1_FUNCTION	;31
   632     0047  28BA               	goto	MODBUS_ADR_D2_FUNCTION	;32
   633     0048  28BA               	goto	MODBUS_ADR_D3_FUNCTION	;33
   634     0049  28BA               	goto	MODBUS_ADR_D4_FUNCTION	;34
   635     004A  28BA               	goto	MODBUS_ADR_D5_FUNCTION	;35
   636     004B  28BA               	goto	MODBUS_ADR_D6_FUNCTION	;36
   637     004C  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;37
   638     004D  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;38
   639     004E  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;39
   640     004F  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3A
   641     0050  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3B
   642     0051  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3C
   643     0052  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3D
   644     0053  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3E
   645     0054  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;3F
   646                           
   647                           ;-----------------------------
   648     0055  28BA               	goto	MODBUS_ADR_E0_FUNCTION	;40
   649     0056  28BA               	goto	MODBUS_ADR_E1_FUNCTION	;41
   650     0057  28BA               	goto	MODBUS_ADR_E2_FUNCTION	;42
   651     0058  28BA               	goto	MODBUS_ADR_E3_FUNCTION	;43
   652     0059  28BA               	goto	MODBUS_ADR_E4_FUNCTION	;44
   653     005A  28BA               	goto	MODBUS_ADR_E5_FUNCTION	;45
   654     005B  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;46
   655     005C  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;47
   656     005D  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;48
   657     005E  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;49
   658     005F  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4A
   659     0060  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4B
   660     0061  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4C
   661     0062  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4D
   662     0063  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4E
   663     0064  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;4F
   664     0065                     MODBUS_ADR_A0_FUNCTION:	
   665                           ;-----------------------------
   666                           ;******************************************************************
   667                           ;******************************************************************
   668                           ;========================================================
   669                           ;==================MODBUS 恢復出廠設定===================
   670                           ;========================================================
   671                           
   672     0065  18BC               	btfsc	60,1
   673     0066  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   674                           
   675                           ;--------------------------------
   676     0067  1D3C               	btfss	60,2
   677     0068  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   678                           
   679                           ;--------------------------------
   680                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   681     0069  3020               	movlw	32	;20B0
   682     006A  0087               	movwf	7
   683     006B  30B0               	movlw	176
   684     006C  0086               	movwf	6
   685     006D  300D               	movlw	13
   686     006E  0786               	addwf	6,f
   687     006F  0801               	movf	1,w
   688     0070  1D03               	btfss	3,2
   689     0071  2876               	goto	MODBUS_ADR_A0_LV1
   690                           
   691                           ;-----------------------
   692     0072  0A86               	incf	6,f
   693     0073  0801               	movf	1,w
   694     0074  1903               	btfsc	3,2
   695     0075  2963               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   696     0076                     MODBUS_ADR_A0_LV1:
   697     0076                     MODBUS_ADR_A1_FUNCTION:	
   698                           ;將所有參數設定為預設值
   699                           ;========================================================
   700                           ;==================MODBUS 整機初始化=====================
   701                           ;========================================================
   702                           
   703     0076  18BC               	btfsc	60,1
   704     0077  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   705                           
   706                           ;--------------------------------
   707     0078  1D3C               	btfss	60,2
   708     0079  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   709                           
   710                           ;--------------------------------
   711                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   712     007A  3020               	movlw	32	;20B0
   713     007B  0087               	movwf	7
   714     007C  30B0               	movlw	176
   715     007D  0086               	movwf	6
   716     007E  300D               	movlw	13
   717     007F  0786               	addwf	6,f
   718     0080  0801               	movf	1,w
   719     0081  1D03               	btfss	3,2
   720     0082  2876               	goto	MODBUS_ADR_A0_LV1
   721                           
   722                           ;-----------------------
   723     0083  0A86               	incf	6,f
   724     0084  0801               	movf	1,w
   725     0085  1903               	btfsc	3,2
   726     0086  2963               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   727     0087                     MODBUS_ADR_A1_LV1:
   728     0087                     MODBUS_ADR_A2_FUNCTION:	
   729                           ;將所有參數設定為預設值
   730                           ;========================================================
   731                           ;==================MODBUS 換向閥初始化===================
   732                           ;========================================================
   733                           
   734     0087  18BC               	btfsc	60,1
   735     0088  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   736                           
   737                           ;--------------------------------
   738     0089  1D3C               	btfss	60,2
   739     008A  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   740                           
   741                           ;--------------------------------
   742                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   743     008B  3020               	movlw	32	;20B0
   744     008C  0087               	movwf	7
   745     008D  30B0               	movlw	176
   746     008E  0086               	movwf	6
   747     008F  300D               	movlw	13
   748     0090  0786               	addwf	6,f
   749     0091  0801               	movf	1,w
   750     0092  1D03               	btfss	3,2
   751     0093  2898               	goto	MODBUS_ADR_A2_LV1
   752                           
   753                           ;-----------------------
   754     0094  0A86               	incf	6,f
   755     0095  0801               	movf	1,w
   756     0096  1903               	btfsc	3,2
   757     0097  2963               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   758     0098                     MODBUS_ADR_A2_LV1:
   759     0098                     MODBUS_ADR_A3_FUNCTION:	
   760                           ;將所有參數設定為預設值
   761                           ;========================================================
   762                           ;==================MODBUS 活塞初始化=====================
   763                           ;========================================================
   764                           
   765     0098  18BC               	btfsc	60,1
   766     0099  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   767                           
   768                           ;--------------------------------
   769     009A  1D3C               	btfss	60,2
   770     009B  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   771                           
   772                           ;--------------------------------
   773                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   774     009C  3020               	movlw	32	;20B0
   775     009D  0087               	movwf	7
   776     009E  30B0               	movlw	176
   777     009F  0086               	movwf	6
   778     00A0  300D               	movlw	13
   779     00A1  0786               	addwf	6,f
   780     00A2  0801               	movf	1,w
   781     00A3  1D03               	btfss	3,2
   782     00A4  28A9               	goto	MODBUS_ADR_A3_LV1
   783                           
   784                           ;-----------------------
   785     00A5  0A86               	incf	6,f
   786     00A6  0801               	movf	1,w
   787     00A7  1903               	btfsc	3,2
   788     00A8  2963               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   789     00A9                     MODBUS_ADR_A3_LV1:
   790     00A9                     MODBUS_ADR_A4_FUNCTION:	
   791                           ;將所有參數設定為預設值
   792                           ;========================================================
   793                           ;==================MODBUS 醒目提示=======================
   794                           ;========================================================
   795                           
   796     00A9  18BC               	btfsc	60,1
   797     00AA  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;這邊只能用寫，讀的話算是異常碼02
   798                           
   799                           ;--------------------------------
   800     00AB  1D3C               	btfss	60,2
   801     00AC  2961               	goto	MODBUS_BUS_02_ERROR_LOOP	;
   802                           
   803                           ;--------------------------------
   804                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   805     00AD  3020               	movlw	32	;20B0
   806     00AE  0087               	movwf	7
   807     00AF  30B0               	movlw	176
   808     00B0  0086               	movwf	6
   809     00B1  300D               	movlw	13
   810     00B2  0786               	addwf	6,f
   811     00B3  0801               	movf	1,w
   812     00B4  1D03               	btfss	3,2
   813     00B5  28BA               	goto	MODBUS_ADR_A4_LV1
   814                           
   815                           ;-----------------------
   816     00B6  0A86               	incf	6,f
   817     00B7  0801               	movf	1,w
   818     00B8  1903               	btfsc	3,2
   819     00B9  2963               	goto	MODBUS_BUS_03_ERROR_LOOP	;資料都是0X00
   820     00BA                     MODBUS_ADR_A4_LV1:
   821     00BA                     MODBUS_ADR_B0_FUNCTION:	
   822                           ;將所有參數設定為預設值
   823                           ;========================================================
   824                           ;==================MODBUS 閥換向=========================
   825                           ;========================================================
   826                           
   827     00BA                     MODBUS_ADR_B1_FUNCTION:	
   828                           ;========================================================
   829                           ;==================MODBUS 活塞移動-絕對位置==============
   830                           ;========================================================
   831                           
   832     00BA                     MODBUS_ADR_B2_FUNCTION:	
   833                           ;========================================================
   834                           ;==================MODBUS 活塞移動-相對位置==============
   835                           ;========================================================
   836                           
   837     00BA                     MODBUS_ADR_B3_FUNCTION:	
   838                           ;========================================================
   839                           ;==================MODBUS 活塞移動-向量-CW===============
   840                           ;========================================================
   841                           
   842     00BA                     MODBUS_ADR_B4_FUNCTION:	
   843                           ;========================================================
   844                           ;==================MODBUS 活塞移動-向量-CCW==============
   845                           ;========================================================
   846                           
   847     00BA                     MODBUS_ADR_B5_FUNCTION:	
   848                           ;========================================================
   849                           ;==================MODBUS 活塞移動-極限==================
   850                           ;========================================================
   851                           
   852     00BA                     MODBUS_ADR_C0_FUNCTION:	
   853                           ;========================================================
   854                           ;==================MODBUS 零點偏移量設定=================
   855                           ;========================================================
   856                           
   857     00BA                     MODBUS_ADR_C1_FUNCTION:	
   858                           ;========================================================
   859                           ;==================MODBUS 累計步數=======================
   860                           ;========================================================
   861                           
   862     00BA                     MODBUS_ADR_C2_FUNCTION:	
   863                           ;========================================================
   864                           ;==================MODBUS 相對零點設定===================
   865                           ;========================================================
   866                           
   867     00BA                     MODBUS_ADR_C3_FUNCTION:	
   868                           ;========================================================
   869                           ;==================MODBUS 反向間隙設定-CW===============
   870                           ;========================================================
   871                           
   872     00BA                     MODBUS_ADR_C4_FUNCTION:	
   873                           ;========================================================
   874                           ;==================MODBUS 反向間隙設定-CCW==============
   875                           ;========================================================
   876                           
   877     00BA                     MODBUS_ADR_C5_FUNCTION:	
   878                           ;========================================================
   879                           ;==================MODBUS 自動校正反向間隙==============
   880                           ;========================================================
   881                           
   882     00BA                     MODBUS_ADR_D0_FUNCTION:	
   883                           ;========================================================
   884                           ;==================MODBUS 安全模式======================
   885                           ;========================================================
   886                           
   887     00BA                     MODBUS_ADR_D1_FUNCTION:	
   888                           ;========================================================
   889                           ;==================MODBUS 設備狀態======================
   890                           ;========================================================
   891                           
   892     00BA                     MODBUS_ADR_D2_FUNCTION:	
   893                           ;========================================================
   894                           ;==================MODBUS 設備辨識資料==================
   895                           ;========================================================
   896                           
   897     00BA                     MODBUS_ADR_D3_FUNCTION:	
   898                           ;========================================================
   899                           ;==================MODBUS 溫度檢測======================
   900                           ;========================================================
   901                           
   902     00BA                     MODBUS_ADR_D4_FUNCTION:	
   903                           ;========================================================
   904                           ;==================MODBUS 電流檢測======================
   905                           ;========================================================
   906                           
   907     00BA                     MODBUS_ADR_D5_FUNCTION:	
   908                           ;========================================================
   909                           ;==================MODBUS 電壓檢測======================
   910                           ;========================================================
   911                           
   912     00BA                     MODBUS_ADR_D6_FUNCTION:	
   913                           ;========================================================
   914                           ;==================MODBUS 上電初始化設定================
   915                           ;========================================================
   916                           
   917     00BA                     MODBUS_ADR_E0_FUNCTION:	
   918                           ;========================================================
   919                           ;==================MODBUS 開發人員權限啟動==============
   920                           ;========================================================
   921                           
   922     00BA                     MODBUS_ADR_E1_FUNCTION:	
   923                           ;========================================================
   924                           ;==================MODBUS 活塞最大行程設定==============
   925                           ;========================================================
   926                           
   927     00BA                     MODBUS_ADR_E2_FUNCTION:	
   928                           ;========================================================
   929                           ;==================MODBUS 微步進模式====================
   930                           ;========================================================
   931                           
   932     00BA                     MODBUS_ADR_E3_FUNCTION:	
   933                           ;========================================================
   934                           ;==================MODBUS 活塞移動-光耦合===============
   935                           ;========================================================
   936                           
   937     00BA                     MODBUS_ADR_E4_FUNCTION:	
   938                           ;========================================================
   939                           ;==================MODBUS 速度設定======================
   940                           ;========================================================
   941                           
   942     00BA                     MODBUS_ADR_E5_FUNCTION:	
   943                           ;========================================================
   944                           ;==================MODBUS 速度==========================
   945                           ;========================================================
   946                           
   947     00BA                     RC2IF_FUNCTION_LOOP:	
   948                           ;******************************************************************************
   949                           ;******************************************************************************
   950                           ;========================================================
   951                           ;==================中斷UART2 FUNCTION====================
   952                           ;========================================================
   953                           
   954     00BA  3188               	pagesel	2048
   955     00BB  
                 warning: (2090) fixup overflow storing 0xD1F in 2 bytes
                 251F               	call	MODBUS_INTPUT_FUNCTION	;將資料存在INDF1
   956     00BC  3180               	pagesel	0
   957     00BD  0009               	retfie
   958     00BE                     TMR2IF_FUNCTION_LOOP:	
   959                           ;========================================================
   960                           ;==================中斷TIMER2 FUNCTION===================
   961                           ;========================================================
   962                           ;TIMER2 BASE IS 1mS
   963                           
   964     00BE  1091               	bcf	17,1
   965                           
   966                           ;---------------------
   967     00BF  1CBA               	btfss	58,1
   968     00C0  28C5               	goto	TMR2IF_FUNCTION_LV0
   969     00C1  0848               	movf	72,w
   970     00C2  1903               	btfsc	3,2
   971     00C3  20F8               	call	TEN_MS_FUNCTION_LOOP
   972     00C4  03C8               	decf	72,f
   973     00C5                     TMR2IF_FUNCTION_LV0:
   974     00C5  1E30               	btfss	48,4
   975     00C6  28CB               	goto	TMR2IF_FUNC_LV1
   976                           
   977                           ;---------
   978     00C7  0824               	movf	36,w
   979     00C8  1903               	btfsc	3,2
   980     00C9  28E2               	goto	TIMER2_INT_LV1
   981     00CA  03A4               	decf	36,f
   982     00CB                     TMR2IF_FUNC_LV1:
   983                           
   984                           ;判斷是否MODBUS RTU TIMEOUT 要啟動
   985     00CB  3020               	movlw	32
   986     00CC  0087               	movwf	7
   987     00CD  30B0               	movlw	176
   988     00CE  0086               	movwf	6
   989     00CF  3008               	movlw	8
   990     00D0  0786               	addwf	6,f
   991     00D1  1C01               	btfss	1,0
   992     00D2  0009               	retfie
   993     00D3  0020               	banksel	12
   994                           
   995                           ;-----------------------------------
   996     00D4  0386               	decf	6,f
   997     00D5  0801               	movf	1,w
   998     00D6  1D03               	btfss	3,2
   999     00D7  28DE               	goto	RESET_MODBUS_TIMEOUT_FUNCTION
  1000                           
  1001                           ;-----------------------------------
  1002     00D8  0020               	banksel	12
  1003     00D9  0823               	movf	35,w
  1004     00DA  1903               	btfsc	3,2
  1005     00DB  292D               	goto	MODBUS_TIMEOUT_IS_FINISH_LOOP
  1006                           
  1007                           ;----------------------------------=
  1008     00DC  03A3               	decf	35,f
  1009     00DD  0009               	retfie
  1010     00DE                     RESET_MODBUS_TIMEOUT_FUNCTION:	
  1011                           ;-------------------------------------------------------
  1012                           
  1013                           
  1014                           ;表示還是持續有收到資料，TIME OUT 資料重製
  1015     00DE  0181               	clrf	1
  1016     00DF  3004               	movlw	4
  1017     00E0  00A3               	movwf	35
  1018     00E1  0009               	retfie
  1019     00E2                     TIMER2_INT_LV1:	
  1020                           ;------------------------------------------------------
  1021                           ;INT 時間
  1022                           
  1023     00E2  3004               	movlw	4
  1024     00E3  00A4               	movwf	36
  1025     00E4  0AC1               	incf	65,f
  1026     00E5  1230               	bcf	48,4
  1027     00E6  108B               	bcf	11,1
  1028     00E7  160B               	bsf	11,4
  1029     00E8  1EB2               	btfss	50,5
  1030     00E9  0009               	retfie
  1031     00EA  3021               	movlw	33
  1032     00EB  0085               	movwf	5
  1033     00EC  3040               	movlw	64
  1034     00ED  0084               	movwf	4
  1035     00EE  3015               	movlw	21
  1036     00EF  0784               	addwf	4,f
  1037     00F0  3005               	movlw	5
  1038     00F1  0784               	addwf	4,f
  1039     00F2  3001               	movlw	1
  1040     00F3  0280               	subwf	0,f
  1041     00F4  0384               	decf	4,f
  1042     00F5  3000               	movlw	0
  1043     00F6  3B80               	subwfb	0,f
  1044     00F7  0009               	retfie
  1045     00F8                     TEN_MS_FUNCTION_LOOP:
  1046     00F8  3002               	movlw	2
  1047     00F9  00C8               	movwf	72
  1048     00FA  3001               	movlw	1
  1049     00FB  07C7               	addwf	71,f
  1050     00FC  3000               	movlw	0
  1051     00FD  3DC6               	addwfc	70,f
  1052     00FE  0008               	return
  1053     00FF                     IOC_INT_FUNCTION:	
  1054                           ;========================================================
  1055                           ;==================中斷IOC FUNCTION====================
  1056                           ;========================================================
  1057                           
  1058     00FF  100B               	bcf	11,0
  1059     0100  0027               	banksel	918
  1060     0101  1896               	btfsc	918,1
  1061     0102  2106               	call	IOCBF1_INT_LOOP
  1062                           
  1063                           ;--------
  1064     0103  1916               	btfsc	918,2
  1065     0104  2109               	call	IOCBF2_INT_LOOP
  1066     0105  0009               	retfie
  1067     0106                     IOCBF1_INT_LOOP:	
  1068                           ;----------------------------------------------------------
  1069                           
  1070     0106  1096               	bcf	918,1
  1071     0107  0027               	banksel	918
  1072     0108  0008               	return
  1073     0109                     IOCBF2_INT_LOOP:
  1074     0109  1116               	bcf	918,2
  1075     010A  0020               	banksel	12
  1076     010B  2912               	goto	IOCBF2_INT_EXIT
  1077     010C                     IOCBF2_INT_LOOP_LV1:	
  1078                           ;BANKSEL PORTF
  1079                           ;BSF PORTF,0X05
  1080                           ;BCF PORTF,0X05
  1081                           ;BANKSEL PORTA
  1082                           ; MOVF IOC_COUNTER_HBYTE,W
  1083                           ; BTFSS STATUS,Z
  1084                           ; GOTO IOCBF2_INT_LOOP_LV1
  1085 ;;------
  1086                           ; MOVLW 0XFF
  1087                           ; ADDWF IOC_COUNTER_LBYTE,W
  1088                           ; BTFSS STATUS,C
  1089                           ; GOTO IOC_ROCK_FUNCTION
  1090                           ;------------------------------------------
  1091                           
  1092     010C  0020               	banksel	12
  1093     010D  0AC0               	incf	64,f
  1094     010E  17F2               	bsf	114,7
  1095                           
  1096                           ;BTFSC FLAG3_BANK0,NOW_IS_LO_HI_STATUS
  1097     010F  190D               	btfsc	13,2
  1098     0110  2914               	goto	IOCB2_HI_TO_LO
  1099     0111  291C               	goto	IOCB2_LO_TO_HI
  1100     0112                     IOCBF2_INT_EXIT:
  1101     0112  0027               	banksel	918
  1102     0113  0008               	return
  1103     0114                     IOCB2_HI_TO_LO:
  1104     0114  0027               	banksel	917
  1105     0115  1515               	bsf	917,2
  1106     0116  1114               	bcf	916,2
  1107     0117  0020               	banksel	12
  1108     0118  103A               	bcf	58,0
  1109     0119  01C6               	clrf	70
  1110     011A  01C7               	clrf	71
  1111     011B  2912               	goto	IOCBF2_INT_EXIT
  1112     011C                     IOCB2_LO_TO_HI:
  1113     011C  0027               	banksel	917
  1114     011D  1115               	bcf	917,2
  1115     011E  1514               	bsf	916,2
  1116     011F  0020               	banksel	12
  1117                           
  1118                           ;BANKSEL PORTF
  1119                           ;BSF PORTF,0X02
  1120                           ;BCF PORTF,0X02
  1121                           ;BANKSEL PORTA
  1122     0120  143A               	bsf	58,0
  1123     0121  01C6               	clrf	70
  1124     0122  01C7               	clrf	71
  1125     0123  2912               	goto	IOCBF2_INT_EXIT
  1126     0124                     IOC_ROCK_FUNCTION:
  1127     0124  01C6               	clrf	70
  1128     0125  01C7               	clrf	71
  1129     0126  2912               	goto	IOCBF2_INT_EXIT
  1130     0127                     INT_INTF_FUNCTION:	
  1131                           ;========================================================
  1132                           ;==================中斷INT FUNCTION====================
  1133                           ;========================================================
  1134                           
  1135     0127  108B               	bcf	11,1
  1136     0128  1A30               	btfsc	48,4
  1137     0129  0009               	retfie
  1138     012A  1630               	bsf	48,4
  1139     012B  120B               	bcf	11,4
  1140     012C  0009               	retfie
  1141     012D                     MODBUS_TIMEOUT_IS_FINISH_LOOP:	
  1142                           ;========================================================
  1143                           ;=============MODBUS TIMEOUT到要進行分析的動作===========
  1144                           ;========================================================
  1145                           ;表示TIMEOUT到了，可以進行分析的動作
  1146                           
  1147     012D  3004               	movlw	4
  1148     012E  00A3               	movwf	35
  1149     012F  0029               	banksel	1173
  1150     0130  1215               	bcf	1173,4	;要進行分析資料前，先把UART RX關閉確保資料不會錯誤
  1151     0131  0020               	banksel	12
  1152     0132  3020               	movlw	32	;20B0
  1153     0133  0087               	movwf	7
  1154     0134  30B0               	movlw	176
  1155     0135  0086               	movwf	6
  1156     0136  3008               	movlw	8	;MODBUS_FLAG
  1157     0137  0786               	addwf	6,f
  1158     0138  0181               	clrf	1
  1159                           
  1160                           ;----------------------------------------------------------
  1161     0139  3020               	movlw	32
  1162     013A  0087               	movwf	7
  1163     013B  30B0               	movlw	176
  1164     013C  0086               	movwf	6
  1165     013D  3003               	movlw	3	;MODBUS的DATA OFFSET
  1166     013E  0786               	addwf	6,f
  1167     013F  0801               	movf	1,w
  1168     0140  00AA               	movwf	42	;得到這次MODBUS所有的資料數量
  1169     0141  00AF               	movwf	47
  1170     0142  00C9               	movwf	73
  1171     0143  3002               	movlw	2
  1172     0144  02AA               	subwf	42,f
  1173     0145  0181               	clrf	1
  1174                           
  1175                           ;----------------------------------------------------------
  1176     0146  2978               	goto	CHECK_CRC16_IS_RIGHT
  1177     0147                     MODBUS_CRC16_CHECK_IS_OK:	
  1178                           ;===================================================
  1179                           ;============MODBUS的CRC16驗證正確==================
  1180                           ;===================================================
  1181                           
  1182     0147  0020               	banksel	12
  1183     0148  3020               	movlw	32
  1184     0149  0087               	movwf	7
  1185     014A  30B0               	movlw	176
  1186     014B  0086               	movwf	6
  1187     014C  300A               	movlw	10
  1188     014D  0786               	addwf	6,f
  1189                           
  1190                           ;----------------------------------------------------------
  1191     014E  0801               	movf	1,w
  1192     014F  0625               	xorwf	37,w
  1193     0150  1D03               	btfss	3,2
  1194     0151  296B               	goto	MODBUS_BUS_ID_ERROR_LOOP
  1195                           
  1196                           ;----------------------------------------------------------表示DEVICE ID 不對
  1197     0152  3008               	movlw	8
  1198     0153  062F               	xorwf	47,w
  1199     0154  1D03               	btfss	3,2
  1200     0155  296B               	goto	MODBUS_BUS_ID_ERROR_LOOP	;當今天收到的資料數量大於8表示異常
  1201                           
  1202                           ;---------------
  1203     0156  0A86               	incf	6,f	;資料為功能碼
  1204     0157  3003               	movlw	3
  1205     0158  0601               	xorwf	1,w
  1206     0159  1903               	btfsc	3,2
  1207     015A  2993               	goto	ANAY_MODBUS_CMD_03_LOOP	;功能碼是READ ONE BYTE
  1208                           
  1209                           ;---------------
  1210     015B  3006               	movlw	6
  1211     015C  0601               	xorwf	1,w
  1212     015D  1903               	btfsc	3,2
  1213     015E  29AA               	goto	ANAY_MODBUS_CMD_06_LOOP	;功能碼是WRITE ONE BYTE
  1214     015F                     MODBUS_BUS_01_ERROR_LOOP:	
  1215                           ;目前功能碼只有接0X03 0X06，其他的算是ERROR
  1216                           ;===================================================
  1217                           ;============MODBUS的功能碼錯誤=====================
  1218                           ;===================================================
  1219                           ;MODBUS RTU ERROR CODE 01
  1220                           ;非法功能，表示非授權的功能碼
  1221                           
  1222     015F  143B               	bsf	59,0
  1223     0160  0009               	retfie
  1224     0161                     MODBUS_BUS_02_ERROR_LOOP:	
  1225                           ;----------------------------------------
  1226                           ;MODBUS RTU ERROR CODE 02
  1227                           ;非法暫存器地址
  1228                           
  1229     0161  14BB               	bsf	59,1
  1230     0162  0009               	retfie
  1231     0163                     MODBUS_BUS_03_ERROR_LOOP:	
  1232                           ;----------------------------------------
  1233                           ;MODBUS RTU ERROR CODE 03
  1234                           ;非法資料數值
  1235                           
  1236     0163  153B               	bsf	59,2
  1237     0164  0009               	retfie
  1238     0165                     MODBUS_BUS_04_ERROR_LOOP:	
  1239                           ;----------------------------------------
  1240                           ;MODBUS RTU ERROR CODE 04
  1241                           ;裝置故障，像是自我檢測出現異常
  1242                           
  1243     0165  15BB               	bsf	59,3
  1244     0166  0009               	retfie
  1245     0167                     MODBUS_BUS_05_ERROR_LOOP:	
  1246                           ;----------------------------------------
  1247                           ;MODBUS RTU ERROR CODE 05
  1248                           ;確認，有收到指令並且立即執行
  1249                           
  1250     0167  163B               	bsf	59,4
  1251     0168  0009               	retfie
  1252     0169                     MODBUS_BUS_06_ERROR_LOOP:	
  1253                           ;----------------------------------------
  1254                           ;MODBUS RTU ERROR CODE 06
  1255                           ;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
  1256                           
  1257     0169  16BB               	bsf	59,5
  1258     016A  0009               	retfie
  1259     016B                     MODBUS_BUS_ID_ERROR_LOOP:	
  1260                           ;----------------------------------------
  1261                           ;===================================================
  1262                           ;============MODBUS的ID或是資料數錯誤===============
  1263                           ;===================================================
  1264                           
  1265     016B  3020               	movlw	32
  1266     016C  0087               	movwf	7
  1267     016D  30B0               	movlw	176
  1268     016E  0086               	movwf	6
  1269     016F  300A               	movlw	10
  1270     0170  0786               	addwf	6,f
  1271     0171                     MODBUS_BUS_ID_ERROR_LV1:
  1272     0171  0181               	clrf	1
  1273     0172  0A86               	incf	6,f
  1274     0173  0BC9               	decfsz	73,f
  1275     0174  2971               	goto	MODBUS_BUS_ID_ERROR_LV1
  1276     0175  0029               	banksel	1173
  1277     0176  1615               	bsf	1173,4
  1278     0177  0009               	retfie
  1279     0178                     CHECK_CRC16_IS_RIGHT:	
  1280                           ;===================================================
  1281                           ;================驗證CRC16是否正確?=================
  1282                           ;===================================================
  1283                           ;這段驗證CRC的時間大約為380uS
  1284                           
  1285     0178  0020               	banksel	12
  1286     0179  30FF               	movlw	255
  1287     017A  00A8               	movwf	40
  1288     017B  30FF               	movlw	255
  1289     017C  00A9               	movwf	41
  1290     017D  3020               	movlw	32
  1291     017E  0087               	movwf	7
  1292     017F  30B0               	movlw	176
  1293     0180  0086               	movwf	6
  1294     0181  300A               	movlw	10
  1295     0182  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1296     0183                     CHECK_CRC16_IS_RIGHT_LV1:
  1297     0183  0801               	movf	1,w
  1298     0184  00A7               	movwf	39
  1299     0185  25EF               	call	CRC_16_FUNCTION_LOOP
  1300     0186  0A86               	incf	6,f
  1301     0187  0BAA               	decfsz	42,f
  1302     0188  2983               	goto	CHECK_CRC16_IS_RIGHT_LV1
  1303                           
  1304                           ;----------------------------
  1305     0189  0829               	movf	41,w
  1306     018A  0601               	xorwf	1,w
  1307     018B  1D03               	btfss	3,2
  1308     018C  296B               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
  1309                           
  1310                           ;----------------------------
  1311     018D  0A86               	incf	6,f
  1312     018E  0828               	movf	40,w
  1313     018F  0601               	xorwf	1,w
  1314     0190  1D03               	btfss	3,2
  1315     0191  296B               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
  1316     0192  2947               	goto	MODBUS_CRC16_CHECK_IS_OK	;CRC16驗證正確
  1317     0193                     ANAY_MODBUS_CMD_03_LOOP:	
  1318                           ;========================================================
  1319                           ;=============MODBUS 功能碼為0X03========================
  1320                           ;========================================================
  1321                           ;功能碼:0X03表示要READ
  1322                           ;先確認ADR是否對應的合法
  1323                           
  1324     0193  30F9               	movlw	249
  1325     0194  05BC               	andwf	60,f
  1326     0195  14BC               	bsf	60,1
  1327                           
  1328                           ;----------------
  1329     0196  3020               	movlw	32
  1330     0197  0087               	movwf	7
  1331     0198  30B0               	movlw	176
  1332     0199  0086               	movwf	6
  1333     019A  300A               	movlw	10
  1334     019B  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1335     019C  3002               	movlw	2	;位置的HBYTE
  1336     019D  0786               	addwf	6,f
  1337                           
  1338                           ;---------------------------------------------------
  1339     019E  0801               	movf	1,w
  1340     019F  00CC               	movwf	76
  1341     01A0  0A86               	incf	6,f
  1342     01A1  0801               	movf	1,w
  1343     01A2  00CD               	movwf	77
  1344                           
  1345                           ;---------------------------------------------------- 將位置資料先複製出來
  1346     01A3  30A0               	movlw	160
  1347     01A4  02CD               	subwf	77,f
  1348     01A5  3000               	movlw	0
  1349     01A6  3BCC               	subwfb	76,f
  1350                           
  1351                           ;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
  1352     01A7  084D               	movf	77,w
  1353     01A8  00CA               	movwf	74
  1354     01A9  2811               	goto	MODBUS_ADR_FUNCTION	;MODBUS ADR TABLE
  1355     01AA                     ANAY_MODBUS_CMD_06_LOOP:	
  1356                           ;========================================================
  1357                           ;=============MODBUS 功能碼為0X06========================
  1358                           ;========================================================
  1359                           ;功能碼:0X06表示要WRITE
  1360                           ;先確認ADR是否對應的合法
  1361                           
  1362     01AA  0020               	banksel	12
  1363     01AB  30F9               	movlw	249
  1364     01AC  05BC               	andwf	60,f
  1365     01AD  153C               	bsf	60,2
  1366                           
  1367                           ;----------------
  1368     01AE  3020               	movlw	32
  1369     01AF  0087               	movwf	7
  1370     01B0  30B0               	movlw	176
  1371     01B1  0086               	movwf	6
  1372     01B2  300A               	movlw	10
  1373     01B3  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1374     01B4  3002               	movlw	2	;位置的HBYTE
  1375     01B5  0786               	addwf	6,f
  1376                           
  1377                           ;---------------------------------------------------
  1378     01B6  0801               	movf	1,w
  1379     01B7  00CC               	movwf	76
  1380     01B8  0A86               	incf	6,f
  1381     01B9  0801               	movf	1,w
  1382     01BA  00CD               	movwf	77
  1383                           
  1384                           ;---------------------------------------------------- 將位置資料先複製出來
  1385     01BB  30A0               	movlw	160
  1386     01BC  02CD               	subwf	77,f
  1387     01BD  3000               	movlw	0
  1388     01BE  3BCC               	subwfb	76,f
  1389                           
  1390                           ;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
  1391     01BF  084D               	movf	77,w
  1392     01C0  00CA               	movwf	74
  1393     01C1  2811               	goto	MODBUS_ADR_FUNCTION	;MODBUS ADR TABLE
  1394     01C2                     MODBUS_RTU_READ_LV2:	
  1395 ;;--------------------------------------------------------------------
  1396                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1397                           ; MOVWF FSR1H
  1398                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1399                           ; MOVWF FSR1L
  1400                           ; MOVLW 0X0A
  1401                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1402                           ; MOVLW 0X05
  1403                           ; ADDWF FSR1L,F ;要讀取的WORD數
  1404 ;;-------------------
  1405                           ; MOVF INDF1,W
  1406                           ; ;MOVWF RTU_COUNTER_DATA ;要讀取的資料WORD數
  1407                           ; MOVWF CAL_TEMP_LBYTE
  1408                           ;
  1409                           ;
  1410                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1411                           ; MOVWF FSR1H
  1412                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1413                           ; MOVWF FSR1L
  1414                           ; MOVLW 0X0A
  1415                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1416                           ; MOVLW 0X03
  1417                           ; ADDWF FSR1L,F
  1418                           ;
  1419                           ;
  1420                           ;
  1421                           ;
  1422                           ;
  1423                           ;
  1424                           ;
  1425                           ;
  1426                           ;
  1427                           ;
  1428                           ;
  1429 ;;-------------------------------
  1430                           ; MOVLW 0X70
  1431                           ; ADDWF INDF1,W
  1432                           ; BTFSC STATUS,C
  1433                           ; GOTO ANAY_MODBUS_READ_0X90_LOOP
  1434                           ;
  1435                           ;
  1436                           ; MOVLW 0X80
  1437                           ; ADDWF INDF1,W
  1438                           ; BTFSC STATUS,C
  1439                           ; GOTO ANAY_MODBUS_READ_0X80_LOOP ;表示使用的CMD是共用型
  1440                           ;
  1441 ;;-----------------------------------------------
  1442                           ;
  1443                           ;
  1444                           ;
  1445                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1446                           ; MOVWF FSR1H
  1447                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1448                           ; MOVWF FSR1L
  1449                           ; MOVLW 0X0A
  1450                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1451                           ; MOVLW 0X05
  1452                           ; ADDWF FSR1L,F ;要讀取的WORD數
  1453                           ;
  1454                           ;
  1455                           ;
  1456                           ;
  1457                           ; MOVLW 0X02
  1458                           ; SUBWF FSR1L,F ;判斷要讀取的ADR
  1459 ;;------------------
  1460                           ; MOVF INDF1,W
  1461                           ; MOVWF CAL_TEMP_HBYTE
  1462                           ; MOVWF ADR_TEST_TEMP
  1463                           ; MOVLW 0XF0
  1464                           ; ANDWF CAL_TEMP_HBYTE,F
  1465 ;;-----------------
  1466                           ; MOVLW 0X10
  1467                           ; XORWF CAL_TEMP_HBYTE,W
  1468                           ; BTFSC STATUS,Z
  1469                           ; GOTO READ_MOTOR_1_SOME_DATA
  1470 ;;-------------------
  1471                           ; MOVLW 0X20
  1472                           ; XORWF CAL_TEMP_HBYTE,W
  1473                           ; BTFSC STATUS,Z
  1474                           ; GOTO READ_MOTOR_2_SOME_DATA
  1475 ;;-------------------
  1476                           ; MOVLW 0X30
  1477                           ; XORWF CAL_TEMP_HBYTE,W
  1478                           ; BTFSC STATUS,Z
  1479                           ; GOTO READ_MOTOR_3_SOME_DATA
  1480 ;;-------------------
  1481                           ; MOVLW 0X40
  1482                           ; XORWF CAL_TEMP_HBYTE,W
  1483                           ; BTFSC STATUS,Z
  1484                           ; GOTO READ_MOTOR_4_SOME_DATA
  1485 ;;-------------------
  1486                           ;GOTO MODBUS_BUS_01_ERROR_LOOP
  1487                           ;ANAY_MODBUS_CMD_03_LEVEL1:
  1488                           ; MOVLW 0X0F
  1489                           ; ANDWF ADR_TEST_TEMP,F
  1490 ;; MOVF ADR_TEST_TEMP,W
  1491 ;; ADDWF FSR0L,F
  1492                           ;
  1493                           ;BCF STATUS,C
  1494                           ;RLF ADR_TEST_TEMP,F
  1495                           ;MOVF ADR_TEST_TEMP,W
  1496                           ;ADDWF FSR0L,F
  1497                           ;
  1498                           ;
  1499                           ;
  1500                           ;
  1501                           ; BCF STATUS,C
  1502                           ; RLF CAL_TEMP_LBYTE,F
  1503                           ; MOVF CAL_TEMP_LBYTE,W
  1504                           ; MOVWF RTU_COUNTER_DATA ;要讀的BYTE數
  1505 ;;------------------
  1506                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1507                           ; MOVWF FSR1H
  1508                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1509                           ; MOVWF FSR1L
  1510                           ; MOVLW 0X0A
  1511                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1512                           ; MOVLW 0X02
  1513                           ; ADDWF FSR1L,F
  1514                           ; MOVF RTU_COUNTER_DATA,W
  1515                           ; MOVWF INDF1
  1516                           ; INCF FSR1L,F
  1517 ;;--------
  1518                           ;ANAY_MODBUS_CMD_03_LEVEL2:
  1519                           ; MOVF INDF0,W
  1520                           ; MOVWF INDF1
  1521                           ;
  1522 ;;MOVWF 0X71
  1523 ;;CALL AAAA_1800
  1524                           ;
  1525                           ;
  1526                           ; INCF FSR1L,F
  1527                           ; INCF FSR0L,F
  1528                           ; DECFSZ CAL_TEMP_LBYTE,F
  1529                           ; GOTO ANAY_MODBUS_CMD_03_LEVEL2
  1530                           ; MOVF RTU_COUNTER_DATA,W
  1531                           ; MOVWF CAL_TEMP_LBYTE
  1532                           ; MOVLW 0X03
  1533                           ; ADDWF RTU_COUNTER_DATA,F
  1534 ;;----------------------------------------------------------
  1535                           ; CALL MODBUS_RTU_READ_LV2
  1536                           ; MOVF CAL_TEMP_LBYTE,W
  1537                           ; MOVWF TX_DATA_COUNTER
  1538                           ; MOVLW 0X05
  1539                           ; ADDWF TX_DATA_COUNTER,F
  1540                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
  1541                           ; RETFIE
  1542 ;;----------------------------------------------------------
  1543                           ;ANAY_MODBUS_READ_0X90_LOOP:
  1544                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1545                           ; MOVWF FSR1H
  1546                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1547                           ; MOVWF FSR1L
  1548                           ; MOVLW 0X0A
  1549                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1550                           ; MOVLW 0X03
  1551                           ; ADDWF FSR1L,F
  1552                           ; MOVLW 0X80
  1553                           ; SUBWF INDF1,F
  1554                           ; GOTO ANAY_MODBUS_READ_LV0
  1555 ;;----------------------------------------------------------
  1556                           ;ANAY_MODBUS_READ_0X80_LOOP:
  1557                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1558                           ; MOVWF FSR1H
  1559                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1560                           ; MOVWF FSR1L
  1561                           ; MOVLW 0X0A
  1562                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1563                           ; MOVLW 0X03
  1564                           ; ADDWF FSR1L,F
  1565                           ; MOVLW 0X80
  1566                           ; SUBWF INDF1,F
  1567                           ;
  1568                           ; BCF STATUS,C
  1569                           ; RLF INDF1,F
  1570                           ;ANAY_MODBUS_READ_LV0:
  1571 ;;-----------------------------------
  1572                           ; MOVLW COMMON_DATA_HBYTE
  1573                           ; MOVWF FSR0H
  1574                           ; MOVLW COMMON_DATA_LBYTE
  1575                           ; MOVWF FSR0L
  1576                           ; MOVF INDF1,W
  1577                           ; ADDWF FSR0L,F
  1578 ;;-------------
  1579                           ; BCF STATUS,C
  1580                           ; RLF CAL_TEMP_LBYTE,F
  1581                           ; MOVF CAL_TEMP_LBYTE,W
  1582                           ; MOVWF RTU_COUNTER_DATA ;要讀的BYTE數
  1583 ;;------------------
  1584                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1585                           ; MOVWF FSR1H
  1586                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1587                           ; MOVWF FSR1L
  1588                           ; MOVLW 0X0A
  1589                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1590                           ; MOVLW 0X02
  1591                           ; ADDWF FSR1L,F
  1592                           ; MOVF RTU_COUNTER_DATA,W
  1593                           ; MOVWF INDF1
  1594                           ; INCF FSR1L,F
  1595 ;;-----------------------------------
  1596                           ;ANAY_MODBUS_READ_0X80_LV1:
  1597                           ; MOVF INDF0,W
  1598                           ; MOVWF INDF1
  1599                           ; INCF FSR0L,F
  1600                           ; INCF FSR1L,F
  1601                           ; DECFSZ CAL_TEMP_LBYTE,F
  1602                           ; GOTO ANAY_MODBUS_READ_0X80_LV1
  1603                           ; MOVF RTU_COUNTER_DATA,W
  1604                           ; MOVWF CAL_TEMP_LBYTE
  1605                           ; MOVLW 0X03
  1606                           ; ADDWF RTU_COUNTER_DATA,F
  1607 ;;----------------------------------------------------------
  1608                           ; CALL MODBUS_RTU_READ_LV2
  1609                           ; MOVF CAL_TEMP_LBYTE,W
  1610                           ; MOVWF TX_DATA_COUNTER
  1611                           ; MOVLW 0X05
  1612                           ; ADDWF TX_DATA_COUNTER,F
  1613                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
  1614                           ; RETFIE
  1615                           ;
  1616                           ;
  1617 ;;----------------------------------------------------------
  1618 ;;----------------------------------------------------------
  1619                           ;READ_MOTOR_1_SOME_DATA:
  1620                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1621                           ; MOVWF FSR0H
  1622                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1623                           ; MOVWF FSR0L
  1624                           ; GOTO ANAY_MODBUS_CMD_03_LEVEL1
  1625                           ;READ_MOTOR_2_SOME_DATA:
  1626                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1627                           ; MOVWF FSR0H
  1628                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1629                           ; MOVWF FSR0L
  1630                           ; MOVLW 0X15
  1631                           ; ADDWF FSR0L,F
  1632                           ; GOTO ANAY_MODBUS_CMD_03_LEVEL1
  1633                           ;READ_MOTOR_3_SOME_DATA:
  1634                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1635                           ; MOVWF FSR0H
  1636                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1637                           ; MOVWF FSR0L
  1638                           ; MOVLW 0X2A
  1639                           ; ADDWF FSR0L,F
  1640                           ; GOTO ANAY_MODBUS_CMD_03_LEVEL1
  1641                           ;READ_MOTOR_4_SOME_DATA:
  1642                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1643                           ; MOVWF FSR0H
  1644                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1645                           ; MOVWF FSR0L
  1646                           ; MOVLW 0X3F
  1647                           ; ADDWF FSR0L,F
  1648                           ; GOTO ANAY_MODBUS_CMD_03_LEVEL1
  1649                           ;
  1650                           ;STORE_WRITE_ACK_LOOP:
  1651                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1652                           ; MOVWF FSR0H
  1653                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1654                           ; MOVWF FSR0L
  1655                           ; MOVLW 0X0A
  1656                           ; ADDWF FSR0L,F ;這裡是第一筆資料的位置
  1657 ;;-------------
  1658                           ; MOVLW 0X22
  1659                           ; MOVWF FSR1H
  1660                           ; MOVLW 0X40
  1661                           ; MOVWF FSR1L ;ADR_90_DAT00的位置
  1662                           ; MOVLW 0X08
  1663                           ; MOVWF ACK_COUNTER_TEMP
  1664 ;;-------------
  1665                           ;STORE_WRITE_ACK_LV1:
  1666                           ; MOVF INDF0,W
  1667                           ; MOVWF INDF1
  1668                           ; INCF FSR0L,F
  1669                           ; INCF FSR1L,F
  1670                           ; DECFSZ ACK_COUNTER_TEMP,F
  1671                           ; GOTO STORE_WRITE_ACK_LV1
  1672                           ; RETURN
  1673 ;;========================================================
  1674 ;;=============MODBUS 功能碼為0X06========================
  1675 ;;========================================================
  1676                           ;ANAY_MODBUS_CMD_06_LOOP:
  1677                           ;BANKSEL PORTA
  1678                           ; ;CALL STORE_WRITE_ACK_LOOP
  1679                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1680                           ; MOVWF FSR1H
  1681                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1682                           ; MOVWF FSR1L
  1683                           ; MOVLW 0X0A
  1684                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1685                           ; MOVLW 0X03
  1686                           ; ADDWF FSR1L,F
  1687                           ; MOVLW 0X80
  1688                           ; ADDWF INDF1,W
  1689                           ; BTFSC STATUS,C
  1690                           ; GOTO ANAY_MODBUS_WRITE_0X80_LOOP ;表示使用的CMD是共用型
  1691                           ;
  1692                           ;
  1693                           ;
  1694                           ;
  1695                           ;
  1696                           ;
  1697                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1698                           ; MOVWF FSR1H
  1699                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1700                           ; MOVWF FSR1L
  1701                           ; MOVLW 0X0A
  1702                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1703                           ; MOVLW 0X03
  1704                           ; ADDWF FSR1L,F
  1705 ;;-------------------
  1706 ;;-------------------
  1707                           ; MOVF INDF1,W
  1708                           ; MOVWF CAL_TEMP_HBYTE
  1709                           ; MOVWF CAL_TEMP_LBYTE
  1710                           ; MOVWF ADR_TEST_TEMP
  1711                           ; MOVLW 0XF0
  1712                           ; ANDWF CAL_TEMP_HBYTE,F
  1713 ;;------------
  1714                           ; MOVLW 0X0F
  1715                           ; ANDWF CAL_TEMP_LBYTE,F
  1716 ;;-----------------
  1717                           ; MOVLW 0X10
  1718                           ; XORWF CAL_TEMP_HBYTE,W
  1719                           ; BTFSC STATUS,Z
  1720                           ; GOTO WRITE_MOTOR_1_SOME_DATA
  1721 ;;-------------------
  1722                           ; MOVLW 0X20
  1723                           ; XORWF CAL_TEMP_HBYTE,W
  1724                           ; BTFSC STATUS,Z
  1725                           ; GOTO WRITE_MOTOR_2_SOME_DATA
  1726 ;;-------------------
  1727                           ; MOVLW 0X30
  1728                           ; XORWF CAL_TEMP_HBYTE,W
  1729                           ; BTFSC STATUS,Z
  1730                           ; GOTO WRITE_MOTOR_3_SOME_DATA
  1731 ;;-------------------
  1732                           ; MOVLW 0X40
  1733                           ; XORWF CAL_TEMP_HBYTE,W
  1734                           ; BTFSC STATUS,Z
  1735                           ; GOTO WRITE_MOTOR_4_SOME_DATA
  1736 ;;-------------------
  1737                           ;GOTO MODBUS_BUS_01_ERROR_LOOP
  1738                           ;ANAY_MODBUS_CMD_06_LEVEL1:
  1739                           ; ;MOVF CAL_TEMP_LBYTE,W
  1740                           ;BCF STATUS,C
  1741                           ;RLF CAL_TEMP_LBYTE,F
  1742                           ;MOVF CAL_TEMP_LBYTE,W
  1743                           ;ADDWF FSR0L,F
  1744 ;;--------------------------------------
  1745                           ; MOVLW MODBUS_DAT_EXTRA_ADRH
  1746                           ; MOVWF FSR1H
  1747                           ; MOVLW MODBUS_DAT_EXTRA_ADRL
  1748                           ; MOVWF FSR1L
  1749                           ; MOVLW 0X0A
  1750                           ; ADDWF FSR1L,F ;這裡是第一筆資料的位置
  1751                           ; MOVLW 0X04
  1752                           ; ADDWF FSR1L,F
  1753                           ;
  1754                           ; MOVF INDF1,W
  1755                           ; MOVWF INDF0
  1756                           ; INCF FSR1L,F
  1757                           ; INCF FSR0L,F
  1758                           ; MOVF INDF1,W
  1759                           ; MOVWF INDF0
  1760 ;;--------------------------------------
  1761                           ; MOVLW 0X08
  1762                           ; MOVWF TX_DATA_COUNTER
  1763                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
  1764                           ;
  1765                           ;MOVF ADR_TEST_TEMP,W
  1766                           ;MOVWF CAL_TEMP_LBYTE
  1767                           ;MOVLW 0X0F
  1768                           ;ANDWF CAL_TEMP_LBYTE,F
  1769                           ;
  1770 ;;------------------------------------------------
  1771                           ; MOVLW 0X09
  1772                           ; XORWF CAL_TEMP_LBYTE,W
  1773                           ; BTFSC STATUS,Z
  1774                           ; GOTO STRONG_STOP_FUNCTION
  1775 ;;------------------------
  1776                           ; MOVLW 0X00
  1777                           ; XORWF CAL_TEMP_LBYTE,W
  1778                           ; BTFSC STATUS,Z
  1779                           ; GOTO CW_STEP_FUNCTION
  1780 ;;------------------------
  1781                           ; MOVLW 0X01
  1782                           ; XORWF CAL_TEMP_LBYTE,W
  1783                           ; BTFSC STATUS,Z
  1784                           ; GOTO CCW_STEP_FUNCTION
  1785 ;;------------------------
  1786                           ; MOVLW 0X04
  1787                           ; XORWF CAL_TEMP_LBYTE,W
  1788                           ; BTFSC STATUS,Z
  1789                           ; GOTO RESET_STEP_FUNCTION
  1790                           ;
  1791 ;;------------------------------------------------
  1792                           ;ANAY_MODBUS_CMD_06_EXIT:
  1793                           ; BCF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1794                           ; BCF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1795                           ; BCF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  1796                           ; BCF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  1797                           ; RETFIE
  1798                           ;
  1799                           ;
  1800                           ;
  1801 ;;-------------------------------------------
  1802 ;;-------------0X80以上的WRITE CMD-----------
  1803 ;;-------------------------------------------
  1804                           ;ANAY_MODBUS_WRITE_0X80_LOOP:
  1805                           ; MOVLW 0X08
  1806                           ; MOVWF TX_DATA_COUNTER
  1807                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
  1808                           ; MOVLW 0X83
  1809                           ; XORWF INDF1,W
  1810                           ; BTFSC STATUS,Z
  1811                           ; CALL COMMON_CMD_0X83_LOOP
  1812                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1813                           ;COMMON_CMD_0X83_LOOP:
  1814                           ; INCF FSR1L,F
  1815                           ; INCF FSR1L,F
  1816                           ; MOVF INDF1,W
  1817                           ; BTFSC STATUS,Z
  1818                           ; GOTO RECOVER_MODULE_LOOP
  1819                           ;BANKSEL BANK7
  1820                           ; MOVLW 0X02
  1821                           ; MOVWF ADR_83_L_DAT
  1822                           ; MOVLW 0X02
  1823                           ; MOVWF ADR_81_L_DAT
  1824                           ;
  1825                           ;
  1826                           ;RECOVER_MODULE_LOOP_LV1:
  1827                           ;BANKSEL MOTOR_CONTROL_PORT
  1828                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  1829                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  1830                           ;BANKSEL PORTA
  1831                           ; BSF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1832                           ; BCF MOTOR2_FLAG0,MOTOR_2_RESET
  1833                           ; BCF MOTOR1_FLAG0,MOTOR_1_RESET
  1834                           ; BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
  1835                           ; BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
  1836                           ; BCF FLAG1_BANK0,CAN_WORK_FLAG
  1837                           ;
  1838                           ; BCF MOTOR2_FLAG0,MOTOR_2_WORK
  1839                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
  1840                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
  1841                           ; BCF FLAG3_BANK0,TEN_TIME_EN
  1842                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  1843                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  1844                           ; BCF MOTOR1_FLAG0,MOTOR_1_WORK
  1845                           ;
  1846                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1847                           ; MOVWF FSR0H
  1848                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1849                           ; MOVWF FSR0L
  1850                           ; MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
  1851                           ; ADDWF FSR0L,F
  1852                           ; MOVLW 0X00
  1853                           ; MOVWF INDF0
  1854                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1855                           ; MOVWF FSR0H
  1856                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1857                           ; MOVWF FSR0L
  1858                           ; MOVLW 0X15
  1859                           ; ADDWF FSR0L,F
  1860                           ; MOVLW 0X07
  1861                           ; ADDWF FSR0L,F
  1862                           ; MOVLW 0X00
  1863                           ; MOVWF INDF0
  1864 ;;---------------------------------------------------------------------------
  1865                           ;
  1866                           ;
  1867                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1868                           ; MOVWF FSR0H
  1869                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1870                           ; MOVWF FSR0L
  1871                           ; CLRF INDF0
  1872                           ; INCF FSR0L,F
  1873 ;;-------------
  1874                           ; CLRF INDF0
  1875                           ; INCF FSR0L,F
  1876 ;;-------------
  1877                           ; CLRF INDF0
  1878                           ; INCF FSR0L,F
  1879 ;;-------------
  1880                           ; CLRF INDF0
  1881                           ; INCF FSR0L,F
  1882 ;;-------------
  1883 ;;=============================================
  1884                           ;
  1885                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1886                           ; MOVWF FSR0H
  1887                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1888                           ; MOVWF FSR0L
  1889                           ; MOVLW 0X15
  1890                           ; ADDWF FSR0L,F
  1891                           ; CLRF INDF0
  1892                           ; INCF FSR0L,F
  1893 ;;-------------
  1894                           ; CLRF INDF0
  1895                           ; INCF FSR0L,F
  1896 ;;-------------
  1897                           ; CLRF INDF0
  1898                           ; INCF FSR0L,F
  1899 ;;-------------
  1900                           ; CLRF INDF0
  1901                           ; INCF FSR0L,F
  1902 ;;-------------
  1903                           ; RETURN
  1904 ;;-----------------------------------------------------
  1905 ;;停止動作
  1906                           ;RECOVER_MODULE_LOOP:
  1907                           ;BANKSEL BANK7
  1908                           ; MOVLW 0X00
  1909                           ; MOVWF ADR_83_L_DAT
  1910                           ; MOVLW 0X00
  1911                           ; MOVWF ADR_81_L_DAT
  1912                           ;BANKSEL PORTA
  1913                           ;CALL RECOVER_MODULE_LOOP_LV1
  1914                           ; BCF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1915                           ; RETURN
  1916                           ;
  1917                           ;
  1918                           ;
  1919                           ;
  1920                           ;
  1921 ;;--------------------------------------------------------------------------
  1922 ;;---------------------------------------------------------------------------
  1923 ;;---------------------------------------------------------------------------
  1924 ;;========================================================
  1925 ;;=============ADDR IS 0X04===============================
  1926 ;;========================================================
  1927                           ;RESET_STEP_FUNCTION:
  1928                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1929                           ; CALL STRONG_RESET_MOTOR_1_FUNC
  1930                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1931                           ; CALL STRONG_RESET_MOTOR_2_FUNC
  1932                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1933                           ;STRONG_RESET_MOTOR_1_FUNC:
  1934                           ;BANKSEL MOTOR_CONTROL_PORT
  1935                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1936                           ;BANKSEL PORTA
  1937                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1938                           ; RETURN
  1939                           ;STRONG_RESET_MOTOR_2_FUNC:
  1940                           ; BSF MOTOR2_FLAG0,MOTOR_2_RESET
  1941                           ; RETURN
  1942                           ;
  1943                           ;
  1944 ;;========================================================
  1945 ;;=============ADDR IS 0X00===============================
  1946 ;;========================================================
  1947                           ;CW_STEP_FUNCTION:
  1948                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1949                           ; CALL STRONG_CW_MOTOR_1_FUNC
  1950                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1951                           ; CALL STRONG_CW_MOTOR_2_FUNC
  1952                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1953                           ;STRONG_CW_MOTOR_1_FUNC:
  1954                           ;BANKSEL MOTOR_CONTROL_PORT
  1955                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1956                           ;BANKSEL PORTA
  1957                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1958                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1959                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1960                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1961                           ; RETURN
  1962                           ;STRONG_CW_MOTOR_2_FUNC:
  1963                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1964                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1965                           ; RETURN
  1966 ;;========================================================
  1967 ;;=============ADDR IS 0X01===============================
  1968 ;;========================================================
  1969                           ;CCW_STEP_FUNCTION:
  1970                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1971                           ; CALL STRONG_CCW_MOTOR_1_FUNC
  1972                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1973                           ; CALL STRONG_CCW_MOTOR_2_FUNC
  1974                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1975                           ;STRONG_CCW_MOTOR_1_FUNC:
  1976                           ;BANKSEL MOTOR_CONTROL_PORT
  1977                           ;BSF MOTOR_CONTROL_PORT,M1_FR
  1978                           ;BANKSEL PORTA
  1979                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1980                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1981                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1982                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1983                           ; RETURN
  1984                           ;STRONG_CCW_MOTOR_2_FUNC:
  1985                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1986                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1987                           ; RETURN
  1988 ;;========================================================
  1989 ;;=============ADDR IS 0X09===============================
  1990 ;;========================================================
  1991                           ;STRONG_STOP_FUNCTION:
  1992                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1993                           ; CALL STRONG_STOP_MOTOR_1_FUNC
  1994                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1995                           ; CALL STRONG_STOP_MOTOR_2_FUNC
  1996 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1997 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1998 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1999 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  2000                           ;
  2001                           ;
  2002                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  2003                           ;
  2004                           ;STRONG_STOP_MOTOR_1_FUNC:
  2005                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2006                           ; MOVWF FSR0H
  2007                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2008                           ; MOVWF FSR0L
  2009                           ; MOVLW 0X07
  2010                           ; ADDWF FSR0L,F
  2011                           ; MOVLW 0X04
  2012                           ; MOVWF INDF0
  2013 ;;----------
  2014                           ; MOVLW 0X01
  2015                           ; MOVWF STRONG_STOP_TEMP1
  2016                           ;BANKSEL MOTOR_CONTROL_PORT
  2017                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  2018                           ;BANKSEL PORTA
  2019                           ; RETURN
  2020                           ;STRONG_STOP_MOTOR_2_FUNC:
  2021                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2022                           ; MOVWF FSR0H
  2023                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2024                           ; MOVWF FSR0L
  2025                           ; MOVLW 0X15
  2026                           ; ADDWF FSR0L,F
  2027                           ; MOVLW 0X07
  2028                           ; ADDWF FSR0L,F
  2029                           ; MOVLW 0X04
  2030                           ; MOVWF INDF0
  2031 ;;----------
  2032                           ; MOVLW 0X01
  2033                           ; MOVWF STRONG_STOP_TEMP2
  2034                           ;BANKSEL MOTOR_CONTROL_PORT
  2035                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  2036                           ;BANKSEL PORTA
  2037                           ; RETURN
  2038                           ;
  2039                           ;
  2040                           ;
  2041                           ;
  2042                           ;
  2043                           ;
  2044                           ;
  2045 ;;----------------------------------------------------------
  2046                           ;WRITE_MOTOR_1_SOME_DATA:
  2047                           ; BSF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  2048                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2049                           ; MOVWF FSR0H
  2050                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2051                           ; MOVWF FSR0L
  2052                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  2053                           ;WRITE_MOTOR_2_SOME_DATA:
  2054                           ; BSF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  2055                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2056                           ; MOVWF FSR0H
  2057                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2058                           ; MOVWF FSR0L
  2059                           ; MOVLW 0X15
  2060                           ; ADDWF FSR0L,F
  2061                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  2062                           ;WRITE_MOTOR_3_SOME_DATA:
  2063                           ; BSF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  2064                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2065                           ; MOVWF FSR0H
  2066                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2067                           ; MOVWF FSR0L
  2068                           ; MOVLW 0X2A
  2069                           ; ADDWF FSR0L,F
  2070                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  2071                           ;WRITE_MOTOR_4_SOME_DATA:
  2072                           ; BSF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  2073                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2074                           ; MOVWF FSR0H
  2075                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2076                           ; MOVWF FSR0L
  2077                           ; MOVLW 0X3F
  2078                           ; ADDWF FSR0L,F
  2079                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  2080                           ;
  2081                           ;
  2082                           ;
  2083                           ;
  2084                           ;
  2085                           ;
  2086                           ;
  2087                           ;
  2088                           ;
  2089                           ;
  2090                           ;
  2091                           ;
  2092                           ;
  2093                           ;
  2094                           ;
  2095                           ;========================================================
  2096                           ;=============MODBUS 計算其CRC 功能======================
  2097                           ;========================================================
  2098                           
  2099     01C2  0020               	banksel	12
  2100     01C3  30FF               	movlw	255
  2101     01C4  00A8               	movwf	40
  2102     01C5  30FF               	movlw	255
  2103     01C6  00A9               	movwf	41
  2104                           
  2105                           ;---------
  2106     01C7  3020               	movlw	32
  2107     01C8  0087               	movwf	7
  2108     01C9  30B0               	movlw	176
  2109     01CA  0086               	movwf	6
  2110     01CB  300A               	movlw	10
  2111     01CC  0786               	addwf	6,f	;這裡是第一筆資料的位置
  2112     01CD                     MODBUS_RTU_READ_CRC_LOOP:	
  2113                           ;---------
  2114                           
  2115     01CD  0801               	movf	1,w
  2116     01CE  00A7               	movwf	39
  2117     01CF  25EF               	call	CRC_16_FUNCTION_LOOP
  2118     01D0  0A86               	incf	6,f
  2119     01D1  0BAA               	decfsz	42,f
  2120     01D2  29CD               	goto	MODBUS_RTU_READ_CRC_LOOP
  2121     01D3  0829               	movf	41,w
  2122     01D4  0081               	movwf	1
  2123     01D5  0A86               	incf	6,f
  2124     01D6  0828               	movf	40,w
  2125     01D7  0081               	movwf	1
  2126     01D8  0008               	return
  2127     01D9                     SYSTEM_START_SETTING:	
  2128                           ;========================================================
  2129                           ;================== 主程序前參數設定 ====================
  2130                           ;========================================================
  2131                           
  2132                           
  2133                           ;========================================================
  2134                           ;=====================振盪器設定=========================
  2135                           ;========================================================
  2136     01D9  0021               	banksel	153
  2137     01DA  3072               	movlw	114
  2138     01DB  0099               	movwf	153	;8MHZ
  2139     01DC  3000               	movlw	0
  2140     01DD  0098               	movwf	152	;校正後頻率
  2141     01DE  3011               	movlw	17
  2142     01DF  009A               	movwf	154	;高頻振盪精度0.5%
  2143                           
  2144                           ;========================================================
  2145                           ;=====================OPTION設定=========================
  2146                           ;========================================================
  2147     01E0  30C8               	movlw	200
  2148     01E1  0095               	movwf	149	;BIT6 0->rising 1->falling
  2149                           
  2150                           ;========================================================
  2151                           ;======================中斷設定==========================
  2152                           ;========================================================
  2153     01E2  3040               	movlw	64
  2154     01E3  008B               	movwf	11
  2155     01E4  0021               	banksel	145
  2156     01E5  3000               	movlw	0
  2157     01E6  0091               	movwf	145	;BIT 3 = MSSP 1 INTERRUPT, BIT 5 = USART 1 RECIEVE INTERRUPT
  2158     01E7  3000               	movlw	0
  2159     01E8  0092               	movwf	146
  2160     01E9  3000               	movlw	0
  2161     01EA  0093               	movwf	147
  2162     01EB  3000               	movlw	0
  2163     01EC  0094               	movwf	148
  2164                           
  2165                           ;========================================================
  2166                           ;========================ADC設定=========================
  2167                           ;========================================================
  2168     01ED  0021               	banksel	157
  2169     01EE  3000               	movlw	0
  2170     01EF  009D               	movwf	157
  2171     01F0  3000               	movlw	0
  2172     01F1  009E               	movwf	158
  2173     01F2  0023               	banksel	396
  2174     01F3  018C               	clrf	396
  2175     01F4  0190               	clrf	400
  2176     01F5  0028               	banksel	1036
  2177     01F6  018C               	clrf	1036
  2178     01F7  018D               	clrf	1037
  2179     01F8  0020               	banksel	12
  2180                           
  2181                           ;========================================================
  2182                           ;=====================I/O設定============================
  2183                           ;========================================================
  2184     01F9  0021               	banksel	140
  2185     01FA  30C0               	movlw	192
  2186     01FB  008C               	movwf	140
  2187     01FC  30FF               	movlw	255
  2188     01FD  008D               	movwf	141
  2189     01FE  3000               	movlw	0
  2190     01FF  008E               	movwf	142
  2191     0200  300F               	movlw	15
  2192     0201  008F               	movwf	143
  2193     0202  30FF               	movlw	255
  2194     0203  0090               	movwf	144
  2195     0204  0026               	banksel	780
  2196     0205  3000               	movlw	0
  2197     0206  008C               	movwf	780
  2198     0207  30F6               	movlw	246
  2199     0208  008D               	movwf	781
  2200                           
  2201                           ;---------------
  2202     0209  0022               	banksel	268
  2203     020A  3000               	movlw	0
  2204     020B  008C               	movwf	268
  2205     020C  3000               	movlw	0
  2206     020D  008D               	movwf	269
  2207     020E  3000               	movlw	0
  2208     020F  008E               	movwf	270
  2209     0210  3000               	movlw	0
  2210     0211  008F               	movwf	271
  2211     0212  3000               	movlw	0
  2212     0213  0090               	movwf	272
  2213     0214  0027               	banksel	908
  2214     0215  018C               	clrf	908
  2215     0216  018D               	clrf	909
  2216                           
  2217                           ;---------------
  2218     0217  0020               	banksel	12
  2219     0218  018C               	clrf	12
  2220     0219  018D               	clrf	13
  2221     021A  018E               	clrf	14
  2222     021B  018F               	clrf	15
  2223     021C  0190               	clrf	16
  2224                           
  2225                           ;---------------
  2226     021D  0025               	banksel	652
  2227     021E  018C               	clrf	652
  2228     021F  018D               	clrf	653
  2229     0220  0020               	banksel	12
  2230     0221  265C               	call	DELAY_1000ms
  2231                           
  2232                           ;========================================================
  2233                           ;=====================暫存器設定=========================
  2234                           ;========================================================
  2235     0222  2625               	call	CLEAN_ALL_REGISTER
  2236     0223  3188               	pagesel	2048
  2237     0224  
                 warning: (2090) fixup overflow storing 0xD08 in 2 bytes
                 2508               	call	SET_MODBUS_MODE_ENABLE	;設定uart2硬體
  2238     0225  3180               	pagesel	0
  2239                           
  2240                           ;========================================================
  2241                           ;=====================TIMER2設定=========================
  2242                           ;========================================================
  2243     0226  2614               	call	SET_TMR2_BASE_TIME	;設定TIMER2基礎時間
  2244     0227  261D               	call	SET_TMR2_INT_EN	;TIMER2中斷啟動
  2245     0228  2621               	call	SET_TMR2_ON	;啟動TIMER2功能
  2246     0229                     ADC_HW_SETTING:	
  2247                           ;========================================================
  2248                           ;=====================ADC設定============================
  2249                           ;========================================================
  2250                           
  2251     0229  0028               	banksel	1037
  2252     022A  3010               	movlw	16
  2253     022B  008D               	movwf	1037
  2254                           
  2255                           ;-------------------------ADC_OPEN-------------------------
  2256     022C  0021               	banksel	158
  2257     022D  3031               	movlw	49	;AN12啟動
  2258     022E  009D               	movwf	157
  2259     022F  30C0               	movlw	192
  2260     0230  009E               	movwf	158
  2261     0231  0020               	banksel	12
  2262     0232  2661               	call	DELAY_100ms
  2263     0233                     SETTING_PWM_HW_LOOP:	
  2264                           ;========================================================
  2265                           ;=====================PWM輸出設定========================
  2266                           ;========================================================
  2267                           
  2268                           
  2269                           ;-------------------------------------設定相對應接腳TIMER
  2270     0233  0025               	banksel	670
  2271     0234  30DF               	movlw	223
  2272     0235  009E               	movwf	670
  2273     0236  300F               	movlw	15
  2274     0237  009F               	movwf	671
  2275                           
  2276                           ;-------------------------------------決定週期
  2277     0238  0028               	banksel	1046
  2278     0239  309C               	movlw	156
  2279     023A  0096               	movwf	1046
  2280                           
  2281                           ;-------------------------------------啟動TIMER
  2282     023B  0028               	banksel	1047
  2283     023C  307F               	movlw	127
  2284     023D  0097               	movwf	1047
  2285                           
  2286                           ;-------------------------------------決定DUTY CYCLE
  2287     023E  0026               	banksel	785
  2288     023F  3032               	movlw	50
  2289     0240  0091               	movwf	785
  2290                           
  2291                           ;-------------------------------------啟動PWM
  2292     0241  0026               	banksel	787
  2293     0242  300C               	movlw	12
  2294     0243  0093               	movwf	787
  2295     0244                     IOC_HW_SETTING:	
  2296                           ;========================================================
  2297                           ;=====================IOC設定============================
  2298                           ;========================================================
  2299                           
  2300     0244  0027               	banksel	916
  2301     0245  3000               	movlw	0
  2302     0246  0095               	movwf	917
  2303     0247  3000               	movlw	0
  2304     0248  0094               	movwf	916	;正緣觸發
  2305     0249                     CHECK_PWM_FREQ_FUCNTION:	
  2306 ;;========================================================
  2307 ;;=====================DIP SWITCH判斷=====================
  2308 ;;========================================================
  2309                           ;DIP_SWITCH_ADR_FUNCTION:
  2310                           ;BANKSEL ADDR_0_1_2_3_PORT
  2311                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_0
  2312                           ; BSF MOTOR1_FLAG0,MOTOR_1_EN
  2313 ;;---------
  2314                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_1
  2315                           ; BSF MOTOR2_FLAG0,MOTOR_2_EN
  2316 ;;---------
  2317                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_2
  2318                           ; BSF MOTOR3_FLAG0,MOTOR_3_EN
  2319 ;;---------
  2320                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_3
  2321                           ; BSF MOTOR4_FLAG0,MOTOR_4_EN
  2322                           ;---------
  2323                           ;========================================================
  2324                           ;=====================PWM頻率偵測========================
  2325                           ;========================================================
  2326                           
  2327     0249                     ID_SELECT_LOOP:	
  2328                           ;CALL ADC_TAKE_DATA_FUNCTION
  2329                           ;========================================================
  2330                           ;=====================ID SELECT==========================
  2331                           ;========================================================
  2332                           
  2333     0249  0020               	banksel	12
  2334     024A  01A5               	clrf	37
  2335     024B  1B0C               	btfsc	12,6
  2336     024C  1425               	bsf	37,0
  2337     024D  1B8C               	btfsc	12,7
  2338     024E  14A5               	bsf	37,1
  2339     024F  1B8D               	btfsc	13,7
  2340     0250  1525               	bsf	37,2
  2341     0251  1B0D               	btfsc	13,6
  2342     0252  15A5               	bsf	37,3
  2343     0253                     POWER_LED_OUTPUT_FUNCTION:	
  2344                           ;========================================================
  2345                           ;===================POWER LED輸出========================
  2346                           ;========================================================
  2347                           
  2348     0253  0020               	banksel	13
  2349     0254  1E8D               	btfss	13,5
  2350     0255  2A58               	goto	POWER_LED_OUTPUT_EXIT
  2351     0256  0027               	banksel	908
  2352     0257  140C               	bsf	908,0
  2353     0258                     POWER_LED_OUTPUT_EXIT:
  2354     0258  0020               	banksel	12
  2355     0259                     INT_HW_SETTING:	
  2356                           ;--------------------------------------------------------
  2357                           ;--------------------------------------------------------
  2358                           ;========================================================
  2359                           ;=====================INT設定============================
  2360                           ;========================================================
  2361                           
  2362     0259  0027               	banksel	909
  2363     025A  118D               	bcf	909,3	;將MAX485設定為RX模式
  2364     025B  160B               	bsf	11,4
  2365     025C  158B               	bsf	11,3
  2366     025D  0021               	banksel	148
  2367     025E  1694               	bsf	148,5
  2368     025F  1491               	bsf	145,1
  2369     0260  178B               	bsf	11,7
  2370     0261  0020               	banksel	12
  2371     0262  3002               	movlw	2
  2372     0263  00C8               	movwf	72
  2373     0264  3004               	movlw	4
  2374     0265  00A4               	movwf	36
  2375                           
  2376                           ; MOVLW 0X06
  2377                           ;MOVWF MODULE_ID_DAT
  2378     0266  0022               	banksel	268
  2379     0267  160C               	bsf	268,4
  2380     0268  168C               	bsf	268,5
  2381     0269  100E               	bcf	270,0
  2382     026A  110E               	bcf	270,2
  2383     026B  108E               	bcf	270,1
  2384     026C  118E               	bcf	270,3
  2385     026D  0027               	banksel	908
  2386     026E  01A0               	clrf	160
  2387     026F  3004               	movlw	4
  2388     0270  00A1               	movwf	161
  2389                           
  2390                           ;-----------------
  2391     0271  01A2               	clrf	162
  2392     0272  3000               	movlw	0
  2393     0273  00A3               	movwf	163
  2394                           
  2395                           ;-----------------
  2396     0274  01A4               	clrf	164
  2397     0275  3000               	movlw	0
  2398     0276  00A5               	movwf	165
  2399                           
  2400                           ;-----------------
  2401     0277  01A6               	clrf	166
  2402     0278  3000               	movlw	0
  2403     0279  00A7               	movwf	167
  2404     027A  0020               	banksel	12
  2405                           
  2406                           ;MOVLW 0X04
  2407                           ;MOVWF MODULE_ID_DAT
  2408     027B  2A8B               	goto	SYSTEM_START
  2409     027C                     TEST_FUNCTION_LOOP:
  2410     027C  0020               	banksel	12
  2411     027D  2665               	call	DELAY_10ms
  2412     027E  0027               	banksel	909
  2413     027F  158D               	bsf	909,3
  2414     0280                     TEST_FUNCTION_LOOP1:	
  2415                           ;---------------------------------------------
  2416                           
  2417     0280  0029               	banksel	1174
  2418     0281  1C96               	btfss	1174,1
  2419     0282  2A80               	goto	TEST_FUNCTION_LOOP1
  2420     0283  0029               	banksel	1170
  2421     0284  30A5               	movlw	165
  2422     0285  0092               	movwf	1170
  2423     0286  0020               	banksel	12
  2424     0287                     TEST_FUNCTION_LOOP2:
  2425     0287  0029               	banksel	1174
  2426     0288  1C96               	btfss	1174,1
  2427     0289  2A87               	goto	TEST_FUNCTION_LOOP2
  2428     028A  2A7C               	goto	TEST_FUNCTION_LOOP
  2429     028B                     SYSTEM_START:	
  2430                           ;CALL MOTOR_1_ZERO_FUNCTION
  2431                           ;CALL MOTOR_2_ZERO_FUNCTION
  2432                           ;********************************************************************************
  2433                           ;********************************************************************************
  2434                           ;========================================================
  2435                           ;=====================主程序迴圈=========================
  2436                           ;========================================================
  2437                           
  2438     028B  0020               	banksel	12
  2439     028C                     SYSTEM_START_LV1:	
  2440                           ; BTFSC PORTE,0X00
  2441                           ; GOTO MOTOR_2_WORK1
  2442                           ; GOTO MOTOR_2_STOP
  2443                           ;BANKSEL PORTA
  2444                           
  2445                           
  2446                           ;-------------------------------------------
  2447     028C  183B               	btfsc	59,0
  2448     028D  2376               	call	MODBUS_ERROR_CODE_01_LOOP
  2449     028E  18BB               	btfsc	59,1
  2450     028F  238A               	call	MODBUS_ERROR_CODE_02_LOOP
  2451     0290  193B               	btfsc	59,2
  2452     0291  2398               	call	MODBUS_ERROR_CODE_03_LOOP
  2453     0292  19BB               	btfsc	59,3
  2454     0293  23A6               	call	MODBUS_ERROR_CODE_04_LOOP
  2455     0294  1A3B               	btfsc	59,4
  2456     0295  23B4               	call	MODBUS_ERROR_CODE_05_LOOP
  2457     0296  1ABB               	btfsc	59,5
  2458     0297  23C2               	call	MODBUS_ERROR_CODE_06_LOOP
  2459                           
  2460                           ;-------------------------------------------
  2461     0298  1830               	btfsc	48,0
  2462     0299  2599               	call	PREPARE_TX_DATA_LOOP
  2463     029A  2A8B               	goto	SYSTEM_START
  2464                           
  2465                           ;-----------
  2466     029B  18B0               	btfsc	48,1
  2467     029C  23D0               	call	MODULE_WORK_LOOP	;順逆轉馬達動作
  2468                           
  2469                           ;-----------
  2470     029D  1A32               	btfsc	50,4
  2471     029E  235A               	call	MOTOR_2_ZERO_FUNCTION
  2472     029F  1AB2               	btfsc	50,5
  2473     02A0  22BE               	call	CHECK_MOTOR2_ZERO_LOOP
  2474                           
  2475                           ;--------------------------------------
  2476     02A1  1A72               	btfsc	114,4
  2477     02A2  232D               	call	MOTOR_1_ZERO_FUNCTION
  2478     02A3  1B72               	btfsc	114,6
  2479     02A4  230F               	call	MOTOR1_ZERO_IN_HI_LOOP
  2480     02A5  1AF2               	btfsc	114,5
  2481     02A6  22E5               	call	MOTOR1_ZERO_IN_LO_LOOP
  2482     02A7  2A8B               	goto	SYSTEM_START
  2483     02A8                     MOTOR_2_WORK1:	
  2484                           ;--------------------------------------
  2485                           
  2486     02A8  3021               	movlw	33
  2487     02A9  0085               	movwf	5
  2488     02AA  3040               	movlw	64
  2489     02AB  0084               	movwf	4
  2490     02AC  3015               	movlw	21
  2491     02AD  0784               	addwf	4,f
  2492     02AE  300F               	movlw	15
  2493     02AF  0784               	addwf	4,f
  2494     02B0  3000               	movlw	0
  2495     02B1  0080               	movwf	0
  2496     02B2  2A8C               	goto	SYSTEM_START_LV1
  2497     02B3                     MOTOR_2_STOP:
  2498     02B3  3021               	movlw	33
  2499     02B4  0085               	movwf	5
  2500     02B5  3040               	movlw	64
  2501     02B6  0084               	movwf	4
  2502     02B7  3015               	movlw	21
  2503     02B8  0784               	addwf	4,f
  2504     02B9  300F               	movlw	15
  2505     02BA  0784               	addwf	4,f
  2506     02BB  30FF               	movlw	255
  2507     02BC  0080               	movwf	0
  2508     02BD  2A8C               	goto	SYSTEM_START_LV1
  2509     02BE                     CHECK_MOTOR2_ZERO_LOOP:	
  2510                           ;========================================================
  2511                           ;=====================注射馬達復位完成===================
  2512                           ;========================================================
  2513                           
  2514     02BE  1A3A               	btfsc	58,4
  2515     02BF  0008               	return
  2516     02C0  18B6               	btfsc	54,1
  2517     02C1  0008               	return
  2518     02C2  1810               	btfsc	16,0
  2519     02C3  0008               	return
  2520     02C4  0022               	banksel	270
  2521     02C5  110E               	bcf	270,2
  2522     02C6  0020               	banksel	12
  2523     02C7  01C3               	clrf	67
  2524     02C8  0020               	banksel	12
  2525     02C9  12B2               	bcf	50,5
  2526     02CA  1036               	bcf	54,0
  2527                           
  2528                           ;-----------------------------
  2529     02CB  3021               	movlw	33
  2530     02CC  0085               	movwf	5
  2531     02CD  3040               	movlw	64
  2532     02CE  0084               	movwf	4
  2533     02CF  3015               	movlw	21
  2534     02D0  0784               	addwf	4,f
  2535     02D1  3004               	movlw	4
  2536     02D2  0784               	addwf	4,f
  2537     02D3  0180               	clrf	0
  2538     02D4  0A84               	incf	4,f
  2539     02D5  0180               	clrf	0
  2540                           
  2541                           ;---------------------------------------------清除累加步數
  2542     02D6  3021               	movlw	33
  2543     02D7  0085               	movwf	5
  2544     02D8  3040               	movlw	64
  2545     02D9  0084               	movwf	4
  2546     02DA  3015               	movlw	21
  2547     02DB  0784               	addwf	4,f
  2548     02DC  3007               	movlw	7
  2549     02DD  0784               	addwf	4,f
  2550     02DE  3000               	movlw	0
  2551     02DF  0080               	movwf	0
  2552     02E0  0027               	banksel	908
  2553     02E1  3000               	movlw	0
  2554     02E2  00A3               	movwf	163
  2555     02E3  0020               	banksel	12
  2556     02E4  0008               	return
  2557     02E5                     MOTOR1_ZERO_IN_LO_LOOP:	
  2558                           ;--------------------------------------------
  2559                           
  2560     02E5  1A3A               	btfsc	58,4
  2561     02E6  0008               	return
  2562     02E7  18B5               	btfsc	53,1
  2563     02E8  0008               	return
  2564     02E9  1D0D               	btfss	13,2
  2565     02EA  2B24               	goto	MOTOR1_TIME_ZERO_LOOP
  2566     02EB  3001               	movlw	1
  2567     02EC  07D1               	addwf	81,f
  2568     02ED  3000               	movlw	0
  2569     02EE  3DD0               	addwfc	80,f
  2570     02EF  30FD               	movlw	253
  2571     02F0  0750               	addwf	80,w
  2572     02F1  1C03               	btfss	3,0
  2573     02F2  0008               	return
  2574     02F3  300C               	movlw	12
  2575     02F4  0751               	addwf	81,w
  2576     02F5  1C03               	btfss	3,0
  2577     02F6  0008               	return
  2578     02F7                     MOTOR1_ZERO_IN_LO_LOOP_LV1:	
  2579                           ; MOVF IOC_COUNTER_HBYTE,W
  2580                           ; BTFSS STATUS,Z
  2581                           ; GOTO MOTOR1_ZERO_IN_LO_LOOP_LV1
  2582 ;;------
  2583                           ; MOVLW 0XFE
  2584                           ; ADDWF IOC_COUNTER_LBYTE,W
  2585                           ; BTFSS STATUS,C
  2586                           ; RETURN
  2587                           
  2588     02F7  0022               	banksel	270
  2589     02F8  100E               	bcf	270,0
  2590     02F9  0020               	banksel	12
  2591     02FA  13F2               	bcf	114,7
  2592     02FB  12F2               	bcf	114,5
  2593     02FC  10BA               	bcf	58,1
  2594     02FD  3021               	movlw	33
  2595     02FE  0085               	movwf	5
  2596     02FF  3040               	movlw	64
  2597     0300  0084               	movwf	4
  2598     0301  3007               	movlw	7
  2599     0302  0784               	addwf	4,f
  2600     0303  3000               	movlw	0
  2601     0304  0080               	movwf	0
  2602                           
  2603                           ;----------
  2604     0305  3000               	movlw	0
  2605     0306  00C2               	movwf	66
  2606     0307  1035               	bcf	53,0
  2607     0308  0027               	banksel	908
  2608     0309  3000               	movlw	0
  2609     030A  00A3               	movwf	163
  2610     030B  0020               	banksel	12
  2611     030C  183C               	btfsc	60,0
  2612     030D  2BF1               	goto	RESET_END_IN_NORMAL_LOOP
  2613                           
  2614                           ;BANKSEL IOCBN
  2615                           ; BSF IOCBN,0X02
  2616                           ; BCF IOCBP,0X02
  2617                           ;BANKSEL PORTA
  2618     030E  0008               	return
  2619     030F                     MOTOR1_ZERO_IN_HI_LOOP:	
  2620                           ;-------------------------------------------------------------
  2621                           ;-------------------------------------------------------------
  2622                           
  2623     030F  1A3A               	btfsc	58,4
  2624     0310  0008               	return
  2625     0311  18B5               	btfsc	53,1
  2626     0312  0008               	return
  2627     0313  190D               	btfsc	13,2
  2628     0314  2B24               	goto	MOTOR1_TIME_ZERO_LOOP
  2629     0315  3001               	movlw	1
  2630     0316  07D1               	addwf	81,f
  2631     0317  3000               	movlw	0
  2632     0318  3DD0               	addwfc	80,f
  2633     0319  30FD               	movlw	253
  2634     031A  0750               	addwf	80,w
  2635     031B  1C03               	btfss	3,0
  2636     031C  0008               	return
  2637     031D  300C               	movlw	12
  2638     031E  0751               	addwf	81,w
  2639     031F  1C03               	btfss	3,0
  2640     0320  0008               	return
  2641     0321                     MOTOR1_ZERO_IN_HI_LOOP_LV1:	
  2642                           ; MOVF IOC_COUNTER_HBYTE,W
  2643                           ; BTFSS STATUS,Z
  2644                           ; GOTO MOTOR1_ZERO_IN_HI_LOOP_LV1
  2645 ;;------
  2646                           ; MOVLW 0XFE
  2647                           ; ADDWF IOC_COUNTER_LBYTE,W
  2648                           ; BTFSS STATUS,C
  2649                           ; RETURN
  2650                           
  2651     0321  13F2               	bcf	114,7
  2652     0322  1372               	bcf	114,6
  2653     0323  2B46               	goto	MOTOR_1_NOW_IS_LO
  2654     0324                     MOTOR1_TIME_ZERO_LOOP:
  2655                           
  2656                           ;CLRF IOC_COUNTER_HBYTE
  2657                           ;CLRF IOC_COUNTER_LBYTE
  2658     0324  0AD3               	incf	83,f
  2659     0325  309C               	movlw	156
  2660     0326  0753               	addwf	83,w
  2661     0327  1C03               	btfss	3,0
  2662     0328  0008               	return
  2663     0329  01D3               	clrf	83
  2664     032A  01D1               	clrf	81
  2665     032B  01D0               	clrf	80
  2666     032C  0008               	return
  2667     032D                     MOTOR_1_ZERO_FUNCTION:	
  2668                           ;========================================================
  2669                           ;=====================轉向馬達復位=======================
  2670                           ;========================================================
  2671                           
  2672     032D  1A3A               	btfsc	58,4
  2673     032E  0008               	return
  2674     032F  18B5               	btfsc	53,1
  2675     0330  0008               	return
  2676     0331  1435               	bsf	53,0
  2677     0332  0027               	banksel	908
  2678     0333  3001               	movlw	1
  2679     0334  00A3               	movwf	163
  2680     0335  0020               	banksel	12
  2681     0336  1272               	bcf	114,4
  2682                           
  2683                           ;-----------
  2684     0337  3021               	movlw	33
  2685     0338  0085               	movwf	5
  2686     0339  3040               	movlw	64
  2687     033A  0084               	movwf	4
  2688     033B  3007               	movlw	7
  2689     033C  0784               	addwf	4,f
  2690     033D  3004               	movlw	4
  2691     033E  0080               	movwf	0
  2692                           
  2693                           ;----------
  2694     033F  3001               	movlw	1
  2695     0340  00C2               	movwf	66
  2696     0341  0022               	banksel	270
  2697     0342  140E               	bsf	270,0
  2698                           
  2699                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  2700                           ; BSF MOTOR_CONTROL_PORT,M1_FR
  2701     0343  0020               	banksel	12
  2702     0344  190D               	btfsc	13,2
  2703     0345  2B50               	goto	MOTOR_1_NOW_IS_HI	;目前是HI
  2704     0346                     MOTOR_1_NOW_IS_LO:
  2705                           
  2706                           ;目前是LO
  2707     0346  0020               	banksel	12
  2708     0347  16F2               	bsf	114,5
  2709     0348  1372               	bcf	114,6
  2710     0349  14BA               	bsf	58,1
  2711     034A  01C6               	clrf	70
  2712     034B  01C7               	clrf	71
  2713     034C  01D0               	clrf	80
  2714     034D  01D1               	clrf	81
  2715     034E  01D3               	clrf	83
  2716     034F  0008               	return
  2717     0350                     MOTOR_1_NOW_IS_HI:
  2718     0350  0020               	banksel	12
  2719     0351  1772               	bsf	114,6
  2720     0352  12F2               	bcf	114,5
  2721     0353  14BA               	bsf	58,1
  2722     0354  01C6               	clrf	70
  2723     0355  01C7               	clrf	71
  2724     0356  01D0               	clrf	80
  2725     0357  01D1               	clrf	81
  2726     0358  01D3               	clrf	83
  2727     0359  0008               	return
  2728     035A                     MOTOR_2_ZERO_FUNCTION:	
  2729                           ;========================================================
  2730                           ;=====================注射馬達復位進行中=================
  2731                           ;========================================================
  2732                           
  2733     035A  1A3A               	btfsc	58,4
  2734     035B  0008               	return
  2735     035C  18B6               	btfsc	54,1
  2736     035D  0008               	return
  2737     035E  1232               	bcf	50,4
  2738     035F  1C10               	btfss	16,0
  2739     0360  0008               	return
  2740     0361  0027               	banksel	908
  2741     0362  3001               	movlw	1
  2742     0363  00A3               	movwf	163
  2743     0364  0020               	banksel	12
  2744     0365  1436               	bsf	54,0
  2745                           
  2746                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2747                           ; MOVWF FSR0H
  2748                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2749                           ; MOVWF FSR0L
  2750                           ; MOVLW 0X15
  2751                           ; ADDWF FSR0L,F
  2752                           ; MOVLW 0X0F
  2753                           ; ADDWF FSR0L,F
  2754                           ; MOVLW 0X00
  2755                           ; MOVWF INDF0
  2756                           ;------------------------------------
  2757     0366  3021               	movlw	33
  2758     0367  0085               	movwf	5
  2759     0368  3040               	movlw	64
  2760     0369  0084               	movwf	4
  2761     036A  3015               	movlw	21
  2762     036B  0784               	addwf	4,f
  2763     036C  3007               	movlw	7
  2764     036D  0784               	addwf	4,f
  2765     036E  3001               	movlw	1
  2766     036F  0080               	movwf	0
  2767     0370  0022               	banksel	270
  2768     0371  118E               	bcf	270,3
  2769     0372  150E               	bsf	270,2
  2770     0373  0020               	banksel	12
  2771     0374  16B2               	bsf	50,5
  2772     0375  0008               	return
  2773     0376                     MODBUS_ERROR_CODE_01_LOOP:	
  2774                           ;========================================================
  2775                           ;===============MODBUS ERROR CODE IS 01==================
  2776                           ;========================================================
  2777                           
  2778     0376  103B               	bcf	59,0
  2779     0377  3020               	movlw	32
  2780     0378  0087               	movwf	7
  2781     0379  30B0               	movlw	176
  2782     037A  0086               	movwf	6
  2783     037B  300A               	movlw	10
  2784     037C  0786               	addwf	6,f
  2785                           
  2786                           ;---------------------
  2787     037D  0A86               	incf	6,f
  2788     037E  3080               	movlw	128
  2789     037F  0481               	iorwf	1,f
  2790     0380  0A86               	incf	6,f
  2791     0381  3001               	movlw	1
  2792     0382  0081               	movwf	1
  2793     0383                     MODBUS_ERROR_CODE_END:	
  2794                           ;--------------------
  2795                           
  2796     0383  3003               	movlw	3
  2797     0384  00AA               	movwf	42
  2798     0385  21C2               	call	MODBUS_RTU_READ_LV2
  2799     0386  3005               	movlw	5
  2800     0387  00AD               	movwf	45
  2801     0388  1430               	bsf	48,0
  2802     0389  0008               	return
  2803     038A                     MODBUS_ERROR_CODE_02_LOOP:	
  2804                           ;========================================================
  2805                           ;===============MODBUS ERROR CODE IS 02==================
  2806                           ;========================================================
  2807                           
  2808     038A  10BB               	bcf	59,1
  2809     038B  3020               	movlw	32
  2810     038C  0087               	movwf	7
  2811     038D  30B0               	movlw	176
  2812     038E  0086               	movwf	6
  2813     038F  300A               	movlw	10
  2814     0390  0786               	addwf	6,f
  2815                           
  2816                           ;---------------------
  2817     0391  0A86               	incf	6,f
  2818     0392  3080               	movlw	128
  2819     0393  0481               	iorwf	1,f
  2820     0394  0A86               	incf	6,f
  2821     0395  3002               	movlw	2
  2822     0396  0081               	movwf	1
  2823                           
  2824                           ;--------------------
  2825     0397  2B83               	goto	MODBUS_ERROR_CODE_END
  2826     0398                     MODBUS_ERROR_CODE_03_LOOP:	
  2827                           ;========================================================
  2828                           ;===============MODBUS ERROR CODE IS 03==================
  2829                           ;========================================================
  2830                           
  2831     0398  113B               	bcf	59,2
  2832     0399  3020               	movlw	32
  2833     039A  0087               	movwf	7
  2834     039B  30B0               	movlw	176
  2835     039C  0086               	movwf	6
  2836     039D  300A               	movlw	10
  2837     039E  0786               	addwf	6,f
  2838                           
  2839                           ;---------------------
  2840     039F  0A86               	incf	6,f
  2841     03A0  3080               	movlw	128
  2842     03A1  0481               	iorwf	1,f
  2843     03A2  0A86               	incf	6,f
  2844     03A3  3003               	movlw	3
  2845     03A4  0081               	movwf	1
  2846                           
  2847                           ;--------------------
  2848     03A5  2B83               	goto	MODBUS_ERROR_CODE_END
  2849     03A6                     MODBUS_ERROR_CODE_04_LOOP:	
  2850                           ;========================================================
  2851                           ;===============MODBUS ERROR CODE IS 04==================
  2852                           ;========================================================
  2853                           
  2854     03A6  11BB               	bcf	59,3
  2855     03A7  3020               	movlw	32
  2856     03A8  0087               	movwf	7
  2857     03A9  30B0               	movlw	176
  2858     03AA  0086               	movwf	6
  2859     03AB  300A               	movlw	10
  2860     03AC  0786               	addwf	6,f
  2861                           
  2862                           ;---------------------
  2863     03AD  0A86               	incf	6,f
  2864     03AE  3080               	movlw	128
  2865     03AF  0481               	iorwf	1,f
  2866     03B0  0A86               	incf	6,f
  2867     03B1  3004               	movlw	4
  2868     03B2  0081               	movwf	1
  2869                           
  2870                           ;--------------------
  2871     03B3  2B83               	goto	MODBUS_ERROR_CODE_END
  2872     03B4                     MODBUS_ERROR_CODE_05_LOOP:	
  2873                           ;========================================================
  2874                           ;===============MODBUS ERROR CODE IS 05==================
  2875                           ;========================================================
  2876                           
  2877     03B4  123B               	bcf	59,4
  2878     03B5  3020               	movlw	32
  2879     03B6  0087               	movwf	7
  2880     03B7  30B0               	movlw	176
  2881     03B8  0086               	movwf	6
  2882     03B9  300A               	movlw	10
  2883     03BA  0786               	addwf	6,f
  2884                           
  2885                           ;---------------------
  2886     03BB  0A86               	incf	6,f
  2887     03BC  3080               	movlw	128
  2888     03BD  0481               	iorwf	1,f
  2889     03BE  0A86               	incf	6,f
  2890     03BF  3005               	movlw	5
  2891     03C0  0081               	movwf	1
  2892                           
  2893                           ;--------------------
  2894     03C1  2B83               	goto	MODBUS_ERROR_CODE_END
  2895     03C2                     MODBUS_ERROR_CODE_06_LOOP:	
  2896                           ;========================================================
  2897                           ;===============MODBUS ERROR CODE IS 06==================
  2898                           ;========================================================
  2899                           
  2900     03C2  12BB               	bcf	59,5
  2901     03C3  3020               	movlw	32
  2902     03C4  0087               	movwf	7
  2903     03C5  30B0               	movlw	176
  2904     03C6  0086               	movwf	6
  2905     03C7  300A               	movlw	10
  2906     03C8  0786               	addwf	6,f
  2907                           
  2908                           ;---------------------
  2909     03C9  0A86               	incf	6,f
  2910     03CA  3080               	movlw	128
  2911     03CB  0481               	iorwf	1,f
  2912     03CC  0A86               	incf	6,f
  2913     03CD  3006               	movlw	6
  2914     03CE  0081               	movwf	1
  2915                           
  2916                           ;--------------------
  2917     03CF  2B83               	goto	MODBUS_ERROR_CODE_END
  2918     03D0                     MODULE_WORK_LOOP:	
  2919                           ;********************************************************************************
  2920                           ;********************************************************************************
  2921                           ;========================================================
  2922                           ;================執行MODULE動作副程式====================
  2923                           ;========================================================
  2924                           
  2925     03D0  1A3A               	btfsc	58,4
  2926     03D1  0008               	return
  2927                           
  2928                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_EN
  2929                           ; CALL MOTOR_1_WORKING_LOOP
  2930 ;;-----
  2931                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_EN
  2932                           ; CALL MOTOR_2_WORKING_LOOP
  2933                           ;-----
  2934                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2935                           ; CALL MOTOR_1_WORKING_LOOP
  2936 ;;-----
  2937                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2938                           ; CALL MOTOR_1_WORKING_LOOP
  2939                           ;-----
  2940     03D2  0008               	return
  2941     03D3                     MOTOR_1_WORKING_LOOP:	
  2942                           ;========================================================
  2943                           ;================馬達1動作副程式=========================
  2944                           ;========================================================
  2945                           
  2946                           
  2947                           ;BTFSC MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  2948                           ;RETURN
  2949     03D3  1CF2               	btfss	114,1
  2950     03D4  0008               	return
  2951                           
  2952                           ;BSF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  2953     03D5  0027               	banksel	908
  2954     03D6  3001               	movlw	1
  2955     03D7  00A3               	movwf	163
  2956     03D8  0020               	banksel	12
  2957     03D9  0008               	return
  2958     03DA  1972               	btfsc	114,2
  2959     03DB  2C1A               	goto	MOTOR_1_WORK_CW_LV1
  2960     03DC  19F2               	btfsc	114,3
  2961     03DD  2C83               	goto	MOTOR_1_WORK_CCW_LV1
  2962                           
  2963                           ;----------------------------------
  2964     03DE  3021               	movlw	33
  2965     03DF  0085               	movwf	5
  2966     03E0  3040               	movlw	64
  2967     03E1  0084               	movwf	4
  2968     03E2  0800               	movf	0,w
  2969     03E3  1D03               	btfss	3,2
  2970     03E4  2C03               	goto	MOTOR_1_WORK_CW_LOOP
  2971                           
  2972                           ;-------------
  2973     03E5  0A84               	incf	4,f
  2974     03E6  0800               	movf	0,w
  2975     03E7  1D03               	btfss	3,2
  2976     03E8  2C03               	goto	MOTOR_1_WORK_CW_LOOP
  2977                           
  2978                           ;-------------
  2979     03E9  0A84               	incf	4,f
  2980     03EA  0800               	movf	0,w
  2981     03EB  1D03               	btfss	3,2
  2982     03EC  2C6D               	goto	MOTOR_1_WORK_CCW_LOOP
  2983                           
  2984                           ;-------------
  2985     03ED  0A84               	incf	4,f
  2986     03EE  0800               	movf	0,w
  2987     03EF  1D03               	btfss	3,2
  2988     03F0  2C6D               	goto	MOTOR_1_WORK_CCW_LOOP
  2989     03F1                     RESET_END_IN_NORMAL_LOOP:	
  2990                           ;-------------
  2991                           
  2992     03F1  10F2               	bcf	114,1
  2993     03F2  10BA               	bcf	58,1
  2994     03F3  01C6               	clrf	70
  2995     03F4  01C7               	clrf	71
  2996     03F5  3021               	movlw	33
  2997     03F6  0085               	movwf	5
  2998     03F7  3040               	movlw	64
  2999     03F8  0084               	movwf	4
  3000     03F9  3007               	movlw	7	;CMD 0X13詢問目前MOTOR1狀態
  3001     03FA  0784               	addwf	4,f
  3002     03FB  3000               	movlw	0
  3003     03FC  0080               	movwf	0
  3004     03FD  10B5               	bcf	53,1
  3005     03FE  0027               	banksel	908
  3006     03FF  3000               	movlw	0
  3007     0400  00A3               	movwf	163
  3008     0401  0020               	banksel	12
  3009                           
  3010                           ;----------
  3011     0402  0008               	return
  3012     0403                     MOTOR_1_WORK_CW_LOOP:	
  3013                           ;========================================================
  3014                           ;================馬達1順時針副程式=======================
  3015                           ;========================================================
  3016                           
  3017     0403  0020               	banksel	13
  3018     0404  1D0D               	btfss	13,2
  3019     0405  0008               	return
  3020     0406  0022               	banksel	270
  3021     0407  140E               	bsf	270,0
  3022     0408  108E               	bcf	270,1
  3023     0409  0020               	banksel	12
  3024     040A  3021               	movlw	33
  3025     040B  0085               	movwf	5
  3026     040C  3040               	movlw	64
  3027     040D  0084               	movwf	4
  3028     040E  3007               	movlw	7
  3029     040F  0784               	addwf	4,f
  3030     0410  3001               	movlw	1
  3031     0411  0080               	movwf	0
  3032                           
  3033                           ;----------
  3034     0412  01C0               	clrf	64
  3035     0413  1572               	bsf	114,2
  3036     0414  14BA               	bsf	58,1
  3037     0415  01C6               	clrf	70
  3038     0416  01C7               	clrf	71
  3039     0417  190D               	btfsc	13,2
  3040     0418  2C52               	goto	MOTOR_1_CW_IOC_SET_HI
  3041     0419  11BA               	bcf	58,3
  3042     041A                     MOTOR_1_WORK_CW_LV1:	
  3043                           ;BTFSC PORTB,0X02
  3044                           ;GOTO MOTOR_1_CW_IOC_SET_HI
  3045                           ;BANKSEL IOCBN
  3046                           ; BCF IOCBN,0X02
  3047                           ; BSF IOCBP,0X02
  3048                           ;BANKSEL PORTA
  3049                           
  3050     041A  3021               	movlw	33
  3051     041B  0085               	movwf	5
  3052     041C  3040               	movlw	64
  3053     041D  0084               	movwf	4
  3054                           
  3055                           ;----------------------------------
  3056     041E  0800               	movf	0,w
  3057     041F  1D03               	btfss	3,2
  3058     0420  2C26               	goto	MOTOR_1_WORK_CW_LV3
  3059     0421  0A84               	incf	4,f
  3060     0422  0800               	movf	0,w
  3061     0423  1D03               	btfss	3,2
  3062     0424  2C26               	goto	MOTOR_1_WORK_CW_LV3
  3063     0425  2C36               	goto	MOTOR_1_WORK_CW_FINISH
  3064     0426                     MOTOR_1_WORK_CW_LV3:
  3065                           
  3066                           ;BANKSEL PORTF
  3067                           ;BSF PORTF,0X01
  3068                           ;BCF PORTF,0X01
  3069                           ;BANKSEL PORTA
  3070                           ; MOVF PWM_1_COUNT_DAT,W
  3071                           ; BTFSC STATUS,Z
  3072                           ; RETURN
  3073     0426  1DBA               	btfss	58,3
  3074     0427  2C63               	goto	CHECK_IOC_IS_LO
  3075     0428  2C54               	goto	CHECK_IOC_IS_HI
  3076     0429                     MOTOR_1_WORK_CW_LV4:
  3077                           
  3078                           ;BANKSEL PORTF
  3079                           ;BSF PORTF,0X01
  3080                           ;BCF PORTF,0X01
  3081     0429  0020               	banksel	12
  3082     042A  01C0               	clrf	64
  3083     042B  3021               	movlw	33
  3084     042C  0085               	movwf	5
  3085     042D  3040               	movlw	64
  3086     042E  0084               	movwf	4
  3087                           
  3088                           ;----------------------------------
  3089     042F  0800               	movf	0,w
  3090     0430  1D03               	btfss	3,2
  3091     0431  2C3B               	goto	MOTOR_1_WORK_CW_LV2
  3092     0432  0A84               	incf	4,f
  3093     0433  0800               	movf	0,w
  3094     0434  1D03               	btfss	3,2
  3095     0435  2C3B               	goto	MOTOR_1_WORK_CW_LV2
  3096     0436                     MOTOR_1_WORK_CW_FINISH:
  3097                           
  3098                           ;BANKSEL PORTF
  3099                           ;BSF PORTF,0X00
  3100                           ;BCF PORTF,0X00
  3101                           ;BANKSEL PORTA
  3102     0436  0022               	banksel	270
  3103     0437  100E               	bcf	270,0
  3104     0438  0020               	banksel	12
  3105     0439  1172               	bcf	114,2
  3106     043A  0008               	return
  3107     043B                     MOTOR_1_WORK_CW_LV2:
  3108     043B  0020               	banksel	12
  3109     043C  3021               	movlw	33
  3110     043D  0085               	movwf	5
  3111     043E  3040               	movlw	64
  3112     043F  0084               	movwf	4
  3113     0440  0A84               	incf	4,f
  3114     0441  3001               	movlw	1
  3115     0442  0280               	subwf	0,f
  3116     0443  0384               	decf	4,f
  3117     0444  3000               	movlw	0
  3118     0445  3B80               	subwfb	0,f
  3119                           
  3120                           ;----------------------------------------------------------
  3121     0446  3021               	movlw	33
  3122     0447  0085               	movwf	5
  3123     0448  3040               	movlw	64
  3124     0449  0084               	movwf	4
  3125     044A  3005               	movlw	5
  3126     044B  0784               	addwf	4,f
  3127     044C  3001               	movlw	1
  3128     044D  0780               	addwf	0,f
  3129     044E  0384               	decf	4,f
  3130     044F  3000               	movlw	0
  3131     0450  3D80               	addwfc	0,f
  3132     0451  0008               	return
  3133     0452                     MOTOR_1_CW_IOC_SET_HI:	
  3134                           ;----------------------------------------------------------
  3135                           
  3136     0452  15BA               	bsf	58,3
  3137     0453  2C1A               	goto	MOTOR_1_WORK_CW_LV1
  3138     0454                     CHECK_IOC_IS_HI:
  3139     0454  190D               	btfsc	13,2
  3140     0455  0008               	return
  3141     0456  0846               	movf	70,w
  3142     0457  1D03               	btfss	3,2
  3143     0458  2C5E               	goto	MOTOR_1_WORK_CW_LV5
  3144                           
  3145                           ;------
  3146     0459  30FE               	movlw	254
  3147     045A  0747               	addwf	71,w
  3148     045B  1C03               	btfss	3,0
  3149     045C  0008               	return
  3150     045D  2C5E               	goto	MOTOR_1_WORK_CW_LV5
  3151     045E                     MOTOR_1_WORK_CW_LV5:
  3152                           
  3153                           ;BANKSEL PORTF
  3154                           ;BSF PORTF,0X00
  3155                           ;BCF PORTF,0X00
  3156     045E  0020               	banksel	12
  3157     045F  01C6               	clrf	70
  3158     0460  01C7               	clrf	71
  3159     0461  11BA               	bcf	58,3
  3160     0462  0008               	return
  3161     0463                     CHECK_IOC_IS_LO:	
  3162                           ;-----------------------------------------------
  3163                           
  3164     0463  1D0D               	btfss	13,2
  3165     0464  0008               	return
  3166     0465  0846               	movf	70,w
  3167     0466  1D03               	btfss	3,2
  3168     0467  2C29               	goto	MOTOR_1_WORK_CW_LV4
  3169                           
  3170                           ;------
  3171     0468  30FE               	movlw	254
  3172     0469  0747               	addwf	71,w
  3173     046A  1C03               	btfss	3,0
  3174     046B  0008               	return
  3175     046C  2C29               	goto	MOTOR_1_WORK_CW_LV4
  3176     046D                     MOTOR_1_WORK_CCW_LOOP:	
  3177                           ;========================================================
  3178                           ;================馬達1逆時針副程式=======================
  3179                           ;========================================================
  3180                           
  3181     046D  0022               	banksel	270
  3182     046E  140E               	bsf	270,0
  3183     046F  148E               	bsf	270,1
  3184     0470  0020               	banksel	12
  3185     0471  3021               	movlw	33
  3186     0472  0085               	movwf	5
  3187     0473  3040               	movlw	64
  3188     0474  0084               	movwf	4
  3189     0475  3007               	movlw	7
  3190     0476  0784               	addwf	4,f
  3191     0477  3001               	movlw	1
  3192     0478  0080               	movwf	0
  3193                           
  3194                           ;----------
  3195     0479  1D0D               	btfss	13,2
  3196     047A  0008               	return
  3197     047B  01C0               	clrf	64
  3198     047C  15F2               	bsf	114,3
  3199     047D  14BA               	bsf	58,1
  3200     047E  01C6               	clrf	70
  3201     047F  01C7               	clrf	71
  3202     0480  190D               	btfsc	13,2
  3203     0481  2CBF               	goto	MOTOR_1_CCW_IOC_SET_HI
  3204     0482  11BA               	bcf	58,3
  3205     0483                     MOTOR_1_WORK_CCW_LV1:
  3206     0483  3021               	movlw	33
  3207     0484  0085               	movwf	5
  3208     0485  3040               	movlw	64
  3209     0486  0084               	movwf	4
  3210     0487  3002               	movlw	2
  3211     0488  0784               	addwf	4,f
  3212                           
  3213                           ;----------------------------------
  3214     0489  0800               	movf	0,w
  3215     048A  1D03               	btfss	3,2
  3216     048B  2C91               	goto	MOTOR_1_WORK_CCW_LV3
  3217     048C  0A84               	incf	4,f
  3218     048D  0800               	movf	0,w
  3219     048E  1D03               	btfss	3,2
  3220     048F  2C91               	goto	MOTOR_1_WORK_CCW_LV3
  3221     0490  2CA2               	goto	MOTOR_1_WORK_CCW_FINISH
  3222     0491                     MOTOR_1_WORK_CCW_LV3:	
  3223                           ;----------------------------------
  3224                           
  3225                           
  3226                           ; MOVF PWM_1_COUNT_DAT,W
  3227                           ; BTFSC STATUS,Z
  3228                           ; RETURN
  3229     0491  1DBA               	btfss	58,3
  3230     0492  2CCD               	goto	CHECKC_IOC_IS_LO
  3231     0493  2CC1               	goto	CHECKC_IOC_IS_HI
  3232     0494                     MOTOR_1_WORK_CCW_LV4:
  3233     0494  01C0               	clrf	64
  3234     0495  3021               	movlw	33
  3235     0496  0085               	movwf	5
  3236     0497  3040               	movlw	64
  3237     0498  0084               	movwf	4
  3238     0499  3002               	movlw	2
  3239     049A  0784               	addwf	4,f
  3240                           
  3241                           ;----------------------------------
  3242     049B  0800               	movf	0,w
  3243     049C  1D03               	btfss	3,2
  3244     049D  2CA7               	goto	MOTOR_1_WORK_CCW_LV2
  3245     049E  0A84               	incf	4,f
  3246     049F  0800               	movf	0,w
  3247     04A0  1D03               	btfss	3,2
  3248     04A1  2CA7               	goto	MOTOR_1_WORK_CCW_LV2
  3249     04A2                     MOTOR_1_WORK_CCW_FINISH:
  3250     04A2  0022               	banksel	270
  3251     04A3  100E               	bcf	270,0
  3252     04A4  0020               	banksel	12
  3253     04A5  11F2               	bcf	114,3
  3254     04A6  0008               	return
  3255     04A7                     MOTOR_1_WORK_CCW_LV2:
  3256     04A7  0020               	banksel	12
  3257     04A8  3021               	movlw	33
  3258     04A9  0085               	movwf	5
  3259     04AA  3040               	movlw	64
  3260     04AB  0084               	movwf	4
  3261     04AC  3003               	movlw	3
  3262     04AD  0784               	addwf	4,f
  3263     04AE  3001               	movlw	1
  3264     04AF  0280               	subwf	0,f
  3265     04B0  0384               	decf	4,f
  3266     04B1  3000               	movlw	0
  3267     04B2  3B80               	subwfb	0,f
  3268                           
  3269                           ;----------------------------------------------
  3270     04B3  3021               	movlw	33
  3271     04B4  0085               	movwf	5
  3272     04B5  3040               	movlw	64
  3273     04B6  0084               	movwf	4
  3274     04B7  3005               	movlw	5
  3275     04B8  0784               	addwf	4,f
  3276     04B9  3001               	movlw	1
  3277     04BA  0280               	subwf	0,f
  3278     04BB  0384               	decf	4,f
  3279     04BC  3000               	movlw	0
  3280     04BD  3B80               	subwfb	0,f
  3281     04BE  0008               	return
  3282     04BF                     MOTOR_1_CCW_IOC_SET_HI:
  3283     04BF  15BA               	bsf	58,3
  3284     04C0  2C83               	goto	MOTOR_1_WORK_CCW_LV1
  3285     04C1                     CHECKC_IOC_IS_HI:
  3286     04C1  190D               	btfsc	13,2
  3287     04C2  0008               	return
  3288     04C3  0846               	movf	70,w
  3289     04C4  1D03               	btfss	3,2
  3290     04C5  2CCB               	goto	MOTOR_1_WORK_CCW_LV5
  3291                           
  3292                           ;------
  3293     04C6  30FE               	movlw	254
  3294     04C7  0747               	addwf	71,w
  3295     04C8  1C03               	btfss	3,0
  3296     04C9  0008               	return
  3297     04CA  2CCB               	goto	MOTOR_1_WORK_CCW_LV5
  3298     04CB                     MOTOR_1_WORK_CCW_LV5:
  3299     04CB  11BA               	bcf	58,3
  3300     04CC  0008               	return
  3301     04CD                     CHECKC_IOC_IS_LO:
  3302     04CD  1D0D               	btfss	13,2
  3303     04CE  0008               	return
  3304     04CF  0846               	movf	70,w
  3305     04D0  1D03               	btfss	3,2
  3306     04D1  2C94               	goto	MOTOR_1_WORK_CCW_LV4
  3307                           
  3308                           ;------
  3309     04D2  30FE               	movlw	254
  3310     04D3  0747               	addwf	71,w
  3311     04D4  1C03               	btfss	3,0
  3312     04D5  0008               	return
  3313     04D6  2C94               	goto	MOTOR_1_WORK_CCW_LV4
  3314     04D7                     MOTOR_2_WORKING_LOOP:	
  3315                           ;========================================================
  3316                           ;================馬達2動作副程式=========================
  3317                           ;========================================================
  3318                           
  3319     04D7  1836               	btfsc	54,0
  3320     04D8  0008               	return
  3321     04D9  1CB2               	btfss	50,1
  3322     04DA  0008               	return
  3323     04DB  0027               	banksel	908
  3324     04DC  3001               	movlw	1
  3325     04DD  00A3               	movwf	163
  3326     04DE  0020               	banksel	12
  3327     04DF  14B6               	bsf	54,1
  3328     04E0  1932               	btfsc	50,2
  3329     04E1  2D1B               	goto	MOTOR_2_WORK_CW_LV1
  3330     04E2  19B2               	btfsc	50,3
  3331     04E3  2D66               	goto	MOTOR_2_WORK_CCW_LV1
  3332                           
  3333                           ;----------------------------------
  3334     04E4  3021               	movlw	33
  3335     04E5  0085               	movwf	5
  3336     04E6  3040               	movlw	64
  3337     04E7  0084               	movwf	4
  3338     04E8  3015               	movlw	21
  3339     04E9  0784               	addwf	4,f
  3340                           
  3341                           ;----------
  3342     04EA  0800               	movf	0,w
  3343     04EB  1D03               	btfss	3,2
  3344     04EC  2D0B               	goto	MOTOR_2_WORK_CW_LOOP
  3345                           
  3346                           ;-------------
  3347     04ED  0A84               	incf	4,f
  3348     04EE  0800               	movf	0,w
  3349     04EF  1D03               	btfss	3,2
  3350     04F0  2D0B               	goto	MOTOR_2_WORK_CW_LOOP
  3351                           
  3352                           ;-------------
  3353     04F1  0A84               	incf	4,f
  3354     04F2  0800               	movf	0,w
  3355     04F3  1D03               	btfss	3,2
  3356     04F4  2D56               	goto	MOTOR_2_WORK_CCW_LOOP
  3357                           
  3358                           ;-------------
  3359     04F5  0A84               	incf	4,f
  3360     04F6  0800               	movf	0,w
  3361     04F7  1D03               	btfss	3,2
  3362     04F8  2D56               	goto	MOTOR_2_WORK_CCW_LOOP
  3363     04F9                     MOTOR_2_IOC_STOP_LOOP:	
  3364                           ;-------------
  3365                           
  3366     04F9  0020               	banksel	12
  3367     04FA  10B2               	bcf	50,1
  3368     04FB  3021               	movlw	33
  3369     04FC  0085               	movwf	5
  3370     04FD  3040               	movlw	64
  3371     04FE  0084               	movwf	4
  3372     04FF  3015               	movlw	21
  3373     0500  0784               	addwf	4,f
  3374     0501  3007               	movlw	7
  3375     0502  0784               	addwf	4,f
  3376     0503  3000               	movlw	0
  3377     0504  0080               	movwf	0
  3378                           
  3379                           ;----------
  3380     0505  10B6               	bcf	54,1
  3381     0506  0027               	banksel	908
  3382     0507  3000               	movlw	0
  3383     0508  00A3               	movwf	163
  3384     0509  0020               	banksel	12
  3385     050A  0008               	return
  3386     050B                     MOTOR_2_WORK_CW_LOOP:	
  3387                           ;========================================================
  3388                           ;================馬達2順時針副程式=======================
  3389                           ;========================================================
  3390                           
  3391     050B  0022               	banksel	270
  3392     050C  150E               	bsf	270,2
  3393     050D  118E               	bcf	270,3
  3394     050E  0020               	banksel	12
  3395     050F  3021               	movlw	33
  3396     0510  0085               	movwf	5
  3397     0511  3040               	movlw	64
  3398     0512  0084               	movwf	4
  3399     0513  3015               	movlw	21
  3400     0514  0784               	addwf	4,f
  3401     0515  3007               	movlw	7
  3402     0516  0784               	addwf	4,f
  3403     0517  3001               	movlw	1	;MOTOR 2 IS WORKING
  3404     0518  0080               	movwf	0
  3405                           
  3406                           ;----------
  3407     0519  01C1               	clrf	65
  3408     051A  1532               	bsf	50,2
  3409     051B                     MOTOR_2_WORK_CW_LV1:
  3410     051B  1C10               	btfss	16,0
  3411     051C  2D2E               	goto	MOTOR_2_WORK_CW_FINISH
  3412     051D  0841               	movf	65,w
  3413     051E  1903               	btfsc	3,2
  3414     051F  0008               	return
  3415     0520  01C1               	clrf	65
  3416     0521  3021               	movlw	33
  3417     0522  0085               	movwf	5
  3418     0523  3040               	movlw	64
  3419     0524  0084               	movwf	4
  3420     0525  3015               	movlw	21
  3421     0526  0784               	addwf	4,f
  3422                           
  3423                           ;----------------------------------
  3424     0527  0800               	movf	0,w
  3425     0528  1D03               	btfss	3,2
  3426     0529  2D3C               	goto	MOTOR_2_WORK_CW_LV2
  3427     052A  0A84               	incf	4,f
  3428     052B  0800               	movf	0,w
  3429     052C  1D03               	btfss	3,2
  3430     052D  2D3C               	goto	MOTOR_2_WORK_CW_LV2
  3431     052E                     MOTOR_2_WORK_CW_FINISH:
  3432     052E  3021               	movlw	33
  3433     052F  0085               	movwf	5
  3434     0530  3040               	movlw	64
  3435     0531  0084               	movwf	4
  3436     0532  3015               	movlw	21
  3437     0533  0784               	addwf	4,f
  3438                           
  3439                           ;----------
  3440     0534  0180               	clrf	0
  3441     0535  0A84               	incf	4,f
  3442     0536  0180               	clrf	0
  3443                           
  3444                           ;-------------------------------
  3445     0537  0022               	banksel	270
  3446     0538  110E               	bcf	270,2
  3447     0539  0020               	banksel	12
  3448     053A  1132               	bcf	50,2
  3449     053B  0008               	return
  3450     053C                     MOTOR_2_WORK_CW_LV2:
  3451     053C  3021               	movlw	33
  3452     053D  0085               	movwf	5
  3453     053E  3040               	movlw	64
  3454     053F  0084               	movwf	4
  3455     0540  3015               	movlw	21
  3456     0541  0784               	addwf	4,f
  3457                           
  3458                           ;------------
  3459     0542  0A84               	incf	4,f
  3460     0543  3001               	movlw	1
  3461     0544  0280               	subwf	0,f
  3462     0545  0384               	decf	4,f
  3463     0546  3000               	movlw	0
  3464     0547  3B80               	subwfb	0,f
  3465                           
  3466                           ;------------------
  3467     0548  3021               	movlw	33
  3468     0549  0085               	movwf	5
  3469     054A  3040               	movlw	64
  3470     054B  0084               	movwf	4
  3471     054C  3015               	movlw	21
  3472     054D  0784               	addwf	4,f
  3473     054E  3005               	movlw	5
  3474     054F  0784               	addwf	4,f
  3475     0550  3001               	movlw	1
  3476     0551  0280               	subwf	0,f
  3477     0552  0384               	decf	4,f
  3478     0553  3000               	movlw	0
  3479     0554  3B80               	subwfb	0,f
  3480     0555  0008               	return
  3481     0556                     MOTOR_2_WORK_CCW_LOOP:	
  3482                           ;========================================================
  3483                           ;================馬達2逆時針副程式=======================
  3484                           ;========================================================
  3485                           
  3486     0556  0022               	banksel	270
  3487     0557  150E               	bsf	270,2
  3488     0558  158E               	bsf	270,3
  3489     0559  0020               	banksel	12
  3490     055A  3021               	movlw	33
  3491     055B  0085               	movwf	5
  3492     055C  3040               	movlw	64
  3493     055D  0084               	movwf	4
  3494     055E  3015               	movlw	21
  3495     055F  0784               	addwf	4,f
  3496     0560  3007               	movlw	7
  3497     0561  0784               	addwf	4,f
  3498     0562  3001               	movlw	1	;馬達正在運作中
  3499     0563  0080               	movwf	0
  3500                           
  3501                           ;----------
  3502     0564  01C1               	clrf	65
  3503     0565  15B2               	bsf	50,3
  3504     0566                     MOTOR_2_WORK_CCW_LV1:
  3505     0566  0841               	movf	65,w
  3506     0567  1903               	btfsc	3,2
  3507     0568  0008               	return
  3508     0569  01C1               	clrf	65
  3509     056A  3021               	movlw	33
  3510     056B  0085               	movwf	5
  3511     056C  3040               	movlw	64
  3512     056D  0084               	movwf	4
  3513     056E  3015               	movlw	21
  3514     056F  0784               	addwf	4,f
  3515     0570  3002               	movlw	2
  3516     0571  0784               	addwf	4,f
  3517                           
  3518                           ;----------------------------------
  3519     0572  0800               	movf	0,w
  3520     0573  1D03               	btfss	3,2
  3521     0574  2D7E               	goto	MOTOR_2_WORK_CCW_LV2
  3522     0575  0A84               	incf	4,f
  3523     0576  0800               	movf	0,w
  3524     0577  1D03               	btfss	3,2
  3525     0578  2D7E               	goto	MOTOR_2_WORK_CCW_LV2
  3526     0579                     MOTOR_2_WORK_CCW_FINISH:
  3527     0579  0022               	banksel	270
  3528     057A  110E               	bcf	270,2
  3529     057B  0020               	banksel	12
  3530     057C  11B2               	bcf	50,3
  3531     057D  0008               	return
  3532     057E                     MOTOR_2_WORK_CCW_LV2:
  3533     057E  3021               	movlw	33
  3534     057F  0085               	movwf	5
  3535     0580  3040               	movlw	64
  3536     0581  0084               	movwf	4
  3537     0582  3015               	movlw	21
  3538     0583  0784               	addwf	4,f
  3539                           
  3540                           ;INCF FSR0L,F
  3541     0584  3003               	movlw	3
  3542     0585  0784               	addwf	4,f
  3543     0586  3001               	movlw	1
  3544     0587  0280               	subwf	0,f
  3545     0588  0384               	decf	4,f
  3546     0589  3000               	movlw	0
  3547     058A  3B80               	subwfb	0,f
  3548                           
  3549                           ;-------------------------
  3550     058B  3021               	movlw	33
  3551     058C  0085               	movwf	5
  3552     058D  3040               	movlw	64
  3553     058E  0084               	movwf	4
  3554     058F  3015               	movlw	21
  3555     0590  0784               	addwf	4,f
  3556     0591  3005               	movlw	5
  3557     0592  0784               	addwf	4,f
  3558     0593  3001               	movlw	1
  3559     0594  0780               	addwf	0,f
  3560     0595  0384               	decf	4,f
  3561     0596  3000               	movlw	0
  3562     0597  3D80               	addwfc	0,f
  3563     0598  0008               	return
  3564     0599                     PREPARE_TX_DATA_LOOP:	
  3565                           ;========================================================
  3566                           ;====================準備TX資料副程式====================
  3567                           ;========================================================
  3568                           
  3569                           
  3570                           ; MOVLW 0X08
  3571                           ; MOVWF WATCH_COUNTER
  3572                           ; CALL WATCH_SUB_FUNCTION
  3573     0599  0020               	banksel	12
  3574     059A  2665               	call	DELAY_10ms
  3575     059B  3020               	movlw	32
  3576     059C  0087               	movwf	7
  3577     059D  30B0               	movlw	176
  3578     059E  0086               	movwf	6
  3579     059F  300A               	movlw	10
  3580     05A0  0786               	addwf	6,f
  3581     05A1  0027               	banksel	909
  3582     05A2  158D               	bsf	909,3
  3583     05A3  266A               	call	DELAY_1ms
  3584     05A4  0020               	banksel	12
  3585     05A5                     TEST_MAX485_LOOP1:	
  3586                           ;---------------------------------------------
  3587                           
  3588     05A5  0029               	banksel	1174
  3589     05A6  1C96               	btfss	1174,1
  3590     05A7  2DA5               	goto	TEST_MAX485_LOOP1
  3591     05A8  0029               	banksel	1170
  3592     05A9  0801               	movf	1,w
  3593     05AA  0092               	movwf	1170
  3594     05AB  0020               	banksel	12
  3595     05AC  0A86               	incf	6,f
  3596     05AD  0BAD               	decfsz	45,f
  3597     05AE  2DA5               	goto	TEST_MAX485_LOOP1
  3598     05AF                     TEST_MAX485_LOOP1_LV1:
  3599     05AF  0029               	banksel	1174
  3600     05B0  1C96               	btfss	1174,1
  3601     05B1  2DAF               	goto	TEST_MAX485_LOOP1_LV1
  3602     05B2  0027               	banksel	909
  3603     05B3  118D               	bcf	909,3
  3604     05B4  0029               	banksel	1173
  3605     05B5  1615               	bsf	1173,4
  3606     05B6  0027               	banksel	908
  3607     05B7  3001               	movlw	1
  3608     05B8  00A5               	movwf	165
  3609     05B9  0020               	banksel	12
  3610     05BA  1030               	bcf	48,0
  3611     05BB  0008               	return
  3612     05BC                     ADC_TAKE_DATA_FUNCTION:	
  3613                           ;========================================================
  3614                           ;=====================ADC取資料副程式====================
  3615                           ;========================================================
  3616                           
  3617     05BC  0021               	banksel	158
  3618     05BD  3031               	movlw	49	;AN12啟動
  3619     05BE  009D               	movwf	157
  3620     05BF  30C0               	movlw	192
  3621     05C0  009E               	movwf	158
  3622     05C1  01FC               	clrf	124
  3623     05C2  01FD               	clrf	125
  3624     05C3  0020               	banksel	12
  3625     05C4  267D               	call	DELAY_100us
  3626     05C5  267D               	call	DELAY_100us
  3627     05C6  267D               	call	DELAY_100us
  3628     05C7  0021               	banksel	157
  3629                           
  3630 ;;------------------------ADC_RUN-------------------------------
  3631     05C8  149D               	bsf	157,1
  3632     05C9                     ADC_WORK:
  3633     05C9  189D               	btfsc	157,1
  3634     05CA  2DC9               	goto	ADC_WORK
  3635     05CB  0021               	banksel	156
  3636     05CC  081C               	movf	156,w
  3637     05CD  00FC               	movwf	124
  3638     05CE  081B               	movf	155,w
  3639     05CF  00FD               	movwf	125
  3640     05D0  0020               	banksel	12
  3641     05D1  0008               	return
  3642     05D2                     WATCH_SUB_FUNCTION:	
  3643                           ;========================================================
  3644                           ;====================測試用將資料送出====================
  3645                           ;========================================================
  3646                           ;這個部分是顯示內部資料的副程式
  3647                           
  3648     05D2  3020               	movlw	32
  3649     05D3  0085               	movwf	5
  3650     05D4  30BA               	movlw	186
  3651     05D5  0084               	movwf	4
  3652     05D6  3008               	movlw	8
  3653     05D7  00F1               	movwf	113
  3654     05D8  0800               	movf	0,w
  3655     05D9  00F2               	movwf	114
  3656     05DA                     WATCH_SUB_FUNC_LV1:
  3657     05DA  0022               	banksel	272
  3658     05DB  1310               	bcf	272,6
  3659     05DC  1BF2               	btfsc	114,7
  3660     05DD  1690               	bsf	272,5
  3661     05DE  1FF2               	btfss	114,7
  3662     05DF  1290               	bcf	272,5
  3663     05E0  1710               	bsf	272,6
  3664     05E1  0DF2               	rlf	114,f
  3665     05E2  0BF1               	decfsz	113,f
  3666     05E3  2DDA               	goto	WATCH_SUB_FUNC_LV1
  3667                           
  3668                           ;----------
  3669     05E4  3008               	movlw	8
  3670     05E5  00F1               	movwf	113
  3671     05E6  0A84               	incf	4,f
  3672     05E7  0800               	movf	0,w
  3673     05E8  00F2               	movwf	114
  3674     05E9  0BF0               	decfsz	112,f
  3675     05EA  2DDA               	goto	WATCH_SUB_FUNC_LV1
  3676     05EB  1290               	bcf	272,5
  3677     05EC  1310               	bcf	272,6
  3678     05ED  0020               	banksel	12
  3679     05EE  0008               	return
  3680     05EF                     CRC_16_FUNCTION_LOOP:	
  3681                           ;========================================================
  3682                           ;====================CRC-16運算副程式====================
  3683                           ;========================================================
  3684                           
  3685     05EF  0020               	banksel	12
  3686     05F0  0827               	movf	39,w
  3687     05F1  06A9               	xorwf	41,f
  3688                           
  3689                           ;---------
  3690     05F2  3009               	movlw	9
  3691     05F3  00A6               	movwf	38
  3692     05F4                     CRC_16_FUNCTION_LV1:
  3693     05F4  03A6               	decf	38,f
  3694     05F5  0826               	movf	38,w
  3695     05F6  1903               	btfsc	3,2
  3696     05F7  2E02               	goto	CRC_16_END_FUNCTION
  3697                           
  3698                           ;---------------------
  3699     05F8  1003               	bcf	3,0
  3700     05F9  0CA8               	rrf	40,f
  3701     05FA  0CA9               	rrf	41,f
  3702     05FB  1C03               	btfss	3,0
  3703     05FC  2DF4               	goto	CRC_16_FUNCTION_LV1
  3704                           
  3705                           ;---------------------
  3706     05FD  30A0               	movlw	160	;CRC-16運算的參數
  3707     05FE  06A8               	xorwf	40,f
  3708     05FF  3001               	movlw	1
  3709     0600  06A9               	xorwf	41,f
  3710     0601  2DF4               	goto	CRC_16_FUNCTION_LV1
  3711     0602                     CRC_16_END_FUNCTION:
  3712     0602  0020               	banksel	12
  3713     0603  0008               	return
  3714     0604                     AAAA_1800:	
  3715                           ;=======================================================
  3716                           ;===============測試將收到的資料顯示出==================OK
  3717                           ;=======================================================
  3718                           
  3719     0604  3008               	movlw	8
  3720     0605  00F0               	movwf	112
  3721     0606                     AAAAN:
  3722     0606  0027               	banksel	908
  3723     0607  100C               	bcf	908,0
  3724                           
  3725                           ;----------------
  3726     0608  1BF1               	btfsc	113,7
  3727     0609  150C               	bsf	908,2
  3728     060A  1FF1               	btfss	113,7
  3729     060B  110C               	bcf	908,2
  3730                           
  3731                           ;----------------
  3732     060C  140C               	bsf	908,0
  3733     060D  0DF1               	rlf	113,f
  3734     060E  0BF0               	decfsz	112,f
  3735     060F  2E06               	goto	AAAAN
  3736     0610  100C               	bcf	908,0
  3737     0611  110C               	bcf	908,2
  3738     0612  0020               	banksel	12
  3739     0613  0008               	return
  3740     0614                     SET_TMR2_BASE_TIME:	
  3741                           ;=======================================================
  3742                           ;================TIMER2基礎時間設定=====================OK
  3743                           ;=======================================================
  3744                           ;TIMER2 BASE TIME IS 1mS
  3745                           
  3746     0614  0020               	banksel	28
  3747     0615  3015               	movlw	21
  3748     0616  009C               	movwf	28
  3749     0617  30A7               	movlw	167
  3750     0618  009B               	movwf	27
  3751                           
  3752                           ;---------------------
  3753     0619  3004               	movlw	4
  3754     061A  00A3               	movwf	35
  3755     061B  0020               	banksel	12
  3756     061C  0008               	return
  3757     061D                     SET_TMR2_INT_EN:	
  3758                           ;=======================================================
  3759                           ;===============TIMER2中斷參數設定======================OK
  3760                           ;=======================================================
  3761                           
  3762     061D  0021               	banksel	145
  3763     061E  1491               	bsf	145,1
  3764     061F  0020               	banksel	12
  3765     0620  0008               	return
  3766     0621                     SET_TMR2_ON:	
  3767                           ;=======================================================
  3768                           ;===================TIMER2啟動==========================OK
  3769                           ;=======================================================
  3770                           
  3771     0621  0020               	banksel	28
  3772     0622  151C               	bsf	28,2
  3773     0623  0020               	banksel	12
  3774     0624  0008               	return
  3775     0625                     CLEAN_ALL_REGISTER:	
  3776                           ;========================================================
  3777                           ;=================將REG內資料全部清空====================OK
  3778                           ;========================================================
  3779                           
  3780     0625  3020               	movlw	32
  3781     0626  0087               	movwf	7
  3782     0627  3000               	movlw	0
  3783     0628  0086               	movwf	6
  3784     0629  3003               	movlw	3
  3785     062A  00F1               	movwf	113
  3786     062B  30FF               	movlw	255
  3787     062C  00F0               	movwf	112
  3788     062D                     CLEAN_ALL_REGISTER_LOOP:
  3789     062D  0181               	clrf	1
  3790     062E  1003               	bcf	3,0
  3791     062F  3001               	movlw	1
  3792     0630  0786               	addwf	6,f
  3793     0631  3000               	movlw	0
  3794     0632  3D87               	addwfc	7,f
  3795     0633  0BF0               	decfsz	112,f
  3796     0634  2E2D               	goto	CLEAN_ALL_REGISTER_LOOP
  3797     0635  30FF               	movlw	255
  3798     0636  00F0               	movwf	112
  3799     0637  0BF1               	decfsz	113,f
  3800     0638  2E2D               	goto	CLEAN_ALL_REGISTER_LOOP
  3801     0639  0020               	banksel	12
  3802     063A  0008               	return
  3803     063B                     READ_EEPROM:	
  3804                           ;=======================================================
  3805                           ;===================== 讀EEPROM ========================OK
  3806                           ;=======================================================
  3807                           
  3808     063B  0023               	banksel	401
  3809     063C  087E               	movf	126,w
  3810     063D  0091               	movwf	401
  3811     063E  1315               	bcf	405,6	;USER EEPROM
  3812     063F  1395               	bcf	405,7	;USER EEPROM
  3813     0640  1415               	bsf	405,0	;READ_EEPROM
  3814     0641  0813               	movf	403,w
  3815     0642  00FF               	movwf	127
  3816     0643  0020               	banksel	12
  3817     0644  0008               	return
  3818     0645                     WRITE_EEPROM:	
  3819                           ;=======================================================
  3820                           ;===================== 寫EEPROM ========================OK
  3821                           ;=======================================================
  3822                           
  3823     0645  138B               	bcf	11,7
  3824     0646  0023               	banksel	401
  3825     0647  087E               	movf	126,w
  3826     0648  0091               	movwf	401	;EEPROM ADDRESS
  3827     0649  087F               	movf	127,w
  3828     064A  0093               	movwf	403	;EEPROM DATA
  3829     064B                     WRITE_EEPROM_LOOP_1:	
  3830 ;;-----------------------
  3831                           
  3832     064B  1315               	bcf	405,6	;USER EEPROM
  3833     064C  1395               	bcf	405,7	;USER EEPROM
  3834     064D  1515               	bsf	405,2	;ENABLE WRITE
  3835     064E  3055               	movlw	85	;固定程序
  3836     064F  0096               	movwf	406
  3837     0650  30AA               	movlw	170
  3838     0651  0096               	movwf	406	;固定程序
  3839                           
  3840 ;;-----------------------
  3841     0652  1495               	bsf	405,1	;RUN WRITE EEPROM
  3842     0653                     WAIT_EEPROM_WRITE_OVER:
  3843     0653  1895               	btfsc	405,1
  3844     0654  2E53               	goto	WAIT_EEPROM_WRITE_OVER
  3845     0655  0023               	banksel	405
  3846     0656  1115               	bcf	405,2	;Disable writes
  3847     0657  0020               	banksel	12
  3848     0658  178B               	bsf	11,7
  3849     0659  0008               	return
  3850     065A                     DELAY_3000ms:	
  3851                           ;========================================================
  3852                           ;======================== DELAY =========================OK
  3853                           ;========================================================
  3854                           ;DEFINE IS 8MHZ
  3855                           
  3856     065A  265C               	call	DELAY_1000ms
  3857     065B  265C               	call	DELAY_1000ms
  3858     065C                     DELAY_1000ms:
  3859     065C  265D               	call	DELAY_500ms
  3860     065D                     DELAY_500ms:
  3861     065D  2661               	call	DELAY_100ms
  3862     065E  2661               	call	DELAY_100ms
  3863     065F  2661               	call	DELAY_100ms
  3864     0660  2661               	call	DELAY_100ms
  3865     0661                     DELAY_100ms:
  3866     0661  2664               	call	DELAY_20ms
  3867     0662  2663               	call	DELAY_40ms
  3868     0663                     DELAY_40ms:
  3869     0663  2664               	call	DELAY_20ms
  3870     0664                     DELAY_20ms:
  3871     0664  2665               	call	DELAY_10ms
  3872     0665                     DELAY_10ms:
  3873     0665  2666               	call	DELAY_5ms
  3874     0666                     DELAY_5ms:
  3875     0666  266A               	call	DELAY_1ms
  3876     0667                     DELAY_4ms:
  3877     0667  266A               	call	DELAY_1ms
  3878     0668                     DELAY_3ms:
  3879     0668  266A               	call	DELAY_1ms
  3880     0669                     DELAY_2ms:
  3881     0669  266A               	call	DELAY_1ms
  3882     066A                     DELAY_1ms:
  3883     066A  3031               	movlw	49
  3884     066B  00A0               	movwf	32	;49
  3885     066C  00A1               	movwf	33	;49
  3886     066D  300A               	movlw	10
  3887     066E  00A2               	movwf	34
  3888     066F  2E70               	goto	DELAY_LOOP_1
  3889     0670                     DELAY_LOOP_1:
  3890     0670  0000               	nop	;1
  3891     0671  0BA0               	decfsz	32,f	;2
  3892     0672  2E70               	goto	DELAY_LOOP_1	;3,4 (0.5*4*49 = 98us)
  3893     0673  0821               	movf	33,w	;4
  3894     0674  00A0               	movwf	32	;1
  3895     0675  0BA2               	decfsz	34,f	;2
  3896     0676  2E70               	goto	DELAY_LOOP_1	;3,4
  3897     0677  0008               	return
  3898     0678                     DELAY_600us:	
  3899                           ;==========================================
  3900                           
  3901     0678  267D               	call	DELAY_100us
  3902     0679                     DELAY_500us:
  3903     0679  267D               	call	DELAY_100us
  3904     067A                     DELAY_400us:
  3905     067A  267D               	call	DELAY_100us
  3906     067B                     DELAY_300us:
  3907     067B  267D               	call	DELAY_100us
  3908     067C                     DELAY_200us:
  3909     067C  267D               	call	DELAY_100us
  3910     067D                     DELAY_100us:
  3911     067D  2686               	call	DELAY_10us
  3912     067E                     DELAY_90us:
  3913     067E  2686               	call	DELAY_10us
  3914     067F  2686               	call	DELAY_10us
  3915     0680  2686               	call	DELAY_10us
  3916     0681                     DELAY_60us:
  3917     0681  2686               	call	DELAY_10us
  3918     0682                     DELAY_50us:
  3919     0682  2686               	call	DELAY_10us
  3920     0683                     DELAY_40us:
  3921     0683  2686               	call	DELAY_10us
  3922     0684                     DELAY_30us:
  3923     0684  2686               	call	DELAY_10us
  3924     0685                     DELAY_20us:
  3925     0685  2686               	call	DELAY_10us
  3926     0686                     DELAY_10us:
  3927     0686  0000               	nop
  3928     0687  0000               	nop
  3929     0688                     DELAY_9us:
  3930     0688  0000               	nop
  3931     0689  0000               	nop
  3932     068A                     DELAY_8us:
  3933     068A  0000               	nop
  3934     068B  0000               	nop
  3935     068C                     DELAY_7us:
  3936     068C  0000               	nop
  3937     068D  0000               	nop
  3938     068E                     DELAY_6us:
  3939     068E  0000               	nop
  3940     068F  0000               	nop
  3941     0690                     DELAY_5us:
  3942     0690  0000               	nop
  3943     0691  0000               	nop
  3944     0692                     DELAY_4us:
  3945     0692  0000               	nop
  3946     0693  0000               	nop
  3947     0694                     DELAY_3us:
  3948     0694  0000               	nop
  3949     0695  0000               	nop
  3950     0696                     DELAY_2us:
  3951     0696  0008               	return
  3952                           
  3953                           	psect	config
  3954                           
  3955                           ;Config register CONFIG1 @ 0x8007
  3956                           ;	Oscillator Selection
  3957                           ;	FOSC = INTOSC, INTOSC oscillator: I/O function on CLKIN pin
  3958                           ;	Watchdog Timer Enable
  3959                           ;	WDTE = OFF, WDT disabled
  3960                           ;	Power-up Timer Enable
  3961                           ;	PWRTE = OFF, PWRT disabled
  3962                           ;	MCLR Pin Function Select
  3963                           ;	MCLRE = OFF, MCLR/VPP pin function is digital input
  3964                           ;	Flash Program Memory Code Protection
  3965                           ;	CP = OFF, Program memory code protection is disabled
  3966                           ;	Data Memory Code Protection
  3967                           ;	CPD = OFF, Data memory code protection is disabled
  3968                           ;	Brown-out Reset Enable
  3969                           ;	BOREN = OFF, Brown-out Reset disabled
  3970                           ;	Clock Out Enable
  3971                           ;	CLKOUTEN = OFF, CLKOUT function is disabled. I/O or oscillator function on the CLKOUT pin
  3972                           ;	Internal/External Switchover
  3973                           ;	IESO = OFF, Internal/External Switchover mode is disabled
  3974                           ;	Fail-Safe Clock Monitor Enable
  3975                           ;	FCMEN = OFF, Fail-Safe Clock Monitor is disabled
  3976     8007                     	org	32775
  3977     8007  09A4               	dw	2468
  3978                           
  3979                           ;Config register CONFIG2 @ 0x8008
  3980                           ;	Flash Memory Self-Write Protection
  3981                           ;	WRT = OFF, Write protection off
  3982                           ;	Voltage Regulator Capacitor Enable
  3983                           ;	VCAPEN = OFF, VCAP pin functionality is disabled
  3984                           ;	PLL Enable
  3985                           ;	PLLEN = OFF, 4x PLL disabled
  3986                           ;	Stack Overflow/Underflow Reset Enable
  3987                           ;	STVREN = OFF, Stack Overflow or Underflow will not cause a Reset
  3988                           ;	Brown-out Reset Voltage Selection
  3989                           ;	BORV = HI, Brown-out Reset Voltage (Vbor), high trip point selected.
  3990                           ;	Low-Voltage Programming Enable
  3991                           ;	LVP = OFF, High-voltage on MCLR/VPP must be used for programming
  3992     8008                     	org	32776
  3993     8008  18FF               	dw	6399


Microchip Technology PIC Macro Assembler V2.40 build 20220703182018 
Symbol Table                                                                                               Tue Oct 03 16:09:48 2023

                            C 0000               CRC_COUNTER_TEMP 0026                              Z 0002  
                           RD 0000                             WR 0001                            GIE 0007  
                          PR2 001B                            PR4 0416              MODBUS_ERROR_FLAG 003B  
                         CFGS 0006                           CREN 0004                           LATA 010C  
                         LATB 010D                           LATC 010E                           LATD 010F  
                         LATE 0110                           LATF 038C                           LATG 038D  
                         PIE1 0091                           PIE2 0092                           PIE3 0093  
                         PIE4 0094                           INTE 0004                           INTF 0001  
                         PIR1 0011                           PIR4 0014                           M_OE 0004  
                         TRMT 0001                           WREN 0002              STRONG_STOP_TEMP1 0042  
            STRONG_STOP_TEMP2 0043            CRC_16_END_FUNCTION 0602                          AAAAN 0606  
          TEST_FUNCTION_LOOP1 0280            TEST_FUNCTION_LOOP2 0287                          BANK7 038C  
                        EEPGD 0007                          M1_FR 0001                          M2_FR 0003  
                        T2CON 001C                          INDF0 0000                          INDF1 0001  
                        M1_ST 0000                          M2_ST 0002                          RC2IE 0005  
                        RC2IF 0005                          T4CON 0417                          IOCBF 0396  
                        IOCBN 0395                          IOCBP 0394                          FSR0H 0005  
                        FSR1H 0007                          IOCIE 0003                          IOCIF 0000  
                        FSR0L 0004                          FSR1L 0006                          PORTA 000C  
                        PORTB 000D                          PORTC 000E                          PORTD 000F  
                        PORTE 0010                          PORTF 028C                          PORTG 028D  
                        TRISA 008C                          TRISB 008D                          TRISC 008E  
                        TRISD 008F                          TRISE 0090                          TRISF 030C  
                        TRISG 030D                          M_RST 0005      MODBUS_ERROR_CODE_01_LOOP 0376  
    MODBUS_ERROR_CODE_02_LOOP 038A      MODBUS_ERROR_CODE_03_LOOP 0398      MODBUS_ERROR_CODE_04_LOOP 03A6  
    MODBUS_ERROR_CODE_05_LOOP 03B4      MODBUS_ERROR_CODE_06_LOOP 03C2           CHECK_CRC16_IS_RIGHT 0178  
                       ADCON0 009D                         ADCON1 009E                         ADRESH 009C  
                       ADRESL 009B                         EEADRL 0191                         EEDATL 0193  
                       CCPR3L 0311                         EECON1 0195                         EECON2 0196  
                       ANSELA 018C                         ANSELE 0190                         ANSELF 040C  
                       ANSELG 040D                         RC2STA 0495                         PCLATH 000A  
                       INTCON 000B            MOTOR_1_WORK_CW_LV1 041A            MOTOR_1_WORK_CW_LV2 043B  
          MOTOR_1_WORK_CW_LV3 0426            MOTOR_1_WORK_CW_LV4 0429            MOTOR_1_WORK_CW_LV5 045E  
                       OSCCON 0099                         TMR2IE 0001                         TMR2IF 0001  
                       TMR2ON 0002                         TX2REG 0492                         TX2STA 0496  
                       STATUS 0003           TMR2IF_FUNCTION_LOOP 00BE               RTU_COUNTER_DATA 002A  
            MOTOR_OE_RST_PORT 010C           MOTOR_1_WORKING_LOOP 03D3               SYSTEM_START_LV1 028C  
         MODBUS_ERROR_COUNTER 0049                PWM_1_COUNT_DAT 0040                        CCP3CON 0313  
          MOTOR_2_WORK_CW_LV1 051B            MOTOR_2_WORK_CW_LV2 053C           MOTOR_1_WORK_CCW_LV1 0483  
         MOTOR_1_WORK_CCW_LV2 04A7           MOTOR_1_WORK_CCW_LV3 0491           MOTOR_1_WORK_CCW_LV4 0494  
         MOTOR_1_WORK_CCW_LV5 04CB                PWM_2_COUNT_DAT 0041           MOTOR_1_WORK_CW_LOOP 0403  
                      OSCSTAT 009A                        TP0_PIN 0000                        OSCTUNE 0098  
          CRC_16_FUNCTION_LV1 05F4         MOTOR_2_WORK_CW_FINISH 052E                     DELAY_10ms 0665  
                   DELAY_20ms 0664                     DELAY_10us 0686                     DELAY_20us 0685  
                   DELAY_40ms 0663                     DELAY_30us 0684                     DELAY_40us 0683  
                   DELAY_50us 0682                     DELAY_60us 0681                     DELAY_90us 067E  
          MOTOR1_IN_ROAT_FLAG 0001           TEN_MS_FUNCTION_LOOP 00F8         WAIT_EEPROM_WRITE_OVER 0653  
             CAN_SEND_TX_FLAG 0000        MOTOR_1_WORK_CCW_FINISH 04A2          ROAT_MOTOR_IS_HI_FLAG 0003  
        MODBUS_DAT_EXTRA_ADRH 0020          MODBUS_DAT_EXTRA_ADRL 00B0             INTERRUPT_SUB_AREA 0006  
                   M1_ENCODER 0001          MOTOR_1_ZERO_FUNCTION 032D         SET_MODBUS_MODE_ENABLE 0D08  
                   EEPROM_ADR 007E            MOTOR1_IN_ZERO_FLAG 0000                     EEPROM_DAT 007F  
                   M2_ENCODER 0002            M1_NOT_COUNTER_TEMP 0053         MOTOR1_ZERO_IN_HI_LOOP 030F  
                   CRC_HIBYTE 0028            RC2IF_FUNCTION_LOOP 00BA                  ADDR_4_5_PORT 000C  
                   CRC_LOBYTE 0029         MOTOR1_ZERO_IN_LO_LOOP 02E5                  ADDR_6_7_PORT 000D  
          IOCBF2_INT_LOOP_LV1 010C           MOTOR_2_WORKING_LOOP 04D7          MODBUS_ERROR_CODE_END 0383  
            INT_INTF_FUNCTION 0127                     ERROR_01_F 0000                     ERROR_02_F 0001  
                   ERROR_03_F 0002                     ERROR_04_F 0003                     ERROR_05_F 0004  
                   ERROR_06_F 0005     MOTOR1_ZERO_IN_HI_LOOP_LV1 0321       MODBUS_RTU_READ_CRC_LOOP 01CD  
        MOTOR1_TIME_ZERO_LOOP 0324             WATCH_SUB_FUNCTION 05D2        MOTOR_2_WORK_CCW_FINISH 0579  
           WATCH_SUB_FUNC_LV1 05DA           MOTOR_2_WORK_CCW_LV1 0566           MOTOR_2_WORK_CCW_LV2 057E  
                     ADDSEL_4 0006                       ADDSEL_5 0007                       ADDSEL_6 0007  
                     ADDSEL_7 0006                       ADC_WORK 05C9         MODBUS_INTPUT_FUNCTION 0D1F  
         MOTOR_2_WORK_CW_LOOP 050B                       CCPTMRS0 029E                       CCPTMRS1 029F  
        MOTOR_1_WORK_CCW_LOOP 046D                   MOTOR1_FLAG0 0072                   MOTOR1_FLAG1 0035  
              BOOTLOADER_LOOP 0005                   MOTOR2_FLAG0 0032                   MOTOR2_FLAG1 0036  
                  ADC_HI_DATA 007C               MODULE_WORK_LOOP 03D0            MOTOR2_IN_ROAT_FLAG 0001  
               ID_SELECT_LOOP 0249                     MOTOR_1_CW 0002                     MOTOR_2_CW 0002  
         CRC_16_FUNCTION_LOOP 05EF                   MOTOR_1_WORK 0001                   MOTOR_2_STOP 02B3  
                 MOTOR_2_WORK 0001             CLEAN_ALL_REGISTER 0625                     WATCH_TEMP 0072  
                   OPTION_REG 0095            MOTOR2_IN_ZERO_FLAG 0000               MOTOR_1_ING_ZERO 0005  
                   TEN_MS_NUM 0002              STANDBY_HBYTE_DAT 004C               MOTOR_2_ING_ZERO 0005  
               TIMER2_INT_LV1 00E2                    DELAY_100ms 0661                    DELAY_100us 067D  
                  DELAY_200us 067C                    DELAY_300us 067B                    DELAY_400us 067A  
                  DELAY_500ms 065D                    DELAY_500us 0679                    DELAY_600us 0678  
        MOTOR_1_CW_IOC_SET_HI 0452              STANDBY_LBYTE_DAT 004D                    DELAY_TEMP1 0020  
                  DELAY_TEMP2 0021                    DELAY_TEMP3 0022     MOTOR1_ZERO_IN_LO_LOOP_LV1 02F7  
                  FLAG1_BANK0 0030                     PWR_DECTET 0005                    FLAG3_BANK0 003A  
                  FLAG5_BANK0 003C             MOTOR_1_IOC_FINISH 0007                  MODULE_ID_DAT 0025  
                CAL_DATA_TEMP 0027             SET_TMR2_BASE_TIME 0614          MODBUS_TABLE_ADR_TEMP 004A  
    POWER_LED_OUTPUT_FUNCTION 0253                SET_TMR2_INT_EN 061D         MOTOR_1_CCW_IOC_SET_HI 04BF  
               IOC_HW_SETTING 0244       MODBUS_BUS_01_ERROR_LOOP 015F                    MAX485_PORT 038D  
             MODBUS_DAT_COUNT 002F                  INT_TIMER_NUM 0004          MOTOR_2_ZERO_FUNCTION 035A  
        M1_ZERO_COUNTER_HBYTE 0050          M1_ZERO_COUNTER_LBYTE 0051        ANAY_MODBUS_CMD_03_LOOP 0193  
      ANAY_MODBUS_CMD_06_LOOP 01AA       MODBUS_BUS_02_ERROR_LOOP 0161               TMR2_DIVIDER_SET 0015  
       MODBUS_ADR_A0_FUNCTION 0065         MODBUS_ADR_A1_FUNCTION 0076         CHECK_MOTOR2_ZERO_LOOP 02BE  
           TEST_FUNCTION_LOOP 027C         MODBUS_ADR_B0_FUNCTION 00BA         MODBUS_ADR_A2_FUNCTION 0087  
       MODBUS_ADR_B1_FUNCTION 00BA         MODBUS_ADR_A3_FUNCTION 0098       MODBUS_BUS_03_ERROR_LOOP 0163  
        MOTOR_2_IOC_STOP_LOOP 04F9         MODBUS_ADR_C0_FUNCTION 00BA         MODBUS_ADR_B2_FUNCTION 00BA  
       MODBUS_ADR_A4_FUNCTION 00A9            TMR2IF_FUNCTION_LV0 00C5         MODBUS_ADR_C1_FUNCTION 00BA  
       MODBUS_ADR_B3_FUNCTION 00BA                CHECK_IOC_IS_HI 0454                CHECK_IOC_IS_LO 0463  
         RESET_IN_NORMAL_FALG 0000         MODBUS_ADR_D0_FUNCTION 00BA         MODBUS_ADR_C2_FUNCTION 00BA  
       MODBUS_ADR_B4_FUNCTION 00BA                      AAAA_1800 0604            WRITE_EEPROM_LOOP_1 064B  
       MODBUS_ADR_D1_FUNCTION 00BA         MODBUS_ADR_C3_FUNCTION 00BA         MODBUS_ADR_B5_FUNCTION 00BA  
       ADC_TAKE_DATA_FUNCTION 05BC       MODBUS_BUS_04_ERROR_LOOP 0165                  CAN_WORK_FLAG 0001  
                  READ_EEPROM 063B                IOCBF1_INT_LOOP 0106         MODBUS_ADR_E0_FUNCTION 00BA  
       MODBUS_ADR_D2_FUNCTION 00BA         MODBUS_ADR_C4_FUNCTION 00BA          MOTOR_2_WORK_CCW_LOOP 0556  
              IOCBF2_INT_EXIT 0112                IOCBF2_INT_LOOP 0109         MODBUS_ADR_E1_FUNCTION 00BA  
       MODBUS_ADR_D3_FUNCTION 00BA         MODBUS_ADR_C5_FUNCTION 00BA             WATCH_DAT_BUF_ADRH 0020  
           WATCH_DAT_BUF_ADRL 00BA         MODBUS_ADR_E2_FUNCTION 00BA         MODBUS_ADR_D4_FUNCTION 00BA  
                    DELAY_1ms 066A                      DELAY_2ms 0669                      DELAY_3ms 0668  
                    DELAY_4ms 0667                      DELAY_5ms 0666                      DELAY_2us 0696  
                    DELAY_3us 0694                      DELAY_4us 0692                      DELAY_5us 0690  
                    DELAY_6us 068E                      DELAY_7us 068C                      DELAY_8us 068A  
                    DELAY_9us 0688         MODBUS_ADR_E3_FUNCTION 00BA         MODBUS_ADR_D5_FUNCTION 00BA  
     MODBUS_BUS_05_ERROR_LOOP 0167           MODBUS_DAT_REAL_ADRH 0021           MODBUS_DAT_REAL_ADRL 0040  
               TMR2_BASE_TEMP 0023            MODBUS_RTU_READ_LV2 01C2              TEST_MAX485_LOOP1 05A5  
       MODBUS_ADR_E4_FUNCTION 00BA         MODBUS_ADR_D6_FUNCTION 00BA              IOC_ROCK_FUNCTION 0124  
       MODBUS_ADR_E5_FUNCTION 00BA                 MODBUS_IN_03_F 0001                 MODBUS_IN_06_F 0002  
               ADC_HW_SETTING 0229                   WRITE_EEPROM 0645       MODBUS_BUS_06_ERROR_LOOP 0169  
       MOTOR_1_WORK_CW_FINISH 0436                   ADC_LOW_DATA 007D          TEST_MAX485_LOOP1_LV1 05AF  
                  MOTOR_1_CCW 0003                    MOTOR_2_CCW 0003               IOC_INT_FUNCTION 00FF  
                MOTOR_1_RESET 0004                  MOTOR_2_RESET 0004                  MOTOR_2_WORK1 02A8  
              MOTOR_1_HI_ZERO 0006                      TEST_PORT 038C                    WATCH_OUT_P 0110  
                 SYSTEM_START 028B            NOW_IS_LO_HI_STATUS 0000                    TEN_TIME_EN 0001  
                 ADR_80_H_DAT 00A0                    TEN_MS_TEMP 0048                   ADR_81_H_DAT 00A2  
                 ADR_80_L_DAT 00A1                   ADR_82_H_DAT 00A4                   ADR_81_L_DAT 00A3  
                 ADR_83_H_DAT 00A6                   ADR_82_L_DAT 00A5        CHECK_PWM_FREQ_FUCNTION 0249  
                 ADR_83_L_DAT 00A7          POWER_LED_OUTPUT_EXIT 0258                    SET_TMR2_ON 0621  
          MODBUS_ADR_FUNCTION 0011                   DELAY_1000ms 065C                   DELAY_3000ms 065A  
                WATCH_COUNTER 0070               POWER_CHECK_PORT 000D              MOTOR_1_NOW_IS_HI 0350  
            MOTOR_1_NOW_IS_LO 0346  MODBUS_TIMEOUT_IS_FINISH_LOOP 012D                  WATCH_OUT_DAT 0005  
                WATCH_OUT_CLK 0006                   DELAY_LOOP_1 0670                 IOCB2_HI_TO_LO 0114  
               IOCB2_LO_TO_HI 011C       MODBUS_CRC16_CHECK_IS_OK 0147               CHECKC_IOC_IS_HI 04C1  
             CHECKC_IOC_IS_LO 04CD           PREPARE_TX_DATA_LOOP 0599       MODBUS_BUS_ID_ERROR_LOOP 016B  
                TMR2_BASE_SET 00A7                  TMR2_BASE_NUM 0004             MOTOR_CONTROL_PORT 010E  
          SETTING_PWM_HW_LOOP 0233                TX_DATA_COUNTER 002D       CHECK_CRC16_IS_RIGHT_LV1 0183  
                MAX485_SELECT 0003              IOC_COUNTER_HBYTE 0046              IOC_COUNTER_LBYTE 0047  
      CLEAN_ALL_REGISTER_LOOP 062D        MODBUS_BUS_ID_ERROR_LV1 0171       RESET_END_IN_NORMAL_LOOP 03F1  
            MODBUS_ADR_A0_LV1 0076              MODBUS_ADR_A1_LV1 0087              MODBUS_ADR_A2_LV1 0098  
            MODBUS_ADR_A3_LV1 00A9              MODBUS_ADR_A4_LV1 00BA            ALL_MOTOR_STOP_FLAG 0004  
RESET_MODBUS_TIMEOUT_FUNCTION 00DE           SYSTEM_START_SETTING 01D9                WATCH_BIT_COUNT 0071  
               INT_TIMER_TEMP 0024                 INT_HW_SETTING 0259                TMR2IF_FUNC_LV1 00CB  
           INT_TRIG_TIME_FLAG 0004  
