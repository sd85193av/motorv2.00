

Microchip MPLAB XC8 Assembler V2.40 build 20220703182018 
                                                                                                           Thu Oct 05 13:54:13 2023


     1                           	processor	16F1947
     2                           	pagewidth 132
     3                           	psect	udata_shr,global,class=COMMON,space=1,delta=1,noexec
     4                           	psect	udata,global,class=RAM,space=1,delta=1,noexec
     5                           	psect	udata_bank0,global,class=BANK0,space=1,delta=1,noexec
     6                           	psect	udata_bank1,global,class=BANK1,space=1,delta=1,noexec
     7                           	psect	udata_bank2,global,class=BANK2,space=1,delta=1,noexec
     8                           	psect	udata_bank3,global,class=BANK3,space=1,delta=1,noexec
     9                           	psect	udata_bank4,global,class=BANK4,space=1,delta=1,noexec
    10                           	psect	udata_bank5,global,class=BANK5,space=1,delta=1,noexec
    11                           	psect	udata_bank6,global,class=BANK6,space=1,delta=1,noexec
    12                           	psect	udata_bank7,global,class=BANK7,space=1,delta=1,noexec
    13                           	psect	udata_bank8,global,class=BANK8,space=1,delta=1,noexec
    14                           	psect	udata_bank9,global,class=BANK9,space=1,delta=1,noexec
    15                           	psect	udata_bank10,global,class=BANK10,space=1,delta=1,noexec
    16                           	psect	udata_bank11,global,class=BANK11,space=1,delta=1,noexec
    17                           	psect	udata_bank12,global,class=BANK12,space=1,delta=1,noexec
    18                           	psect	code,global,class=CODE,delta=2
    19                           	psect	data,global,class=STRCODE,delta=2,noexec
    20                           	psect	edata,global,class=EEDATA,space=3,delta=2,noexec
    21                           	psect	main,global,size=2048,class=CODE,delta=2
    22                           	psect	config,global,abs,ovrld,class=CONFIG,space=4,delta=2,noexec
    23                           
    24                           ;========================================================
    25                           ;================ Project Information ===================
    26                           ;========================================================
    27                           ;Project Name : MOTOR-MODULE_V2.00
    28                           ;Project Version:
    29                           ;Project object :
    30                           ;Project number :
    31                           ;Edit Date :
    32                           ;--------------------------------------------------------
    33                           ;========================================================
    34                           ;========================================================
    35                           ;========================================================
    36                           ;========================================================
    37                           ;======== PIC16F1947 Configuration Bit Settings =========
    38                           ;========================================================
    39                           ; PIC16F1947 Configuration Bit Settings
    40                           ; Assembly source line config statements
    41                           ; CONFIG1
    42                           ; CONFIG2
    43                           ;** ***************************************************************************************
    44                           ;==========================================================================
    45                           ; MPASM PIC16LF1947 processor include
    46                           ;
    47                           ; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
    48                           ;==========================================================================
    49                           ;==========================================================================
    50                           ; This header file defines configurations, registers, and other useful
    51                           ; bits of information for the PIC16LF1947 microcontroller. These names
    52                           ; are taken to match the data sheets as closely as possible.
    53                           ;
    54                           ; Note that the processor must be selected before this file is included.
    55                           ; The processor may be selected the following ways:
    56                           ;
    57                           ; 1. Command line switch:
    58                           ; C:\MPASM MYFILE.ASM /PIC16LF1947
    59                           ; 2. LIST directive in the source file
    60                           ; LIST P=PIC16LF1947
    61                           ; 3. Processor Type entry in the MPASM full-screen interface
    62                           ; 4. Setting the processor in the MPLAB Project Dialog
    63                           ;==========================================================================
    64                           ;==========================================================================
    65                           ;
    66                           ; Verify Processor
    67                           ;
    68                           ;==========================================================================
    69                           ; IFNDEF __16LF1947
    70                           ; MESSG "Processor-header file mismatch.  Verify selected processor."
    71                           ; ENDIF
    72                           ;==========================================================================
    73                           ;
    74                           ; Register Definitions
    75                           ;
    76                           ;==========================================================================
    77                           ;W EQU 0000H
    78                           ;F EQU 0001H
    79                           ;----- Register Files -----------------------------------------------------
    80                           ;-----Bank0------------------
    81     0003                     
    82                           ;FSR0 EQU 0004H
    83     0005                     
    84                           ;FSR1 EQU 0006H
    85     001F                     
    86                           ;-----Bank1------------------
    87     009E                     
    88                           ;-----Bank2------------------
    89     011F                     
    90                           ;-----Bank3------------------
    91     019F                     
    92                           ;-----Bank4------------------
    93     021F                     
    94                           ;-----Bank5------------------
    95     029F                     
    96                           ;-----Bank6------------------
    97     031E                     
    98                           ;-----Bank7------------------
    99     0396                     
   100                           ;-----Bank8------------------
   101     041E                     
   102                           ;-----Bank9------------------
   103     0497                     
   104                           ;-----Bank15------------------
   105     07B7                     
   106                           ;-----Bank31------------------
   107     0FEF                     
   108                           ;----- STATUS Bits -----------------------------------------------------
   109     0004                     
   110                           ;----- BSR Bits -----------------------------------------------------
   111     0004                     
   112                           ;----- INTCON Bits -----------------------------------------------------
   113     0005                     
   114                           ;----- PORTA Bits -----------------------------------------------------
   115     0007                     
   116                           ;----- PORTB Bits -----------------------------------------------------
   117     0000                     
   118                           ;----- PORTC Bits -----------------------------------------------------
   119     0002                     
   120                           ;----- PORTD Bits -----------------------------------------------------
   121     0006                     
   122                           ;----- PORTE Bits -----------------------------------------------------
   123     0007                     
   124                           ;----- PIR1 Bits -----------------------------------------------------
   125     0005                     
   126                           ;----- PIR2 Bits -----------------------------------------------------
   127     0007                     
   128                           ;----- PIR3 Bits -----------------------------------------------------
   129     0006                     
   130                           ;----- PIR4 Bits -----------------------------------------------------
   131     0005                     
   132                           ;----- T1CON Bits -----------------------------------------------------
   133     0007                     
   134                           ;----- T1GCON Bits -----------------------------------------------------
   135     0003                     
   136                           ;----- T2CON Bits -----------------------------------------------------
   137     0006                     
   138                           ;----- CPSCON0 Bits -----------------------------------------------------
   139     0007                     
   140                           ;----- CPSCON1 Bits -----------------------------------------------------
   141     0004                     
   142                           ;----- TRISA Bits -----------------------------------------------------
   143     0007                     
   144                           ;----- TRISB Bits -----------------------------------------------------
   145     0007                     
   146                           ;----- TRISC Bits -----------------------------------------------------
   147     0007                     
   148                           ;----- TRISD Bits -----------------------------------------------------
   149     0007                     
   150                           ;----- TRISE Bits -----------------------------------------------------
   151     0007                     
   152                           ;----- PIE1 Bits -----------------------------------------------------
   153     0005                     
   154                           ;----- PIE2 Bits -----------------------------------------------------
   155     0007                     
   156                           ;----- PIE3 Bits -----------------------------------------------------
   157     0006                     
   158                           ;----- PIE4 Bits -----------------------------------------------------
   159     0005                     
   160                           ;----- OPTION_REG Bits -----------------------------------------------------
   161     0005                     
   162                           ;----- PCON Bits -----------------------------------------------------
   163     0007                     
   164                           ;----- WDTCON Bits -----------------------------------------------------
   165     0005                     
   166                           ;----- OSCTUNE Bits -----------------------------------------------------
   167     0005                     
   168                           ;----- OSCCON Bits -----------------------------------------------------
   169     0007                     
   170                           ;----- OSCSTAT Bits -----------------------------------------------------
   171     0007                     
   172                           ;----- ADCON0 Bits -----------------------------------------------------
   173     0001                     
   174                           ;----- ADCON1 Bits -----------------------------------------------------
   175     0007                     
   176                           ;----- LATA Bits -----------------------------------------------------
   177     0007                     
   178                           ;----- LATB Bits -----------------------------------------------------
   179     0007                     
   180                           ;----- LATC Bits -----------------------------------------------------
   181     0007                     
   182                           ;----- LATD Bits -----------------------------------------------------
   183     0007                     
   184                           ;----- LATE Bits -----------------------------------------------------
   185     0007                     
   186                           ;----- CM1CON0 Bits -----------------------------------------------------
   187     0007                     
   188                           ;----- CM1CON1 Bits -----------------------------------------------------
   189     0007                     
   190                           ;----- CM2CON0 Bits -----------------------------------------------------
   191     0007                     
   192                           ;----- CM2CON1 Bits -----------------------------------------------------
   193     0007                     
   194                           ;----- CMOUT Bits -----------------------------------------------------
   195     0002                     
   196                           ;----- BORCON Bits -----------------------------------------------------
   197     0007                     
   198                           ;----- FVRCON Bits -----------------------------------------------------
   199     0007                     
   200                           ;----- DACCON0 Bits -----------------------------------------------------
   201     0007                     
   202                           ;----- DACCON1 Bits -----------------------------------------------------
   203     0004                     
   204                           ;----- SRCON0 Bits -----------------------------------------------------
   205     0007                     
   206                           ;----- SRCON1 Bits -----------------------------------------------------
   207     0007                     
   208                           ;----- APFCON Bits -----------------------------------------------------
   209     0007                     
   210                           ;----- CM3CON0 Bits -----------------------------------------------------
   211     0007                     
   212                           ;----- CM3CON1 Bits -----------------------------------------------------
   213     0007                     
   214                           ;----- ANSELA Bits -----------------------------------------------------
   215     0005                     
   216                           ;----- ANSELE Bits -----------------------------------------------------
   217     0002                     
   218                           ;----- EECON1 Bits -----------------------------------------------------
   219     0007                     
   220                           ;----- RC1STA Bits -----------------------------------------------------
   221     0007                     
   222                           ;----- RCSTA Bits -----------------------------------------------------
   223     0007                     
   224                           ;----- TX1STA Bits -----------------------------------------------------
   225     0007                     
   226                           ;----- TXSTA Bits -----------------------------------------------------
   227     0007                     
   228                           ;----- BAUD1CON Bits -----------------------------------------------------
   229     0007                     
   230                           ;----- WPUB Bits -----------------------------------------------------
   231     0007                     
   232                           ;----- SSP1STAT Bits -----------------------------------------------------
   233     0007                     
   234                           ;----- SSPSTAT Bits -----------------------------------------------------
   235     0007                     
   236                           ;----- SSP1CON1 Bits -----------------------------------------------------
   237     0007                     
   238                           ;----- SSPCON Bits -----------------------------------------------------
   239     0007                     
   240                           ;----- SSPCON1 Bits -----------------------------------------------------
   241     0007                     
   242                           ;----- SSP1CON2 Bits -----------------------------------------------------
   243     0007                     
   244                           ;----- SSPCON2 Bits -----------------------------------------------------
   245     0007                     
   246                           ;----- SSP1CON3 Bits -----------------------------------------------------
   247     0007                     
   248                           ;----- SSPCON3 Bits -----------------------------------------------------
   249     0007                     
   250                           ;----- SSP2STAT Bits -----------------------------------------------------
   251     0007                     
   252                           ;----- SSP2CON1 Bits -----------------------------------------------------
   253     0007                     
   254                           ;----- SSP2CON2 Bits -----------------------------------------------------
   255     0007                     
   256                           ;----- SSP2CON3 Bits -----------------------------------------------------
   257     0007                     
   258                           ;----- PORTF Bits -----------------------------------------------------
   259     0007                     
   260                           ;----- PORTG Bits -----------------------------------------------------
   261     0004                     
   262                           ;----- CCP1CON Bits -----------------------------------------------------
   263     0007                     
   264                           ;----- PWM1CON Bits -----------------------------------------------------
   265     0007                     
   266                           ;----- CCP1AS Bits -----------------------------------------------------
   267     0007                     
   268                           ;----- ECCP1AS Bits -----------------------------------------------------
   269     0007                     
   270                           ;----- PSTR1CON Bits -----------------------------------------------------
   271     0004                     
   272                           ;----- CCP2CON Bits -----------------------------------------------------
   273     0007                     
   274                           ;----- PWM2CON Bits -----------------------------------------------------
   275     0007                     
   276                           ;----- CCP2AS Bits -----------------------------------------------------
   277     0007                     
   278                           ;----- ECCP2AS Bits -----------------------------------------------------
   279     0007                     
   280                           ;----- PSTR2CON Bits -----------------------------------------------------
   281     0004                     
   282                           ;----- CCPTMRS0 Bits -----------------------------------------------------
   283     0007                     
   284                           ;----- CCPTMRS1 Bits -----------------------------------------------------
   285     0001                     
   286                           ;----- TRISF Bits -----------------------------------------------------
   287     0007                     
   288                           ;----- TRISG Bits -----------------------------------------------------
   289     0005                     
   290                           ;----- CCP3CON Bits -----------------------------------------------------
   291     0007                     
   292                           ;----- PWM3CON Bits -----------------------------------------------------
   293     0007                     
   294                           ;----- CCP3AS Bits -----------------------------------------------------
   295     0007                     
   296                           ;----- ECCP3AS Bits -----------------------------------------------------
   297     0007                     
   298                           ;----- PSTR3CON Bits -----------------------------------------------------
   299     0004                     
   300                           ;----- CCP4CON Bits -----------------------------------------------------
   301     0005                     
   302                           ;----- CCP5CON Bits -----------------------------------------------------
   303     0005                     
   304                           ;----- LATF Bits -----------------------------------------------------
   305     0007                     
   306                           ;----- LATG Bits -----------------------------------------------------
   307     0005                     
   308                           ;----- IOCBP Bits -----------------------------------------------------
   309     0007                     
   310                           ;----- IOCBN Bits -----------------------------------------------------
   311     0007                     
   312                           ;----- IOCBF Bits -----------------------------------------------------
   313     0007                     
   314                           ;----- ANSELF Bits -----------------------------------------------------
   315     0007                     
   316                           ;----- ANSELG Bits -----------------------------------------------------
   317     0004                     
   318                           ;----- T4CON Bits -----------------------------------------------------
   319     0006                     
   320                           ;----- T6CON Bits -----------------------------------------------------
   321     0006                     
   322                           ;----- WPUG Bits -----------------------------------------------------
   323     0005                     
   324                           ;----- RC2STA Bits -----------------------------------------------------
   325     0007                     
   326                           ;----- TX2STA Bits -----------------------------------------------------
   327     0007                     
   328                           ;----- BAUD2CON Bits -----------------------------------------------------
   329     0007                     
   330                           ;----- LCDCON Bits -----------------------------------------------------
   331     0007                     
   332                           ;----- LCDPS Bits -----------------------------------------------------
   333     0007                     
   334                           ;----- LCDREF Bits -----------------------------------------------------
   335     0007                     
   336                           ;----- LCDCST Bits -----------------------------------------------------
   337     0002                     
   338                           ;----- LCDRL Bits -----------------------------------------------------
   339     0007                     
   340                           ;----- LCDSE0 Bits -----------------------------------------------------
   341     0007                     
   342                           ;----- LCDSE1 Bits -----------------------------------------------------
   343     0007                     
   344                           ;----- LCDSE2 Bits -----------------------------------------------------
   345     0007                     
   346                           ;----- LCDSE3 Bits -----------------------------------------------------
   347     0007                     
   348                           ;----- LCDSE4 Bits -----------------------------------------------------
   349     0007                     
   350                           ;----- LCDSE5 Bits -----------------------------------------------------
   351     0005                     
   352                           ;----- LCDDATA0 Bits -----------------------------------------------------
   353     0007                     
   354                           ;----- LCDDATA1 Bits -----------------------------------------------------
   355     0007                     
   356                           ;----- LCDDATA2 Bits -----------------------------------------------------
   357     0007                     
   358                           ;----- LCDDATA3 Bits -----------------------------------------------------
   359     0007                     
   360                           ;----- LCDDATA4 Bits -----------------------------------------------------
   361     0007                     
   362                           ;----- LCDDATA5 Bits -----------------------------------------------------
   363     0007                     
   364                           ;----- LCDDATA6 Bits -----------------------------------------------------
   365     0007                     
   366                           ;----- LCDDATA7 Bits -----------------------------------------------------
   367     0007                     
   368                           ;----- LCDDATA8 Bits -----------------------------------------------------
   369     0007                     
   370                           ;----- LCDDATA9 Bits -----------------------------------------------------
   371     0007                     
   372                           ;----- LCDDATA10 Bits -----------------------------------------------------
   373     0007                     
   374                           ;----- LCDDATA11 Bits -----------------------------------------------------
   375     0007                     
   376                           ;----- LCDDATA12 Bits -----------------------------------------------------
   377     0007                     
   378                           ;----- LCDDATA13 Bits -----------------------------------------------------
   379     0007                     
   380                           ;----- LCDDATA14 Bits -----------------------------------------------------
   381     0005                     
   382                           ;----- LCDDATA15 Bits -----------------------------------------------------
   383     0007                     
   384                           ;----- LCDDATA16 Bits -----------------------------------------------------
   385     0007                     
   386                           ;----- LCDDATA17 Bits -----------------------------------------------------
   387     0005                     
   388                           ;----- LCDDATA18 Bits -----------------------------------------------------
   389     0007                     
   390                           ;----- LCDDATA19 Bits -----------------------------------------------------
   391     0007                     
   392                           ;----- LCDDATA20 Bits -----------------------------------------------------
   393     0005                     
   394                           ;----- LCDDATA21 Bits -----------------------------------------------------
   395     0007                     
   396                           ;----- LCDDATA22 Bits -----------------------------------------------------
   397     0007                     
   398                           ;----- LCDDATA23 Bits -----------------------------------------------------
   399     0005                     
   400                           ;----- STATUS_SHAD Bits -----------------------------------------------------
   401     0002                     
   402                           	psect	edata
   403                           
   404                           ;==========================================================================
   405                           ;
   406                           ; Configuration Bits
   407                           ;
   408                           ; NAME Address
   409                           ; CONFIG1 8007h
   410                           ; CONFIG2 8008h
   411                           ;
   412                           ;==========================================================================
   413                           ;========================================================
   414                           ;================ Project Information ===================
   415                           ;========================================================
   416                           ;Pin Assignment :
   417                           ;Project Name :
   418                           ;Project Version: V2.00 (Bate00)
   419                           ;Project object :
   420                           ;Project number :
   421                           ;Edit Date : 2023/04/18
   422                           ;--------------------------------------------------------
   423                           ;========================================================
   424                           ;========================================================
   425                           ;INCLUDE TITLE
   426                           ;========================================================
   427                           ;================ Project Information ===================
   428                           ;========================================================
   429                           ;Project Name : MODBUS RTU BASE
   430                           ;-------------------------------------------------------
   431                           ;Project Version: 2.00
   432                           ;Edit Date : 2023/09/28
   433                           ;Function Info :
   434                           ;-------------------------------------------------------
   435                           ;Description of Register Informatione (use FSR)
   436                           ;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
   437                           ;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
   438                           ;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
   439                           ;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
   440                           ;MODBUS_DAT_BUF_ADRL+4 : CRC counter
   441                           ;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
   442                           ;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
   443                           ;MODBUS_DAT_BUF_ADRL+7 : time out count
   444                           ;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG
   445                           ;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
   446                           ;-------------------------------------------------------
   447                           ;-------------------------------------------------------
   448                           ;-------------------------------------------------------
   449                           ;須被定義的部分
   450     0003                     
   451                           ;-------------------------------------------------------
   452     00B0                     
   453                           ;========================================================
   454                           ;================ Project Information ===================
   455                           ;========================================================
   456                           ;Project Name : MODBUS RTU BASE
   457                           ;-------------------------------------------------------
   458                           ;Project Version: 2.00
   459                           ;Edit Date : 2023/09/28
   460                           ;Function Info :
   461                           ;-------------------------------------------------------
   462                           ;-------------------------------------------------------
   463                           ;========================================================
   464                           ;========================================================
   465     0074                     
   466                           ;-------------------------------------------------------
   467     038C                     
   468                           ;-------------------------------------------------------
   469                           ;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
   470     00B0                     	;存放從485送進來的資料
   471     0040                     	;將485送的資料複製出來，之後的判斷都使用這個地方
   472                           
   473                           ;這邊主要是因為有4個馬達，可以直接選擇要使用哪個資料
   474                           ;注射泵2.00來說，轉向馬達是MOTOR1 活塞馬達是MOTOR2
   475     0090                     
   476                           ;MOTOR1 0X2190-0X21AF
   477                           ;CW:4BYTE
   478                           ;CCW:4BYTE
   479                           ;-----------------------------------------------
   480                           ;MOTOR2 0X21B0-0X21CF
   481                           ;MOTOR3 0X21D0-0X21EF
   482                           ;MOTOR4 0X21F0-0X220F
   483                           ;0X21 0X40-0X21 0X54 MOTOR1
   484                           ;0X21 0X55-0X21 0X69 MOTOR2
   485                           ;0X21 0X6A-0X21 0X7E MOTOR3
   486                           ;0X21 0X7F-0X21 0X93 MOTOR4
   487                           ;-------------------------------------------------------
   488                           ;--------------------------------------------------------
   489                           ;WATCH用的暫存器設定
   490     0006                     
   491                           ;--------------------------------------------------------
   492                           ;--------------------------------------------------------
   493                           ;mcu腳位定義
   494                           ;Pin assignment definition
   495     0003                     	;0->往光遮端方向 1->反方向
   496     0005                     	;0->表示電源沒有進入 1->表示有電源
   497     0002                     
   498                           ;--------------------------------------------------------
   499                           ;--------------------------------------------------------
   500                           ;========================================================
   501                           ;==================== 0X20 ~ 0X2F =======================
   502                           ;========================================================
   503                           ;Register definition
   504     002A                     	;用來計算MODBUS RTU
   505     002D                     	;整理UART TX傳送的資料數量
   506     002F                     
   507                           ;========================================================
   508                           ;==================== 0X30 ~ 0X3F =======================
   509                           ;========================================================
   510                           ;Register definition
   511                           ;--------------------------------------
   512     0000                     	;可以回傳資料FLAG
   513     0001                     	;表示目前馬達可以動作
   514     0002                     	;RX資料有錯誤
   515     0003                     	;強制命令執行後SET
   516     0004                     	;表示INT地一次觸發啟動INT_TIMER功能
   517     0005                     
   518                           ;--------------------------------------------------------
   519                           ;馬達1為轉向馬達(目前使用在注射泵)
   520     0001                     	;馬達1收到指令可以進行運作
   521     0002                     	;馬達1順時針
   522     0003                     	;馬達1逆時針
   523     0038                     
   524                           ;--------------------------------------------------------馬達參數設定
   525     0039                     	;在通訊判斷使用哪個馬達的情況下使用
   526     0003                     
   527                           ;--------------------------------------------------------
   528     0004                     	;CMD 0X83全部停止動作
   529                           
   530                           ;--------------------------------------------------------
   531     0001                     	;0表示沒有在功能碼03/1表示有在
   532     0002                     	;0表示沒有在功能碼06/1表示有在
   533     0003                     	;0表示沒有在功能碼10/1表示有在
   534     003D                     	;FLAG6_BANK0，為MODBUS動作前FLAG
   535     0000                     	;恢復出廠設定
   536     0001                     	;整機初始化
   537     0002                     	;換向閥初始化
   538     0003                     	;活塞初始化
   539     0004                     	;進入醒目提示_F
   540     0000                     	;未初始化
   541     0001                     	;設備在線
   542     0002                     	;安全模式
   543     0003                     	;設備異常
   544     0004                     	;醒目提示
   545                           
   546                           ; 0X3F
   547                           ;========================================================
   548                           ;==================== 0X40 ~ 0X4F =======================
   549                           ;========================================================
   550                           ;Register definition
   551     0040                     	;每次一個PWM就+1
   552     0041                     	;每次一個PWM就+1
   553     0045                     
   554                           ;-----------------------------------------------
   555     004D                     	;用來暫存MODBUS中運算的資料
   556     00A0                     
   557                           ;--------------------------------------------------------------
   558                           ;------------------------BANK7參數設定-------------------------
   559                           ;--------------------------------------------------------------
   560     00A9                     
   561                           	psect	main
   562     0000                     	org	0
   563     0000  2805               	goto	BOOTLOADER_LOOP
   564     0004                     	org	4
   565     0004  2806               	goto	INTERRUPT_SUB_AREA
   566     0005                     BOOTLOADER_LOOP:	
   567                           ;* ****************************************************************************************
   568                           ;* Label Start
   569                           ;*
   570                           ;========================================================
   571                           ;================== BOOTLOADER副程式 ====================
   572                           ;========================================================
   573                           
   574     0005  291B               	goto	SYSTEM_START_SETTING
   575     0006                     INTERRUPT_SUB_AREA:	
   576                           ;========================================================
   577                           ;================== 中斷副程式起始位址 ==================
   578                           ;========================================================
   579                           
   580     0006  3180               	pagesel	0
   581     0007  0020               	banksel	12
   582                           
   583                           ;--------------------------
   584     0008  1A94               	btfsc	20,5
   585     0009  28AC               	goto	RC2IF_FUNCTION_LOOP	;硬體UART2收資料
   586                           
   587                           ;--------------------------
   588     000A  1891               	btfsc	17,1
   589     000B  28B0               	goto	TMR2IF_FUNCTION_LOOP	;TIMER2基準為1mS
   590                           
   591                           ;--------------------------
   592     000C  188B               	btfsc	11,1
   593     000D  28FE               	goto	INT_INTF_FUNCTION	;PWM INT
   594                           
   595                           ;-----------
   596     000E  180B               	btfsc	11,0
   597     000F  28F1               	goto	IOC_INT_FUNCTION	;光遮斷器觸發
   598     0010  0009               	retfie
   599     0011                     MODBUS_TIMEOUT_IS_FINISH_LOOP:	
   600                           ;========================================================
   601                           ;=============MODBUS TIMEOUT到要進行分析的動作===========
   602                           ;========================================================
   603                           ;表示TIMEOUT到了，可以進行分析的動作
   604                           
   605     0011  3004               	movlw	4
   606     0012  00A3               	movwf	35
   607     0013  0029               	banksel	1173
   608     0014  1215               	bcf	1173,4	;要進行分析資料前，先把UART RX關閉確保資料不會錯誤
   609     0015  0020               	banksel	12
   610     0016  3020               	movlw	32	;20B0
   611     0017  0087               	movwf	7
   612     0018  30B0               	movlw	176
   613     0019  0086               	movwf	6
   614     001A  3008               	movlw	8	;MODBUS_FLAG
   615     001B  0786               	addwf	6,f
   616     001C  0181               	clrf	1
   617                           
   618                           ;----------------------------------------------------------
   619     001D  3020               	movlw	32
   620     001E  0087               	movwf	7
   621     001F  30B0               	movlw	176
   622     0020  0086               	movwf	6
   623     0021  3003               	movlw	3	;MODBUS的DATA OFFSET
   624     0022  0786               	addwf	6,f
   625     0023  0801               	movf	1,w
   626     0024  00AA               	movwf	42	;得到這次MODBUS所有的資料數量
   627     0025  00AF               	movwf	47
   628     0026  00C9               	movwf	73
   629     0027  3002               	movlw	2
   630     0028  02AA               	subwf	42,f
   631     0029  0181               	clrf	1
   632                           
   633                           ;----------------------------------------------------------
   634                           ; GOTO CHECK_CRC16_IS_RIGHT ;驗證收到CRC-16是否正確
   635     002A  283E               	goto	MODBUS_CRC16_CHECK_IS_OK
   636     002B                     COPY_485_DATA_LOOP:	
   637                           ;===================================================
   638                           ;============複製485傳送的資料一份參考參考==========OK
   639                           ;===================================================
   640                           
   641     002B  3020               	movlw	32
   642     002C  0087               	movwf	7
   643     002D  30B0               	movlw	176
   644     002E  0086               	movwf	6
   645     002F  300A               	movlw	10
   646     0030  0786               	addwf	6,f
   647                           
   648                           ;-------------------------
   649     0031  3021               	movlw	33
   650     0032  0085               	movwf	5
   651     0033  3040               	movlw	64
   652     0034  0084               	movwf	4
   653     0035  082F               	movf	47,w
   654     0036  00AA               	movwf	42	;確認資料總數量
   655     0037                     COPY_485_DATA_LV1:	
   656                           ;-------------------------
   657                           
   658     0037  0801               	movf	1,w
   659     0038  0080               	movwf	0
   660     0039  0A86               	incf	6,f
   661     003A  0A84               	incf	4,f
   662     003B  0BAA               	decfsz	42,f
   663     003C  2837               	goto	COPY_485_DATA_LV1
   664     003D  0008               	return
   665     003E                     MODBUS_CRC16_CHECK_IS_OK:	
   666                           ;===================================================
   667                           ;============MODBUS的CRC16驗證正確==================OK
   668                           ;===================================================
   669                           ;這段的CRC16驗證已經通過了，先把資料做個複製的動作
   670                           
   671     003E  202B               	call	COPY_485_DATA_LOOP
   672     003F  0020               	banksel	12
   673     0040  3021               	movlw	33	;21
   674     0041  0087               	movwf	7
   675     0042  3040               	movlw	64	;E0
   676     0043  0086               	movwf	6
   677                           
   678                           ;----------------------------------------------------------
   679     0044  0801               	movf	1,w
   680     0045  0625               	xorwf	37,w
   681     0046  1D03               	btfss	3,2
   682     0047  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP
   683                           
   684                           ;----------------------------------------------------------表示DEVICE ID 不對
   685                           ; MOVLW 0X08
   686                           ; XORWF MODBUS_DAT_COUNT,W
   687                           ; BTFSS STATUS,Z
   688                           ; GOTO MODBUS_BUS_ID_ERROR_LOOP ;當今天收到的資料數量大於8表示異常
   689                           ;---------------
   690     0048  0A86               	incf	6,f	;資料為功能碼
   691     0049  3003               	movlw	3
   692     004A  0601               	xorwf	1,w
   693     004B  1903               	btfsc	3,2
   694     004C  2889               	goto	ANAY_MODBUS_CMD_03_LOOP	;功能碼是READ ONE BYTE
   695                           
   696                           ;---------------
   697     004D  3006               	movlw	6
   698     004E  0601               	xorwf	1,w
   699     004F  1903               	btfsc	3,2
   700     0050  2893               	goto	ANAY_MODBUS_CMD_06_LOOP	;功能碼是WRITE ONE BYTE
   701                           
   702                           ;---------------
   703     0051  3010               	movlw	16
   704     0052  0601               	xorwf	1,w
   705     0053  1903               	btfsc	3,2
   706     0054  288E               	goto	ANAY_MODBUS_CMD_10_LOOP	;功能碼是WRITE MORE BYTE
   707     0055                     MODBUS_BUS_01_ERROR_LOOP:	
   708                           ;目前功能碼只有接0X03 0X06 0X10，其他的算是ERROR CODE 0X01
   709                           ;===================================================
   710                           ;============MODBUS的功能碼錯誤=====================OK
   711                           ;===================================================
   712                           ;MODBUS RTU ERROR CODE 01
   713                           ;非法功能，表示非授權的功能碼
   714                           
   715     0055  143B               	bsf	59,0
   716     0056  0009               	retfie
   717     0057                     MODBUS_BUS_02_ERROR_LOOP:	
   718                           ;----------------------------------------
   719                           ;MODBUS RTU ERROR CODE 02
   720                           ;非法暫存器地址
   721                           
   722     0057  14BB               	bsf	59,1
   723     0058  0009               	retfie
   724     0059                     MODBUS_BUS_03_ERROR_LOOP:	
   725                           ;----------------------------------------
   726                           ;MODBUS RTU ERROR CODE 03
   727                           ;非法資料數值
   728                           
   729     0059  153B               	bsf	59,2
   730     005A  0009               	retfie
   731     005B                     MODBUS_BUS_04_ERROR_LOOP:	
   732                           ;----------------------------------------
   733                           ;MODBUS RTU ERROR CODE 04
   734                           ;裝置故障，像是自我檢測出現異常
   735                           
   736     005B  15BB               	bsf	59,3
   737     005C  0009               	retfie
   738     005D                     MODBUS_BUS_05_ERROR_LOOP:	
   739                           ;----------------------------------------
   740                           ;MODBUS RTU ERROR CODE 05
   741                           ;確認，有收到指令並且立即執行
   742                           
   743     005D  163B               	bsf	59,4
   744     005E  0009               	retfie
   745     005F                     MODBUS_BUS_06_ERROR_LOOP:	
   746                           ;----------------------------------------
   747                           ;MODBUS RTU ERROR CODE 06
   748                           ;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
   749                           
   750     005F  16BB               	bsf	59,5
   751     0060  0009               	retfie
   752     0061                     MODBUS_BUS_ID_ERROR_LOOP:	
   753                           ;===================================================
   754                           ;============MODBUS的ID或是資料數錯誤===============OK
   755                           ;===================================================
   756                           ;將RX存放資料的空間清空
   757                           
   758     0061  3020               	movlw	32
   759     0062  0087               	movwf	7
   760     0063  30B0               	movlw	176
   761     0064  0086               	movwf	6
   762     0065  300A               	movlw	10
   763     0066  0786               	addwf	6,f
   764     0067                     MODBUS_BUS_ID_ERROR_LV1:
   765     0067  0181               	clrf	1
   766     0068  0A86               	incf	6,f
   767     0069  0BC9               	decfsz	73,f
   768     006A  2867               	goto	MODBUS_BUS_ID_ERROR_LV1
   769     006B  0029               	banksel	1173
   770     006C  1615               	bsf	1173,4	;重新啟動UART RX功能
   771     006D  0009               	retfie
   772     006E                     CHECK_CRC16_IS_RIGHT:	
   773                           ;===================================================
   774                           ;================驗證CRC16是否正確?=================OK
   775                           ;===================================================
   776                           ;這段驗證CRC的時間大約為380uS
   777                           
   778     006E  0020               	banksel	12
   779     006F  30FF               	movlw	255
   780     0070  00A8               	movwf	40
   781     0071  30FF               	movlw	255
   782     0072  00A9               	movwf	41
   783     0073  3020               	movlw	32	;0X20
   784     0074  0087               	movwf	7
   785     0075  30B0               	movlw	176	;0XB0
   786     0076  0086               	movwf	6
   787     0077  300A               	movlw	10
   788     0078  0786               	addwf	6,f	;這裡是第一筆資料的位置
   789     0079                     CHECK_CRC16_IS_RIGHT_LV1:
   790     0079  0801               	movf	1,w
   791     007A  00A7               	movwf	39
   792     007B  24EE               	call	CRC_16_FUNCTION_LOOP
   793     007C  0A86               	incf	6,f
   794     007D  0BAA               	decfsz	42,f
   795     007E  2879               	goto	CHECK_CRC16_IS_RIGHT_LV1
   796                           
   797                           ;----------------------------
   798     007F  0829               	movf	41,w
   799     0080  0601               	xorwf	1,w
   800     0081  1D03               	btfss	3,2
   801     0082  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
   802                           
   803                           ;----------------------------
   804     0083  0A86               	incf	6,f
   805     0084  0828               	movf	40,w
   806     0085  0601               	xorwf	1,w
   807     0086  1D03               	btfss	3,2
   808     0087  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
   809     0088  283E               	goto	MODBUS_CRC16_CHECK_IS_OK	;CRC16驗證正確
   810     0089                     ANAY_MODBUS_CMD_03_LOOP:	
   811                           ;========================================================
   812                           ;=============MODBUS 功能碼為0X03========================
   813                           ;========================================================
   814                           ;功能碼:0X03表示要READ
   815                           ;先確認ADR是否對應的合法
   816                           
   817     0089  0020               	banksel	12
   818     008A  30F1               	movlw	241
   819     008B  05BC               	andwf	60,f
   820     008C  14BC               	bsf	60,1
   821     008D  2897               	goto	ANAY_MODBUS_CMD_COMMON_LOOP
   822     008E                     ANAY_MODBUS_CMD_10_LOOP:	
   823                           ;========================================================
   824                           ;=============MODBUS 功能碼為0X10========================
   825                           ;========================================================
   826                           ;功能碼:0X10，這個部分有可能寫入一個WORD的資料和功能碼0X06相同
   827                           ;所以要多確認是否合法
   828                           ;先確認ADR是否對應的合法
   829                           
   830     008E  0020               	banksel	12
   831     008F  30F1               	movlw	241
   832     0090  05BC               	andwf	60,f
   833     0091  15BC               	bsf	60,3
   834     0092  2897               	goto	ANAY_MODBUS_CMD_COMMON_LOOP
   835     0093                     ANAY_MODBUS_CMD_06_LOOP:	
   836                           ;========================================================
   837                           ;=============MODBUS 功能碼為0X06========================
   838                           ;========================================================
   839                           ;功能碼:0X06表示要WRITE
   840                           ;先確認ADR是否對應的合法
   841                           
   842     0093  0020               	banksel	12
   843     0094  30F1               	movlw	241
   844     0095  05BC               	andwf	60,f
   845     0096  153C               	bsf	60,2	;先將MODBUS FLAG重新設定為功能碼06
   846     0097                     ANAY_MODBUS_CMD_COMMON_LOOP:	
   847                           ;GOTO ANAY_MODBUS_CMD_COMMON_LOOP
   848                           
   849                           
   850                           ;----------------
   851     0097  0020               	banksel	12
   852     0098  3021               	movlw	33	;21
   853     0099  0087               	movwf	7
   854     009A  3040               	movlw	64	;E0
   855     009B  0086               	movwf	6	;這裡是第一筆資料的位置
   856     009C  3002               	movlw	2
   857     009D  0786               	addwf	6,f
   858                           
   859                           ;---------------------------------------------------
   860     009E  0801               	movf	1,w
   861     009F  00CC               	movwf	76	;ADR位置的HBYTE
   862     00A0  0A86               	incf	6,f
   863     00A1  0801               	movf	1,w
   864     00A2  00CD               	movwf	77	;ADR位置的LBYTE
   865                           
   866                           ;---------------------------------------------------- 將位置資料先複製出來
   867     00A3  30A0               	movlw	160
   868     00A4  02CD               	subwf	77,f
   869     00A5  3000               	movlw	0
   870     00A6  3BCC               	subwfb	76,f
   871                           
   872                           ;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
   873     00A7  084D               	movf	77,w
   874     00A8  00CA               	movwf	74
   875     00A9  0020               	banksel	12
   876     00AA  16B0               	bsf	48,5
   877     00AB  0009               	retfie
   878     00AC                     RC2IF_FUNCTION_LOOP:	
   879                           ;---------------------------------------------------------------------------------------------------
      +                          -
   880                           ;下面是之前功能碼0X06的動作副程式
   881 ;;------------------------------------------------
   882                           ; MOVLW 0X09
   883                           ; XORWF CAL_TEMP_LBYTE,W
   884                           ; BTFSC STATUS,Z
   885                           ; GOTO STRONG_STOP_FUNCTION
   886 ;;------------------------
   887                           ; MOVLW 0X00
   888                           ; XORWF CAL_TEMP_LBYTE,W
   889                           ; BTFSC STATUS,Z
   890                           ; GOTO CW_STEP_FUNCTION
   891 ;;------------------------
   892                           ; MOVLW 0X01
   893                           ; XORWF CAL_TEMP_LBYTE,W
   894                           ; BTFSC STATUS,Z
   895                           ; GOTO CCW_STEP_FUNCTION
   896 ;;------------------------
   897                           ; MOVLW 0X04
   898                           ; XORWF CAL_TEMP_LBYTE,W
   899                           ; BTFSC STATUS,Z
   900                           ; GOTO RESET_STEP_FUNCTION
   901                           ;
   902 ;;------------------------------------------------
   903                           ;ANAY_MODBUS_CMD_06_EXIT:
   904                           ; BCF FLAG2_BANK0,NOW_MOTOR_1_FLAG
   905                           ; BCF FLAG2_BANK0,NOW_MOTOR_2_FLAG
   906                           ; BCF FLAG2_BANK0,NOW_MOTOR_3_FLAG
   907                           ; BCF FLAG2_BANK0,NOW_MOTOR_4_FLAG
   908                           ; RETFIE
   909                           ;
   910                           ;
   911                           ;
   912 ;;-------------------------------------------
   913 ;;-------------0X80以上的WRITE CMD-----------
   914 ;;-------------------------------------------
   915                           ;ANAY_MODBUS_WRITE_0X80_LOOP:
   916                           ; MOVLW 0X08
   917                           ; MOVWF TX_DATA_COUNTER
   918                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
   919                           ; MOVLW 0X83
   920                           ; XORWF INDF1,W
   921                           ; BTFSC STATUS,Z
   922                           ; CALL COMMON_CMD_0X83_LOOP
   923                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
   924                           ;COMMON_CMD_0X83_LOOP:
   925                           ; INCF FSR1L,F
   926                           ; INCF FSR1L,F
   927                           ; MOVF INDF1,W
   928                           ; BTFSC STATUS,Z
   929                           ; GOTO RECOVER_MODULE_LOOP
   930                           ;BANKSEL BANK7
   931                           ; MOVLW 0X02
   932                           ; MOVWF ADR_83_L_DAT
   933                           ; MOVLW 0X02
   934                           ; MOVWF ADR_81_L_DAT
   935                           ;
   936                           ;
   937                           ;RECOVER_MODULE_LOOP_LV1:
   938                           ;BANKSEL MOTOR_CONTROL_PORT
   939                           ; BCF MOTOR_CONTROL_PORT,M1_ST
   940                           ; BCF MOTOR_CONTROL_PORT,M2_ST
   941                           ;BANKSEL PORTA
   942                           ; BSF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
   943                           ; BCF MOTOR2_FLAG0,MOTOR_2_RESET
   944                           ; BCF MOTOR1_FLAG0,MOTOR_1_RESET
   945                           ; BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
   946                           ; BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
   947                           ; BCF FLAG1_BANK0,CAN_WORK_FLAG
   948                           ;
   949                           ; BCF MOTOR2_FLAG0,MOTOR_2_WORK
   950                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
   951                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
   952                           ; BCF FLAG3_BANK0,TEN_TIME_EN
   953                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
   954                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
   955                           ; BCF MOTOR1_FLAG0,MOTOR_1_WORK
   956                           ;
   957                           ; MOVLW MODBUS_DAT_REAL_ADRH
   958                           ; MOVWF FSR0H
   959                           ; MOVLW MODBUS_DAT_REAL_ADRL
   960                           ; MOVWF FSR0L
   961                           ; MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
   962                           ; ADDWF FSR0L,F
   963                           ; MOVLW 0X00
   964                           ; MOVWF INDF0
   965                           ; MOVLW MODBUS_DAT_REAL_ADRH
   966                           ; MOVWF FSR0H
   967                           ; MOVLW MODBUS_DAT_REAL_ADRL
   968                           ; MOVWF FSR0L
   969                           ; MOVLW 0X15
   970                           ; ADDWF FSR0L,F
   971                           ; MOVLW 0X07
   972                           ; ADDWF FSR0L,F
   973                           ; MOVLW 0X00
   974                           ; MOVWF INDF0
   975 ;;---------------------------------------------------------------------------
   976                           ;
   977                           ;
   978                           ; MOVLW MODBUS_DAT_REAL_ADRH
   979                           ; MOVWF FSR0H
   980                           ; MOVLW MODBUS_DAT_REAL_ADRL
   981                           ; MOVWF FSR0L
   982                           ; CLRF INDF0
   983                           ; INCF FSR0L,F
   984 ;;-------------
   985                           ; CLRF INDF0
   986                           ; INCF FSR0L,F
   987 ;;-------------
   988                           ; CLRF INDF0
   989                           ; INCF FSR0L,F
   990 ;;-------------
   991                           ; CLRF INDF0
   992                           ; INCF FSR0L,F
   993 ;;-------------
   994 ;;=============================================
   995                           ;
   996                           ; MOVLW MODBUS_DAT_REAL_ADRH
   997                           ; MOVWF FSR0H
   998                           ; MOVLW MODBUS_DAT_REAL_ADRL
   999                           ; MOVWF FSR0L
  1000                           ; MOVLW 0X15
  1001                           ; ADDWF FSR0L,F
  1002                           ; CLRF INDF0
  1003                           ; INCF FSR0L,F
  1004 ;;-------------
  1005                           ; CLRF INDF0
  1006                           ; INCF FSR0L,F
  1007 ;;-------------
  1008                           ; CLRF INDF0
  1009                           ; INCF FSR0L,F
  1010 ;;-------------
  1011                           ; CLRF INDF0
  1012                           ; INCF FSR0L,F
  1013 ;;-------------
  1014                           ; RETURN
  1015 ;;-----------------------------------------------------
  1016 ;;停止動作
  1017                           ;RECOVER_MODULE_LOOP:
  1018                           ;BANKSEL BANK7
  1019                           ; MOVLW 0X00
  1020                           ; MOVWF ADR_83_L_DAT
  1021                           ; MOVLW 0X00
  1022                           ; MOVWF ADR_81_L_DAT
  1023                           ;BANKSEL PORTA
  1024                           ;CALL RECOVER_MODULE_LOOP_LV1
  1025                           ; BCF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1026                           ; RETURN
  1027                           ;
  1028                           ;
  1029                           ;
  1030                           ;
  1031                           ;
  1032 ;;--------------------------------------------------------------------------
  1033 ;;---------------------------------------------------------------------------
  1034 ;;---------------------------------------------------------------------------
  1035 ;;========================================================
  1036 ;;=============ADDR IS 0X04===============================
  1037 ;;========================================================
  1038                           ;RESET_STEP_FUNCTION:
  1039                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1040                           ; CALL STRONG_RESET_MOTOR_1_FUNC
  1041                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1042                           ; CALL STRONG_RESET_MOTOR_2_FUNC
  1043                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1044                           ;STRONG_RESET_MOTOR_1_FUNC:
  1045                           ;BANKSEL MOTOR_CONTROL_PORT
  1046                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1047                           ;BANKSEL PORTA
  1048                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1049                           ; RETURN
  1050                           ;STRONG_RESET_MOTOR_2_FUNC:
  1051                           ; BSF MOTOR2_FLAG0,MOTOR_2_RESET
  1052                           ; RETURN
  1053                           ;
  1054                           ;
  1055 ;;========================================================
  1056 ;;=============ADDR IS 0X00===============================
  1057 ;;========================================================
  1058                           ;CW_STEP_FUNCTION:
  1059                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1060                           ; CALL STRONG_CW_MOTOR_1_FUNC
  1061                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1062                           ; CALL STRONG_CW_MOTOR_2_FUNC
  1063                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1064                           ;STRONG_CW_MOTOR_1_FUNC:
  1065                           ;BANKSEL MOTOR_CONTROL_PORT
  1066                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1067                           ;BANKSEL PORTA
  1068                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1069                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1070                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1071                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1072                           ; RETURN
  1073                           ;STRONG_CW_MOTOR_2_FUNC:
  1074                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1075                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1076                           ; RETURN
  1077 ;;========================================================
  1078 ;;=============ADDR IS 0X01===============================
  1079 ;;========================================================
  1080                           ;CCW_STEP_FUNCTION:
  1081                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1082                           ; CALL STRONG_CCW_MOTOR_1_FUNC
  1083                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1084                           ; CALL STRONG_CCW_MOTOR_2_FUNC
  1085                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1086                           ;STRONG_CCW_MOTOR_1_FUNC:
  1087                           ;BANKSEL MOTOR_CONTROL_PORT
  1088                           ;BSF MOTOR_CONTROL_PORT,M1_FR
  1089                           ;BANKSEL PORTA
  1090                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1091                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1092                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1093                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1094                           ; RETURN
  1095                           ;STRONG_CCW_MOTOR_2_FUNC:
  1096                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1097                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1098                           ; RETURN
  1099 ;;========================================================
  1100 ;;=============ADDR IS 0X09===============================
  1101 ;;========================================================
  1102                           ;STRONG_STOP_FUNCTION:
  1103                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1104                           ; CALL STRONG_STOP_MOTOR_1_FUNC
  1105                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1106                           ; CALL STRONG_STOP_MOTOR_2_FUNC
  1107 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1108 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1109 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1110 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1111                           ;
  1112                           ;
  1113                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1114                           ;
  1115                           ;STRONG_STOP_MOTOR_1_FUNC:
  1116                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1117                           ; MOVWF FSR0H
  1118                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1119                           ; MOVWF FSR0L
  1120                           ; MOVLW 0X07
  1121                           ; ADDWF FSR0L,F
  1122                           ; MOVLW 0X04
  1123                           ; MOVWF INDF0
  1124 ;;----------
  1125                           ; MOVLW 0X01
  1126                           ; MOVWF STRONG_STOP_TEMP1
  1127                           ;BANKSEL MOTOR_CONTROL_PORT
  1128                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  1129                           ;BANKSEL PORTA
  1130                           ; RETURN
  1131                           ;STRONG_STOP_MOTOR_2_FUNC:
  1132                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1133                           ; MOVWF FSR0H
  1134                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1135                           ; MOVWF FSR0L
  1136                           ; MOVLW 0X15
  1137                           ; ADDWF FSR0L,F
  1138                           ; MOVLW 0X07
  1139                           ; ADDWF FSR0L,F
  1140                           ; MOVLW 0X04
  1141                           ; MOVWF INDF0
  1142 ;;----------
  1143                           ; MOVLW 0X01
  1144                           ; MOVWF STRONG_STOP_TEMP2
  1145                           ;BANKSEL MOTOR_CONTROL_PORT
  1146                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  1147                           ;BANKSEL PORTA
  1148                           ; RETURN
  1149                           ;
  1150                           ;
  1151                           ;
  1152                           ;
  1153                           ;
  1154                           ;
  1155                           ;
  1156 ;;----------------------------------------------------------
  1157                           ;WRITE_MOTOR_1_SOME_DATA:
  1158                           ; BSF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1159                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1160                           ; MOVWF FSR0H
  1161                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1162                           ; MOVWF FSR0L
  1163                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1164                           ;WRITE_MOTOR_2_SOME_DATA:
  1165                           ; BSF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1166                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1167                           ; MOVWF FSR0H
  1168                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1169                           ; MOVWF FSR0L
  1170                           ; MOVLW 0X15
  1171                           ; ADDWF FSR0L,F
  1172                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1173                           ;WRITE_MOTOR_3_SOME_DATA:
  1174                           ; BSF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  1175                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1176                           ; MOVWF FSR0H
  1177                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1178                           ; MOVWF FSR0L
  1179                           ; MOVLW 0X2A
  1180                           ; ADDWF FSR0L,F
  1181                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1182                           ;WRITE_MOTOR_4_SOME_DATA:
  1183                           ; BSF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  1184                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1185                           ; MOVWF FSR0H
  1186                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1187                           ; MOVWF FSR0L
  1188                           ; MOVLW 0X3F
  1189                           ; ADDWF FSR0L,F
  1190                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1191                           ;
  1192                           ;
  1193                           ;
  1194                           ;
  1195                           ;
  1196                           ;
  1197                           ;
  1198                           ;
  1199                           ;
  1200                           ;
  1201                           ;
  1202                           ;
  1203                           ;
  1204                           ;
  1205                           ;
  1206                           ;******************************************************************************
  1207                           ;******************************************************************************
  1208                           ;========================================================
  1209                           ;==================中斷UART2 FUNCTION====================
  1210                           ;========================================================
  1211                           
  1212     00AC  3188               	pagesel	2048
  1213     00AD  
                 warning: (2090) fixup overflow storing 0xD1F in 2 bytes
                 251F               	call	MODBUS_INTPUT_FUNCTION	;將資料存在INDF1
  1214     00AE  3180               	pagesel	0
  1215     00AF  0009               	retfie
  1216     00B0                     TMR2IF_FUNCTION_LOOP:	
  1217                           ;========================================================
  1218                           ;==================中斷TIMER2 FUNCTION===================
  1219                           ;========================================================
  1220                           ;TIMER2 BASE IS 1mS
  1221                           
  1222     00B0  1091               	bcf	17,1
  1223                           
  1224                           ;---------------------
  1225     00B1  1CBA               	btfss	58,1
  1226     00B2  28B7               	goto	TMR2IF_FUNCTION_LV0
  1227     00B3  0848               	movf	72,w
  1228     00B4  1903               	btfsc	3,2
  1229     00B5  20EA               	call	TEN_MS_FUNCTION_LOOP
  1230     00B6  03C8               	decf	72,f
  1231     00B7                     TMR2IF_FUNCTION_LV0:
  1232     00B7  1E30               	btfss	48,4
  1233     00B8  28BD               	goto	TMR2IF_FUNC_LV1
  1234                           
  1235                           ;---------
  1236     00B9  0824               	movf	36,w
  1237     00BA  1903               	btfsc	3,2
  1238     00BB  28D4               	goto	TIMER2_INT_LV1
  1239     00BC  03A4               	decf	36,f
  1240     00BD                     TMR2IF_FUNC_LV1:
  1241                           
  1242                           ;判斷是否MODBUS RTU TIMEOUT 要啟動
  1243     00BD  3020               	movlw	32
  1244     00BE  0087               	movwf	7
  1245     00BF  30B0               	movlw	176
  1246     00C0  0086               	movwf	6
  1247     00C1  3008               	movlw	8
  1248     00C2  0786               	addwf	6,f
  1249     00C3  1C01               	btfss	1,0
  1250     00C4  0009               	retfie
  1251     00C5  0020               	banksel	12
  1252                           
  1253                           ;-----------------------------------
  1254     00C6  0386               	decf	6,f
  1255     00C7  0801               	movf	1,w
  1256     00C8  1D03               	btfss	3,2
  1257     00C9  28D0               	goto	RESET_MODBUS_TIMEOUT_FUNCTION
  1258                           
  1259                           ;-----------------------------------
  1260     00CA  0020               	banksel	12
  1261     00CB  0823               	movf	35,w
  1262     00CC  1903               	btfsc	3,2
  1263     00CD  2811               	goto	MODBUS_TIMEOUT_IS_FINISH_LOOP
  1264                           
  1265                           ;----------------------------------=
  1266     00CE  03A3               	decf	35,f
  1267     00CF  0009               	retfie
  1268     00D0                     RESET_MODBUS_TIMEOUT_FUNCTION:	
  1269                           ;-------------------------------------------------------
  1270                           
  1271                           
  1272                           ;表示還是持續有收到資料，TIME OUT 資料重製
  1273     00D0  0181               	clrf	1
  1274     00D1  3004               	movlw	4
  1275     00D2  00A3               	movwf	35
  1276     00D3  0009               	retfie
  1277     00D4                     TIMER2_INT_LV1:	
  1278                           ;------------------------------------------------------
  1279                           ;INT 時間
  1280                           
  1281     00D4  3004               	movlw	4
  1282     00D5  00A4               	movwf	36
  1283     00D6  0AC1               	incf	65,f
  1284     00D7  1230               	bcf	48,4
  1285     00D8  108B               	bcf	11,1
  1286     00D9  160B               	bsf	11,4
  1287     00DA  1EB2               	btfss	50,5
  1288     00DB  0009               	retfie
  1289     00DC  3021               	movlw	33
  1290     00DD  0085               	movwf	5
  1291     00DE  3090               	movlw	144
  1292     00DF  0084               	movwf	4
  1293     00E0  3015               	movlw	21
  1294     00E1  0784               	addwf	4,f
  1295     00E2  3005               	movlw	5
  1296     00E3  0784               	addwf	4,f
  1297     00E4  3001               	movlw	1
  1298     00E5  0280               	subwf	0,f
  1299     00E6  0384               	decf	4,f
  1300     00E7  3000               	movlw	0
  1301     00E8  3B80               	subwfb	0,f
  1302     00E9  0009               	retfie
  1303     00EA                     TEN_MS_FUNCTION_LOOP:
  1304     00EA  3002               	movlw	2
  1305     00EB  00C8               	movwf	72
  1306     00EC  3001               	movlw	1
  1307     00ED  07C7               	addwf	71,f
  1308     00EE  3000               	movlw	0
  1309     00EF  3DC6               	addwfc	70,f
  1310     00F0  0008               	return
  1311     00F1                     IOC_INT_FUNCTION:	
  1312                           ;========================================================
  1313                           ;==================中斷IOC FUNCTION====================
  1314                           ;========================================================
  1315                           
  1316     00F1  100B               	bcf	11,0
  1317     00F2  0027               	banksel	918
  1318     00F3  1896               	btfsc	918,1
  1319     00F4  20F8               	call	IOCBF1_INT_LOOP
  1320                           
  1321                           ;--------
  1322     00F5  1916               	btfsc	918,2
  1323     00F6  20FB               	call	IOCBF2_INT_LOOP
  1324     00F7  0009               	retfie
  1325     00F8                     IOCBF1_INT_LOOP:	
  1326                           ;----------------------------------------------------------
  1327                           
  1328     00F8  1096               	bcf	918,1
  1329     00F9  0027               	banksel	918
  1330     00FA  0008               	return
  1331     00FB                     IOCBF2_INT_LOOP:
  1332     00FB  1116               	bcf	918,2
  1333     00FC  0020               	banksel	12
  1334     00FD  0008               	return
  1335     00FE                     INT_INTF_FUNCTION:	
  1336                           ;========================================================
  1337                           ;==================中斷INT FUNCTION====================
  1338                           ;========================================================
  1339                           
  1340     00FE  108B               	bcf	11,1
  1341     00FF  1A30               	btfsc	48,4
  1342     0100  0009               	retfie
  1343     0101  1630               	bsf	48,4
  1344     0102  120B               	bcf	11,4
  1345     0103  0009               	retfie
  1346     0104                     MODBUS_RTU_READ_LV2:	
  1347                           ;========================================================
  1348                           ;=============MODBUS 計算其CRC 功能======================
  1349                           ;========================================================
  1350                           
  1351     0104  0020               	banksel	12
  1352     0105  30FF               	movlw	255
  1353     0106  00A8               	movwf	40
  1354     0107  30FF               	movlw	255
  1355     0108  00A9               	movwf	41
  1356                           
  1357                           ;---------
  1358     0109  3020               	movlw	32
  1359     010A  0087               	movwf	7
  1360     010B  30B0               	movlw	176
  1361     010C  0086               	movwf	6
  1362     010D  300A               	movlw	10
  1363     010E  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1364     010F                     MODBUS_RTU_READ_CRC_LOOP:	
  1365                           ;---------
  1366                           
  1367     010F  0801               	movf	1,w
  1368     0110  00A7               	movwf	39
  1369     0111  24EE               	call	CRC_16_FUNCTION_LOOP
  1370     0112  0A86               	incf	6,f
  1371     0113  0BAA               	decfsz	42,f
  1372     0114  290F               	goto	MODBUS_RTU_READ_CRC_LOOP
  1373     0115  0829               	movf	41,w
  1374     0116  0081               	movwf	1
  1375     0117  0A86               	incf	6,f
  1376     0118  0828               	movf	40,w
  1377     0119  0081               	movwf	1
  1378     011A  0008               	return
  1379     011B                     SYSTEM_START_SETTING:	
  1380                           ;========================================================
  1381                           ;================== 主程序前參數設定 ====================
  1382                           ;========================================================
  1383                           
  1384                           
  1385                           ;========================================================
  1386                           ;=====================振盪器設定=========================
  1387                           ;========================================================
  1388     011B  0021               	banksel	153
  1389     011C  3072               	movlw	114
  1390     011D  0099               	movwf	153	;8MHZ
  1391     011E  3000               	movlw	0
  1392     011F  0098               	movwf	152	;校正後頻率
  1393     0120  3011               	movlw	17
  1394     0121  009A               	movwf	154	;高頻振盪精度0.5%
  1395                           
  1396                           ;========================================================
  1397                           ;=====================OPTION設定=========================
  1398                           ;========================================================
  1399     0122  30C8               	movlw	200
  1400     0123  0095               	movwf	149	;BIT6 0->rising 1->falling
  1401                           
  1402                           ;========================================================
  1403                           ;======================中斷設定==========================
  1404                           ;========================================================
  1405     0124  3040               	movlw	64
  1406     0125  008B               	movwf	11
  1407     0126  0021               	banksel	145
  1408     0127  3000               	movlw	0
  1409     0128  0091               	movwf	145	;BIT 3 = MSSP 1 INTERRUPT, BIT 5 = USART 1 RECIEVE INTERRUPT
  1410     0129  3000               	movlw	0
  1411     012A  0092               	movwf	146
  1412     012B  3000               	movlw	0
  1413     012C  0093               	movwf	147
  1414     012D  3000               	movlw	0
  1415     012E  0094               	movwf	148
  1416                           
  1417                           ;========================================================
  1418                           ;========================ADC設定=========================
  1419                           ;========================================================
  1420     012F  0021               	banksel	157
  1421     0130  3000               	movlw	0
  1422     0131  009D               	movwf	157
  1423     0132  3000               	movlw	0
  1424     0133  009E               	movwf	158
  1425     0134  0023               	banksel	396
  1426     0135  018C               	clrf	396
  1427     0136  0190               	clrf	400
  1428     0137  0028               	banksel	1036
  1429     0138  018C               	clrf	1036
  1430     0139  018D               	clrf	1037
  1431     013A  0020               	banksel	12
  1432                           
  1433                           ;========================================================
  1434                           ;=====================I/O設定============================
  1435                           ;========================================================
  1436     013B  0021               	banksel	140
  1437     013C  30C0               	movlw	192
  1438     013D  008C               	movwf	140
  1439     013E  30FF               	movlw	255
  1440     013F  008D               	movwf	141
  1441     0140  3000               	movlw	0
  1442     0141  008E               	movwf	142
  1443     0142  300F               	movlw	15
  1444     0143  008F               	movwf	143
  1445     0144  30FF               	movlw	255
  1446     0145  0090               	movwf	144
  1447     0146  0026               	banksel	780
  1448     0147  3000               	movlw	0
  1449     0148  008C               	movwf	780
  1450     0149  30F6               	movlw	246
  1451     014A  008D               	movwf	781
  1452                           
  1453                           ;---------------
  1454     014B  0022               	banksel	268
  1455     014C  3000               	movlw	0
  1456     014D  008C               	movwf	268
  1457     014E  3000               	movlw	0
  1458     014F  008D               	movwf	269
  1459     0150  3000               	movlw	0
  1460     0151  008E               	movwf	270
  1461     0152  3000               	movlw	0
  1462     0153  008F               	movwf	271
  1463     0154  3000               	movlw	0
  1464     0155  0090               	movwf	272
  1465     0156  0027               	banksel	908
  1466     0157  018C               	clrf	908
  1467     0158  018D               	clrf	909
  1468                           
  1469                           ;---------------
  1470     0159  0020               	banksel	12
  1471     015A  018C               	clrf	12
  1472     015B  018D               	clrf	13
  1473     015C  018E               	clrf	14
  1474     015D  018F               	clrf	15
  1475     015E  0190               	clrf	16
  1476                           
  1477                           ;---------------
  1478     015F  0025               	banksel	652
  1479     0160  018C               	clrf	652
  1480     0161  018D               	clrf	653
  1481     0162  0020               	banksel	12
  1482     0163  255B               	call	DELAY_1000ms
  1483                           
  1484                           ;========================================================
  1485                           ;=====================暫存器設定=========================
  1486                           ;========================================================
  1487     0164  2524               	call	CLEAN_ALL_REGISTER
  1488     0165  3188               	pagesel	2048
  1489     0166  
                 warning: (2090) fixup overflow storing 0xD08 in 2 bytes
                 2508               	call	SET_MODBUS_MODE_ENABLE	;設定uart2硬體
  1490     0167  3180               	pagesel	0
  1491                           
  1492                           ;========================================================
  1493                           ;=====================TIMER2設定=========================
  1494                           ;========================================================
  1495     0168  2513               	call	SET_TMR2_BASE_TIME	;設定TIMER2基礎時間
  1496     0169  251C               	call	SET_TMR2_INT_EN	;TIMER2中斷啟動
  1497     016A  2520               	call	SET_TMR2_ON	;啟動TIMER2功能
  1498     016B                     ADC_HW_SETTING:	
  1499                           ;========================================================
  1500                           ;=====================ADC設定============================
  1501                           ;========================================================
  1502                           
  1503     016B  0028               	banksel	1037
  1504     016C  3010               	movlw	16
  1505     016D  008D               	movwf	1037
  1506                           
  1507                           ;-------------------------ADC_OPEN-------------------------
  1508     016E  0021               	banksel	158
  1509     016F  3031               	movlw	49	;AN12啟動
  1510     0170  009D               	movwf	157
  1511     0171  30C0               	movlw	192
  1512     0172  009E               	movwf	158
  1513     0173  0020               	banksel	12
  1514     0174  2560               	call	DELAY_100ms
  1515     0175                     SETTING_PWM_HW_LOOP:	
  1516                           ;========================================================
  1517                           ;=====================PWM輸出設定========================
  1518                           ;========================================================
  1519                           
  1520                           
  1521                           ;-------------------------------------設定相對應接腳TIMER
  1522     0175  0025               	banksel	670
  1523     0176  30DF               	movlw	223
  1524     0177  009E               	movwf	670
  1525     0178  300F               	movlw	15
  1526     0179  009F               	movwf	671
  1527                           
  1528                           ;-------------------------------------決定週期
  1529     017A  0028               	banksel	1046
  1530     017B  309C               	movlw	156
  1531     017C  0096               	movwf	1046
  1532                           
  1533                           ;-------------------------------------啟動TIMER
  1534     017D  0028               	banksel	1047
  1535     017E  307F               	movlw	127
  1536     017F  0097               	movwf	1047
  1537                           
  1538                           ;-------------------------------------決定DUTY CYCLE
  1539     0180  0026               	banksel	785
  1540     0181  3032               	movlw	50
  1541     0182  0091               	movwf	785
  1542                           
  1543                           ;-------------------------------------啟動PWM
  1544     0183  0026               	banksel	787
  1545     0184  300C               	movlw	12
  1546     0185  0093               	movwf	787
  1547     0186                     IOC_HW_SETTING:	
  1548                           ;========================================================
  1549                           ;=====================IOC設定============================
  1550                           ;========================================================
  1551                           
  1552     0186  0027               	banksel	916
  1553     0187  3000               	movlw	0
  1554     0188  0095               	movwf	917
  1555     0189  3000               	movlw	0
  1556     018A  0094               	movwf	916	;正緣觸發
  1557     018B                     CHECK_PWM_FREQ_FUCNTION:	
  1558 ;;========================================================
  1559 ;;=====================DIP SWITCH判斷=====================
  1560 ;;========================================================
  1561                           ;DIP_SWITCH_ADR_FUNCTION:
  1562                           ;BANKSEL ADDR_0_1_2_3_PORT
  1563                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_0
  1564                           ; BSF MOTOR1_FLAG0,MOTOR_1_EN
  1565 ;;---------
  1566                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_1
  1567                           ; BSF MOTOR2_FLAG0,MOTOR_2_EN
  1568 ;;---------
  1569                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_2
  1570                           ; BSF MOTOR3_FLAG0,MOTOR_3_EN
  1571 ;;---------
  1572                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_3
  1573                           ; BSF MOTOR4_FLAG0,MOTOR_4_EN
  1574                           ;---------
  1575                           ;========================================================
  1576                           ;=====================PWM頻率偵測========================
  1577                           ;========================================================
  1578                           
  1579     018B                     ID_SELECT_LOOP:	
  1580                           ;CALL ADC_TAKE_DATA_FUNCTION
  1581                           ;========================================================
  1582                           ;=====================ID SELECT==========================
  1583                           ;========================================================
  1584                           ;這邊判斷ID的條件是由ADC RF0的數值來判斷
  1585                           
  1586     018B  0020               	banksel	12
  1587     018C  01A5               	clrf	37
  1588     018D                     POWER_LED_OUTPUT_FUNCTION:	
  1589                           ;========================================================
  1590                           ;===================POWER LED輸出========================
  1591                           ;========================================================
  1592                           
  1593     018D  0020               	banksel	13
  1594     018E  1E8D               	btfss	13,5
  1595     018F  2992               	goto	POWER_LED_OUTPUT_EXIT
  1596     0190  0027               	banksel	908
  1597     0191  140C               	bsf	908,0
  1598     0192                     POWER_LED_OUTPUT_EXIT:
  1599     0192  0020               	banksel	12
  1600     0193                     INT_HW_SETTING:	
  1601                           ;--------------------------------------------------------
  1602                           ;--------------------------------------------------------
  1603                           ;========================================================
  1604                           ;=====================INT設定============================
  1605                           ;========================================================
  1606                           
  1607     0193  0027               	banksel	909
  1608     0194  118D               	bcf	909,3	;將MAX485設定為RX模式
  1609     0195  160B               	bsf	11,4
  1610     0196  158B               	bsf	11,3
  1611     0197  0021               	banksel	148
  1612     0198  1694               	bsf	148,5
  1613     0199  1491               	bsf	145,1
  1614     019A  178B               	bsf	11,7
  1615     019B  0020               	banksel	12
  1616     019C  3002               	movlw	2
  1617     019D  00C8               	movwf	72
  1618     019E  3004               	movlw	4
  1619     019F  00A4               	movwf	36
  1620     01A0  0022               	banksel	268
  1621     01A1  160C               	bsf	268,4
  1622     01A2  168C               	bsf	268,5
  1623     01A3  100E               	bcf	270,0
  1624     01A4  110E               	bcf	270,2
  1625     01A5  108E               	bcf	270,1
  1626     01A6  118E               	bcf	270,3
  1627     01A7  0020               	banksel	12
  1628     01A8  3004               	movlw	4
  1629     01A9  00A5               	movwf	37
  1630                           
  1631                           ;BCF INTCON,GIE
  1632     01AA  29AB               	goto	SYSTEM_START
  1633     01AB                     SYSTEM_START:	
  1634                           ;********************************************************************************
  1635                           ;********************************************************************************
  1636                           ;========================================================
  1637                           ;=====================主程序迴圈=========================
  1638                           ;========================================================
  1639                           
  1640     01AB  0020               	banksel	12
  1641     01AC                     SYSTEM_START_LV1:	
  1642                           ; BTFSC PORTE,0X00
  1643                           ; GOTO MOTOR_2_WORK1
  1644                           ; GOTO MOTOR_2_STOP
  1645                           ;BANKSEL PORTA
  1646                           
  1647     01AC  1AB0               	btfsc	48,5
  1648     01AD  21BD               	call	DEAL_WITH_MODBUS_LOOP
  1649                           
  1650                           ;------------------------------------------- 傳送ERROR CODE的地方
  1651     01AE  183B               	btfsc	59,0
  1652     01AF  227A               	call	MODBUS_ERROR_CODE_01_LOOP
  1653     01B0  18BB               	btfsc	59,1
  1654     01B1  228E               	call	MODBUS_ERROR_CODE_02_LOOP
  1655     01B2  193B               	btfsc	59,2
  1656     01B3  229C               	call	MODBUS_ERROR_CODE_03_LOOP
  1657     01B4  19BB               	btfsc	59,3
  1658     01B5  22AA               	call	MODBUS_ERROR_CODE_04_LOOP
  1659     01B6  1A3B               	btfsc	59,4
  1660     01B7  22B8               	call	MODBUS_ERROR_CODE_05_LOOP
  1661     01B8  1ABB               	btfsc	59,5
  1662     01B9  22C6               	call	MODBUS_ERROR_CODE_06_LOOP
  1663                           
  1664                           ;-------------------------------------------
  1665     01BA  1830               	btfsc	48,0
  1666     01BB  249D               	call	PREPARE_TX_DATA_LOOP	;UART TX傳送資料
  1667                           
  1668                           ;-------------------------------------------
  1669     01BC  29AB               	goto	SYSTEM_START
  1670     01BD                     DEAL_WITH_MODBUS_LOOP:	
  1671                           ;========================================================
  1672                           ;====================處理MODBUS指令=======================
  1673                           ;========================================================
  1674                           
  1675     01BD  12B0               	bcf	48,5
  1676     01BE  3188               	pagesel	2048
  1677     01BF  
                 warning: (2090) fixup overflow storing 0x800 in 2 bytes
                 2000               	call	MODBUS_ADR_FUNCTION
  1678     01C0  3180               	pagesel	0
  1679     01C1  0008               	return
  1680     01C2                     CHECK_MOTOR2_ZERO_LOOP:	
  1681 ;;-----------
  1682                           ; BTFSC FLAG1_BANK0,CAN_WORK_FLAG
  1683                           ; CALL MODULE_WORK_LOOP ;順逆轉馬達動作
  1684 ;;-----------
  1685                           ;
  1686                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_RESET
  1687                           ; CALL MOTOR_2_ZERO_FUNCTION
  1688                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_ING_ZERO
  1689                           ; CALL CHECK_MOTOR2_ZERO_LOOP
  1690 ;;--------------------------------------
  1691                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_RESET
  1692                           ; CALL MOTOR_1_ZERO_FUNCTION
  1693                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_HI_ZERO
  1694                           ; CALL MOTOR1_ZERO_IN_HI_LOOP
  1695                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_ING_ZERO
  1696                           ; CALL MOTOR1_ZERO_IN_LO_LOOP
  1697                           ; GOTO SYSTEM_START
  1698 ;;--------------------------------------
  1699                           ;MOTOR_2_WORK1:
  1700                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1701                           ; MOVWF FSR0H
  1702                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1703                           ; MOVWF FSR0L
  1704                           ; MOVLW 0X15
  1705                           ; ADDWF FSR0L,F
  1706                           ; MOVLW 0X0F
  1707                           ; ADDWF FSR0L,F
  1708                           ; MOVLW 0X00
  1709                           ; MOVWF INDF0
  1710                           ; GOTO SYSTEM_START_LV1
  1711                           ;MOTOR_2_STOP:
  1712                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1713                           ; MOVWF FSR0H
  1714                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1715                           ; MOVWF FSR0L
  1716                           ; MOVLW 0X15
  1717                           ; ADDWF FSR0L,F
  1718                           ; MOVLW 0X0F
  1719                           ; ADDWF FSR0L,F
  1720                           ; MOVLW 0XFF
  1721                           ; MOVWF INDF0
  1722                           ; GOTO SYSTEM_START_LV1
  1723                           ;========================================================
  1724                           ;=====================注射馬達復位完成===================
  1725                           ;========================================================
  1726                           
  1727     01C2  1A3A               	btfsc	58,4
  1728     01C3  0008               	return
  1729     01C4  18B6               	btfsc	54,1
  1730     01C5  0008               	return
  1731     01C6  1810               	btfsc	16,0
  1732     01C7  0008               	return
  1733     01C8  0022               	banksel	270
  1734     01C9  110E               	bcf	270,2
  1735     01CA  0020               	banksel	12
  1736     01CB  01C3               	clrf	67
  1737     01CC  0020               	banksel	12
  1738     01CD  12B2               	bcf	50,5
  1739     01CE  1036               	bcf	54,0
  1740                           
  1741                           ;-----------------------------
  1742     01CF  3021               	movlw	33
  1743     01D0  0085               	movwf	5
  1744     01D1  3090               	movlw	144
  1745     01D2  0084               	movwf	4
  1746     01D3  3015               	movlw	21
  1747     01D4  0784               	addwf	4,f
  1748     01D5  3004               	movlw	4
  1749     01D6  0784               	addwf	4,f
  1750     01D7  0180               	clrf	0
  1751     01D8  0A84               	incf	4,f
  1752     01D9  0180               	clrf	0
  1753                           
  1754                           ;---------------------------------------------清除累加步數
  1755     01DA  3021               	movlw	33
  1756     01DB  0085               	movwf	5
  1757     01DC  3090               	movlw	144
  1758     01DD  0084               	movwf	4
  1759     01DE  3015               	movlw	21
  1760     01DF  0784               	addwf	4,f
  1761     01E0  3007               	movlw	7
  1762     01E1  0784               	addwf	4,f
  1763     01E2  3000               	movlw	0
  1764     01E3  0080               	movwf	0
  1765     01E4  0027               	banksel	908
  1766     01E5  3000               	movlw	0
  1767     01E6  00A3               	movwf	163
  1768     01E7  0020               	banksel	12
  1769     01E8  0008               	return
  1770     01E9                     MOTOR1_ZERO_IN_LO_LOOP:	
  1771                           ;--------------------------------------------
  1772                           
  1773     01E9  1A3A               	btfsc	58,4
  1774     01EA  0008               	return
  1775     01EB  18B5               	btfsc	53,1
  1776     01EC  0008               	return
  1777     01ED  1D0D               	btfss	13,2
  1778     01EE  2A28               	goto	MOTOR1_TIME_ZERO_LOOP
  1779     01EF  3001               	movlw	1
  1780     01F0  07D1               	addwf	81,f
  1781     01F1  3000               	movlw	0
  1782     01F2  3DD0               	addwfc	80,f
  1783     01F3  30FD               	movlw	253
  1784     01F4  0750               	addwf	80,w
  1785     01F5  1C03               	btfss	3,0
  1786     01F6  0008               	return
  1787     01F7  300C               	movlw	12
  1788     01F8  0751               	addwf	81,w
  1789     01F9  1C03               	btfss	3,0
  1790     01FA  0008               	return
  1791     01FB                     MOTOR1_ZERO_IN_LO_LOOP_LV1:	
  1792                           ; MOVF IOC_COUNTER_HBYTE,W
  1793                           ; BTFSS STATUS,Z
  1794                           ; GOTO MOTOR1_ZERO_IN_LO_LOOP_LV1
  1795 ;;------
  1796                           ; MOVLW 0XFE
  1797                           ; ADDWF IOC_COUNTER_LBYTE,W
  1798                           ; BTFSS STATUS,C
  1799                           ; RETURN
  1800                           
  1801     01FB  0022               	banksel	270
  1802     01FC  100E               	bcf	270,0
  1803     01FD  0020               	banksel	12
  1804     01FE  13B1               	bcf	49,7
  1805     01FF  12B1               	bcf	49,5
  1806     0200  10BA               	bcf	58,1
  1807     0201  3021               	movlw	33
  1808     0202  0085               	movwf	5
  1809     0203  3090               	movlw	144
  1810     0204  0084               	movwf	4
  1811     0205  3007               	movlw	7
  1812     0206  0784               	addwf	4,f
  1813     0207  3000               	movlw	0
  1814     0208  0080               	movwf	0
  1815                           
  1816                           ;----------
  1817     0209  3000               	movlw	0
  1818     020A  00C2               	movwf	66
  1819     020B  1035               	bcf	53,0
  1820     020C  0027               	banksel	908
  1821     020D  3000               	movlw	0
  1822     020E  00A3               	movwf	163
  1823     020F  0020               	banksel	12
  1824     0210  183C               	btfsc	60,0
  1825     0211  2AF5               	goto	RESET_END_IN_NORMAL_LOOP
  1826                           
  1827                           ;BANKSEL IOCBN
  1828                           ; BSF IOCBN,0X02
  1829                           ; BCF IOCBP,0X02
  1830                           ;BANKSEL PORTA
  1831     0212  0008               	return
  1832     0213                     MOTOR1_ZERO_IN_HI_LOOP:	
  1833                           ;-------------------------------------------------------------
  1834                           ;-------------------------------------------------------------
  1835                           
  1836     0213  1A3A               	btfsc	58,4
  1837     0214  0008               	return
  1838     0215  18B5               	btfsc	53,1
  1839     0216  0008               	return
  1840     0217  190D               	btfsc	13,2
  1841     0218  2A28               	goto	MOTOR1_TIME_ZERO_LOOP
  1842     0219  3001               	movlw	1
  1843     021A  07D1               	addwf	81,f
  1844     021B  3000               	movlw	0
  1845     021C  3DD0               	addwfc	80,f
  1846     021D  30FD               	movlw	253
  1847     021E  0750               	addwf	80,w
  1848     021F  1C03               	btfss	3,0
  1849     0220  0008               	return
  1850     0221  300C               	movlw	12
  1851     0222  0751               	addwf	81,w
  1852     0223  1C03               	btfss	3,0
  1853     0224  0008               	return
  1854     0225                     MOTOR1_ZERO_IN_HI_LOOP_LV1:	
  1855                           ; MOVF IOC_COUNTER_HBYTE,W
  1856                           ; BTFSS STATUS,Z
  1857                           ; GOTO MOTOR1_ZERO_IN_HI_LOOP_LV1
  1858 ;;------
  1859                           ; MOVLW 0XFE
  1860                           ; ADDWF IOC_COUNTER_LBYTE,W
  1861                           ; BTFSS STATUS,C
  1862                           ; RETURN
  1863                           
  1864     0225  13B1               	bcf	49,7
  1865     0226  1331               	bcf	49,6
  1866     0227  2A4A               	goto	MOTOR_1_NOW_IS_LO
  1867     0228                     MOTOR1_TIME_ZERO_LOOP:
  1868                           
  1869                           ;CLRF IOC_COUNTER_HBYTE
  1870                           ;CLRF IOC_COUNTER_LBYTE
  1871     0228  0AD3               	incf	83,f
  1872     0229  309C               	movlw	156
  1873     022A  0753               	addwf	83,w
  1874     022B  1C03               	btfss	3,0
  1875     022C  0008               	return
  1876     022D  01D3               	clrf	83
  1877     022E  01D1               	clrf	81
  1878     022F  01D0               	clrf	80
  1879     0230  0008               	return
  1880     0231                     MOTOR_1_ZERO_FUNCTION:	
  1881                           ;========================================================
  1882                           ;=====================轉向馬達復位=======================
  1883                           ;========================================================
  1884                           
  1885     0231  1A3A               	btfsc	58,4
  1886     0232  0008               	return
  1887     0233  18B5               	btfsc	53,1
  1888     0234  0008               	return
  1889     0235  1435               	bsf	53,0
  1890     0236  0027               	banksel	908
  1891     0237  3001               	movlw	1
  1892     0238  00A3               	movwf	163
  1893     0239  0020               	banksel	12
  1894     023A  1231               	bcf	49,4
  1895                           
  1896                           ;-----------
  1897     023B  3021               	movlw	33
  1898     023C  0085               	movwf	5
  1899     023D  3090               	movlw	144
  1900     023E  0084               	movwf	4
  1901     023F  3007               	movlw	7
  1902     0240  0784               	addwf	4,f
  1903     0241  3004               	movlw	4
  1904     0242  0080               	movwf	0
  1905                           
  1906                           ;----------
  1907     0243  3001               	movlw	1
  1908     0244  00C2               	movwf	66
  1909     0245  0022               	banksel	270
  1910     0246  140E               	bsf	270,0
  1911                           
  1912                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1913                           ; BSF MOTOR_CONTROL_PORT,M1_FR
  1914     0247  0020               	banksel	12
  1915     0248  190D               	btfsc	13,2
  1916     0249  2A54               	goto	MOTOR_1_NOW_IS_HI	;目前是HI
  1917     024A                     MOTOR_1_NOW_IS_LO:
  1918                           
  1919                           ;目前是LO
  1920     024A  0020               	banksel	12
  1921     024B  16B1               	bsf	49,5
  1922     024C  1331               	bcf	49,6
  1923     024D  14BA               	bsf	58,1
  1924     024E  01C6               	clrf	70
  1925     024F  01C7               	clrf	71
  1926     0250  01D0               	clrf	80
  1927     0251  01D1               	clrf	81
  1928     0252  01D3               	clrf	83
  1929     0253  0008               	return
  1930     0254                     MOTOR_1_NOW_IS_HI:
  1931     0254  0020               	banksel	12
  1932     0255  1731               	bsf	49,6
  1933     0256  12B1               	bcf	49,5
  1934     0257  14BA               	bsf	58,1
  1935     0258  01C6               	clrf	70
  1936     0259  01C7               	clrf	71
  1937     025A  01D0               	clrf	80
  1938     025B  01D1               	clrf	81
  1939     025C  01D3               	clrf	83
  1940     025D  0008               	return
  1941     025E                     MOTOR_2_ZERO_FUNCTION:	
  1942                           ;========================================================
  1943                           ;=====================注射馬達復位進行中=================
  1944                           ;========================================================
  1945                           
  1946     025E  1A3A               	btfsc	58,4
  1947     025F  0008               	return
  1948     0260  18B6               	btfsc	54,1
  1949     0261  0008               	return
  1950     0262  1232               	bcf	50,4
  1951     0263  1C10               	btfss	16,0
  1952     0264  0008               	return
  1953     0265  0027               	banksel	908
  1954     0266  3001               	movlw	1
  1955     0267  00A3               	movwf	163
  1956     0268  0020               	banksel	12
  1957     0269  1436               	bsf	54,0
  1958                           
  1959                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1960                           ; MOVWF FSR0H
  1961                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1962                           ; MOVWF FSR0L
  1963                           ; MOVLW 0X15
  1964                           ; ADDWF FSR0L,F
  1965                           ; MOVLW 0X0F
  1966                           ; ADDWF FSR0L,F
  1967                           ; MOVLW 0X00
  1968                           ; MOVWF INDF0
  1969                           ;------------------------------------
  1970     026A  3021               	movlw	33
  1971     026B  0085               	movwf	5
  1972     026C  3090               	movlw	144
  1973     026D  0084               	movwf	4
  1974     026E  3015               	movlw	21
  1975     026F  0784               	addwf	4,f
  1976     0270  3007               	movlw	7
  1977     0271  0784               	addwf	4,f
  1978     0272  3001               	movlw	1
  1979     0273  0080               	movwf	0
  1980     0274  0022               	banksel	270
  1981     0275  118E               	bcf	270,3
  1982     0276  150E               	bsf	270,2
  1983     0277  0020               	banksel	12
  1984     0278  16B2               	bsf	50,5
  1985     0279  0008               	return
  1986     027A                     MODBUS_ERROR_CODE_01_LOOP:	
  1987                           ;========================================================
  1988                           ;===============MODBUS ERROR CODE IS 01==================
  1989                           ;========================================================
  1990                           
  1991     027A  103B               	bcf	59,0
  1992     027B  3020               	movlw	32
  1993     027C  0087               	movwf	7
  1994     027D  30B0               	movlw	176
  1995     027E  0086               	movwf	6
  1996     027F  300A               	movlw	10
  1997     0280  0786               	addwf	6,f
  1998                           
  1999                           ;---------------------
  2000     0281  0A86               	incf	6,f
  2001     0282  3080               	movlw	128
  2002     0283  0481               	iorwf	1,f
  2003     0284  0A86               	incf	6,f
  2004     0285  3001               	movlw	1
  2005     0286  0081               	movwf	1
  2006     0287                     MODBUS_ERROR_CODE_END:	
  2007                           ;--------------------
  2008                           
  2009     0287  3003               	movlw	3
  2010     0288  00AA               	movwf	42
  2011     0289  2104               	call	MODBUS_RTU_READ_LV2
  2012     028A  3005               	movlw	5
  2013     028B  00AD               	movwf	45
  2014     028C  1430               	bsf	48,0
  2015     028D  0008               	return
  2016     028E                     MODBUS_ERROR_CODE_02_LOOP:	
  2017                           ;========================================================
  2018                           ;===============MODBUS ERROR CODE IS 02==================
  2019                           ;========================================================
  2020                           
  2021     028E  10BB               	bcf	59,1
  2022     028F  3020               	movlw	32
  2023     0290  0087               	movwf	7
  2024     0291  30B0               	movlw	176
  2025     0292  0086               	movwf	6
  2026     0293  300A               	movlw	10
  2027     0294  0786               	addwf	6,f
  2028                           
  2029                           ;---------------------
  2030     0295  0A86               	incf	6,f
  2031     0296  3080               	movlw	128
  2032     0297  0481               	iorwf	1,f
  2033     0298  0A86               	incf	6,f
  2034     0299  3002               	movlw	2
  2035     029A  0081               	movwf	1
  2036                           
  2037                           ;--------------------
  2038     029B  2A87               	goto	MODBUS_ERROR_CODE_END
  2039     029C                     MODBUS_ERROR_CODE_03_LOOP:	
  2040                           ;========================================================
  2041                           ;===============MODBUS ERROR CODE IS 03==================
  2042                           ;========================================================
  2043                           
  2044     029C  113B               	bcf	59,2
  2045     029D  3020               	movlw	32
  2046     029E  0087               	movwf	7
  2047     029F  30B0               	movlw	176
  2048     02A0  0086               	movwf	6
  2049     02A1  300A               	movlw	10
  2050     02A2  0786               	addwf	6,f
  2051                           
  2052                           ;---------------------
  2053     02A3  0A86               	incf	6,f
  2054     02A4  3080               	movlw	128
  2055     02A5  0481               	iorwf	1,f
  2056     02A6  0A86               	incf	6,f
  2057     02A7  3003               	movlw	3
  2058     02A8  0081               	movwf	1
  2059                           
  2060                           ;--------------------
  2061     02A9  2A87               	goto	MODBUS_ERROR_CODE_END
  2062     02AA                     MODBUS_ERROR_CODE_04_LOOP:	
  2063                           ;========================================================
  2064                           ;===============MODBUS ERROR CODE IS 04==================
  2065                           ;========================================================
  2066                           
  2067     02AA  11BB               	bcf	59,3
  2068     02AB  3020               	movlw	32
  2069     02AC  0087               	movwf	7
  2070     02AD  30B0               	movlw	176
  2071     02AE  0086               	movwf	6
  2072     02AF  300A               	movlw	10
  2073     02B0  0786               	addwf	6,f
  2074                           
  2075                           ;---------------------
  2076     02B1  0A86               	incf	6,f
  2077     02B2  3080               	movlw	128
  2078     02B3  0481               	iorwf	1,f
  2079     02B4  0A86               	incf	6,f
  2080     02B5  3004               	movlw	4
  2081     02B6  0081               	movwf	1
  2082                           
  2083                           ;--------------------
  2084     02B7  2A87               	goto	MODBUS_ERROR_CODE_END
  2085     02B8                     MODBUS_ERROR_CODE_05_LOOP:	
  2086                           ;========================================================
  2087                           ;===============MODBUS ERROR CODE IS 05==================
  2088                           ;========================================================
  2089                           
  2090     02B8  123B               	bcf	59,4
  2091     02B9  3020               	movlw	32
  2092     02BA  0087               	movwf	7
  2093     02BB  30B0               	movlw	176
  2094     02BC  0086               	movwf	6
  2095     02BD  300A               	movlw	10
  2096     02BE  0786               	addwf	6,f
  2097                           
  2098                           ;---------------------
  2099     02BF  0A86               	incf	6,f
  2100     02C0  3080               	movlw	128
  2101     02C1  0481               	iorwf	1,f
  2102     02C2  0A86               	incf	6,f
  2103     02C3  3005               	movlw	5
  2104     02C4  0081               	movwf	1
  2105                           
  2106                           ;--------------------
  2107     02C5  2A87               	goto	MODBUS_ERROR_CODE_END
  2108     02C6                     MODBUS_ERROR_CODE_06_LOOP:	
  2109                           ;========================================================
  2110                           ;===============MODBUS ERROR CODE IS 06==================
  2111                           ;========================================================
  2112                           
  2113     02C6  12BB               	bcf	59,5
  2114     02C7  3020               	movlw	32
  2115     02C8  0087               	movwf	7
  2116     02C9  30B0               	movlw	176
  2117     02CA  0086               	movwf	6
  2118     02CB  300A               	movlw	10
  2119     02CC  0786               	addwf	6,f
  2120                           
  2121                           ;---------------------
  2122     02CD  0A86               	incf	6,f
  2123     02CE  3080               	movlw	128
  2124     02CF  0481               	iorwf	1,f
  2125     02D0  0A86               	incf	6,f
  2126     02D1  3006               	movlw	6
  2127     02D2  0081               	movwf	1
  2128                           
  2129                           ;--------------------
  2130     02D3  2A87               	goto	MODBUS_ERROR_CODE_END
  2131     02D4                     MODULE_WORK_LOOP:	
  2132                           ;********************************************************************************
  2133                           ;********************************************************************************
  2134                           ;========================================================
  2135                           ;================執行MODULE動作副程式====================
  2136                           ;========================================================
  2137                           
  2138     02D4  1A3A               	btfsc	58,4
  2139     02D5  0008               	return
  2140                           
  2141                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_EN
  2142                           ; CALL MOTOR_1_WORKING_LOOP
  2143 ;;-----
  2144                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_EN
  2145                           ; CALL MOTOR_2_WORKING_LOOP
  2146                           ;-----
  2147                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2148                           ; CALL MOTOR_1_WORKING_LOOP
  2149 ;;-----
  2150                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2151                           ; CALL MOTOR_1_WORKING_LOOP
  2152                           ;-----
  2153     02D6  0008               	return
  2154     02D7                     MOTOR_1_WORKING_LOOP:	
  2155                           ;========================================================
  2156                           ;================馬達1動作副程式=========================
  2157                           ;========================================================
  2158                           
  2159                           
  2160                           ;BTFSC MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  2161                           ;RETURN
  2162     02D7  1CB1               	btfss	49,1
  2163     02D8  0008               	return
  2164                           
  2165                           ;BSF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  2166     02D9  0027               	banksel	908
  2167     02DA  3001               	movlw	1
  2168     02DB  00A3               	movwf	163
  2169     02DC  0020               	banksel	12
  2170     02DD  0008               	return
  2171     02DE  1931               	btfsc	49,2
  2172     02DF  2B1E               	goto	MOTOR_1_WORK_CW_LV1
  2173     02E0  19B1               	btfsc	49,3
  2174     02E1  2B87               	goto	MOTOR_1_WORK_CCW_LV1
  2175                           
  2176                           ;----------------------------------
  2177     02E2  3021               	movlw	33
  2178     02E3  0085               	movwf	5
  2179     02E4  3090               	movlw	144
  2180     02E5  0084               	movwf	4
  2181     02E6  0800               	movf	0,w
  2182     02E7  1D03               	btfss	3,2
  2183     02E8  2B07               	goto	MOTOR_1_WORK_CW_LOOP
  2184                           
  2185                           ;-------------
  2186     02E9  0A84               	incf	4,f
  2187     02EA  0800               	movf	0,w
  2188     02EB  1D03               	btfss	3,2
  2189     02EC  2B07               	goto	MOTOR_1_WORK_CW_LOOP
  2190                           
  2191                           ;-------------
  2192     02ED  0A84               	incf	4,f
  2193     02EE  0800               	movf	0,w
  2194     02EF  1D03               	btfss	3,2
  2195     02F0  2B71               	goto	MOTOR_1_WORK_CCW_LOOP
  2196                           
  2197                           ;-------------
  2198     02F1  0A84               	incf	4,f
  2199     02F2  0800               	movf	0,w
  2200     02F3  1D03               	btfss	3,2
  2201     02F4  2B71               	goto	MOTOR_1_WORK_CCW_LOOP
  2202     02F5                     RESET_END_IN_NORMAL_LOOP:	
  2203                           ;-------------
  2204                           
  2205     02F5  10B1               	bcf	49,1
  2206     02F6  10BA               	bcf	58,1
  2207     02F7  01C6               	clrf	70
  2208     02F8  01C7               	clrf	71
  2209     02F9  3021               	movlw	33
  2210     02FA  0085               	movwf	5
  2211     02FB  3090               	movlw	144
  2212     02FC  0084               	movwf	4
  2213     02FD  3007               	movlw	7	;CMD 0X13詢問目前MOTOR1狀態
  2214     02FE  0784               	addwf	4,f
  2215     02FF  3000               	movlw	0
  2216     0300  0080               	movwf	0
  2217     0301  10B5               	bcf	53,1
  2218     0302  0027               	banksel	908
  2219     0303  3000               	movlw	0
  2220     0304  00A3               	movwf	163
  2221     0305  0020               	banksel	12
  2222                           
  2223                           ;----------
  2224     0306  0008               	return
  2225     0307                     MOTOR_1_WORK_CW_LOOP:	
  2226                           ;========================================================
  2227                           ;================馬達1順時針副程式=======================
  2228                           ;========================================================
  2229                           
  2230     0307  0020               	banksel	13
  2231     0308  1D0D               	btfss	13,2
  2232     0309  0008               	return
  2233     030A  0022               	banksel	270
  2234     030B  140E               	bsf	270,0
  2235     030C  108E               	bcf	270,1
  2236     030D  0020               	banksel	12
  2237     030E  3021               	movlw	33
  2238     030F  0085               	movwf	5
  2239     0310  3090               	movlw	144
  2240     0311  0084               	movwf	4
  2241     0312  3007               	movlw	7
  2242     0313  0784               	addwf	4,f
  2243     0314  3001               	movlw	1
  2244     0315  0080               	movwf	0
  2245                           
  2246                           ;----------
  2247     0316  01C0               	clrf	64
  2248     0317  1531               	bsf	49,2
  2249     0318  14BA               	bsf	58,1
  2250     0319  01C6               	clrf	70
  2251     031A  01C7               	clrf	71
  2252     031B  190D               	btfsc	13,2
  2253     031C  2B56               	goto	MOTOR_1_CW_IOC_SET_HI
  2254     031D  11BA               	bcf	58,3
  2255     031E                     MOTOR_1_WORK_CW_LV1:	
  2256                           ;BTFSC PORTB,0X02
  2257                           ;GOTO MOTOR_1_CW_IOC_SET_HI
  2258                           ;BANKSEL IOCBN
  2259                           ; BCF IOCBN,0X02
  2260                           ; BSF IOCBP,0X02
  2261                           ;BANKSEL PORTA
  2262                           
  2263     031E  3021               	movlw	33
  2264     031F  0085               	movwf	5
  2265     0320  3090               	movlw	144
  2266     0321  0084               	movwf	4
  2267                           
  2268                           ;----------------------------------
  2269     0322  0800               	movf	0,w
  2270     0323  1D03               	btfss	3,2
  2271     0324  2B2A               	goto	MOTOR_1_WORK_CW_LV3
  2272     0325  0A84               	incf	4,f
  2273     0326  0800               	movf	0,w
  2274     0327  1D03               	btfss	3,2
  2275     0328  2B2A               	goto	MOTOR_1_WORK_CW_LV3
  2276     0329  2B3A               	goto	MOTOR_1_WORK_CW_FINISH
  2277     032A                     MOTOR_1_WORK_CW_LV3:
  2278                           
  2279                           ;BANKSEL PORTF
  2280                           ;BSF PORTF,0X01
  2281                           ;BCF PORTF,0X01
  2282                           ;BANKSEL PORTA
  2283                           ; MOVF PWM_1_COUNT_DAT,W
  2284                           ; BTFSC STATUS,Z
  2285                           ; RETURN
  2286     032A  1DBA               	btfss	58,3
  2287     032B  2B67               	goto	CHECK_IOC_IS_LO
  2288     032C  2B58               	goto	CHECK_IOC_IS_HI
  2289     032D                     MOTOR_1_WORK_CW_LV4:
  2290                           
  2291                           ;BANKSEL PORTF
  2292                           ;BSF PORTF,0X01
  2293                           ;BCF PORTF,0X01
  2294     032D  0020               	banksel	12
  2295     032E  01C0               	clrf	64
  2296     032F  3021               	movlw	33
  2297     0330  0085               	movwf	5
  2298     0331  3090               	movlw	144
  2299     0332  0084               	movwf	4
  2300                           
  2301                           ;----------------------------------
  2302     0333  0800               	movf	0,w
  2303     0334  1D03               	btfss	3,2
  2304     0335  2B3F               	goto	MOTOR_1_WORK_CW_LV2
  2305     0336  0A84               	incf	4,f
  2306     0337  0800               	movf	0,w
  2307     0338  1D03               	btfss	3,2
  2308     0339  2B3F               	goto	MOTOR_1_WORK_CW_LV2
  2309     033A                     MOTOR_1_WORK_CW_FINISH:
  2310                           
  2311                           ;BANKSEL PORTF
  2312                           ;BSF PORTF,0X00
  2313                           ;BCF PORTF,0X00
  2314                           ;BANKSEL PORTA
  2315     033A  0022               	banksel	270
  2316     033B  100E               	bcf	270,0
  2317     033C  0020               	banksel	12
  2318     033D  1131               	bcf	49,2
  2319     033E  0008               	return
  2320     033F                     MOTOR_1_WORK_CW_LV2:
  2321     033F  0020               	banksel	12
  2322     0340  3021               	movlw	33
  2323     0341  0085               	movwf	5
  2324     0342  3090               	movlw	144
  2325     0343  0084               	movwf	4
  2326     0344  0A84               	incf	4,f
  2327     0345  3001               	movlw	1
  2328     0346  0280               	subwf	0,f
  2329     0347  0384               	decf	4,f
  2330     0348  3000               	movlw	0
  2331     0349  3B80               	subwfb	0,f
  2332                           
  2333                           ;----------------------------------------------------------
  2334     034A  3021               	movlw	33
  2335     034B  0085               	movwf	5
  2336     034C  3090               	movlw	144
  2337     034D  0084               	movwf	4
  2338     034E  3005               	movlw	5
  2339     034F  0784               	addwf	4,f
  2340     0350  3001               	movlw	1
  2341     0351  0780               	addwf	0,f
  2342     0352  0384               	decf	4,f
  2343     0353  3000               	movlw	0
  2344     0354  3D80               	addwfc	0,f
  2345     0355  0008               	return
  2346     0356                     MOTOR_1_CW_IOC_SET_HI:	
  2347                           ;----------------------------------------------------------
  2348                           
  2349     0356  15BA               	bsf	58,3
  2350     0357  2B1E               	goto	MOTOR_1_WORK_CW_LV1
  2351     0358                     CHECK_IOC_IS_HI:
  2352     0358  190D               	btfsc	13,2
  2353     0359  0008               	return
  2354     035A  0846               	movf	70,w
  2355     035B  1D03               	btfss	3,2
  2356     035C  2B62               	goto	MOTOR_1_WORK_CW_LV5
  2357                           
  2358                           ;------
  2359     035D  30FE               	movlw	254
  2360     035E  0747               	addwf	71,w
  2361     035F  1C03               	btfss	3,0
  2362     0360  0008               	return
  2363     0361  2B62               	goto	MOTOR_1_WORK_CW_LV5
  2364     0362                     MOTOR_1_WORK_CW_LV5:
  2365                           
  2366                           ;BANKSEL PORTF
  2367                           ;BSF PORTF,0X00
  2368                           ;BCF PORTF,0X00
  2369     0362  0020               	banksel	12
  2370     0363  01C6               	clrf	70
  2371     0364  01C7               	clrf	71
  2372     0365  11BA               	bcf	58,3
  2373     0366  0008               	return
  2374     0367                     CHECK_IOC_IS_LO:	
  2375                           ;-----------------------------------------------
  2376                           
  2377     0367  1D0D               	btfss	13,2
  2378     0368  0008               	return
  2379     0369  0846               	movf	70,w
  2380     036A  1D03               	btfss	3,2
  2381     036B  2B2D               	goto	MOTOR_1_WORK_CW_LV4
  2382                           
  2383                           ;------
  2384     036C  30FE               	movlw	254
  2385     036D  0747               	addwf	71,w
  2386     036E  1C03               	btfss	3,0
  2387     036F  0008               	return
  2388     0370  2B2D               	goto	MOTOR_1_WORK_CW_LV4
  2389     0371                     MOTOR_1_WORK_CCW_LOOP:	
  2390                           ;========================================================
  2391                           ;================馬達1逆時針副程式=======================
  2392                           ;========================================================
  2393                           
  2394     0371  0022               	banksel	270
  2395     0372  140E               	bsf	270,0
  2396     0373  148E               	bsf	270,1
  2397     0374  0020               	banksel	12
  2398     0375  3021               	movlw	33
  2399     0376  0085               	movwf	5
  2400     0377  3090               	movlw	144
  2401     0378  0084               	movwf	4
  2402     0379  3007               	movlw	7
  2403     037A  0784               	addwf	4,f
  2404     037B  3001               	movlw	1
  2405     037C  0080               	movwf	0
  2406                           
  2407                           ;----------
  2408     037D  1D0D               	btfss	13,2
  2409     037E  0008               	return
  2410     037F  01C0               	clrf	64
  2411     0380  15B1               	bsf	49,3
  2412     0381  14BA               	bsf	58,1
  2413     0382  01C6               	clrf	70
  2414     0383  01C7               	clrf	71
  2415     0384  190D               	btfsc	13,2
  2416     0385  2BC3               	goto	MOTOR_1_CCW_IOC_SET_HI
  2417     0386  11BA               	bcf	58,3
  2418     0387                     MOTOR_1_WORK_CCW_LV1:
  2419     0387  3021               	movlw	33
  2420     0388  0085               	movwf	5
  2421     0389  3090               	movlw	144
  2422     038A  0084               	movwf	4
  2423     038B  3002               	movlw	2
  2424     038C  0784               	addwf	4,f
  2425                           
  2426                           ;----------------------------------
  2427     038D  0800               	movf	0,w
  2428     038E  1D03               	btfss	3,2
  2429     038F  2B95               	goto	MOTOR_1_WORK_CCW_LV3
  2430     0390  0A84               	incf	4,f
  2431     0391  0800               	movf	0,w
  2432     0392  1D03               	btfss	3,2
  2433     0393  2B95               	goto	MOTOR_1_WORK_CCW_LV3
  2434     0394  2BA6               	goto	MOTOR_1_WORK_CCW_FINISH
  2435     0395                     MOTOR_1_WORK_CCW_LV3:	
  2436                           ;----------------------------------
  2437                           
  2438                           
  2439                           ; MOVF PWM_1_COUNT_DAT,W
  2440                           ; BTFSC STATUS,Z
  2441                           ; RETURN
  2442     0395  1DBA               	btfss	58,3
  2443     0396  2BD1               	goto	CHECKC_IOC_IS_LO
  2444     0397  2BC5               	goto	CHECKC_IOC_IS_HI
  2445     0398                     MOTOR_1_WORK_CCW_LV4:
  2446     0398  01C0               	clrf	64
  2447     0399  3021               	movlw	33
  2448     039A  0085               	movwf	5
  2449     039B  3090               	movlw	144
  2450     039C  0084               	movwf	4
  2451     039D  3002               	movlw	2
  2452     039E  0784               	addwf	4,f
  2453                           
  2454                           ;----------------------------------
  2455     039F  0800               	movf	0,w
  2456     03A0  1D03               	btfss	3,2
  2457     03A1  2BAB               	goto	MOTOR_1_WORK_CCW_LV2
  2458     03A2  0A84               	incf	4,f
  2459     03A3  0800               	movf	0,w
  2460     03A4  1D03               	btfss	3,2
  2461     03A5  2BAB               	goto	MOTOR_1_WORK_CCW_LV2
  2462     03A6                     MOTOR_1_WORK_CCW_FINISH:
  2463     03A6  0022               	banksel	270
  2464     03A7  100E               	bcf	270,0
  2465     03A8  0020               	banksel	12
  2466     03A9  11B1               	bcf	49,3
  2467     03AA  0008               	return
  2468     03AB                     MOTOR_1_WORK_CCW_LV2:
  2469     03AB  0020               	banksel	12
  2470     03AC  3021               	movlw	33
  2471     03AD  0085               	movwf	5
  2472     03AE  3090               	movlw	144
  2473     03AF  0084               	movwf	4
  2474     03B0  3003               	movlw	3
  2475     03B1  0784               	addwf	4,f
  2476     03B2  3001               	movlw	1
  2477     03B3  0280               	subwf	0,f
  2478     03B4  0384               	decf	4,f
  2479     03B5  3000               	movlw	0
  2480     03B6  3B80               	subwfb	0,f
  2481                           
  2482                           ;----------------------------------------------
  2483     03B7  3021               	movlw	33
  2484     03B8  0085               	movwf	5
  2485     03B9  3090               	movlw	144
  2486     03BA  0084               	movwf	4
  2487     03BB  3005               	movlw	5
  2488     03BC  0784               	addwf	4,f
  2489     03BD  3001               	movlw	1
  2490     03BE  0280               	subwf	0,f
  2491     03BF  0384               	decf	4,f
  2492     03C0  3000               	movlw	0
  2493     03C1  3B80               	subwfb	0,f
  2494     03C2  0008               	return
  2495     03C3                     MOTOR_1_CCW_IOC_SET_HI:
  2496     03C3  15BA               	bsf	58,3
  2497     03C4  2B87               	goto	MOTOR_1_WORK_CCW_LV1
  2498     03C5                     CHECKC_IOC_IS_HI:
  2499     03C5  190D               	btfsc	13,2
  2500     03C6  0008               	return
  2501     03C7  0846               	movf	70,w
  2502     03C8  1D03               	btfss	3,2
  2503     03C9  2BCF               	goto	MOTOR_1_WORK_CCW_LV5
  2504                           
  2505                           ;------
  2506     03CA  30FE               	movlw	254
  2507     03CB  0747               	addwf	71,w
  2508     03CC  1C03               	btfss	3,0
  2509     03CD  0008               	return
  2510     03CE  2BCF               	goto	MOTOR_1_WORK_CCW_LV5
  2511     03CF                     MOTOR_1_WORK_CCW_LV5:
  2512     03CF  11BA               	bcf	58,3
  2513     03D0  0008               	return
  2514     03D1                     CHECKC_IOC_IS_LO:
  2515     03D1  1D0D               	btfss	13,2
  2516     03D2  0008               	return
  2517     03D3  0846               	movf	70,w
  2518     03D4  1D03               	btfss	3,2
  2519     03D5  2B98               	goto	MOTOR_1_WORK_CCW_LV4
  2520                           
  2521                           ;------
  2522     03D6  30FE               	movlw	254
  2523     03D7  0747               	addwf	71,w
  2524     03D8  1C03               	btfss	3,0
  2525     03D9  0008               	return
  2526     03DA  2B98               	goto	MOTOR_1_WORK_CCW_LV4
  2527     03DB                     MOTOR_2_WORKING_LOOP:	
  2528                           ;========================================================
  2529                           ;================馬達2動作副程式=========================
  2530                           ;========================================================
  2531                           
  2532     03DB  1836               	btfsc	54,0
  2533     03DC  0008               	return
  2534     03DD  1CB2               	btfss	50,1
  2535     03DE  0008               	return
  2536     03DF  0027               	banksel	908
  2537     03E0  3001               	movlw	1
  2538     03E1  00A3               	movwf	163
  2539     03E2  0020               	banksel	12
  2540     03E3  14B6               	bsf	54,1
  2541     03E4  1932               	btfsc	50,2
  2542     03E5  2C1F               	goto	MOTOR_2_WORK_CW_LV1
  2543     03E6  19B2               	btfsc	50,3
  2544     03E7  2C6A               	goto	MOTOR_2_WORK_CCW_LV1
  2545                           
  2546                           ;----------------------------------
  2547     03E8  3021               	movlw	33
  2548     03E9  0085               	movwf	5
  2549     03EA  3090               	movlw	144
  2550     03EB  0084               	movwf	4
  2551     03EC  3015               	movlw	21
  2552     03ED  0784               	addwf	4,f
  2553                           
  2554                           ;----------
  2555     03EE  0800               	movf	0,w
  2556     03EF  1D03               	btfss	3,2
  2557     03F0  2C0F               	goto	MOTOR_2_WORK_CW_LOOP
  2558                           
  2559                           ;-------------
  2560     03F1  0A84               	incf	4,f
  2561     03F2  0800               	movf	0,w
  2562     03F3  1D03               	btfss	3,2
  2563     03F4  2C0F               	goto	MOTOR_2_WORK_CW_LOOP
  2564                           
  2565                           ;-------------
  2566     03F5  0A84               	incf	4,f
  2567     03F6  0800               	movf	0,w
  2568     03F7  1D03               	btfss	3,2
  2569     03F8  2C5A               	goto	MOTOR_2_WORK_CCW_LOOP
  2570                           
  2571                           ;-------------
  2572     03F9  0A84               	incf	4,f
  2573     03FA  0800               	movf	0,w
  2574     03FB  1D03               	btfss	3,2
  2575     03FC  2C5A               	goto	MOTOR_2_WORK_CCW_LOOP
  2576     03FD                     MOTOR_2_IOC_STOP_LOOP:	
  2577                           ;-------------
  2578                           
  2579     03FD  0020               	banksel	12
  2580     03FE  10B2               	bcf	50,1
  2581     03FF  3021               	movlw	33
  2582     0400  0085               	movwf	5
  2583     0401  3090               	movlw	144
  2584     0402  0084               	movwf	4
  2585     0403  3015               	movlw	21
  2586     0404  0784               	addwf	4,f
  2587     0405  3007               	movlw	7
  2588     0406  0784               	addwf	4,f
  2589     0407  3000               	movlw	0
  2590     0408  0080               	movwf	0
  2591                           
  2592                           ;----------
  2593     0409  10B6               	bcf	54,1
  2594     040A  0027               	banksel	908
  2595     040B  3000               	movlw	0
  2596     040C  00A3               	movwf	163
  2597     040D  0020               	banksel	12
  2598     040E  0008               	return
  2599     040F                     MOTOR_2_WORK_CW_LOOP:	
  2600                           ;========================================================
  2601                           ;================馬達2順時針副程式=======================
  2602                           ;========================================================
  2603                           
  2604     040F  0022               	banksel	270
  2605     0410  150E               	bsf	270,2
  2606     0411  118E               	bcf	270,3
  2607     0412  0020               	banksel	12
  2608     0413  3021               	movlw	33
  2609     0414  0085               	movwf	5
  2610     0415  3090               	movlw	144
  2611     0416  0084               	movwf	4
  2612     0417  3015               	movlw	21
  2613     0418  0784               	addwf	4,f
  2614     0419  3007               	movlw	7
  2615     041A  0784               	addwf	4,f
  2616     041B  3001               	movlw	1	;MOTOR 2 IS WORKING
  2617     041C  0080               	movwf	0
  2618                           
  2619                           ;----------
  2620     041D  01C1               	clrf	65
  2621     041E  1532               	bsf	50,2
  2622     041F                     MOTOR_2_WORK_CW_LV1:
  2623     041F  1C10               	btfss	16,0
  2624     0420  2C32               	goto	MOTOR_2_WORK_CW_FINISH
  2625     0421  0841               	movf	65,w
  2626     0422  1903               	btfsc	3,2
  2627     0423  0008               	return
  2628     0424  01C1               	clrf	65
  2629     0425  3021               	movlw	33
  2630     0426  0085               	movwf	5
  2631     0427  3090               	movlw	144
  2632     0428  0084               	movwf	4
  2633     0429  3015               	movlw	21
  2634     042A  0784               	addwf	4,f
  2635                           
  2636                           ;----------------------------------
  2637     042B  0800               	movf	0,w
  2638     042C  1D03               	btfss	3,2
  2639     042D  2C40               	goto	MOTOR_2_WORK_CW_LV2
  2640     042E  0A84               	incf	4,f
  2641     042F  0800               	movf	0,w
  2642     0430  1D03               	btfss	3,2
  2643     0431  2C40               	goto	MOTOR_2_WORK_CW_LV2
  2644     0432                     MOTOR_2_WORK_CW_FINISH:
  2645     0432  3021               	movlw	33
  2646     0433  0085               	movwf	5
  2647     0434  3090               	movlw	144
  2648     0435  0084               	movwf	4
  2649     0436  3015               	movlw	21
  2650     0437  0784               	addwf	4,f
  2651                           
  2652                           ;----------
  2653     0438  0180               	clrf	0
  2654     0439  0A84               	incf	4,f
  2655     043A  0180               	clrf	0
  2656                           
  2657                           ;-------------------------------
  2658     043B  0022               	banksel	270
  2659     043C  110E               	bcf	270,2
  2660     043D  0020               	banksel	12
  2661     043E  1132               	bcf	50,2
  2662     043F  0008               	return
  2663     0440                     MOTOR_2_WORK_CW_LV2:
  2664     0440  3021               	movlw	33
  2665     0441  0085               	movwf	5
  2666     0442  3090               	movlw	144
  2667     0443  0084               	movwf	4
  2668     0444  3015               	movlw	21
  2669     0445  0784               	addwf	4,f
  2670                           
  2671                           ;------------
  2672     0446  0A84               	incf	4,f
  2673     0447  3001               	movlw	1
  2674     0448  0280               	subwf	0,f
  2675     0449  0384               	decf	4,f
  2676     044A  3000               	movlw	0
  2677     044B  3B80               	subwfb	0,f
  2678                           
  2679                           ;------------------
  2680     044C  3021               	movlw	33
  2681     044D  0085               	movwf	5
  2682     044E  3090               	movlw	144
  2683     044F  0084               	movwf	4
  2684     0450  3015               	movlw	21
  2685     0451  0784               	addwf	4,f
  2686     0452  3005               	movlw	5
  2687     0453  0784               	addwf	4,f
  2688     0454  3001               	movlw	1
  2689     0455  0280               	subwf	0,f
  2690     0456  0384               	decf	4,f
  2691     0457  3000               	movlw	0
  2692     0458  3B80               	subwfb	0,f
  2693     0459  0008               	return
  2694     045A                     MOTOR_2_WORK_CCW_LOOP:	
  2695                           ;========================================================
  2696                           ;================馬達2逆時針副程式=======================
  2697                           ;========================================================
  2698                           
  2699     045A  0022               	banksel	270
  2700     045B  150E               	bsf	270,2
  2701     045C  158E               	bsf	270,3
  2702     045D  0020               	banksel	12
  2703     045E  3021               	movlw	33
  2704     045F  0085               	movwf	5
  2705     0460  3090               	movlw	144
  2706     0461  0084               	movwf	4
  2707     0462  3015               	movlw	21
  2708     0463  0784               	addwf	4,f
  2709     0464  3007               	movlw	7
  2710     0465  0784               	addwf	4,f
  2711     0466  3001               	movlw	1	;馬達正在運作中
  2712     0467  0080               	movwf	0
  2713                           
  2714                           ;----------
  2715     0468  01C1               	clrf	65
  2716     0469  15B2               	bsf	50,3
  2717     046A                     MOTOR_2_WORK_CCW_LV1:
  2718     046A  0841               	movf	65,w
  2719     046B  1903               	btfsc	3,2
  2720     046C  0008               	return
  2721     046D  01C1               	clrf	65
  2722     046E  3021               	movlw	33
  2723     046F  0085               	movwf	5
  2724     0470  3090               	movlw	144
  2725     0471  0084               	movwf	4
  2726     0472  3015               	movlw	21
  2727     0473  0784               	addwf	4,f
  2728     0474  3002               	movlw	2
  2729     0475  0784               	addwf	4,f
  2730                           
  2731                           ;----------------------------------
  2732     0476  0800               	movf	0,w
  2733     0477  1D03               	btfss	3,2
  2734     0478  2C82               	goto	MOTOR_2_WORK_CCW_LV2
  2735     0479  0A84               	incf	4,f
  2736     047A  0800               	movf	0,w
  2737     047B  1D03               	btfss	3,2
  2738     047C  2C82               	goto	MOTOR_2_WORK_CCW_LV2
  2739     047D                     MOTOR_2_WORK_CCW_FINISH:
  2740     047D  0022               	banksel	270
  2741     047E  110E               	bcf	270,2
  2742     047F  0020               	banksel	12
  2743     0480  11B2               	bcf	50,3
  2744     0481  0008               	return
  2745     0482                     MOTOR_2_WORK_CCW_LV2:
  2746     0482  3021               	movlw	33
  2747     0483  0085               	movwf	5
  2748     0484  3090               	movlw	144
  2749     0485  0084               	movwf	4
  2750     0486  3015               	movlw	21
  2751     0487  0784               	addwf	4,f
  2752                           
  2753                           ;INCF FSR0L,F
  2754     0488  3003               	movlw	3
  2755     0489  0784               	addwf	4,f
  2756     048A  3001               	movlw	1
  2757     048B  0280               	subwf	0,f
  2758     048C  0384               	decf	4,f
  2759     048D  3000               	movlw	0
  2760     048E  3B80               	subwfb	0,f
  2761                           
  2762                           ;-------------------------
  2763     048F  3021               	movlw	33
  2764     0490  0085               	movwf	5
  2765     0491  3090               	movlw	144
  2766     0492  0084               	movwf	4
  2767     0493  3015               	movlw	21
  2768     0494  0784               	addwf	4,f
  2769     0495  3005               	movlw	5
  2770     0496  0784               	addwf	4,f
  2771     0497  3001               	movlw	1
  2772     0498  0780               	addwf	0,f
  2773     0499  0384               	decf	4,f
  2774     049A  3000               	movlw	0
  2775     049B  3D80               	addwfc	0,f
  2776     049C  0008               	return
  2777     049D                     PREPARE_TX_DATA_LOOP:	
  2778                           ;========================================================
  2779                           ;====================準備TX資料副程式====================
  2780                           ;========================================================
  2781                           
  2782     049D  2564               	call	DELAY_10ms
  2783     049E  3020               	movlw	32
  2784     049F  0087               	movwf	7
  2785     04A0  30B0               	movlw	176
  2786     04A1  0086               	movwf	6
  2787     04A2  300A               	movlw	10
  2788     04A3  0786               	addwf	6,f
  2789     04A4  0027               	banksel	909
  2790     04A5  158D               	bsf	909,3
  2791     04A6  0020               	banksel	12
  2792     04A7                     TEST_MAX485_LOOP1:	
  2793                           ;---------------------------------------------
  2794                           
  2795     04A7  0029               	banksel	1174
  2796     04A8  1C96               	btfss	1174,1
  2797     04A9  2CA7               	goto	TEST_MAX485_LOOP1
  2798     04AA  0029               	banksel	1170
  2799     04AB  0801               	movf	1,w
  2800     04AC  0092               	movwf	1170
  2801     04AD  0020               	banksel	12
  2802     04AE  0A86               	incf	6,f
  2803     04AF  0BAD               	decfsz	45,f
  2804     04B0  2CA7               	goto	TEST_MAX485_LOOP1
  2805     04B1                     TEST_MAX485_LOOP1_LV1:
  2806     04B1  0029               	banksel	1174
  2807     04B2  1C96               	btfss	1174,1
  2808     04B3  2CB1               	goto	TEST_MAX485_LOOP1_LV1
  2809     04B4  0027               	banksel	909
  2810     04B5  118D               	bcf	909,3
  2811     04B6  0029               	banksel	1173
  2812     04B7  1615               	bsf	1173,4	;啟動UART RX功能
  2813     04B8  0020               	banksel	12
  2814     04B9  1030               	bcf	48,0
  2815     04BA  0008               	return
  2816     04BB                     ADC_TAKE_DATA_FUNCTION:	
  2817                           ;========================================================
  2818                           ;=====================ADC取資料副程式====================
  2819                           ;========================================================
  2820                           
  2821     04BB  0021               	banksel	158
  2822     04BC  3031               	movlw	49	;AN12啟動
  2823     04BD  009D               	movwf	157
  2824     04BE  30C0               	movlw	192
  2825     04BF  009E               	movwf	158
  2826     04C0  01FC               	clrf	124
  2827     04C1  01FD               	clrf	125
  2828     04C2  0020               	banksel	12
  2829     04C3  257C               	call	DELAY_100us
  2830     04C4  257C               	call	DELAY_100us
  2831     04C5  257C               	call	DELAY_100us
  2832     04C6  0021               	banksel	157
  2833                           
  2834 ;;------------------------ADC_RUN-------------------------------
  2835     04C7  149D               	bsf	157,1
  2836     04C8                     ADC_WORK:
  2837     04C8  189D               	btfsc	157,1
  2838     04C9  2CC8               	goto	ADC_WORK
  2839     04CA  0021               	banksel	156
  2840     04CB  081C               	movf	156,w
  2841     04CC  00FC               	movwf	124
  2842     04CD  081B               	movf	155,w
  2843     04CE  00FD               	movwf	125
  2844     04CF  0020               	banksel	12
  2845     04D0  0008               	return
  2846     04D1                     WATCH_SUB_FUNCTION:	
  2847                           ;========================================================
  2848                           ;====================測試用將資料送出====================OK
  2849                           ;========================================================
  2850                           ;這個部分是顯示內部資料的副程式
  2851                           
  2852     04D1  3020               	movlw	32
  2853     04D2  0085               	movwf	5
  2854     04D3  30BA               	movlw	186
  2855     04D4  0084               	movwf	4
  2856     04D5  3008               	movlw	8
  2857     04D6  00F1               	movwf	113
  2858     04D7  0800               	movf	0,w
  2859     04D8  00F2               	movwf	114
  2860     04D9                     WATCH_SUB_FUNC_LV1:
  2861     04D9  0022               	banksel	272
  2862     04DA  1310               	bcf	272,6
  2863     04DB  1BF2               	btfsc	114,7
  2864     04DC  1690               	bsf	272,5
  2865     04DD  1FF2               	btfss	114,7
  2866     04DE  1290               	bcf	272,5
  2867     04DF  1710               	bsf	272,6
  2868     04E0  0DF2               	rlf	114,f
  2869     04E1  0BF1               	decfsz	113,f
  2870     04E2  2CD9               	goto	WATCH_SUB_FUNC_LV1
  2871                           
  2872                           ;----------
  2873     04E3  3008               	movlw	8
  2874     04E4  00F1               	movwf	113
  2875     04E5  0A84               	incf	4,f
  2876     04E6  0800               	movf	0,w
  2877     04E7  00F2               	movwf	114
  2878     04E8  0BF0               	decfsz	112,f
  2879     04E9  2CD9               	goto	WATCH_SUB_FUNC_LV1
  2880     04EA  1290               	bcf	272,5
  2881     04EB  1310               	bcf	272,6
  2882     04EC  0020               	banksel	12
  2883     04ED  0008               	return
  2884     04EE                     CRC_16_FUNCTION_LOOP:	
  2885                           ;========================================================
  2886                           ;====================CRC-16運算副程式====================OK
  2887                           ;========================================================
  2888                           ;做一個BYTE大概40-50uS
  2889                           
  2890     04EE  0020               	banksel	12
  2891     04EF  0827               	movf	39,w
  2892     04F0  06A9               	xorwf	41,f
  2893                           
  2894                           ;---------
  2895     04F1  3009               	movlw	9
  2896     04F2  00A6               	movwf	38
  2897     04F3                     CRC_16_FUNCTION_LV1:
  2898     04F3  03A6               	decf	38,f
  2899     04F4  0826               	movf	38,w
  2900     04F5  1903               	btfsc	3,2
  2901     04F6  2D01               	goto	CRC_16_END_FUNCTION
  2902                           
  2903                           ;---------------------
  2904     04F7  1003               	bcf	3,0
  2905     04F8  0CA8               	rrf	40,f
  2906     04F9  0CA9               	rrf	41,f
  2907     04FA  1C03               	btfss	3,0
  2908     04FB  2CF3               	goto	CRC_16_FUNCTION_LV1
  2909                           
  2910                           ;---------------------
  2911     04FC  30A0               	movlw	160	;CRC-16運算的參數
  2912     04FD  06A8               	xorwf	40,f
  2913     04FE  3001               	movlw	1
  2914     04FF  06A9               	xorwf	41,f
  2915     0500  2CF3               	goto	CRC_16_FUNCTION_LV1
  2916     0501                     CRC_16_END_FUNCTION:
  2917     0501  0020               	banksel	12
  2918     0502  0008               	return
  2919     0503                     AAAA_1800:	
  2920                           ;=======================================================
  2921                           ;===============測試將收到的資料顯示出==================OK
  2922                           ;=======================================================
  2923                           
  2924     0503  3008               	movlw	8
  2925     0504  00F0               	movwf	112
  2926     0505                     AAAAN:
  2927     0505  0027               	banksel	908
  2928     0506  120C               	bcf	908,4
  2929                           
  2930                           ;----------------
  2931     0507  1BF1               	btfsc	113,7
  2932     0508  168C               	bsf	908,5
  2933     0509  1FF1               	btfss	113,7
  2934     050A  128C               	bcf	908,5
  2935                           
  2936                           ;----------------
  2937     050B  160C               	bsf	908,4
  2938     050C  0DF1               	rlf	113,f
  2939     050D  0BF0               	decfsz	112,f
  2940     050E  2D05               	goto	AAAAN
  2941     050F  120C               	bcf	908,4
  2942     0510  128C               	bcf	908,5
  2943     0511  0020               	banksel	12
  2944     0512  0008               	return
  2945     0513                     SET_TMR2_BASE_TIME:	
  2946                           ;=======================================================
  2947                           ;================TIMER2基礎時間設定=====================OK
  2948                           ;=======================================================
  2949                           ;TIMER2 BASE TIME IS 1mS
  2950                           
  2951     0513  0020               	banksel	28
  2952     0514  3015               	movlw	21
  2953     0515  009C               	movwf	28
  2954     0516  30A7               	movlw	167
  2955     0517  009B               	movwf	27
  2956                           
  2957                           ;---------------------
  2958     0518  3004               	movlw	4
  2959     0519  00A3               	movwf	35
  2960     051A  0020               	banksel	12
  2961     051B  0008               	return
  2962     051C                     SET_TMR2_INT_EN:	
  2963                           ;=======================================================
  2964                           ;===============TIMER2中斷參數設定======================OK
  2965                           ;=======================================================
  2966                           
  2967     051C  0021               	banksel	145
  2968     051D  1491               	bsf	145,1
  2969     051E  0020               	banksel	12
  2970     051F  0008               	return
  2971     0520                     SET_TMR2_ON:	
  2972                           ;=======================================================
  2973                           ;===================TIMER2啟動==========================OK
  2974                           ;=======================================================
  2975                           
  2976     0520  0020               	banksel	28
  2977     0521  151C               	bsf	28,2
  2978     0522  0020               	banksel	12
  2979     0523  0008               	return
  2980     0524                     CLEAN_ALL_REGISTER:	
  2981                           ;========================================================
  2982                           ;=================將REG內資料全部清空====================OK
  2983                           ;========================================================
  2984                           
  2985     0524  3020               	movlw	32
  2986     0525  0087               	movwf	7
  2987     0526  3000               	movlw	0
  2988     0527  0086               	movwf	6
  2989     0528  3003               	movlw	3
  2990     0529  00F1               	movwf	113
  2991     052A  30FF               	movlw	255
  2992     052B  00F0               	movwf	112
  2993     052C                     CLEAN_ALL_REGISTER_LOOP:
  2994     052C  0181               	clrf	1
  2995     052D  1003               	bcf	3,0
  2996     052E  3001               	movlw	1
  2997     052F  0786               	addwf	6,f
  2998     0530  3000               	movlw	0
  2999     0531  3D87               	addwfc	7,f
  3000     0532  0BF0               	decfsz	112,f
  3001     0533  2D2C               	goto	CLEAN_ALL_REGISTER_LOOP
  3002     0534  30FF               	movlw	255
  3003     0535  00F0               	movwf	112
  3004     0536  0BF1               	decfsz	113,f
  3005     0537  2D2C               	goto	CLEAN_ALL_REGISTER_LOOP
  3006     0538  0020               	banksel	12
  3007     0539  0008               	return
  3008     053A                     READ_EEPROM:	
  3009                           ;=======================================================
  3010                           ;===================== 讀EEPROM ========================OK
  3011                           ;=======================================================
  3012                           
  3013     053A  0023               	banksel	401
  3014     053B  087E               	movf	126,w
  3015     053C  0091               	movwf	401
  3016     053D  1315               	bcf	405,6	;USER EEPROM
  3017     053E  1395               	bcf	405,7	;USER EEPROM
  3018     053F  1415               	bsf	405,0	;READ_EEPROM
  3019     0540  0813               	movf	403,w
  3020     0541  00FF               	movwf	127
  3021     0542  0020               	banksel	12
  3022     0543  0008               	return
  3023     0544                     WRITE_EEPROM:	
  3024                           ;=======================================================
  3025                           ;===================== 寫EEPROM ========================OK
  3026                           ;=======================================================
  3027                           
  3028     0544  138B               	bcf	11,7
  3029     0545  0023               	banksel	401
  3030     0546  087E               	movf	126,w
  3031     0547  0091               	movwf	401	;EEPROM ADDRESS
  3032     0548  087F               	movf	127,w
  3033     0549  0093               	movwf	403	;EEPROM DATA
  3034     054A                     WRITE_EEPROM_LOOP_1:	
  3035 ;;-----------------------
  3036                           
  3037     054A  1315               	bcf	405,6	;USER EEPROM
  3038     054B  1395               	bcf	405,7	;USER EEPROM
  3039     054C  1515               	bsf	405,2	;ENABLE WRITE
  3040     054D  3055               	movlw	85	;固定程序
  3041     054E  0096               	movwf	406
  3042     054F  30AA               	movlw	170
  3043     0550  0096               	movwf	406	;固定程序
  3044                           
  3045 ;;-----------------------
  3046     0551  1495               	bsf	405,1	;RUN WRITE EEPROM
  3047     0552                     WAIT_EEPROM_WRITE_OVER:
  3048     0552  1895               	btfsc	405,1
  3049     0553  2D52               	goto	WAIT_EEPROM_WRITE_OVER
  3050     0554  0023               	banksel	405
  3051     0555  1115               	bcf	405,2	;Disable writes
  3052     0556  0020               	banksel	12
  3053     0557  178B               	bsf	11,7
  3054     0558  0008               	return
  3055     0559                     DELAY_3000ms:	
  3056                           ;========================================================
  3057                           ;======================== DELAY =========================OK
  3058                           ;========================================================
  3059                           ;DEFINE IS 8MHZ
  3060                           
  3061     0559  255B               	call	DELAY_1000ms
  3062     055A  255B               	call	DELAY_1000ms
  3063     055B                     DELAY_1000ms:
  3064     055B  255C               	call	DELAY_500ms
  3065     055C                     DELAY_500ms:
  3066     055C  2560               	call	DELAY_100ms
  3067     055D  2560               	call	DELAY_100ms
  3068     055E  2560               	call	DELAY_100ms
  3069     055F  2560               	call	DELAY_100ms
  3070     0560                     DELAY_100ms:
  3071     0560  2563               	call	DELAY_20ms
  3072     0561  2562               	call	DELAY_40ms
  3073     0562                     DELAY_40ms:
  3074     0562  2563               	call	DELAY_20ms
  3075     0563                     DELAY_20ms:
  3076     0563  2564               	call	DELAY_10ms
  3077     0564                     DELAY_10ms:
  3078     0564  2565               	call	DELAY_5ms
  3079     0565                     DELAY_5ms:
  3080     0565  2569               	call	DELAY_1ms
  3081     0566                     DELAY_4ms:
  3082     0566  2569               	call	DELAY_1ms
  3083     0567                     DELAY_3ms:
  3084     0567  2569               	call	DELAY_1ms
  3085     0568                     DELAY_2ms:
  3086     0568  2569               	call	DELAY_1ms
  3087     0569                     DELAY_1ms:
  3088     0569  3031               	movlw	49
  3089     056A  00A0               	movwf	32	;49
  3090     056B  00A1               	movwf	33	;49
  3091     056C  300A               	movlw	10
  3092     056D  00A2               	movwf	34
  3093     056E  2D6F               	goto	DELAY_LOOP_1
  3094     056F                     DELAY_LOOP_1:
  3095     056F  0000               	nop	;1
  3096     0570  0BA0               	decfsz	32,f	;2
  3097     0571  2D6F               	goto	DELAY_LOOP_1	;3,4 (0.5*4*49 = 98us)
  3098     0572  0821               	movf	33,w	;4
  3099     0573  00A0               	movwf	32	;1
  3100     0574  0BA2               	decfsz	34,f	;2
  3101     0575  2D6F               	goto	DELAY_LOOP_1	;3,4
  3102     0576  0008               	return
  3103     0577                     DELAY_600us:	
  3104                           ;==========================================
  3105                           
  3106     0577  257C               	call	DELAY_100us
  3107     0578                     DELAY_500us:
  3108     0578  257C               	call	DELAY_100us
  3109     0579                     DELAY_400us:
  3110     0579  257C               	call	DELAY_100us
  3111     057A                     DELAY_300us:
  3112     057A  257C               	call	DELAY_100us
  3113     057B                     DELAY_200us:
  3114     057B  257C               	call	DELAY_100us
  3115     057C                     DELAY_100us:
  3116     057C  2585               	call	DELAY_10us
  3117     057D                     DELAY_90us:
  3118     057D  2585               	call	DELAY_10us
  3119     057E  2585               	call	DELAY_10us
  3120     057F  2585               	call	DELAY_10us
  3121     0580                     DELAY_60us:
  3122     0580  2585               	call	DELAY_10us
  3123     0581                     DELAY_50us:
  3124     0581  2585               	call	DELAY_10us
  3125     0582                     DELAY_40us:
  3126     0582  2585               	call	DELAY_10us
  3127     0583                     DELAY_30us:
  3128     0583  2585               	call	DELAY_10us
  3129     0584                     DELAY_20us:
  3130     0584  2585               	call	DELAY_10us
  3131     0585                     DELAY_10us:
  3132     0585  0000               	nop
  3133     0586  0000               	nop
  3134     0587                     DELAY_9us:
  3135     0587  0000               	nop
  3136     0588  0000               	nop
  3137     0589                     DELAY_8us:
  3138     0589  0000               	nop
  3139     058A  0000               	nop
  3140     058B                     DELAY_7us:
  3141     058B  0000               	nop
  3142     058C  0000               	nop
  3143     058D                     DELAY_6us:
  3144     058D  0000               	nop
  3145     058E  0000               	nop
  3146     058F                     DELAY_5us:
  3147     058F  0000               	nop
  3148     0590  0000               	nop
  3149     0591                     DELAY_4us:
  3150     0591  0000               	nop
  3151     0592  0000               	nop
  3152     0593                     DELAY_3us:
  3153     0593  0000               	nop
  3154     0594  0000               	nop
  3155     0595                     DELAY_2us:
  3156     0595  0008               	return
  3157                           
  3158                           	psect	config
  3159                           
  3160                           ;Config register CONFIG1 @ 0x8007
  3161                           ;	Oscillator Selection
  3162                           ;	FOSC = INTOSC, INTOSC oscillator: I/O function on CLKIN pin
  3163                           ;	Watchdog Timer Enable
  3164                           ;	WDTE = OFF, WDT disabled
  3165                           ;	Power-up Timer Enable
  3166                           ;	PWRTE = OFF, PWRT disabled
  3167                           ;	MCLR Pin Function Select
  3168                           ;	MCLRE = OFF, MCLR/VPP pin function is digital input
  3169                           ;	Flash Program Memory Code Protection
  3170                           ;	CP = OFF, Program memory code protection is disabled
  3171                           ;	Data Memory Code Protection
  3172                           ;	CPD = OFF, Data memory code protection is disabled
  3173                           ;	Brown-out Reset Enable
  3174                           ;	BOREN = OFF, Brown-out Reset disabled
  3175                           ;	Clock Out Enable
  3176                           ;	CLKOUTEN = OFF, CLKOUT function is disabled. I/O or oscillator function on the CLKOUT pin
  3177                           ;	Internal/External Switchover
  3178                           ;	IESO = OFF, Internal/External Switchover mode is disabled
  3179                           ;	Fail-Safe Clock Monitor Enable
  3180                           ;	FCMEN = OFF, Fail-Safe Clock Monitor is disabled
  3181     8007                     	org	32775
  3182     8007  09A4               	dw	2468
  3183                           
  3184                           ;Config register CONFIG2 @ 0x8008
  3185                           ;	Flash Memory Self-Write Protection
  3186                           ;	WRT = OFF, Write protection off
  3187                           ;	Voltage Regulator Capacitor Enable
  3188                           ;	VCAPEN = OFF, VCAP pin functionality is disabled
  3189                           ;	PLL Enable
  3190                           ;	PLLEN = OFF, 4x PLL disabled
  3191                           ;	Stack Overflow/Underflow Reset Enable
  3192                           ;	STVREN = OFF, Stack Overflow or Underflow will not cause a Reset
  3193                           ;	Brown-out Reset Voltage Selection
  3194                           ;	BORV = HI, Brown-out Reset Voltage (Vbor), high trip point selected.
  3195                           ;	Low-Voltage Programming Enable
  3196                           ;	LVP = OFF, High-voltage on MCLR/VPP must be used for programming
  3197     8008                     	org	32776
  3198     8008  18FF               	dw	6399


Microchip Technology PIC Macro Assembler V2.40 build 20220703182018 
Symbol Table                                                                                               Thu Oct 05 13:54:13 2023

                            C 0000               CRC_COUNTER_TEMP 0026                              Z 0002  
                           RD 0000                             WR 0001                            GIE 0007  
                          PR2 001B                            PR4 0416              MODBUS_ERROR_FLAG 003B  
                         CFGS 0006                           CREN 0004                           LATA 010C  
                         LATB 010D                           LATC 010E                           LATD 010F  
                         LATE 0110                           LATF 038C                           LATG 038D  
                         PIE1 0091                           PIE2 0092                           PIE3 0093  
                         PIE4 0094                           INTE 0004                           INTF 0001  
                         PIR1 0011                           PIR4 0014                           M_OE 0004  
                         TRMT 0001                           WREN 0002              STRONG_STOP_TEMP1 0042  
            STRONG_STOP_TEMP2 0043            CRC_16_END_FUNCTION 0501                          AAAAN 0505  
                        BANK7 038C                          EEPGD 0007                          M1_FR 0001  
                        M2_FR 0003                          T2CON 001C                          INDF0 0000  
                        INDF1 0001                          M1_ST 0000                          M2_ST 0002  
                        RC2IE 0005                          RC2IF 0005                          T4CON 0417  
                        IOCBF 0396                          IOCBN 0395                          IOCBP 0394  
                        FSR0H 0005                          FSR1H 0007                          IOCIE 0003  
                        IOCIF 0000                          FSR0L 0004                          FSR1L 0006  
                        PORTA 000C                          PORTB 000D                          PORTC 000E  
                        PORTD 000F                          PORTE 0010                          PORTF 028C  
                        PORTG 028D                          TRISA 008C                          TRISB 008D  
                        TRISC 008E                          TRISD 008F                          TRISE 0090  
                        TRISF 030C                          TRISG 030D                          M_RST 0005  
    MODBUS_ERROR_CODE_01_LOOP 027A      MODBUS_ERROR_CODE_02_LOOP 028E      MODBUS_ERROR_CODE_03_LOOP 029C  
    MODBUS_ERROR_CODE_04_LOOP 02AA      MODBUS_ERROR_CODE_05_LOOP 02B8      MODBUS_ERROR_CODE_06_LOOP 02C6  
         CHECK_CRC16_IS_RIGHT 006E                         ADCON0 009D                         ADCON1 009E  
                       ADRESH 009C                         ADRESL 009B                         EEADRL 0191  
                       EEDATL 0193                         CCPR3L 0311                         EECON1 0195  
                       EECON2 0196                         ANSELA 018C                         ANSELE 0190  
                       ANSELF 040C                         ANSELG 040D                         RC2STA 0495  
                       INTCON 000B            MOTOR_1_WORK_CW_LV1 031E            MOTOR_1_WORK_CW_LV2 033F  
          MOTOR_1_WORK_CW_LV3 032A            MOTOR_1_WORK_CW_LV4 032D            MOTOR_1_WORK_CW_LV5 0362  
                       OSCCON 0099                         TMR2IE 0001                         TMR2IF 0001  
                       TMR2ON 0002                         TX2REG 0492                         TX2STA 0496  
                       STATUS 0003           TMR2IF_FUNCTION_LOOP 00B0               RTU_COUNTER_DATA 002A  
            MOTOR_OE_RST_PORT 010C           MOTOR_1_WORKING_LOOP 02D7               SYSTEM_START_LV1 01AC  
         MODBUS_ERROR_COUNTER 0049                PWM_1_COUNT_DAT 0040                        CCP3CON 0313  
          MOTOR_2_WORK_CW_LV1 041F            MOTOR_2_WORK_CW_LV2 0440           MOTOR_1_WORK_CCW_LV1 0387  
         MOTOR_1_WORK_CCW_LV2 03AB           MOTOR_1_WORK_CCW_LV3 0395           MOTOR_1_WORK_CCW_LV4 0398  
         MOTOR_1_WORK_CCW_LV5 03CF                PWM_2_COUNT_DAT 0041           MOTOR_1_WORK_CW_LOOP 0307  
                      OSCSTAT 009A                        TP0_PIN 0000                        OSCTUNE 0098  
          CRC_16_FUNCTION_LV1 04F3         MOTOR_2_WORK_CW_FINISH 0432                     DELAY_10ms 0564  
                   DELAY_20ms 0563                     DELAY_10us 0585                     DELAY_20us 0584  
                   DELAY_40ms 0562                     DELAY_30us 0583                     DELAY_40us 0582  
                   DELAY_50us 0581                     DELAY_60us 0580                     DELAY_90us 057D  
          MOTOR1_IN_ROAT_FLAG 0001           TEN_MS_FUNCTION_LOOP 00EA         WAIT_EEPROM_WRITE_OVER 0552  
             CAN_SEND_TX_FLAG 0000        MOTOR_1_WORK_CCW_FINISH 03A6          ROAT_MOTOR_IS_HI_FLAG 0003  
        MODBUS_DAT_EXTRA_ADRH 0020          MODBUS_DAT_EXTRA_ADRL 00B0             INTERRUPT_SUB_AREA 0006  
                   M1_ENCODER 0001          MOTOR_1_ZERO_FUNCTION 0231         SET_MODBUS_MODE_ENABLE 0D08  
                   EEPROM_ADR 007E            MOTOR1_IN_ZERO_FLAG 0000                     EEPROM_DAT 007F  
                   M2_ENCODER 0002            M1_NOT_COUNTER_TEMP 0053         MOTOR1_ZERO_IN_HI_LOOP 0213  
                   CRC_HIBYTE 0028            RC2IF_FUNCTION_LOOP 00AC                     CRC_LOBYTE 0029  
       MOTOR1_ZERO_IN_LO_LOOP 01E9           MOTOR_2_WORKING_LOOP 03DB          MODBUS_ERROR_CODE_END 0287  
            INT_INTF_FUNCTION 00FE                     ERROR_01_F 0000                     ERROR_02_F 0001  
                   ERROR_03_F 0002                     ERROR_04_F 0003                     ERROR_05_F 0004  
                   ERROR_06_F 0005     MOTOR1_ZERO_IN_HI_LOOP_LV1 0225       MODBUS_RTU_READ_CRC_LOOP 010F  
        MOTOR1_TIME_ZERO_LOOP 0228             WATCH_SUB_FUNCTION 04D1        MOTOR_2_WORK_CCW_FINISH 047D  
           WATCH_SUB_FUNC_LV1 04D9           MOTOR_2_WORK_CCW_LV1 046A           MOTOR_2_WORK_CCW_LV2 0482  
                     ADC_WORK 04C8         MODBUS_INTPUT_FUNCTION 0D1F           MOTOR_2_WORK_CW_LOOP 040F  
                     CCPTMRS0 029E                       CCPTMRS1 029F          MOTOR_1_WORK_CCW_LOOP 0371  
                 MOTOR1_FLAG0 0031                   MOTOR1_FLAG1 0035                BOOTLOADER_LOOP 0005  
                 MOTOR2_FLAG0 0032                   MOTOR2_FLAG1 0036                    ADC_HI_DATA 007C  
             MODULE_WORK_LOOP 02D4            MOTOR2_IN_ROAT_FLAG 0001                 ID_SELECT_LOOP 018B  
                   MOTOR_1_CW 0002                     MOTOR_2_CW 0002           CRC_16_FUNCTION_LOOP 04EE  
                 MOTOR_1_WORK 0001                   MOTOR_2_WORK 0001             CLEAN_ALL_REGISTER 0524  
                   WATCH_TEMP 0072                     OPTION_REG 0095            MOTOR2_IN_ZERO_FLAG 0000  
             MOTOR_1_ING_ZERO 0005                     TEN_MS_NUM 0002              STANDBY_HBYTE_DAT 004C  
             MOTOR_2_ING_ZERO 0005                 TIMER2_INT_LV1 00D4                    DELAY_100ms 0560  
                  DELAY_100us 057C                    DELAY_200us 057B                    DELAY_300us 057A  
                  DELAY_400us 0579                    DELAY_500ms 055C                    DELAY_500us 0578  
                  DELAY_600us 0577          MOTOR_1_CW_IOC_SET_HI 0356              STANDBY_LBYTE_DAT 004D  
                  DELAY_TEMP1 0020                    DELAY_TEMP2 0021                    DELAY_TEMP3 0022  
            COPY_485_DATA_LV1 0037     MOTOR1_ZERO_IN_LO_LOOP_LV1 01FB                    FLAG1_BANK0 0030  
                   PWR_DECTET 0005                    FLAG3_BANK0 003A                    FLAG5_BANK0 003C  
           MOTOR_1_IOC_FINISH 0007                  MODULE_ID_DAT 0025                  CAL_DATA_TEMP 0027  
           SET_TMR2_BASE_TIME 0513          MODBUS_TABLE_ADR_TEMP 004A      POWER_LED_OUTPUT_FUNCTION 018D  
              SET_TMR2_INT_EN 051C         MOTOR_1_CCW_IOC_SET_HI 03C3                 IOC_HW_SETTING 0186  
     MODBUS_BUS_01_ERROR_LOOP 0055                    MAX485_PORT 038D               MODBUS_DAT_COUNT 002F  
                INT_TIMER_NUM 0004          MOTOR_2_ZERO_FUNCTION 025E          M1_ZERO_COUNTER_HBYTE 0050  
        M1_ZERO_COUNTER_LBYTE 0051        ANAY_MODBUS_CMD_10_LOOP 008E        ANAY_MODBUS_CMD_03_LOOP 0089  
      ANAY_MODBUS_CMD_06_LOOP 0093       MODBUS_BUS_02_ERROR_LOOP 0057               TMR2_DIVIDER_SET 0015  
       CHECK_MOTOR2_ZERO_LOOP 01C2    ANAY_MODBUS_CMD_COMMON_LOOP 0097       MODBUS_BUS_03_ERROR_LOOP 0059  
        MOTOR_2_IOC_STOP_LOOP 03FD            TMR2IF_FUNCTION_LV0 00B7                CHECK_IOC_IS_HI 0358  
              CHECK_IOC_IS_LO 0367           RESET_IN_NORMAL_FALG 0000                      AAAA_1800 0503  
          WRITE_EEPROM_LOOP_1 054A         ADC_TAKE_DATA_FUNCTION 04BB       MODBUS_BUS_04_ERROR_LOOP 005B  
                  READ_EEPROM 053A                IOCBF1_INT_LOOP 00F8          MOTOR_2_WORK_CCW_LOOP 045A  
              IOCBF2_INT_LOOP 00FB             WATCH_DAT_BUF_ADRH 0020             WATCH_DAT_BUF_ADRL 00BA  
                    DELAY_1ms 0569                      DELAY_2ms 0568                      DELAY_3ms 0567  
                    DELAY_4ms 0566                      DELAY_5ms 0565                      DELAY_2us 0595  
                    DELAY_3us 0593                      DELAY_4us 0591                      DELAY_5us 058F  
                    DELAY_6us 058D                      DELAY_7us 058B                      DELAY_8us 0589  
                    DELAY_9us 0587       MODBUS_BUS_05_ERROR_LOOP 005D           MODBUS_DAT_REAL_ADRH 0021  
         MODBUS_DAT_REAL_ADRL 0090                 TMR2_BASE_TEMP 0023            MODBUS_RTU_READ_LV2 0104  
            TEST_MAX485_LOOP1 04A7                 MODBUS_IN_10_F 0003                 MODBUS_IN_03_F 0001  
               MODBUS_IN_06_F 0002                 ADC_HW_SETTING 016B                   WRITE_EEPROM 0544  
     MODBUS_BUS_06_ERROR_LOOP 005F         MOTOR_1_WORK_CW_FINISH 033A                   ADC_LOW_DATA 007D  
         MODBUS_DAT_WORK_ADRH 0021           MODBUS_DAT_WORK_ADRL 0040          TEST_MAX485_LOOP1_LV1 04B1  
                  MOTOR_1_CCW 0003                    MOTOR_2_CCW 0003               IOC_INT_FUNCTION 00F1  
                MOTOR_1_RESET 0004                  MOTOR_2_RESET 0004                MOTOR_1_HI_ZERO 0006  
                    TEST_PORT 038C                    WATCH_OUT_P 0110                   SYSTEM_START 01AB  
                  TEN_TIME_EN 0001                    TEN_MS_TEMP 0048                   ADR_81_L_DAT 00A3  
      CHECK_PWM_FREQ_FUCNTION 018B          POWER_LED_OUTPUT_EXIT 0192                    SET_TMR2_ON 0520  
          MODBUS_ADR_FUNCTION 0800                   DELAY_1000ms 055B                   DELAY_3000ms 0559  
                WATCH_COUNTER 0070               POWER_CHECK_PORT 000D              MOTOR_1_NOW_IS_HI 0254  
            MOTOR_1_NOW_IS_LO 024A  MODBUS_TIMEOUT_IS_FINISH_LOOP 0011                  WATCH_OUT_DAT 0005  
                WATCH_OUT_CLK 0006                   DELAY_LOOP_1 056F             COPY_485_DATA_LOOP 002B  
     MODBUS_CRC16_CHECK_IS_OK 003E               CHECKC_IOC_IS_HI 03C5               CHECKC_IOC_IS_LO 03D1  
         PREPARE_TX_DATA_LOOP 049D       MODBUS_BUS_ID_ERROR_LOOP 0061                  TMR2_BASE_SET 00A7  
                TMR2_BASE_NUM 0004             MOTOR_CONTROL_PORT 010E            SETTING_PWM_HW_LOOP 0175  
              TX_DATA_COUNTER 002D       CHECK_CRC16_IS_RIGHT_LV1 0079                  MAX485_SELECT 0003  
            IOC_COUNTER_HBYTE 0046              IOC_COUNTER_LBYTE 0047        CLEAN_ALL_REGISTER_LOOP 052C  
      MODBUS_BUS_ID_ERROR_LV1 0067       RESET_END_IN_NORMAL_LOOP 02F5          DEAL_WITH_MODBUS_FLAG 0005  
        DEAL_WITH_MODBUS_LOOP 01BD            ALL_MOTOR_STOP_FLAG 0004  RESET_MODBUS_TIMEOUT_FUNCTION 00D0  
         SYSTEM_START_SETTING 011B                WATCH_BIT_COUNT 0071                 INT_TIMER_TEMP 0024  
               INT_HW_SETTING 0193                TMR2IF_FUNC_LV1 00BD             INT_TRIG_TIME_FLAG 0004  
