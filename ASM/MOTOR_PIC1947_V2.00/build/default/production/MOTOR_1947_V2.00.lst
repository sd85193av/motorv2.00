

Microchip MPLAB XC8 Assembler V2.40 build 20220703182018 
                                                                                                           Fri Oct 06 11:40:38 2023


     1                           	processor	16F1947
     2                           	pagewidth 132
     3                           	psect	udata_shr,global,class=COMMON,space=1,delta=1,noexec
     4                           	psect	udata,global,class=RAM,space=1,delta=1,noexec
     5                           	psect	udata_bank0,global,class=BANK0,space=1,delta=1,noexec
     6                           	psect	udata_bank1,global,class=BANK1,space=1,delta=1,noexec
     7                           	psect	udata_bank2,global,class=BANK2,space=1,delta=1,noexec
     8                           	psect	udata_bank3,global,class=BANK3,space=1,delta=1,noexec
     9                           	psect	udata_bank4,global,class=BANK4,space=1,delta=1,noexec
    10                           	psect	udata_bank5,global,class=BANK5,space=1,delta=1,noexec
    11                           	psect	udata_bank6,global,class=BANK6,space=1,delta=1,noexec
    12                           	psect	udata_bank7,global,class=BANK7,space=1,delta=1,noexec
    13                           	psect	udata_bank8,global,class=BANK8,space=1,delta=1,noexec
    14                           	psect	udata_bank9,global,class=BANK9,space=1,delta=1,noexec
    15                           	psect	udata_bank10,global,class=BANK10,space=1,delta=1,noexec
    16                           	psect	udata_bank11,global,class=BANK11,space=1,delta=1,noexec
    17                           	psect	udata_bank12,global,class=BANK12,space=1,delta=1,noexec
    18                           	psect	code,global,class=CODE,delta=2
    19                           	psect	data,global,class=STRCODE,delta=2,noexec
    20                           	psect	edata,global,class=EEDATA,space=3,delta=2,noexec
    21                           	psect	main,global,size=2048,class=CODE,delta=2
    22                           	psect	config,global,abs,ovrld,class=CONFIG,space=4,delta=2,noexec
    23                           
    24                           ;========================================================
    25                           ;================ Project Information ===================
    26                           ;========================================================
    27                           ;Project Name : MOTOR-MODULE_V2.00
    28                           ;Project Version:
    29                           ;Project object :
    30                           ;Project number :
    31                           ;Edit Date :
    32                           ;--------------------------------------------------------
    33                           ;========================================================
    34                           ;========================================================
    35                           ;========================================================
    36                           ;========================================================
    37                           ;======== PIC16F1947 Configuration Bit Settings =========
    38                           ;========================================================
    39                           ; PIC16F1947 Configuration Bit Settings
    40                           ; Assembly source line config statements
    41                           ; CONFIG1
    42                           ; CONFIG2
    43                           ;** ***************************************************************************************
    44                           ;==========================================================================
    45                           ; MPASM PIC16LF1947 processor include
    46                           ;
    47                           ; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
    48                           ;==========================================================================
    49                           ;==========================================================================
    50                           ; This header file defines configurations, registers, and other useful
    51                           ; bits of information for the PIC16LF1947 microcontroller. These names
    52                           ; are taken to match the data sheets as closely as possible.
    53                           ;
    54                           ; Note that the processor must be selected before this file is included.
    55                           ; The processor may be selected the following ways:
    56                           ;
    57                           ; 1. Command line switch:
    58                           ; C:\MPASM MYFILE.ASM /PIC16LF1947
    59                           ; 2. LIST directive in the source file
    60                           ; LIST P=PIC16LF1947
    61                           ; 3. Processor Type entry in the MPASM full-screen interface
    62                           ; 4. Setting the processor in the MPLAB Project Dialog
    63                           ;==========================================================================
    64                           ;==========================================================================
    65                           ;
    66                           ; Verify Processor
    67                           ;
    68                           ;==========================================================================
    69                           ; IFNDEF __16LF1947
    70                           ; MESSG "Processor-header file mismatch.  Verify selected processor."
    71                           ; ENDIF
    72                           ;==========================================================================
    73                           ;
    74                           ; Register Definitions
    75                           ;
    76                           ;==========================================================================
    77                           ;W EQU 0000H
    78                           ;F EQU 0001H
    79                           ;----- Register Files -----------------------------------------------------
    80                           ;-----Bank0------------------
    81     0003                     
    82                           ;FSR0 EQU 0004H
    83     0005                     
    84                           ;FSR1 EQU 0006H
    85     001F                     
    86                           ;-----Bank1------------------
    87     009E                     
    88                           ;-----Bank2------------------
    89     011F                     
    90                           ;-----Bank3------------------
    91     019F                     
    92                           ;-----Bank4------------------
    93     021F                     
    94                           ;-----Bank5------------------
    95     029F                     
    96                           ;-----Bank6------------------
    97     031E                     
    98                           ;-----Bank7------------------
    99     0396                     
   100                           ;-----Bank8------------------
   101     041E                     
   102                           ;-----Bank9------------------
   103     0497                     
   104                           ;-----Bank15------------------
   105     07B7                     
   106                           ;-----Bank31------------------
   107     0FEF                     
   108                           ;----- STATUS Bits -----------------------------------------------------
   109     0004                     
   110                           ;----- BSR Bits -----------------------------------------------------
   111     0004                     
   112                           ;----- INTCON Bits -----------------------------------------------------
   113     0005                     
   114                           ;----- PORTA Bits -----------------------------------------------------
   115     0007                     
   116                           ;----- PORTB Bits -----------------------------------------------------
   117     0000                     
   118                           ;----- PORTC Bits -----------------------------------------------------
   119     0002                     
   120                           ;----- PORTD Bits -----------------------------------------------------
   121     0006                     
   122                           ;----- PORTE Bits -----------------------------------------------------
   123     0007                     
   124                           ;----- PIR1 Bits -----------------------------------------------------
   125     0005                     
   126                           ;----- PIR2 Bits -----------------------------------------------------
   127     0007                     
   128                           ;----- PIR3 Bits -----------------------------------------------------
   129     0006                     
   130                           ;----- PIR4 Bits -----------------------------------------------------
   131     0005                     
   132                           ;----- T1CON Bits -----------------------------------------------------
   133     0007                     
   134                           ;----- T1GCON Bits -----------------------------------------------------
   135     0003                     
   136                           ;----- T2CON Bits -----------------------------------------------------
   137     0006                     
   138                           ;----- CPSCON0 Bits -----------------------------------------------------
   139     0007                     
   140                           ;----- CPSCON1 Bits -----------------------------------------------------
   141     0004                     
   142                           ;----- TRISA Bits -----------------------------------------------------
   143     0007                     
   144                           ;----- TRISB Bits -----------------------------------------------------
   145     0007                     
   146                           ;----- TRISC Bits -----------------------------------------------------
   147     0007                     
   148                           ;----- TRISD Bits -----------------------------------------------------
   149     0007                     
   150                           ;----- TRISE Bits -----------------------------------------------------
   151     0007                     
   152                           ;----- PIE1 Bits -----------------------------------------------------
   153     0005                     
   154                           ;----- PIE2 Bits -----------------------------------------------------
   155     0007                     
   156                           ;----- PIE3 Bits -----------------------------------------------------
   157     0006                     
   158                           ;----- PIE4 Bits -----------------------------------------------------
   159     0005                     
   160                           ;----- OPTION_REG Bits -----------------------------------------------------
   161     0005                     
   162                           ;----- PCON Bits -----------------------------------------------------
   163     0007                     
   164                           ;----- WDTCON Bits -----------------------------------------------------
   165     0005                     
   166                           ;----- OSCTUNE Bits -----------------------------------------------------
   167     0005                     
   168                           ;----- OSCCON Bits -----------------------------------------------------
   169     0007                     
   170                           ;----- OSCSTAT Bits -----------------------------------------------------
   171     0007                     
   172                           ;----- ADCON0 Bits -----------------------------------------------------
   173     0001                     
   174                           ;----- ADCON1 Bits -----------------------------------------------------
   175     0007                     
   176                           ;----- LATA Bits -----------------------------------------------------
   177     0007                     
   178                           ;----- LATB Bits -----------------------------------------------------
   179     0007                     
   180                           ;----- LATC Bits -----------------------------------------------------
   181     0007                     
   182                           ;----- LATD Bits -----------------------------------------------------
   183     0007                     
   184                           ;----- LATE Bits -----------------------------------------------------
   185     0007                     
   186                           ;----- CM1CON0 Bits -----------------------------------------------------
   187     0007                     
   188                           ;----- CM1CON1 Bits -----------------------------------------------------
   189     0007                     
   190                           ;----- CM2CON0 Bits -----------------------------------------------------
   191     0007                     
   192                           ;----- CM2CON1 Bits -----------------------------------------------------
   193     0007                     
   194                           ;----- CMOUT Bits -----------------------------------------------------
   195     0002                     
   196                           ;----- BORCON Bits -----------------------------------------------------
   197     0007                     
   198                           ;----- FVRCON Bits -----------------------------------------------------
   199     0007                     
   200                           ;----- DACCON0 Bits -----------------------------------------------------
   201     0007                     
   202                           ;----- DACCON1 Bits -----------------------------------------------------
   203     0004                     
   204                           ;----- SRCON0 Bits -----------------------------------------------------
   205     0007                     
   206                           ;----- SRCON1 Bits -----------------------------------------------------
   207     0007                     
   208                           ;----- APFCON Bits -----------------------------------------------------
   209     0007                     
   210                           ;----- CM3CON0 Bits -----------------------------------------------------
   211     0007                     
   212                           ;----- CM3CON1 Bits -----------------------------------------------------
   213     0007                     
   214                           ;----- ANSELA Bits -----------------------------------------------------
   215     0005                     
   216                           ;----- ANSELE Bits -----------------------------------------------------
   217     0002                     
   218                           ;----- EECON1 Bits -----------------------------------------------------
   219     0007                     
   220                           ;----- RC1STA Bits -----------------------------------------------------
   221     0007                     
   222                           ;----- RCSTA Bits -----------------------------------------------------
   223     0007                     
   224                           ;----- TX1STA Bits -----------------------------------------------------
   225     0007                     
   226                           ;----- TXSTA Bits -----------------------------------------------------
   227     0007                     
   228                           ;----- BAUD1CON Bits -----------------------------------------------------
   229     0007                     
   230                           ;----- WPUB Bits -----------------------------------------------------
   231     0007                     
   232                           ;----- SSP1STAT Bits -----------------------------------------------------
   233     0007                     
   234                           ;----- SSPSTAT Bits -----------------------------------------------------
   235     0007                     
   236                           ;----- SSP1CON1 Bits -----------------------------------------------------
   237     0007                     
   238                           ;----- SSPCON Bits -----------------------------------------------------
   239     0007                     
   240                           ;----- SSPCON1 Bits -----------------------------------------------------
   241     0007                     
   242                           ;----- SSP1CON2 Bits -----------------------------------------------------
   243     0007                     
   244                           ;----- SSPCON2 Bits -----------------------------------------------------
   245     0007                     
   246                           ;----- SSP1CON3 Bits -----------------------------------------------------
   247     0007                     
   248                           ;----- SSPCON3 Bits -----------------------------------------------------
   249     0007                     
   250                           ;----- SSP2STAT Bits -----------------------------------------------------
   251     0007                     
   252                           ;----- SSP2CON1 Bits -----------------------------------------------------
   253     0007                     
   254                           ;----- SSP2CON2 Bits -----------------------------------------------------
   255     0007                     
   256                           ;----- SSP2CON3 Bits -----------------------------------------------------
   257     0007                     
   258                           ;----- PORTF Bits -----------------------------------------------------
   259     0007                     
   260                           ;----- PORTG Bits -----------------------------------------------------
   261     0004                     
   262                           ;----- CCP1CON Bits -----------------------------------------------------
   263     0007                     
   264                           ;----- PWM1CON Bits -----------------------------------------------------
   265     0007                     
   266                           ;----- CCP1AS Bits -----------------------------------------------------
   267     0007                     
   268                           ;----- ECCP1AS Bits -----------------------------------------------------
   269     0007                     
   270                           ;----- PSTR1CON Bits -----------------------------------------------------
   271     0004                     
   272                           ;----- CCP2CON Bits -----------------------------------------------------
   273     0007                     
   274                           ;----- PWM2CON Bits -----------------------------------------------------
   275     0007                     
   276                           ;----- CCP2AS Bits -----------------------------------------------------
   277     0007                     
   278                           ;----- ECCP2AS Bits -----------------------------------------------------
   279     0007                     
   280                           ;----- PSTR2CON Bits -----------------------------------------------------
   281     0004                     
   282                           ;----- CCPTMRS0 Bits -----------------------------------------------------
   283     0007                     
   284                           ;----- CCPTMRS1 Bits -----------------------------------------------------
   285     0001                     
   286                           ;----- TRISF Bits -----------------------------------------------------
   287     0007                     
   288                           ;----- TRISG Bits -----------------------------------------------------
   289     0005                     
   290                           ;----- CCP3CON Bits -----------------------------------------------------
   291     0007                     
   292                           ;----- PWM3CON Bits -----------------------------------------------------
   293     0007                     
   294                           ;----- CCP3AS Bits -----------------------------------------------------
   295     0007                     
   296                           ;----- ECCP3AS Bits -----------------------------------------------------
   297     0007                     
   298                           ;----- PSTR3CON Bits -----------------------------------------------------
   299     0004                     
   300                           ;----- CCP4CON Bits -----------------------------------------------------
   301     0005                     
   302                           ;----- CCP5CON Bits -----------------------------------------------------
   303     0005                     
   304                           ;----- LATF Bits -----------------------------------------------------
   305     0007                     
   306                           ;----- LATG Bits -----------------------------------------------------
   307     0005                     
   308                           ;----- IOCBP Bits -----------------------------------------------------
   309     0007                     
   310                           ;----- IOCBN Bits -----------------------------------------------------
   311     0007                     
   312                           ;----- IOCBF Bits -----------------------------------------------------
   313     0007                     
   314                           ;----- ANSELF Bits -----------------------------------------------------
   315     0007                     
   316                           ;----- ANSELG Bits -----------------------------------------------------
   317     0004                     
   318                           ;----- T4CON Bits -----------------------------------------------------
   319     0006                     
   320                           ;----- T6CON Bits -----------------------------------------------------
   321     0006                     
   322                           ;----- WPUG Bits -----------------------------------------------------
   323     0005                     
   324                           ;----- RC2STA Bits -----------------------------------------------------
   325     0007                     
   326                           ;----- TX2STA Bits -----------------------------------------------------
   327     0007                     
   328                           ;----- BAUD2CON Bits -----------------------------------------------------
   329     0007                     
   330                           ;----- LCDCON Bits -----------------------------------------------------
   331     0007                     
   332                           ;----- LCDPS Bits -----------------------------------------------------
   333     0007                     
   334                           ;----- LCDREF Bits -----------------------------------------------------
   335     0007                     
   336                           ;----- LCDCST Bits -----------------------------------------------------
   337     0002                     
   338                           ;----- LCDRL Bits -----------------------------------------------------
   339     0007                     
   340                           ;----- LCDSE0 Bits -----------------------------------------------------
   341     0007                     
   342                           ;----- LCDSE1 Bits -----------------------------------------------------
   343     0007                     
   344                           ;----- LCDSE2 Bits -----------------------------------------------------
   345     0007                     
   346                           ;----- LCDSE3 Bits -----------------------------------------------------
   347     0007                     
   348                           ;----- LCDSE4 Bits -----------------------------------------------------
   349     0007                     
   350                           ;----- LCDSE5 Bits -----------------------------------------------------
   351     0005                     
   352                           ;----- LCDDATA0 Bits -----------------------------------------------------
   353     0007                     
   354                           ;----- LCDDATA1 Bits -----------------------------------------------------
   355     0007                     
   356                           ;----- LCDDATA2 Bits -----------------------------------------------------
   357     0007                     
   358                           ;----- LCDDATA3 Bits -----------------------------------------------------
   359     0007                     
   360                           ;----- LCDDATA4 Bits -----------------------------------------------------
   361     0007                     
   362                           ;----- LCDDATA5 Bits -----------------------------------------------------
   363     0007                     
   364                           ;----- LCDDATA6 Bits -----------------------------------------------------
   365     0007                     
   366                           ;----- LCDDATA7 Bits -----------------------------------------------------
   367     0007                     
   368                           ;----- LCDDATA8 Bits -----------------------------------------------------
   369     0007                     
   370                           ;----- LCDDATA9 Bits -----------------------------------------------------
   371     0007                     
   372                           ;----- LCDDATA10 Bits -----------------------------------------------------
   373     0007                     
   374                           ;----- LCDDATA11 Bits -----------------------------------------------------
   375     0007                     
   376                           ;----- LCDDATA12 Bits -----------------------------------------------------
   377     0007                     
   378                           ;----- LCDDATA13 Bits -----------------------------------------------------
   379     0007                     
   380                           ;----- LCDDATA14 Bits -----------------------------------------------------
   381     0005                     
   382                           ;----- LCDDATA15 Bits -----------------------------------------------------
   383     0007                     
   384                           ;----- LCDDATA16 Bits -----------------------------------------------------
   385     0007                     
   386                           ;----- LCDDATA17 Bits -----------------------------------------------------
   387     0005                     
   388                           ;----- LCDDATA18 Bits -----------------------------------------------------
   389     0007                     
   390                           ;----- LCDDATA19 Bits -----------------------------------------------------
   391     0007                     
   392                           ;----- LCDDATA20 Bits -----------------------------------------------------
   393     0005                     
   394                           ;----- LCDDATA21 Bits -----------------------------------------------------
   395     0007                     
   396                           ;----- LCDDATA22 Bits -----------------------------------------------------
   397     0007                     
   398                           ;----- LCDDATA23 Bits -----------------------------------------------------
   399     0005                     
   400                           ;----- STATUS_SHAD Bits -----------------------------------------------------
   401     0002                     
   402                           	psect	edata
   403                           
   404                           ;==========================================================================
   405                           ;
   406                           ; Configuration Bits
   407                           ;
   408                           ; NAME Address
   409                           ; CONFIG1 8007h
   410                           ; CONFIG2 8008h
   411                           ;
   412                           ;==========================================================================
   413                           ;========================================================
   414                           ;================ Project Information ===================
   415                           ;========================================================
   416                           ;Pin Assignment :
   417                           ;Project Name :
   418                           ;Project Version: V2.00 (Bate00)
   419                           ;Project object :
   420                           ;Project number :
   421                           ;Edit Date : 2023/04/18
   422                           ;--------------------------------------------------------
   423                           ;========================================================
   424                           ;========================================================
   425                           ;INCLUDE TITLE
   426                           ;========================================================
   427                           ;================ Project Information ===================
   428                           ;========================================================
   429                           ;Project Name : MODBUS RTU BASE
   430                           ;-------------------------------------------------------
   431                           ;Project Version: 2.00
   432                           ;Edit Date : 2023/09/28
   433                           ;Function Info :
   434                           ;-------------------------------------------------------
   435                           ;Description of Register Informatione (use FSR)
   436                           ;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
   437                           ;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
   438                           ;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
   439                           ;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
   440                           ;MODBUS_DAT_BUF_ADRL+4 : CRC counter
   441                           ;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
   442                           ;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
   443                           ;MODBUS_DAT_BUF_ADRL+7 : time out count
   444                           ;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG
   445                           ;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
   446                           ;-------------------------------------------------------
   447                           ;-------------------------------------------------------
   448                           ;-------------------------------------------------------
   449                           ;須被定義的部分
   450     0003                     
   451                           ;-------------------------------------------------------
   452     00B0                     
   453                           ;========================================================
   454                           ;================ Project Information ===================
   455                           ;========================================================
   456                           ;Project Name : MODBUS RTU BASE
   457                           ;-------------------------------------------------------
   458                           ;Project Version: 2.00
   459                           ;Edit Date : 2023/09/28
   460                           ;Function Info :
   461                           ;-------------------------------------------------------
   462                           ;-------------------------------------------------------
   463                           ;========================================================
   464                           ;========================================================
   465     0074                     
   466                           ;-------------------------------------------------------
   467     038C                     
   468                           ;-------------------------------------------------------
   469                           ;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
   470     00B0                     	;存放從485送進來的資料
   471     0040                     	;將485送的資料複製出來，之後的判斷都使用這個地方
   472                           
   473                           ;這邊主要是因為有4個馬達，可以直接選擇要使用哪個資料
   474                           ;注射泵2.00來說，轉向馬達是MOTOR1 活塞馬達是MOTOR2
   475     0090                     
   476                           ;MOTOR1 0X2190-0X21AF
   477                           ;CW:4BYTE
   478                           ;CCW:4BYTE
   479                           ;
   480                           ;-----------------------------------------------
   481                           ;MOTOR2 0X21B0-0X21CF
   482                           ;MOTOR3 0X21D0-0X21EF
   483                           ;MOTOR4 0X21F0-0X220F
   484                           ;--------------------------------------------------------------
   485                           ;--------------------------------------------------------------
   486                           ;0X21 0X40-0X21 0X54 MOTOR1
   487                           ;0X21 0X55-0X21 0X69 MOTOR2
   488                           ;0X21 0X6A-0X21 0X7E MOTOR3
   489                           ;0X21 0X7F-0X21 0X93 MOTOR4
   490                           ;-------------------------------------------------------
   491                           ;--------------------------------------------------------
   492                           ;WATCH用的暫存器設定
   493     0006                     
   494                           ;--------------------------------------------------------
   495                           ;--------------------------------------------------------
   496                           ;mcu腳位定義
   497                           ;Pin assignment definition
   498     0003                     	;0->往光遮端方向 1->反方向
   499     0005                     	;0->表示電源沒有進入 1->表示有電源
   500     0002                     
   501                           ;--------------------------------------------------------
   502                           ;--------------------------------------------------------
   503                           ;========================================================
   504                           ;==================== 0X20 ~ 0X2F =======================
   505                           ;========================================================
   506                           ;Register definition
   507     002A                     	;用來計算MODBUS RTU
   508     002D                     	;整理UART TX傳送的資料數量
   509     002F                     
   510                           ;========================================================
   511                           ;==================== 0X30 ~ 0X3F =======================
   512                           ;========================================================
   513                           ;Register definition
   514                           ;--------------------------------------
   515     0000                     	;可以回傳資料FLAG
   516     0001                     	;表示目前馬達可以動作
   517     0002                     	;RX資料有錯誤
   518     0003                     	;強制命令執行後SET
   519     0004                     	;表示INT地一次觸發啟動INT_TIMER功能
   520     0005                     
   521                           ;--------------------------------------------------------
   522                           ;馬達1為轉向馬達(目前使用在注射泵)
   523     0001                     	;馬達1收到指令可以進行運作
   524     0002                     	;馬達1順時針
   525     0003                     	;馬達1逆時針
   526     0005                     	;目前馬達正在復位當中
   527     0001                     	;目前馬達正在一般運作動作當中
   528     0038                     
   529                           ;--------------------------------------------------------馬達參數設定
   530     0039                     	;在通訊判斷使用哪個馬達的情況下使用
   531     0003                     
   532                           ;--------------------------------------------------------
   533     0004                     	;CMD 0X83全部停止動作
   534                           
   535                           ;--------------------------------------------------------
   536     0001                     	;0表示沒有在功能碼03/1表示有在
   537     0002                     	;0表示沒有在功能碼06/1表示有在
   538     0003                     	;0表示沒有在功能碼10/1表示有在
   539     003D                     	;FLAG6_BANK0，為MODBUS動作前FLAG
   540     0000                     	;恢復出廠設定
   541     0001                     	;整機初始化
   542     0002                     	;換向閥初始化
   543     0003                     	;活塞初始化
   544     0004                     	;進入醒目提示_F
   545     0000                     	;未初始化
   546     0001                     	;設備在線
   547     0002                     	;安全模式
   548     0003                     	;設備異常
   549     0004                     	;醒目提示
   550                           
   551                           ; 0X3F
   552                           ;========================================================
   553                           ;==================== 0X40 ~ 0X4F =======================
   554                           ;========================================================
   555                           ;Register definition
   556     0040                     	;每次一個PWM就+1
   557     0041                     	;每次一個PWM就+1
   558     0045                     
   559                           ;-----------------------------------------------
   560     004D                     	;用來暫存MODBUS中運算的資料
   561     00A0                     
   562                           ;--------------------------------------------------------------
   563                           ;------------------------BANK7參數設定-------------------------
   564                           ;--------------------------------------------------------------
   565     00A9                     
   566                           	psect	main
   567     0000                     	org	0
   568     0000  2805               	goto	BOOTLOADER_LOOP
   569     0004                     	org	4
   570     0004  2806               	goto	INTERRUPT_SUB_AREA
   571     0005                     BOOTLOADER_LOOP:	
   572                           ;* ****************************************************************************************
   573                           ;* Label Start
   574                           ;*
   575                           ;========================================================
   576                           ;================== BOOTLOADER副程式 ====================
   577                           ;========================================================
   578                           
   579     0005  291B               	goto	SYSTEM_START_SETTING
   580     0006                     INTERRUPT_SUB_AREA:	
   581                           ;========================================================
   582                           ;================== 中斷副程式起始位址 ==================
   583                           ;========================================================
   584                           
   585     0006  3180               	pagesel	0
   586     0007  0020               	banksel	12
   587                           
   588                           ;--------------------------
   589     0008  1A94               	btfsc	20,5
   590     0009  28AC               	goto	RC2IF_FUNCTION_LOOP	;硬體UART2收資料
   591                           
   592                           ;--------------------------
   593     000A  1891               	btfsc	17,1
   594     000B  28B0               	goto	TMR2IF_FUNCTION_LOOP	;TIMER2基準為1mS
   595                           
   596                           ;--------------------------
   597     000C  188B               	btfsc	11,1
   598     000D  28FE               	goto	INT_INTF_FUNCTION	;PWM INT
   599                           
   600                           ;-----------
   601     000E  180B               	btfsc	11,0
   602     000F  28F1               	goto	IOC_INT_FUNCTION	;光遮斷器觸發
   603     0010  0009               	retfie
   604     0011                     MODBUS_TIMEOUT_IS_FINISH_LOOP:	
   605                           ;========================================================
   606                           ;=============MODBUS TIMEOUT到要進行分析的動作===========
   607                           ;========================================================
   608                           ;表示TIMEOUT到了，可以進行分析的動作
   609                           
   610     0011  3004               	movlw	4
   611     0012  00A3               	movwf	35
   612     0013  0029               	banksel	1173
   613     0014  1215               	bcf	1173,4	;要進行分析資料前，先把UART RX關閉確保資料不會錯誤
   614     0015  0020               	banksel	12
   615     0016  3020               	movlw	32	;20B0
   616     0017  0087               	movwf	7
   617     0018  30B0               	movlw	176
   618     0019  0086               	movwf	6
   619     001A  3008               	movlw	8	;MODBUS_FLAG
   620     001B  0786               	addwf	6,f
   621     001C  0181               	clrf	1
   622                           
   623                           ;----------------------------------------------------------
   624     001D  3020               	movlw	32
   625     001E  0087               	movwf	7
   626     001F  30B0               	movlw	176
   627     0020  0086               	movwf	6
   628     0021  3003               	movlw	3	;MODBUS的DATA OFFSET
   629     0022  0786               	addwf	6,f
   630     0023  0801               	movf	1,w
   631     0024  00AA               	movwf	42	;得到這次MODBUS所有的資料數量
   632     0025  00AF               	movwf	47
   633     0026  00C9               	movwf	73
   634     0027  3002               	movlw	2
   635     0028  02AA               	subwf	42,f
   636     0029  0181               	clrf	1
   637                           
   638                           ;----------------------------------------------------------
   639                           ; GOTO CHECK_CRC16_IS_RIGHT ;驗證收到CRC-16是否正確
   640     002A  283E               	goto	MODBUS_CRC16_CHECK_IS_OK
   641     002B                     COPY_485_DATA_LOOP:	
   642                           ;===================================================
   643                           ;============複製485傳送的資料一份參考參考==========OK
   644                           ;===================================================
   645                           
   646     002B  3020               	movlw	32
   647     002C  0087               	movwf	7
   648     002D  30B0               	movlw	176
   649     002E  0086               	movwf	6
   650     002F  300A               	movlw	10
   651     0030  0786               	addwf	6,f
   652                           
   653                           ;-------------------------
   654     0031  3021               	movlw	33
   655     0032  0085               	movwf	5
   656     0033  3040               	movlw	64
   657     0034  0084               	movwf	4
   658     0035  082F               	movf	47,w
   659     0036  00AA               	movwf	42	;確認資料總數量
   660     0037                     COPY_485_DATA_LV1:	
   661                           ;-------------------------
   662                           
   663     0037  0801               	movf	1,w
   664     0038  0080               	movwf	0
   665     0039  0A86               	incf	6,f
   666     003A  0A84               	incf	4,f
   667     003B  0BAA               	decfsz	42,f
   668     003C  2837               	goto	COPY_485_DATA_LV1
   669     003D  0008               	return
   670     003E                     MODBUS_CRC16_CHECK_IS_OK:	
   671                           ;===================================================
   672                           ;============MODBUS的CRC16驗證正確==================OK
   673                           ;===================================================
   674                           ;這段的CRC16驗證已經通過了，先把資料做個複製的動作
   675                           
   676     003E  202B               	call	COPY_485_DATA_LOOP
   677     003F  0020               	banksel	12
   678     0040  3021               	movlw	33	;21
   679     0041  0087               	movwf	7
   680     0042  3040               	movlw	64	;E0
   681     0043  0086               	movwf	6
   682                           
   683                           ;----------------------------------------------------------
   684     0044  0801               	movf	1,w
   685     0045  0625               	xorwf	37,w
   686     0046  1D03               	btfss	3,2
   687     0047  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP
   688                           
   689                           ;----------------------------------------------------------表示DEVICE ID 不對
   690                           ; MOVLW 0X08
   691                           ; XORWF MODBUS_DAT_COUNT,W
   692                           ; BTFSS STATUS,Z
   693                           ; GOTO MODBUS_BUS_ID_ERROR_LOOP ;當今天收到的資料數量大於8表示異常
   694                           ;---------------
   695     0048  0A86               	incf	6,f	;資料為功能碼
   696     0049  3003               	movlw	3
   697     004A  0601               	xorwf	1,w
   698     004B  1903               	btfsc	3,2
   699     004C  2889               	goto	ANAY_MODBUS_CMD_03_LOOP	;功能碼是READ ONE BYTE
   700                           
   701                           ;---------------
   702     004D  3006               	movlw	6
   703     004E  0601               	xorwf	1,w
   704     004F  1903               	btfsc	3,2
   705     0050  2893               	goto	ANAY_MODBUS_CMD_06_LOOP	;功能碼是WRITE ONE BYTE
   706                           
   707                           ;---------------
   708     0051  3010               	movlw	16
   709     0052  0601               	xorwf	1,w
   710     0053  1903               	btfsc	3,2
   711     0054  288E               	goto	ANAY_MODBUS_CMD_10_LOOP	;功能碼是WRITE MORE BYTE
   712     0055                     MODBUS_BUS_01_ERROR_LOOP:	
   713                           ;目前功能碼只有接0X03 0X06 0X10，其他的算是ERROR CODE 0X01
   714                           ;===================================================
   715                           ;============MODBUS的功能碼錯誤=====================OK
   716                           ;===================================================
   717                           ;MODBUS RTU ERROR CODE 01
   718                           ;非法功能，表示非授權的功能碼
   719                           
   720     0055  143B               	bsf	59,0
   721     0056  0009               	retfie
   722     0057                     MODBUS_BUS_02_ERROR_LOOP:	
   723                           ;----------------------------------------
   724                           ;MODBUS RTU ERROR CODE 02
   725                           ;非法暫存器地址
   726                           
   727     0057  14BB               	bsf	59,1
   728     0058  0009               	retfie
   729     0059                     MODBUS_BUS_03_ERROR_LOOP:	
   730                           ;----------------------------------------
   731                           ;MODBUS RTU ERROR CODE 03
   732                           ;非法資料數值
   733                           
   734     0059  153B               	bsf	59,2
   735     005A  0009               	retfie
   736     005B                     MODBUS_BUS_04_ERROR_LOOP:	
   737                           ;----------------------------------------
   738                           ;MODBUS RTU ERROR CODE 04
   739                           ;裝置故障，像是自我檢測出現異常
   740                           
   741     005B  15BB               	bsf	59,3
   742     005C  0009               	retfie
   743     005D                     MODBUS_BUS_05_ERROR_LOOP:	
   744                           ;----------------------------------------
   745                           ;MODBUS RTU ERROR CODE 05
   746                           ;確認，有收到指令並且立即執行
   747                           
   748     005D  163B               	bsf	59,4
   749     005E  0009               	retfie
   750     005F                     MODBUS_BUS_06_ERROR_LOOP:	
   751                           ;----------------------------------------
   752                           ;MODBUS RTU ERROR CODE 06
   753                           ;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
   754                           
   755     005F  16BB               	bsf	59,5
   756     0060  0009               	retfie
   757     0061                     MODBUS_BUS_ID_ERROR_LOOP:	
   758                           ;===================================================
   759                           ;============MODBUS的ID或是資料數錯誤===============OK
   760                           ;===================================================
   761                           ;將RX存放資料的空間清空
   762                           
   763     0061  3020               	movlw	32
   764     0062  0087               	movwf	7
   765     0063  30B0               	movlw	176
   766     0064  0086               	movwf	6
   767     0065  300A               	movlw	10
   768     0066  0786               	addwf	6,f
   769     0067                     MODBUS_BUS_ID_ERROR_LV1:
   770     0067  0181               	clrf	1
   771     0068  0A86               	incf	6,f
   772     0069  0BC9               	decfsz	73,f
   773     006A  2867               	goto	MODBUS_BUS_ID_ERROR_LV1
   774     006B  0029               	banksel	1173
   775     006C  1615               	bsf	1173,4	;重新啟動UART RX功能
   776     006D  0009               	retfie
   777     006E                     CHECK_CRC16_IS_RIGHT:	
   778                           ;===================================================
   779                           ;================驗證CRC16是否正確?=================OK
   780                           ;===================================================
   781                           ;這段驗證CRC的時間大約為380uS
   782                           
   783     006E  0020               	banksel	12
   784     006F  30FF               	movlw	255
   785     0070  00A8               	movwf	40
   786     0071  30FF               	movlw	255
   787     0072  00A9               	movwf	41
   788     0073  3020               	movlw	32	;0X20
   789     0074  0087               	movwf	7
   790     0075  30B0               	movlw	176	;0XB0
   791     0076  0086               	movwf	6
   792     0077  300A               	movlw	10
   793     0078  0786               	addwf	6,f	;這裡是第一筆資料的位置
   794     0079                     CHECK_CRC16_IS_RIGHT_LV1:
   795     0079  0801               	movf	1,w
   796     007A  00A7               	movwf	39
   797     007B  24C3               	call	CRC_16_FUNCTION_LOOP
   798     007C  0A86               	incf	6,f
   799     007D  0BAA               	decfsz	42,f
   800     007E  2879               	goto	CHECK_CRC16_IS_RIGHT_LV1
   801                           
   802                           ;----------------------------
   803     007F  0829               	movf	41,w
   804     0080  0601               	xorwf	1,w
   805     0081  1D03               	btfss	3,2
   806     0082  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
   807                           
   808                           ;----------------------------
   809     0083  0A86               	incf	6,f
   810     0084  0828               	movf	40,w
   811     0085  0601               	xorwf	1,w
   812     0086  1D03               	btfss	3,2
   813     0087  2861               	goto	MODBUS_BUS_ID_ERROR_LOOP	;CRC16錯誤，模組不做回應
   814     0088  283E               	goto	MODBUS_CRC16_CHECK_IS_OK	;CRC16驗證正確
   815     0089                     ANAY_MODBUS_CMD_03_LOOP:	
   816                           ;========================================================
   817                           ;=============MODBUS 功能碼為0X03========================
   818                           ;========================================================
   819                           ;功能碼:0X03表示要READ
   820                           ;先確認ADR是否對應的合法
   821                           
   822     0089  0020               	banksel	12
   823     008A  30F1               	movlw	241
   824     008B  05BC               	andwf	60,f
   825     008C  14BC               	bsf	60,1
   826     008D  2897               	goto	ANAY_MODBUS_CMD_COMMON_LOOP
   827     008E                     ANAY_MODBUS_CMD_10_LOOP:	
   828                           ;========================================================
   829                           ;=============MODBUS 功能碼為0X10========================
   830                           ;========================================================
   831                           ;功能碼:0X10，這個部分有可能寫入一個WORD的資料和功能碼0X06相同
   832                           ;所以要多確認是否合法
   833                           ;先確認ADR是否對應的合法
   834                           
   835     008E  0020               	banksel	12
   836     008F  30F1               	movlw	241
   837     0090  05BC               	andwf	60,f
   838     0091  15BC               	bsf	60,3
   839     0092  2897               	goto	ANAY_MODBUS_CMD_COMMON_LOOP
   840     0093                     ANAY_MODBUS_CMD_06_LOOP:	
   841                           ;========================================================
   842                           ;=============MODBUS 功能碼為0X06========================
   843                           ;========================================================
   844                           ;功能碼:0X06表示要WRITE
   845                           ;先確認ADR是否對應的合法
   846                           
   847     0093  0020               	banksel	12
   848     0094  30F1               	movlw	241
   849     0095  05BC               	andwf	60,f
   850     0096  153C               	bsf	60,2	;先將MODBUS FLAG重新設定為功能碼06
   851     0097                     ANAY_MODBUS_CMD_COMMON_LOOP:	
   852                           ;GOTO ANAY_MODBUS_CMD_COMMON_LOOP
   853                           
   854                           
   855                           ;----------------
   856     0097  0020               	banksel	12
   857     0098  3021               	movlw	33	;21
   858     0099  0087               	movwf	7
   859     009A  3040               	movlw	64	;E0
   860     009B  0086               	movwf	6	;這裡是第一筆資料的位置
   861     009C  3002               	movlw	2
   862     009D  0786               	addwf	6,f
   863                           
   864                           ;---------------------------------------------------
   865     009E  0801               	movf	1,w
   866     009F  00CC               	movwf	76	;ADR位置的HBYTE
   867     00A0  0A86               	incf	6,f
   868     00A1  0801               	movf	1,w
   869     00A2  00CD               	movwf	77	;ADR位置的LBYTE
   870                           
   871                           ;---------------------------------------------------- 將位置資料先複製出來
   872     00A3  30A0               	movlw	160
   873     00A4  02CD               	subwf	77,f
   874     00A5  3000               	movlw	0
   875     00A6  3BCC               	subwfb	76,f
   876                           
   877                           ;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
   878     00A7  084D               	movf	77,w
   879     00A8  00CA               	movwf	74
   880     00A9  0020               	banksel	12
   881     00AA  16B0               	bsf	48,5
   882     00AB  0009               	retfie
   883     00AC                     RC2IF_FUNCTION_LOOP:	
   884                           ;---------------------------------------------------------------------------------------------------
      +                          -
   885                           ;下面是之前功能碼0X06的動作副程式
   886 ;;------------------------------------------------
   887                           ; MOVLW 0X09
   888                           ; XORWF CAL_TEMP_LBYTE,W
   889                           ; BTFSC STATUS,Z
   890                           ; GOTO STRONG_STOP_FUNCTION
   891 ;;------------------------
   892                           ; MOVLW 0X00
   893                           ; XORWF CAL_TEMP_LBYTE,W
   894                           ; BTFSC STATUS,Z
   895                           ; GOTO CW_STEP_FUNCTION
   896 ;;------------------------
   897                           ; MOVLW 0X01
   898                           ; XORWF CAL_TEMP_LBYTE,W
   899                           ; BTFSC STATUS,Z
   900                           ; GOTO CCW_STEP_FUNCTION
   901 ;;------------------------
   902                           ; MOVLW 0X04
   903                           ; XORWF CAL_TEMP_LBYTE,W
   904                           ; BTFSC STATUS,Z
   905                           ; GOTO RESET_STEP_FUNCTION
   906                           ;
   907 ;;------------------------------------------------
   908                           ;ANAY_MODBUS_CMD_06_EXIT:
   909                           ; BCF FLAG2_BANK0,NOW_MOTOR_1_FLAG
   910                           ; BCF FLAG2_BANK0,NOW_MOTOR_2_FLAG
   911                           ; BCF FLAG2_BANK0,NOW_MOTOR_3_FLAG
   912                           ; BCF FLAG2_BANK0,NOW_MOTOR_4_FLAG
   913                           ; RETFIE
   914                           ;
   915                           ;
   916                           ;
   917 ;;-------------------------------------------
   918 ;;-------------0X80以上的WRITE CMD-----------
   919 ;;-------------------------------------------
   920                           ;ANAY_MODBUS_WRITE_0X80_LOOP:
   921                           ; MOVLW 0X08
   922                           ; MOVWF TX_DATA_COUNTER
   923                           ; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
   924                           ; MOVLW 0X83
   925                           ; XORWF INDF1,W
   926                           ; BTFSC STATUS,Z
   927                           ; CALL COMMON_CMD_0X83_LOOP
   928                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
   929                           ;COMMON_CMD_0X83_LOOP:
   930                           ; INCF FSR1L,F
   931                           ; INCF FSR1L,F
   932                           ; MOVF INDF1,W
   933                           ; BTFSC STATUS,Z
   934                           ; GOTO RECOVER_MODULE_LOOP
   935                           ;BANKSEL BANK7
   936                           ; MOVLW 0X02
   937                           ; MOVWF ADR_83_L_DAT
   938                           ; MOVLW 0X02
   939                           ; MOVWF ADR_81_L_DAT
   940                           ;
   941                           ;
   942                           ;RECOVER_MODULE_LOOP_LV1:
   943                           ;BANKSEL MOTOR_CONTROL_PORT
   944                           ; BCF MOTOR_CONTROL_PORT,M1_ST
   945                           ; BCF MOTOR_CONTROL_PORT,M2_ST
   946                           ;BANKSEL PORTA
   947                           ; BSF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
   948                           ; BCF MOTOR2_FLAG0,MOTOR_2_RESET
   949                           ; BCF MOTOR1_FLAG0,MOTOR_1_RESET
   950                           ; BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
   951                           ; BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
   952                           ; BCF FLAG1_BANK0,CAN_WORK_FLAG
   953                           ;
   954                           ; BCF MOTOR2_FLAG0,MOTOR_2_WORK
   955                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
   956                           ; BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
   957                           ; BCF FLAG3_BANK0,TEN_TIME_EN
   958                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
   959                           ; BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
   960                           ; BCF MOTOR1_FLAG0,MOTOR_1_WORK
   961                           ;
   962                           ; MOVLW MODBUS_DAT_REAL_ADRH
   963                           ; MOVWF FSR0H
   964                           ; MOVLW MODBUS_DAT_REAL_ADRL
   965                           ; MOVWF FSR0L
   966                           ; MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
   967                           ; ADDWF FSR0L,F
   968                           ; MOVLW 0X00
   969                           ; MOVWF INDF0
   970                           ; MOVLW MODBUS_DAT_REAL_ADRH
   971                           ; MOVWF FSR0H
   972                           ; MOVLW MODBUS_DAT_REAL_ADRL
   973                           ; MOVWF FSR0L
   974                           ; MOVLW 0X15
   975                           ; ADDWF FSR0L,F
   976                           ; MOVLW 0X07
   977                           ; ADDWF FSR0L,F
   978                           ; MOVLW 0X00
   979                           ; MOVWF INDF0
   980 ;;---------------------------------------------------------------------------
   981                           ;
   982                           ;
   983                           ; MOVLW MODBUS_DAT_REAL_ADRH
   984                           ; MOVWF FSR0H
   985                           ; MOVLW MODBUS_DAT_REAL_ADRL
   986                           ; MOVWF FSR0L
   987                           ; CLRF INDF0
   988                           ; INCF FSR0L,F
   989 ;;-------------
   990                           ; CLRF INDF0
   991                           ; INCF FSR0L,F
   992 ;;-------------
   993                           ; CLRF INDF0
   994                           ; INCF FSR0L,F
   995 ;;-------------
   996                           ; CLRF INDF0
   997                           ; INCF FSR0L,F
   998 ;;-------------
   999 ;;=============================================
  1000                           ;
  1001                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1002                           ; MOVWF FSR0H
  1003                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1004                           ; MOVWF FSR0L
  1005                           ; MOVLW 0X15
  1006                           ; ADDWF FSR0L,F
  1007                           ; CLRF INDF0
  1008                           ; INCF FSR0L,F
  1009 ;;-------------
  1010                           ; CLRF INDF0
  1011                           ; INCF FSR0L,F
  1012 ;;-------------
  1013                           ; CLRF INDF0
  1014                           ; INCF FSR0L,F
  1015 ;;-------------
  1016                           ; CLRF INDF0
  1017                           ; INCF FSR0L,F
  1018 ;;-------------
  1019                           ; RETURN
  1020 ;;-----------------------------------------------------
  1021 ;;停止動作
  1022                           ;RECOVER_MODULE_LOOP:
  1023                           ;BANKSEL BANK7
  1024                           ; MOVLW 0X00
  1025                           ; MOVWF ADR_83_L_DAT
  1026                           ; MOVLW 0X00
  1027                           ; MOVWF ADR_81_L_DAT
  1028                           ;BANKSEL PORTA
  1029                           ;CALL RECOVER_MODULE_LOOP_LV1
  1030                           ; BCF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
  1031                           ; RETURN
  1032                           ;
  1033                           ;
  1034                           ;
  1035                           ;
  1036                           ;
  1037 ;;--------------------------------------------------------------------------
  1038 ;;---------------------------------------------------------------------------
  1039 ;;---------------------------------------------------------------------------
  1040 ;;========================================================
  1041 ;;=============ADDR IS 0X04===============================
  1042 ;;========================================================
  1043                           ;RESET_STEP_FUNCTION:
  1044                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1045                           ; CALL STRONG_RESET_MOTOR_1_FUNC
  1046                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1047                           ; CALL STRONG_RESET_MOTOR_2_FUNC
  1048                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1049                           ;STRONG_RESET_MOTOR_1_FUNC:
  1050                           ;BANKSEL MOTOR_CONTROL_PORT
  1051                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1052                           ;BANKSEL PORTA
  1053                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1054                           ; RETURN
  1055                           ;STRONG_RESET_MOTOR_2_FUNC:
  1056                           ; BSF MOTOR2_FLAG0,MOTOR_2_RESET
  1057                           ; RETURN
  1058                           ;
  1059                           ;
  1060 ;;========================================================
  1061 ;;=============ADDR IS 0X00===============================
  1062 ;;========================================================
  1063                           ;CW_STEP_FUNCTION:
  1064                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1065                           ; CALL STRONG_CW_MOTOR_1_FUNC
  1066                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1067                           ; CALL STRONG_CW_MOTOR_2_FUNC
  1068                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1069                           ;STRONG_CW_MOTOR_1_FUNC:
  1070                           ;BANKSEL MOTOR_CONTROL_PORT
  1071                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1072                           ;BANKSEL PORTA
  1073                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1074                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1075                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1076                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1077                           ; RETURN
  1078                           ;STRONG_CW_MOTOR_2_FUNC:
  1079                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1080                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1081                           ; RETURN
  1082 ;;========================================================
  1083 ;;=============ADDR IS 0X01===============================
  1084 ;;========================================================
  1085                           ;CCW_STEP_FUNCTION:
  1086                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1087                           ; CALL STRONG_CCW_MOTOR_1_FUNC
  1088                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1089                           ; CALL STRONG_CCW_MOTOR_2_FUNC
  1090                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1091                           ;STRONG_CCW_MOTOR_1_FUNC:
  1092                           ;BANKSEL MOTOR_CONTROL_PORT
  1093                           ;BSF MOTOR_CONTROL_PORT,M1_FR
  1094                           ;BANKSEL PORTA
  1095                           ;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
  1096                           ; BSF MOTOR1_FLAG0,MOTOR_1_RESET
  1097                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1098                           ; BSF MOTOR1_FLAG0,MOTOR_1_WORK
  1099                           ; RETURN
  1100                           ;STRONG_CCW_MOTOR_2_FUNC:
  1101                           ; BSF FLAG1_BANK0,CAN_WORK_FLAG
  1102                           ; BSF MOTOR2_FLAG0,MOTOR_2_WORK
  1103                           ; RETURN
  1104 ;;========================================================
  1105 ;;=============ADDR IS 0X09===============================
  1106 ;;========================================================
  1107                           ;STRONG_STOP_FUNCTION:
  1108                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1109                           ; CALL STRONG_STOP_MOTOR_1_FUNC
  1110                           ; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1111                           ; CALL STRONG_STOP_MOTOR_2_FUNC
  1112 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1113 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1114 ;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1115 ;; CALL STRONG_STOP_MOTOR_1_FUNC
  1116                           ;
  1117                           ;
  1118                           ; GOTO ANAY_MODBUS_CMD_06_EXIT
  1119                           ;
  1120                           ;STRONG_STOP_MOTOR_1_FUNC:
  1121                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1122                           ; MOVWF FSR0H
  1123                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1124                           ; MOVWF FSR0L
  1125                           ; MOVLW 0X07
  1126                           ; ADDWF FSR0L,F
  1127                           ; MOVLW 0X04
  1128                           ; MOVWF INDF0
  1129 ;;----------
  1130                           ; MOVLW 0X01
  1131                           ; MOVWF STRONG_STOP_TEMP1
  1132                           ;BANKSEL MOTOR_CONTROL_PORT
  1133                           ; BCF MOTOR_CONTROL_PORT,M1_ST
  1134                           ;BANKSEL PORTA
  1135                           ; RETURN
  1136                           ;STRONG_STOP_MOTOR_2_FUNC:
  1137                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1138                           ; MOVWF FSR0H
  1139                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1140                           ; MOVWF FSR0L
  1141                           ; MOVLW 0X15
  1142                           ; ADDWF FSR0L,F
  1143                           ; MOVLW 0X07
  1144                           ; ADDWF FSR0L,F
  1145                           ; MOVLW 0X04
  1146                           ; MOVWF INDF0
  1147 ;;----------
  1148                           ; MOVLW 0X01
  1149                           ; MOVWF STRONG_STOP_TEMP2
  1150                           ;BANKSEL MOTOR_CONTROL_PORT
  1151                           ; BCF MOTOR_CONTROL_PORT,M2_ST
  1152                           ;BANKSEL PORTA
  1153                           ; RETURN
  1154                           ;
  1155                           ;
  1156                           ;
  1157                           ;
  1158                           ;
  1159                           ;
  1160                           ;
  1161 ;;----------------------------------------------------------
  1162                           ;WRITE_MOTOR_1_SOME_DATA:
  1163                           ; BSF FLAG2_BANK0,NOW_MOTOR_1_FLAG
  1164                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1165                           ; MOVWF FSR0H
  1166                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1167                           ; MOVWF FSR0L
  1168                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1169                           ;WRITE_MOTOR_2_SOME_DATA:
  1170                           ; BSF FLAG2_BANK0,NOW_MOTOR_2_FLAG
  1171                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1172                           ; MOVWF FSR0H
  1173                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1174                           ; MOVWF FSR0L
  1175                           ; MOVLW 0X15
  1176                           ; ADDWF FSR0L,F
  1177                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1178                           ;WRITE_MOTOR_3_SOME_DATA:
  1179                           ; BSF FLAG2_BANK0,NOW_MOTOR_3_FLAG
  1180                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1181                           ; MOVWF FSR0H
  1182                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1183                           ; MOVWF FSR0L
  1184                           ; MOVLW 0X2A
  1185                           ; ADDWF FSR0L,F
  1186                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1187                           ;WRITE_MOTOR_4_SOME_DATA:
  1188                           ; BSF FLAG2_BANK0,NOW_MOTOR_4_FLAG
  1189                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1190                           ; MOVWF FSR0H
  1191                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1192                           ; MOVWF FSR0L
  1193                           ; MOVLW 0X3F
  1194                           ; ADDWF FSR0L,F
  1195                           ; GOTO ANAY_MODBUS_CMD_06_LEVEL1
  1196                           ;
  1197                           ;
  1198                           ;
  1199                           ;
  1200                           ;
  1201                           ;
  1202                           ;
  1203                           ;
  1204                           ;
  1205                           ;
  1206                           ;
  1207                           ;
  1208                           ;
  1209                           ;
  1210                           ;
  1211                           ;******************************************************************************
  1212                           ;******************************************************************************
  1213                           ;========================================================
  1214                           ;==================中斷UART2 FUNCTION====================
  1215                           ;========================================================
  1216                           
  1217     00AC  3188               	pagesel	2048
  1218     00AD  
                 warning: (2090) fixup overflow storing 0xD1F in 2 bytes
                 251F               	call	MODBUS_INTPUT_FUNCTION	;將資料存在INDF1
  1219     00AE  3180               	pagesel	0
  1220     00AF  0009               	retfie
  1221     00B0                     TMR2IF_FUNCTION_LOOP:	
  1222                           ;========================================================
  1223                           ;==================中斷TIMER2 FUNCTION===================
  1224                           ;========================================================
  1225                           ;TIMER2 BASE IS 1mS
  1226                           
  1227     00B0  1091               	bcf	17,1
  1228                           
  1229                           ;---------------------
  1230     00B1  1CBA               	btfss	58,1
  1231     00B2  28B7               	goto	TMR2IF_FUNCTION_LV0
  1232     00B3  0848               	movf	72,w
  1233     00B4  1903               	btfsc	3,2
  1234     00B5  20EA               	call	TEN_MS_FUNCTION_LOOP
  1235     00B6  03C8               	decf	72,f
  1236     00B7                     TMR2IF_FUNCTION_LV0:
  1237     00B7  1E30               	btfss	48,4
  1238     00B8  28BD               	goto	TMR2IF_FUNC_LV1
  1239                           
  1240                           ;---------
  1241     00B9  0824               	movf	36,w
  1242     00BA  1903               	btfsc	3,2
  1243     00BB  28D4               	goto	TIMER2_INT_LV1
  1244     00BC  03A4               	decf	36,f
  1245     00BD                     TMR2IF_FUNC_LV1:
  1246                           
  1247                           ;判斷是否MODBUS RTU TIMEOUT 要啟動
  1248     00BD  3020               	movlw	32
  1249     00BE  0087               	movwf	7
  1250     00BF  30B0               	movlw	176
  1251     00C0  0086               	movwf	6
  1252     00C1  3008               	movlw	8
  1253     00C2  0786               	addwf	6,f
  1254     00C3  1C01               	btfss	1,0
  1255     00C4  0009               	retfie
  1256     00C5  0020               	banksel	12
  1257                           
  1258                           ;-----------------------------------
  1259     00C6  0386               	decf	6,f
  1260     00C7  0801               	movf	1,w
  1261     00C8  1D03               	btfss	3,2
  1262     00C9  28D0               	goto	RESET_MODBUS_TIMEOUT_FUNCTION
  1263                           
  1264                           ;-----------------------------------
  1265     00CA  0020               	banksel	12
  1266     00CB  0823               	movf	35,w
  1267     00CC  1903               	btfsc	3,2
  1268     00CD  2811               	goto	MODBUS_TIMEOUT_IS_FINISH_LOOP
  1269                           
  1270                           ;----------------------------------=
  1271     00CE  03A3               	decf	35,f
  1272     00CF  0009               	retfie
  1273     00D0                     RESET_MODBUS_TIMEOUT_FUNCTION:	
  1274                           ;-------------------------------------------------------
  1275                           
  1276                           
  1277                           ;表示還是持續有收到資料，TIME OUT 資料重製
  1278     00D0  0181               	clrf	1
  1279     00D1  3004               	movlw	4
  1280     00D2  00A3               	movwf	35
  1281     00D3  0009               	retfie
  1282     00D4                     TIMER2_INT_LV1:	
  1283                           ;------------------------------------------------------
  1284                           ;INT 時間
  1285                           
  1286     00D4  3004               	movlw	4
  1287     00D5  00A4               	movwf	36
  1288     00D6  0AC1               	incf	65,f
  1289     00D7  1230               	bcf	48,4
  1290     00D8  108B               	bcf	11,1
  1291     00D9  160B               	bsf	11,4
  1292     00DA  1EB2               	btfss	50,5
  1293     00DB  0009               	retfie
  1294     00DC  3021               	movlw	33
  1295     00DD  0085               	movwf	5
  1296     00DE  3090               	movlw	144
  1297     00DF  0084               	movwf	4
  1298     00E0  3015               	movlw	21
  1299     00E1  0784               	addwf	4,f
  1300     00E2  3005               	movlw	5
  1301     00E3  0784               	addwf	4,f
  1302     00E4  3001               	movlw	1
  1303     00E5  0280               	subwf	0,f
  1304     00E6  0384               	decf	4,f
  1305     00E7  3000               	movlw	0
  1306     00E8  3B80               	subwfb	0,f
  1307     00E9  0009               	retfie
  1308     00EA                     TEN_MS_FUNCTION_LOOP:
  1309     00EA  3002               	movlw	2
  1310     00EB  00C8               	movwf	72
  1311     00EC  3001               	movlw	1
  1312     00ED  07C7               	addwf	71,f
  1313     00EE  3000               	movlw	0
  1314     00EF  3DC6               	addwfc	70,f
  1315     00F0  0008               	return
  1316     00F1                     IOC_INT_FUNCTION:	
  1317                           ;========================================================
  1318                           ;==================中斷IOC FUNCTION====================
  1319                           ;========================================================
  1320                           ;設定上下極限當有觸發到時，會先觸發IOC
  1321                           
  1322     00F1  100B               	bcf	11,0
  1323     00F2  0027               	banksel	918
  1324     00F3  1896               	btfsc	918,1
  1325     00F4  20F8               	call	IOCBF1_INT_LOOP
  1326                           
  1327                           ;--------
  1328     00F5  1916               	btfsc	918,2
  1329     00F6  20FB               	call	IOCBF2_INT_LOOP
  1330     00F7  0009               	retfie
  1331     00F8                     IOCBF1_INT_LOOP:	
  1332                           ;----------------------------------------------------------
  1333                           
  1334     00F8  1096               	bcf	918,1
  1335     00F9  0027               	banksel	918
  1336     00FA  0008               	return
  1337     00FB                     IOCBF2_INT_LOOP:
  1338     00FB  1116               	bcf	918,2
  1339     00FC  0020               	banksel	12
  1340     00FD  0008               	return
  1341     00FE                     INT_INTF_FUNCTION:	
  1342                           ;========================================================
  1343                           ;==================中斷INT FUNCTION====================
  1344                           ;========================================================
  1345                           
  1346     00FE  108B               	bcf	11,1
  1347     00FF  1A30               	btfsc	48,4
  1348     0100  0009               	retfie
  1349     0101  1630               	bsf	48,4
  1350     0102  120B               	bcf	11,4
  1351     0103  0009               	retfie
  1352     0104                     MODBUS_RTU_READ_LV2:	
  1353                           ;========================================================
  1354                           ;=============MODBUS 計算其CRC 功能======================
  1355                           ;========================================================
  1356                           
  1357     0104  0020               	banksel	12
  1358     0105  30FF               	movlw	255
  1359     0106  00A8               	movwf	40
  1360     0107  30FF               	movlw	255
  1361     0108  00A9               	movwf	41
  1362                           
  1363                           ;---------
  1364     0109  3020               	movlw	32
  1365     010A  0087               	movwf	7
  1366     010B  30B0               	movlw	176
  1367     010C  0086               	movwf	6
  1368     010D  300A               	movlw	10
  1369     010E  0786               	addwf	6,f	;這裡是第一筆資料的位置
  1370     010F                     MODBUS_RTU_READ_CRC_LOOP:	
  1371                           ;---------
  1372                           
  1373     010F  0801               	movf	1,w
  1374     0110  00A7               	movwf	39
  1375     0111  24C3               	call	CRC_16_FUNCTION_LOOP
  1376     0112  0A86               	incf	6,f
  1377     0113  0BAA               	decfsz	42,f
  1378     0114  290F               	goto	MODBUS_RTU_READ_CRC_LOOP
  1379     0115  0829               	movf	41,w
  1380     0116  0081               	movwf	1
  1381     0117  0A86               	incf	6,f
  1382     0118  0828               	movf	40,w
  1383     0119  0081               	movwf	1
  1384     011A  0008               	return
  1385     011B                     SYSTEM_START_SETTING:	
  1386                           ;========================================================
  1387                           ;================== 主程序前參數設定 ====================
  1388                           ;========================================================
  1389                           
  1390                           
  1391                           ;========================================================
  1392                           ;=====================振盪器設定=========================
  1393                           ;========================================================
  1394     011B  0021               	banksel	153
  1395     011C  3072               	movlw	114
  1396     011D  0099               	movwf	153	;8MHZ
  1397     011E  3000               	movlw	0
  1398     011F  0098               	movwf	152	;校正後頻率
  1399     0120  3011               	movlw	17
  1400     0121  009A               	movwf	154	;高頻振盪精度0.5%
  1401                           
  1402                           ;========================================================
  1403                           ;=====================OPTION設定=========================
  1404                           ;========================================================
  1405     0122  30C8               	movlw	200
  1406     0123  0095               	movwf	149	;BIT6 0->rising 1->falling
  1407                           
  1408                           ;========================================================
  1409                           ;======================中斷設定==========================
  1410                           ;========================================================
  1411     0124  3040               	movlw	64
  1412     0125  008B               	movwf	11
  1413     0126  0021               	banksel	145
  1414     0127  3000               	movlw	0
  1415     0128  0091               	movwf	145	;BIT 3 = MSSP 1 INTERRUPT, BIT 5 = USART 1 RECIEVE INTERRUPT
  1416     0129  3000               	movlw	0
  1417     012A  0092               	movwf	146
  1418     012B  3000               	movlw	0
  1419     012C  0093               	movwf	147
  1420     012D  3000               	movlw	0
  1421     012E  0094               	movwf	148
  1422                           
  1423                           ;========================================================
  1424                           ;========================ADC設定=========================
  1425                           ;========================================================
  1426     012F  0021               	banksel	157
  1427     0130  3000               	movlw	0
  1428     0131  009D               	movwf	157
  1429     0132  3000               	movlw	0
  1430     0133  009E               	movwf	158
  1431     0134  0023               	banksel	396
  1432     0135  018C               	clrf	396
  1433     0136  0190               	clrf	400
  1434     0137  0028               	banksel	1036
  1435     0138  018C               	clrf	1036
  1436     0139  018D               	clrf	1037
  1437     013A  0020               	banksel	12
  1438                           
  1439                           ;========================================================
  1440                           ;=====================I/O設定============================
  1441                           ;========================================================
  1442     013B  0021               	banksel	140
  1443     013C  30C0               	movlw	192
  1444     013D  008C               	movwf	140
  1445     013E  30FF               	movlw	255
  1446     013F  008D               	movwf	141
  1447     0140  3000               	movlw	0
  1448     0141  008E               	movwf	142
  1449     0142  300F               	movlw	15
  1450     0143  008F               	movwf	143
  1451     0144  30FF               	movlw	255
  1452     0145  0090               	movwf	144
  1453     0146  0026               	banksel	780
  1454     0147  3000               	movlw	0
  1455     0148  008C               	movwf	780
  1456     0149  30F6               	movlw	246
  1457     014A  008D               	movwf	781
  1458                           
  1459                           ;---------------
  1460     014B  0022               	banksel	268
  1461     014C  3000               	movlw	0
  1462     014D  008C               	movwf	268
  1463     014E  3000               	movlw	0
  1464     014F  008D               	movwf	269
  1465     0150  3000               	movlw	0
  1466     0151  008E               	movwf	270
  1467     0152  3000               	movlw	0
  1468     0153  008F               	movwf	271
  1469     0154  3000               	movlw	0
  1470     0155  0090               	movwf	272
  1471     0156  0027               	banksel	908
  1472     0157  018C               	clrf	908
  1473     0158  018D               	clrf	909
  1474                           
  1475                           ;---------------
  1476     0159  0020               	banksel	12
  1477     015A  018C               	clrf	12
  1478     015B  018D               	clrf	13
  1479     015C  018E               	clrf	14
  1480     015D  018F               	clrf	15
  1481     015E  0190               	clrf	16
  1482                           
  1483                           ;---------------
  1484     015F  0025               	banksel	652
  1485     0160  018C               	clrf	652
  1486     0161  018D               	clrf	653
  1487     0162  0020               	banksel	12
  1488     0163  2530               	call	DELAY_1000ms
  1489                           
  1490                           ;========================================================
  1491                           ;=====================暫存器設定=========================
  1492                           ;========================================================
  1493     0164  24F9               	call	CLEAN_ALL_REGISTER
  1494     0165  3188               	pagesel	2048
  1495     0166  
                 warning: (2090) fixup overflow storing 0xD08 in 2 bytes
                 2508               	call	SET_MODBUS_MODE_ENABLE	;設定uart2硬體
  1496     0167  3180               	pagesel	0
  1497                           
  1498                           ;========================================================
  1499                           ;=====================TIMER2設定=========================
  1500                           ;========================================================
  1501     0168  24E8               	call	SET_TMR2_BASE_TIME	;設定TIMER2基礎時間
  1502     0169  24F1               	call	SET_TMR2_INT_EN	;TIMER2中斷啟動
  1503     016A  24F5               	call	SET_TMR2_ON	;啟動TIMER2功能
  1504     016B                     ADC_HW_SETTING:	
  1505                           ;========================================================
  1506                           ;=====================ADC設定============================
  1507                           ;========================================================
  1508                           
  1509     016B  0028               	banksel	1037
  1510     016C  3010               	movlw	16
  1511     016D  008D               	movwf	1037
  1512                           
  1513                           ;-------------------------ADC_OPEN-------------------------
  1514     016E  0021               	banksel	158
  1515     016F  3031               	movlw	49	;AN12啟動
  1516     0170  009D               	movwf	157
  1517     0171  30C0               	movlw	192
  1518     0172  009E               	movwf	158
  1519     0173  0020               	banksel	12
  1520     0174  2535               	call	DELAY_100ms
  1521     0175                     SETTING_PWM_HW_LOOP:	
  1522                           ;========================================================
  1523                           ;=====================PWM輸出設定========================
  1524                           ;========================================================
  1525                           
  1526                           
  1527                           ;-------------------------------------設定相對應接腳TIMER
  1528     0175  0025               	banksel	670
  1529     0176  30DF               	movlw	223
  1530     0177  009E               	movwf	670
  1531     0178  300F               	movlw	15
  1532     0179  009F               	movwf	671
  1533                           
  1534                           ;-------------------------------------決定週期
  1535     017A  0028               	banksel	1046
  1536     017B  309C               	movlw	156
  1537     017C  0096               	movwf	1046
  1538                           
  1539                           ;-------------------------------------啟動TIMER
  1540     017D  0028               	banksel	1047
  1541     017E  307F               	movlw	127
  1542     017F  0097               	movwf	1047
  1543                           
  1544                           ;-------------------------------------決定DUTY CYCLE
  1545     0180  0026               	banksel	785
  1546     0181  3032               	movlw	50
  1547     0182  0091               	movwf	785
  1548                           
  1549                           ;-------------------------------------啟動PWM
  1550     0183  0026               	banksel	787
  1551     0184  300C               	movlw	12
  1552     0185  0093               	movwf	787
  1553     0186                     IOC_HW_SETTING:	
  1554                           ;========================================================
  1555                           ;=====================IOC設定============================
  1556                           ;========================================================
  1557                           
  1558     0186  0027               	banksel	916
  1559     0187  3000               	movlw	0
  1560     0188  0095               	movwf	917
  1561     0189  3000               	movlw	0
  1562     018A  0094               	movwf	916	;正緣觸發
  1563     018B                     CHECK_PWM_FREQ_FUCNTION:	
  1564 ;;========================================================
  1565 ;;=====================DIP SWITCH判斷=====================
  1566 ;;========================================================
  1567                           ;DIP_SWITCH_ADR_FUNCTION:
  1568                           ;BANKSEL ADDR_0_1_2_3_PORT
  1569                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_0
  1570                           ; BSF MOTOR1_FLAG0,MOTOR_1_EN
  1571 ;;---------
  1572                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_1
  1573                           ; BSF MOTOR2_FLAG0,MOTOR_2_EN
  1574 ;;---------
  1575                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_2
  1576                           ; BSF MOTOR3_FLAG0,MOTOR_3_EN
  1577 ;;---------
  1578                           ; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_3
  1579                           ; BSF MOTOR4_FLAG0,MOTOR_4_EN
  1580                           ;---------
  1581                           ;========================================================
  1582                           ;=====================PWM頻率偵測========================
  1583                           ;========================================================
  1584                           
  1585     018B                     ID_SELECT_LOOP:	
  1586                           ;CALL ADC_TAKE_DATA_FUNCTION
  1587                           ;========================================================
  1588                           ;=====================ID SELECT==========================
  1589                           ;========================================================
  1590                           ;這邊判斷ID的條件是由ADC RF0的數值來判斷
  1591                           
  1592     018B  0020               	banksel	12
  1593     018C  01A5               	clrf	37
  1594     018D                     POWER_LED_OUTPUT_FUNCTION:	
  1595                           ;========================================================
  1596                           ;===================POWER LED輸出========================
  1597                           ;========================================================
  1598                           
  1599     018D  0020               	banksel	13
  1600     018E  1E8D               	btfss	13,5
  1601     018F  2992               	goto	POWER_LED_OUTPUT_EXIT
  1602     0190  0027               	banksel	908
  1603     0191  140C               	bsf	908,0
  1604     0192                     POWER_LED_OUTPUT_EXIT:
  1605     0192  0020               	banksel	12
  1606     0193                     INT_HW_SETTING:	
  1607                           ;--------------------------------------------------------
  1608                           ;--------------------------------------------------------
  1609                           ;========================================================
  1610                           ;=====================INT設定============================
  1611                           ;========================================================
  1612                           
  1613     0193  0027               	banksel	909
  1614     0194  118D               	bcf	909,3	;將MAX485設定為RX模式
  1615     0195  160B               	bsf	11,4
  1616     0196  158B               	bsf	11,3
  1617     0197  0021               	banksel	148
  1618     0198  1694               	bsf	148,5
  1619     0199  1491               	bsf	145,1
  1620     019A  178B               	bsf	11,7
  1621     019B  0020               	banksel	12
  1622     019C  3002               	movlw	2
  1623     019D  00C8               	movwf	72
  1624     019E  3004               	movlw	4
  1625     019F  00A4               	movwf	36
  1626     01A0  0022               	banksel	268
  1627     01A1  160C               	bsf	268,4
  1628     01A2  168C               	bsf	268,5
  1629     01A3  100E               	bcf	270,0
  1630     01A4  110E               	bcf	270,2
  1631     01A5  108E               	bcf	270,1
  1632     01A6  118E               	bcf	270,3
  1633     01A7  0020               	banksel	12
  1634     01A8  3004               	movlw	4
  1635     01A9  00A5               	movwf	37
  1636                           
  1637                           ;BCF INTCON,GIE
  1638     01AA  29AB               	goto	SYSTEM_START
  1639     01AB                     SYSTEM_START:	
  1640                           ;********************************************************************************
  1641                           ;********************************************************************************
  1642                           ;========================================================
  1643                           ;=====================主程序迴圈=========================
  1644                           ;========================================================
  1645                           ;缺少:ADC/馬達復位/馬達CW CCW
  1646                           
  1647     01AB  0020               	banksel	12
  1648     01AC                     SYSTEM_START_LV1:	
  1649                           ; BTFSC PORTE,0X00
  1650                           ; GOTO MOTOR_2_WORK1
  1651                           ; GOTO MOTOR_2_STOP
  1652                           ;BANKSEL PORTA
  1653                           
  1654     01AC  1AB0               	btfsc	48,5
  1655     01AD  21BD               	call	DEAL_WITH_MODBUS_LOOP	;中斷收值okCRCok，要判斷後續動作
  1656                           
  1657                           ;------------------------------------------- ;傳送ERROR CODE的地方
  1658     01AE  183B               	btfsc	59,0
  1659     01AF  2277               	call	MODBUS_ERROR_CODE_01_LOOP
  1660     01B0  18BB               	btfsc	59,1
  1661     01B1  228B               	call	MODBUS_ERROR_CODE_02_LOOP
  1662     01B2  193B               	btfsc	59,2
  1663     01B3  2299               	call	MODBUS_ERROR_CODE_03_LOOP
  1664     01B4  19BB               	btfsc	59,3
  1665     01B5  22A7               	call	MODBUS_ERROR_CODE_04_LOOP
  1666     01B6  1A3B               	btfsc	59,4
  1667     01B7  22B5               	call	MODBUS_ERROR_CODE_05_LOOP
  1668     01B8  1ABB               	btfsc	59,5
  1669     01B9  22C3               	call	MODBUS_ERROR_CODE_06_LOOP
  1670                           
  1671                           ;-------------------------------------------
  1672     01BA  1830               	btfsc	48,0
  1673     01BB  2472               	call	PREPARE_TX_DATA_LOOP	;UART TX傳送資料
  1674                           
  1675                           ;-------------------------------------------
  1676     01BC  29AB               	goto	SYSTEM_START
  1677     01BD                     DEAL_WITH_MODBUS_LOOP:	
  1678                           ;========================================================
  1679                           ;====================處理MODBUS指令======================
  1680                           ;========================================================
  1681                           
  1682     01BD  12B0               	bcf	48,5
  1683     01BE  3188               	pagesel	2048
  1684     01BF  
                 warning: (2090) fixup overflow storing 0x800 in 2 bytes
                 2000               	call	MODBUS_ADR_FUNCTION
  1685     01C0  3180               	pagesel	0
  1686     01C1  0008               	return
  1687     01C2                     CHECK_MOTOR2_ZERO_LOOP:	
  1688 ;;-----------
  1689                           ; BTFSC FLAG1_BANK0,CAN_WORK_FLAG
  1690                           ; CALL MODULE_WORK_LOOP ;順逆轉馬達動作
  1691 ;;-----------
  1692                           ;
  1693                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_RESET
  1694                           ; CALL MOTOR_2_ZERO_FUNCTION
  1695                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_ING_ZERO
  1696                           ; CALL CHECK_MOTOR2_ZERO_LOOP
  1697 ;;--------------------------------------
  1698                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_RESET
  1699                           ; CALL MOTOR_1_ZERO_FUNCTION
  1700                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_HI_ZERO
  1701                           ; CALL MOTOR1_ZERO_IN_HI_LOOP
  1702                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_ING_ZERO
  1703                           ; CALL MOTOR1_ZERO_IN_LO_LOOP
  1704                           ; GOTO SYSTEM_START
  1705 ;;--------------------------------------
  1706                           ;MOTOR_2_WORK1:
  1707                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1708                           ; MOVWF FSR0H
  1709                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1710                           ; MOVWF FSR0L
  1711                           ; MOVLW 0X15
  1712                           ; ADDWF FSR0L,F
  1713                           ; MOVLW 0X0F
  1714                           ; ADDWF FSR0L,F
  1715                           ; MOVLW 0X00
  1716                           ; MOVWF INDF0
  1717                           ; GOTO SYSTEM_START_LV1
  1718                           ;MOTOR_2_STOP:
  1719                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1720                           ; MOVWF FSR0H
  1721                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1722                           ; MOVWF FSR0L
  1723                           ; MOVLW 0X15
  1724                           ; ADDWF FSR0L,F
  1725                           ; MOVLW 0X0F
  1726                           ; ADDWF FSR0L,F
  1727                           ; MOVLW 0XFF
  1728                           ; MOVWF INDF0
  1729                           ; GOTO SYSTEM_START_LV1
  1730                           ;========================================================
  1731                           ;=====================注射馬達復位完成===================
  1732                           ;========================================================
  1733                           
  1734     01C2  1A3A               	btfsc	58,4
  1735     01C3  0008               	return
  1736     01C4  18B6               	btfsc	54,1
  1737     01C5  0008               	return
  1738     01C6  1810               	btfsc	16,0
  1739     01C7  0008               	return
  1740     01C8  0022               	banksel	270
  1741     01C9  110E               	bcf	270,2
  1742     01CA  0020               	banksel	12
  1743     01CB  01C3               	clrf	67
  1744     01CC  0020               	banksel	12
  1745     01CD  12B2               	bcf	50,5
  1746     01CE  1036               	bcf	54,0
  1747                           
  1748                           ;-----------------------------
  1749     01CF  3021               	movlw	33
  1750     01D0  0085               	movwf	5
  1751     01D1  3090               	movlw	144
  1752     01D2  0084               	movwf	4
  1753     01D3  3015               	movlw	21
  1754     01D4  0784               	addwf	4,f
  1755     01D5  3004               	movlw	4
  1756     01D6  0784               	addwf	4,f
  1757     01D7  0180               	clrf	0
  1758     01D8  0A84               	incf	4,f
  1759     01D9  0180               	clrf	0
  1760                           
  1761                           ;---------------------------------------------清除累加步數
  1762     01DA  3021               	movlw	33
  1763     01DB  0085               	movwf	5
  1764     01DC  3090               	movlw	144
  1765     01DD  0084               	movwf	4
  1766     01DE  3015               	movlw	21
  1767     01DF  0784               	addwf	4,f
  1768     01E0  3007               	movlw	7
  1769     01E1  0784               	addwf	4,f
  1770     01E2  3000               	movlw	0
  1771     01E3  0080               	movwf	0
  1772     01E4  0027               	banksel	908
  1773     01E5  3000               	movlw	0
  1774     01E6  00A3               	movwf	163
  1775     01E7  0020               	banksel	12
  1776     01E8  0008               	return
  1777     01E9                     MOTOR1_ZERO_IN_LO_LOOP:	
  1778                           ;--------------------------------------------
  1779                           
  1780     01E9  1A3A               	btfsc	58,4
  1781     01EA  0008               	return
  1782     01EB  18B5               	btfsc	53,1
  1783     01EC  0008               	return
  1784     01ED  1D0D               	btfss	13,2
  1785     01EE  2A28               	goto	MOTOR1_TIME_ZERO_LOOP
  1786     01EF  3001               	movlw	1
  1787     01F0  07D1               	addwf	81,f
  1788     01F1  3000               	movlw	0
  1789     01F2  3DD0               	addwfc	80,f
  1790     01F3  30FD               	movlw	253
  1791     01F4  0750               	addwf	80,w
  1792     01F5  1C03               	btfss	3,0
  1793     01F6  0008               	return
  1794     01F7  300C               	movlw	12
  1795     01F8  0751               	addwf	81,w
  1796     01F9  1C03               	btfss	3,0
  1797     01FA  0008               	return
  1798     01FB                     MOTOR1_ZERO_IN_LO_LOOP_LV1:	
  1799                           ; MOVF IOC_COUNTER_HBYTE,W
  1800                           ; BTFSS STATUS,Z
  1801                           ; GOTO MOTOR1_ZERO_IN_LO_LOOP_LV1
  1802 ;;------
  1803                           ; MOVLW 0XFE
  1804                           ; ADDWF IOC_COUNTER_LBYTE,W
  1805                           ; BTFSS STATUS,C
  1806                           ; RETURN
  1807                           
  1808     01FB  0022               	banksel	270
  1809     01FC  100E               	bcf	270,0
  1810     01FD  0020               	banksel	12
  1811     01FE  13B1               	bcf	49,7
  1812     01FF  12B1               	bcf	49,5
  1813     0200  10BA               	bcf	58,1
  1814     0201  3021               	movlw	33
  1815     0202  0085               	movwf	5
  1816     0203  3090               	movlw	144
  1817     0204  0084               	movwf	4
  1818     0205  3007               	movlw	7
  1819     0206  0784               	addwf	4,f
  1820     0207  3000               	movlw	0
  1821     0208  0080               	movwf	0
  1822                           
  1823                           ;----------
  1824     0209  3000               	movlw	0
  1825     020A  00C2               	movwf	66
  1826     020B  1035               	bcf	53,0
  1827     020C  0027               	banksel	908
  1828     020D  3000               	movlw	0
  1829     020E  00A3               	movwf	163
  1830     020F  0020               	banksel	12
  1831     0210  183C               	btfsc	60,0
  1832     0211  2AEF               	goto	RESET_END_IN_NORMAL_LOOP
  1833                           
  1834                           ;BANKSEL IOCBN
  1835                           ; BSF IOCBN,0X02
  1836                           ; BCF IOCBP,0X02
  1837                           ;BANKSEL PORTA
  1838     0212  0008               	return
  1839     0213                     MOTOR1_ZERO_IN_HI_LOOP:	
  1840                           ;-------------------------------------------------------------
  1841                           ;-------------------------------------------------------------
  1842                           
  1843     0213  1A3A               	btfsc	58,4
  1844     0214  0008               	return
  1845     0215  18B5               	btfsc	53,1
  1846     0216  0008               	return
  1847     0217  190D               	btfsc	13,2
  1848     0218  2A28               	goto	MOTOR1_TIME_ZERO_LOOP
  1849     0219  3001               	movlw	1
  1850     021A  07D1               	addwf	81,f
  1851     021B  3000               	movlw	0
  1852     021C  3DD0               	addwfc	80,f
  1853     021D  30FD               	movlw	253
  1854     021E  0750               	addwf	80,w
  1855     021F  1C03               	btfss	3,0
  1856     0220  0008               	return
  1857     0221  300C               	movlw	12
  1858     0222  0751               	addwf	81,w
  1859     0223  1C03               	btfss	3,0
  1860     0224  0008               	return
  1861     0225                     MOTOR1_ZERO_IN_HI_LOOP_LV1:	
  1862                           ; MOVF IOC_COUNTER_HBYTE,W
  1863                           ; BTFSS STATUS,Z
  1864                           ; GOTO MOTOR1_ZERO_IN_HI_LOOP_LV1
  1865 ;;------
  1866                           ; MOVLW 0XFE
  1867                           ; ADDWF IOC_COUNTER_LBYTE,W
  1868                           ; BTFSS STATUS,C
  1869                           ; RETURN
  1870                           
  1871     0225  13B1               	bcf	49,7
  1872     0226  1331               	bcf	49,6
  1873     0227  2A47               	goto	MOTOR_1_NOW_IS_LO
  1874     0228                     MOTOR1_TIME_ZERO_LOOP:
  1875                           
  1876                           ;CLRF IOC_COUNTER_HBYTE
  1877                           ;CLRF IOC_COUNTER_LBYTE
  1878     0228  0AD3               	incf	83,f
  1879     0229  309C               	movlw	156
  1880     022A  0753               	addwf	83,w
  1881     022B  1C03               	btfss	3,0
  1882     022C  0008               	return
  1883     022D  01D3               	clrf	83
  1884     022E  01D1               	clrf	81
  1885     022F  01D0               	clrf	80
  1886     0230  0008               	return
  1887     0231                     MOTOR_1_ZERO_FUNCTION:	
  1888                           ;========================================================
  1889                           ;=====================轉向馬達復位=======================
  1890                           ;========================================================
  1891                           
  1892     0231  1A3A               	btfsc	58,4
  1893     0232  0008               	return
  1894     0233  18B5               	btfsc	53,1
  1895     0234  0008               	return
  1896     0235  1435               	bsf	53,0
  1897                           
  1898                           ;BANKSEL BANK7
  1899                           ; MOVLW 0X01
  1900                           ; MOVWF ADR_81_L_DAT
  1901     0236  0020               	banksel	12
  1902     0237  1231               	bcf	49,4
  1903                           
  1904                           ;-----------
  1905     0238  3021               	movlw	33
  1906     0239  0085               	movwf	5
  1907     023A  3090               	movlw	144
  1908     023B  0084               	movwf	4
  1909     023C  3007               	movlw	7
  1910     023D  0784               	addwf	4,f
  1911     023E  3004               	movlw	4
  1912     023F  0080               	movwf	0
  1913                           
  1914                           ;----------
  1915     0240  3001               	movlw	1
  1916     0241  00C2               	movwf	66
  1917     0242  0022               	banksel	270
  1918     0243  140E               	bsf	270,0
  1919                           
  1920                           ;BCF MOTOR_CONTROL_PORT,M1_FR
  1921                           ; BSF MOTOR_CONTROL_PORT,M1_FR
  1922     0244  0020               	banksel	12
  1923     0245  190D               	btfsc	13,2
  1924     0246  2A51               	goto	MOTOR_1_NOW_IS_HI	;目前是HI
  1925     0247                     MOTOR_1_NOW_IS_LO:
  1926                           
  1927                           ;目前是LO
  1928     0247  0020               	banksel	12
  1929     0248  16B1               	bsf	49,5
  1930     0249  1331               	bcf	49,6
  1931     024A  14BA               	bsf	58,1
  1932     024B  01C6               	clrf	70
  1933     024C  01C7               	clrf	71
  1934     024D  01D0               	clrf	80
  1935     024E  01D1               	clrf	81
  1936     024F  01D3               	clrf	83
  1937     0250  0008               	return
  1938     0251                     MOTOR_1_NOW_IS_HI:
  1939     0251  0020               	banksel	12
  1940     0252  1731               	bsf	49,6
  1941     0253  12B1               	bcf	49,5
  1942     0254  14BA               	bsf	58,1
  1943     0255  01C6               	clrf	70
  1944     0256  01C7               	clrf	71
  1945     0257  01D0               	clrf	80
  1946     0258  01D1               	clrf	81
  1947     0259  01D3               	clrf	83
  1948     025A  0008               	return
  1949     025B                     MOTOR_2_ZERO_FUNCTION:	
  1950                           ;========================================================
  1951                           ;=====================注射馬達復位進行中=================
  1952                           ;========================================================
  1953                           
  1954     025B  1A3A               	btfsc	58,4
  1955     025C  0008               	return
  1956     025D  18B6               	btfsc	54,1
  1957     025E  0008               	return
  1958     025F  1232               	bcf	50,4
  1959     0260  1C10               	btfss	16,0
  1960     0261  0008               	return
  1961     0262  0027               	banksel	908
  1962     0263  3001               	movlw	1
  1963     0264  00A3               	movwf	163
  1964     0265  0020               	banksel	12
  1965     0266  1436               	bsf	54,0
  1966                           
  1967                           ; MOVLW MODBUS_DAT_REAL_ADRH
  1968                           ; MOVWF FSR0H
  1969                           ; MOVLW MODBUS_DAT_REAL_ADRL
  1970                           ; MOVWF FSR0L
  1971                           ; MOVLW 0X15
  1972                           ; ADDWF FSR0L,F
  1973                           ; MOVLW 0X0F
  1974                           ; ADDWF FSR0L,F
  1975                           ; MOVLW 0X00
  1976                           ; MOVWF INDF0
  1977                           ;------------------------------------
  1978     0267  3021               	movlw	33
  1979     0268  0085               	movwf	5
  1980     0269  3090               	movlw	144
  1981     026A  0084               	movwf	4
  1982     026B  3015               	movlw	21
  1983     026C  0784               	addwf	4,f
  1984     026D  3007               	movlw	7
  1985     026E  0784               	addwf	4,f
  1986     026F  3001               	movlw	1
  1987     0270  0080               	movwf	0
  1988     0271  0022               	banksel	270
  1989     0272  118E               	bcf	270,3
  1990     0273  150E               	bsf	270,2
  1991     0274  0020               	banksel	12
  1992     0275  16B2               	bsf	50,5
  1993     0276  0008               	return
  1994     0277                     MODBUS_ERROR_CODE_01_LOOP:	
  1995                           ;========================================================
  1996                           ;===============MODBUS ERROR CODE IS 01==================
  1997                           ;========================================================
  1998                           
  1999     0277  103B               	bcf	59,0
  2000     0278  3020               	movlw	32
  2001     0279  0087               	movwf	7
  2002     027A  30B0               	movlw	176
  2003     027B  0086               	movwf	6
  2004     027C  300A               	movlw	10
  2005     027D  0786               	addwf	6,f
  2006                           
  2007                           ;---------------------
  2008     027E  0A86               	incf	6,f
  2009     027F  3080               	movlw	128
  2010     0280  0481               	iorwf	1,f
  2011     0281  0A86               	incf	6,f
  2012     0282  3001               	movlw	1
  2013     0283  0081               	movwf	1
  2014     0284                     MODBUS_ERROR_CODE_END:	
  2015                           ;--------------------
  2016                           ;--------------------
  2017                           
  2018     0284  3003               	movlw	3
  2019     0285  00AA               	movwf	42	;ID 功能碼 DATA 由這三個生成CRC16
  2020     0286  2104               	call	MODBUS_RTU_READ_LV2	;CRC16生成副程式
  2021     0287  3005               	movlw	5
  2022     0288  00AD               	movwf	45
  2023     0289  1430               	bsf	48,0
  2024     028A  0008               	return
  2025     028B                     MODBUS_ERROR_CODE_02_LOOP:	
  2026                           ;========================================================
  2027                           ;===============MODBUS ERROR CODE IS 02==================
  2028                           ;========================================================
  2029                           
  2030     028B  10BB               	bcf	59,1
  2031     028C  3020               	movlw	32
  2032     028D  0087               	movwf	7
  2033     028E  30B0               	movlw	176
  2034     028F  0086               	movwf	6
  2035     0290  300A               	movlw	10
  2036     0291  0786               	addwf	6,f
  2037                           
  2038                           ;---------------------
  2039     0292  0A86               	incf	6,f
  2040     0293  3080               	movlw	128
  2041     0294  0481               	iorwf	1,f
  2042     0295  0A86               	incf	6,f
  2043     0296  3002               	movlw	2
  2044     0297  0081               	movwf	1
  2045                           
  2046                           ;--------------------
  2047     0298  2A84               	goto	MODBUS_ERROR_CODE_END
  2048     0299                     MODBUS_ERROR_CODE_03_LOOP:	
  2049                           ;========================================================
  2050                           ;===============MODBUS ERROR CODE IS 03==================
  2051                           ;========================================================
  2052                           
  2053     0299  113B               	bcf	59,2
  2054     029A  3020               	movlw	32
  2055     029B  0087               	movwf	7
  2056     029C  30B0               	movlw	176
  2057     029D  0086               	movwf	6
  2058     029E  300A               	movlw	10
  2059     029F  0786               	addwf	6,f
  2060                           
  2061                           ;---------------------
  2062     02A0  0A86               	incf	6,f
  2063     02A1  3080               	movlw	128
  2064     02A2  0481               	iorwf	1,f
  2065     02A3  0A86               	incf	6,f
  2066     02A4  3003               	movlw	3
  2067     02A5  0081               	movwf	1
  2068                           
  2069                           ;--------------------
  2070     02A6  2A84               	goto	MODBUS_ERROR_CODE_END
  2071     02A7                     MODBUS_ERROR_CODE_04_LOOP:	
  2072                           ;========================================================
  2073                           ;===============MODBUS ERROR CODE IS 04==================
  2074                           ;========================================================
  2075                           
  2076     02A7  11BB               	bcf	59,3
  2077     02A8  3020               	movlw	32
  2078     02A9  0087               	movwf	7
  2079     02AA  30B0               	movlw	176
  2080     02AB  0086               	movwf	6
  2081     02AC  300A               	movlw	10
  2082     02AD  0786               	addwf	6,f
  2083                           
  2084                           ;---------------------
  2085     02AE  0A86               	incf	6,f
  2086     02AF  3080               	movlw	128
  2087     02B0  0481               	iorwf	1,f
  2088     02B1  0A86               	incf	6,f
  2089     02B2  3004               	movlw	4
  2090     02B3  0081               	movwf	1
  2091                           
  2092                           ;--------------------
  2093     02B4  2A84               	goto	MODBUS_ERROR_CODE_END
  2094     02B5                     MODBUS_ERROR_CODE_05_LOOP:	
  2095                           ;========================================================
  2096                           ;===============MODBUS ERROR CODE IS 05==================
  2097                           ;========================================================
  2098                           
  2099     02B5  123B               	bcf	59,4
  2100     02B6  3020               	movlw	32
  2101     02B7  0087               	movwf	7
  2102     02B8  30B0               	movlw	176
  2103     02B9  0086               	movwf	6
  2104     02BA  300A               	movlw	10
  2105     02BB  0786               	addwf	6,f
  2106                           
  2107                           ;---------------------
  2108     02BC  0A86               	incf	6,f
  2109     02BD  3080               	movlw	128
  2110     02BE  0481               	iorwf	1,f
  2111     02BF  0A86               	incf	6,f
  2112     02C0  3005               	movlw	5
  2113     02C1  0081               	movwf	1
  2114                           
  2115                           ;--------------------
  2116     02C2  2A84               	goto	MODBUS_ERROR_CODE_END
  2117     02C3                     MODBUS_ERROR_CODE_06_LOOP:	
  2118                           ;========================================================
  2119                           ;===============MODBUS ERROR CODE IS 06==================
  2120                           ;========================================================
  2121                           
  2122     02C3  12BB               	bcf	59,5
  2123     02C4  3020               	movlw	32
  2124     02C5  0087               	movwf	7
  2125     02C6  30B0               	movlw	176
  2126     02C7  0086               	movwf	6
  2127     02C8  300A               	movlw	10
  2128     02C9  0786               	addwf	6,f
  2129                           
  2130                           ;---------------------
  2131     02CA  0A86               	incf	6,f
  2132     02CB  3080               	movlw	128
  2133     02CC  0481               	iorwf	1,f
  2134     02CD  0A86               	incf	6,f
  2135     02CE  3006               	movlw	6
  2136     02CF  0081               	movwf	1
  2137                           
  2138                           ;--------------------
  2139     02D0  2A84               	goto	MODBUS_ERROR_CODE_END
  2140     02D1                     MODULE_WORK_LOOP:	
  2141                           ;********************************************************************************
  2142                           ;********************************************************************************
  2143                           ;========================================================
  2144                           ;================執行MODULE動作副程式====================
  2145                           ;========================================================
  2146                           
  2147     02D1  1A3A               	btfsc	58,4
  2148     02D2  0008               	return
  2149                           
  2150                           ; BTFSC MOTOR1_FLAG0,MOTOR_1_EN
  2151                           ; CALL MOTOR_1_WORKING_LOOP
  2152 ;;-----
  2153                           ; BTFSC MOTOR2_FLAG0,MOTOR_2_EN
  2154                           ; CALL MOTOR_2_WORKING_LOOP
  2155                           ;-----
  2156                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2157                           ; CALL MOTOR_1_WORKING_LOOP
  2158 ;;-----
  2159                           ; BTFSC FLAG0_BANK0,MOTOR_1_EN
  2160                           ; CALL MOTOR_1_WORKING_LOOP
  2161                           ;-----
  2162     02D3  0008               	return
  2163     02D4                     MOTOR_1_WORKING_LOOP:	
  2164                           ;========================================================
  2165                           ;================馬達1動作副程式=========================
  2166                           ;========================================================
  2167                           
  2168                           
  2169                           ;BTFSC MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
  2170                           ;RETURN
  2171     02D4  1CB1               	btfss	49,1
  2172     02D5  0008               	return
  2173                           
  2174                           ;BSF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
  2175     02D6  0020               	banksel	12
  2176     02D7  0008               	return
  2177     02D8  1931               	btfsc	49,2
  2178     02D9  2B18               	goto	MOTOR_1_WORK_CW_LV1
  2179     02DA  19B1               	btfsc	49,3
  2180     02DB  2B81               	goto	MOTOR_1_WORK_CCW_LV1
  2181                           
  2182                           ;----------------------------------
  2183     02DC  3021               	movlw	33
  2184     02DD  0085               	movwf	5
  2185     02DE  3090               	movlw	144
  2186     02DF  0084               	movwf	4
  2187     02E0  0800               	movf	0,w
  2188     02E1  1D03               	btfss	3,2
  2189     02E2  2B01               	goto	MOTOR_1_WORK_CW_LOOP
  2190                           
  2191                           ;-------------
  2192     02E3  0A84               	incf	4,f
  2193     02E4  0800               	movf	0,w
  2194     02E5  1D03               	btfss	3,2
  2195     02E6  2B01               	goto	MOTOR_1_WORK_CW_LOOP
  2196                           
  2197                           ;-------------
  2198     02E7  0A84               	incf	4,f
  2199     02E8  0800               	movf	0,w
  2200     02E9  1D03               	btfss	3,2
  2201     02EA  2B6B               	goto	MOTOR_1_WORK_CCW_LOOP
  2202                           
  2203                           ;-------------
  2204     02EB  0A84               	incf	4,f
  2205     02EC  0800               	movf	0,w
  2206     02ED  1D03               	btfss	3,2
  2207     02EE  2B6B               	goto	MOTOR_1_WORK_CCW_LOOP
  2208     02EF                     RESET_END_IN_NORMAL_LOOP:	
  2209                           ;-------------
  2210                           
  2211     02EF  10B1               	bcf	49,1
  2212     02F0  10BA               	bcf	58,1
  2213     02F1  01C6               	clrf	70
  2214     02F2  01C7               	clrf	71
  2215     02F3  3021               	movlw	33
  2216     02F4  0085               	movwf	5
  2217     02F5  3090               	movlw	144
  2218     02F6  0084               	movwf	4
  2219     02F7  3007               	movlw	7	;CMD 0X13詢問目前MOTOR1狀態
  2220     02F8  0784               	addwf	4,f
  2221     02F9  3000               	movlw	0
  2222     02FA  0080               	movwf	0
  2223     02FB  10B5               	bcf	53,1
  2224     02FC  0027               	banksel	908
  2225     02FD  3000               	movlw	0
  2226     02FE  00A3               	movwf	163
  2227     02FF  0020               	banksel	12
  2228                           
  2229                           ;----------
  2230     0300  0008               	return
  2231     0301                     MOTOR_1_WORK_CW_LOOP:	
  2232                           ;========================================================
  2233                           ;================馬達1順時針副程式=======================
  2234                           ;========================================================
  2235                           
  2236     0301  0020               	banksel	13
  2237     0302  1D0D               	btfss	13,2
  2238     0303  0008               	return
  2239     0304  0022               	banksel	270
  2240     0305  140E               	bsf	270,0
  2241     0306  108E               	bcf	270,1
  2242     0307  0020               	banksel	12
  2243     0308  3021               	movlw	33
  2244     0309  0085               	movwf	5
  2245     030A  3090               	movlw	144
  2246     030B  0084               	movwf	4
  2247     030C  3007               	movlw	7
  2248     030D  0784               	addwf	4,f
  2249     030E  3001               	movlw	1
  2250     030F  0080               	movwf	0
  2251                           
  2252                           ;----------
  2253     0310  01C0               	clrf	64
  2254     0311  1531               	bsf	49,2
  2255     0312  14BA               	bsf	58,1
  2256     0313  01C6               	clrf	70
  2257     0314  01C7               	clrf	71
  2258     0315  190D               	btfsc	13,2
  2259     0316  2B50               	goto	MOTOR_1_CW_IOC_SET_HI
  2260     0317  11BA               	bcf	58,3
  2261     0318                     MOTOR_1_WORK_CW_LV1:	
  2262                           ;BTFSC PORTB,0X02
  2263                           ;GOTO MOTOR_1_CW_IOC_SET_HI
  2264                           ;BANKSEL IOCBN
  2265                           ; BCF IOCBN,0X02
  2266                           ; BSF IOCBP,0X02
  2267                           ;BANKSEL PORTA
  2268                           
  2269     0318  3021               	movlw	33
  2270     0319  0085               	movwf	5
  2271     031A  3090               	movlw	144
  2272     031B  0084               	movwf	4
  2273                           
  2274                           ;----------------------------------
  2275     031C  0800               	movf	0,w
  2276     031D  1D03               	btfss	3,2
  2277     031E  2B24               	goto	MOTOR_1_WORK_CW_LV3
  2278     031F  0A84               	incf	4,f
  2279     0320  0800               	movf	0,w
  2280     0321  1D03               	btfss	3,2
  2281     0322  2B24               	goto	MOTOR_1_WORK_CW_LV3
  2282     0323  2B34               	goto	MOTOR_1_WORK_CW_FINISH
  2283     0324                     MOTOR_1_WORK_CW_LV3:
  2284                           
  2285                           ;BANKSEL PORTF
  2286                           ;BSF PORTF,0X01
  2287                           ;BCF PORTF,0X01
  2288                           ;BANKSEL PORTA
  2289                           ; MOVF PWM_1_COUNT_DAT,W
  2290                           ; BTFSC STATUS,Z
  2291                           ; RETURN
  2292     0324  1DBA               	btfss	58,3
  2293     0325  2B61               	goto	CHECK_IOC_IS_LO
  2294     0326  2B52               	goto	CHECK_IOC_IS_HI
  2295     0327                     MOTOR_1_WORK_CW_LV4:
  2296                           
  2297                           ;BANKSEL PORTF
  2298                           ;BSF PORTF,0X01
  2299                           ;BCF PORTF,0X01
  2300     0327  0020               	banksel	12
  2301     0328  01C0               	clrf	64
  2302     0329  3021               	movlw	33
  2303     032A  0085               	movwf	5
  2304     032B  3090               	movlw	144
  2305     032C  0084               	movwf	4
  2306                           
  2307                           ;----------------------------------
  2308     032D  0800               	movf	0,w
  2309     032E  1D03               	btfss	3,2
  2310     032F  2B39               	goto	MOTOR_1_WORK_CW_LV2
  2311     0330  0A84               	incf	4,f
  2312     0331  0800               	movf	0,w
  2313     0332  1D03               	btfss	3,2
  2314     0333  2B39               	goto	MOTOR_1_WORK_CW_LV2
  2315     0334                     MOTOR_1_WORK_CW_FINISH:
  2316                           
  2317                           ;BANKSEL PORTF
  2318                           ;BSF PORTF,0X00
  2319                           ;BCF PORTF,0X00
  2320                           ;BANKSEL PORTA
  2321     0334  0022               	banksel	270
  2322     0335  100E               	bcf	270,0
  2323     0336  0020               	banksel	12
  2324     0337  1131               	bcf	49,2
  2325     0338  0008               	return
  2326     0339                     MOTOR_1_WORK_CW_LV2:
  2327     0339  0020               	banksel	12
  2328     033A  3021               	movlw	33
  2329     033B  0085               	movwf	5
  2330     033C  3090               	movlw	144
  2331     033D  0084               	movwf	4
  2332     033E  0A84               	incf	4,f
  2333     033F  3001               	movlw	1
  2334     0340  0280               	subwf	0,f
  2335     0341  0384               	decf	4,f
  2336     0342  3000               	movlw	0
  2337     0343  3B80               	subwfb	0,f
  2338                           
  2339                           ;----------------------------------------------------------
  2340     0344  3021               	movlw	33
  2341     0345  0085               	movwf	5
  2342     0346  3090               	movlw	144
  2343     0347  0084               	movwf	4
  2344     0348  3005               	movlw	5
  2345     0349  0784               	addwf	4,f
  2346     034A  3001               	movlw	1
  2347     034B  0780               	addwf	0,f
  2348     034C  0384               	decf	4,f
  2349     034D  3000               	movlw	0
  2350     034E  3D80               	addwfc	0,f
  2351     034F  0008               	return
  2352     0350                     MOTOR_1_CW_IOC_SET_HI:	
  2353                           ;----------------------------------------------------------
  2354                           
  2355     0350  15BA               	bsf	58,3
  2356     0351  2B18               	goto	MOTOR_1_WORK_CW_LV1
  2357     0352                     CHECK_IOC_IS_HI:
  2358     0352  190D               	btfsc	13,2
  2359     0353  0008               	return
  2360     0354  0846               	movf	70,w
  2361     0355  1D03               	btfss	3,2
  2362     0356  2B5C               	goto	MOTOR_1_WORK_CW_LV5
  2363                           
  2364                           ;------
  2365     0357  30FE               	movlw	254
  2366     0358  0747               	addwf	71,w
  2367     0359  1C03               	btfss	3,0
  2368     035A  0008               	return
  2369     035B  2B5C               	goto	MOTOR_1_WORK_CW_LV5
  2370     035C                     MOTOR_1_WORK_CW_LV5:
  2371                           
  2372                           ;BANKSEL PORTF
  2373                           ;BSF PORTF,0X00
  2374                           ;BCF PORTF,0X00
  2375     035C  0020               	banksel	12
  2376     035D  01C6               	clrf	70
  2377     035E  01C7               	clrf	71
  2378     035F  11BA               	bcf	58,3
  2379     0360  0008               	return
  2380     0361                     CHECK_IOC_IS_LO:	
  2381                           ;-----------------------------------------------
  2382                           
  2383     0361  1D0D               	btfss	13,2
  2384     0362  0008               	return
  2385     0363  0846               	movf	70,w
  2386     0364  1D03               	btfss	3,2
  2387     0365  2B27               	goto	MOTOR_1_WORK_CW_LV4
  2388                           
  2389                           ;------
  2390     0366  30FE               	movlw	254
  2391     0367  0747               	addwf	71,w
  2392     0368  1C03               	btfss	3,0
  2393     0369  0008               	return
  2394     036A  2B27               	goto	MOTOR_1_WORK_CW_LV4
  2395     036B                     MOTOR_1_WORK_CCW_LOOP:	
  2396                           ;========================================================
  2397                           ;================馬達1逆時針副程式=======================
  2398                           ;========================================================
  2399                           
  2400     036B  0022               	banksel	270
  2401     036C  140E               	bsf	270,0
  2402     036D  148E               	bsf	270,1
  2403     036E  0020               	banksel	12
  2404     036F  3021               	movlw	33
  2405     0370  0085               	movwf	5
  2406     0371  3090               	movlw	144
  2407     0372  0084               	movwf	4
  2408     0373  3007               	movlw	7
  2409     0374  0784               	addwf	4,f
  2410     0375  3001               	movlw	1
  2411     0376  0080               	movwf	0
  2412                           
  2413                           ;----------
  2414     0377  1D0D               	btfss	13,2
  2415     0378  0008               	return
  2416     0379  01C0               	clrf	64
  2417     037A  15B1               	bsf	49,3
  2418     037B  14BA               	bsf	58,1
  2419     037C  01C6               	clrf	70
  2420     037D  01C7               	clrf	71
  2421     037E  190D               	btfsc	13,2
  2422     037F  2BBD               	goto	MOTOR_1_CCW_IOC_SET_HI
  2423     0380  11BA               	bcf	58,3
  2424     0381                     MOTOR_1_WORK_CCW_LV1:
  2425     0381  3021               	movlw	33
  2426     0382  0085               	movwf	5
  2427     0383  3090               	movlw	144
  2428     0384  0084               	movwf	4
  2429     0385  3002               	movlw	2
  2430     0386  0784               	addwf	4,f
  2431                           
  2432                           ;----------------------------------
  2433     0387  0800               	movf	0,w
  2434     0388  1D03               	btfss	3,2
  2435     0389  2B8F               	goto	MOTOR_1_WORK_CCW_LV3
  2436     038A  0A84               	incf	4,f
  2437     038B  0800               	movf	0,w
  2438     038C  1D03               	btfss	3,2
  2439     038D  2B8F               	goto	MOTOR_1_WORK_CCW_LV3
  2440     038E  2BA0               	goto	MOTOR_1_WORK_CCW_FINISH
  2441     038F                     MOTOR_1_WORK_CCW_LV3:	
  2442                           ;----------------------------------
  2443                           
  2444                           
  2445                           ; MOVF PWM_1_COUNT_DAT,W
  2446                           ; BTFSC STATUS,Z
  2447                           ; RETURN
  2448     038F  1DBA               	btfss	58,3
  2449     0390  2BCB               	goto	CHECKC_IOC_IS_LO
  2450     0391  2BBF               	goto	CHECKC_IOC_IS_HI
  2451     0392                     MOTOR_1_WORK_CCW_LV4:
  2452     0392  01C0               	clrf	64
  2453     0393  3021               	movlw	33
  2454     0394  0085               	movwf	5
  2455     0395  3090               	movlw	144
  2456     0396  0084               	movwf	4
  2457     0397  3002               	movlw	2
  2458     0398  0784               	addwf	4,f
  2459                           
  2460                           ;----------------------------------
  2461     0399  0800               	movf	0,w
  2462     039A  1D03               	btfss	3,2
  2463     039B  2BA5               	goto	MOTOR_1_WORK_CCW_LV2
  2464     039C  0A84               	incf	4,f
  2465     039D  0800               	movf	0,w
  2466     039E  1D03               	btfss	3,2
  2467     039F  2BA5               	goto	MOTOR_1_WORK_CCW_LV2
  2468     03A0                     MOTOR_1_WORK_CCW_FINISH:
  2469     03A0  0022               	banksel	270
  2470     03A1  100E               	bcf	270,0
  2471     03A2  0020               	banksel	12
  2472     03A3  11B1               	bcf	49,3
  2473     03A4  0008               	return
  2474     03A5                     MOTOR_1_WORK_CCW_LV2:
  2475     03A5  0020               	banksel	12
  2476     03A6  3021               	movlw	33
  2477     03A7  0085               	movwf	5
  2478     03A8  3090               	movlw	144
  2479     03A9  0084               	movwf	4
  2480     03AA  3003               	movlw	3
  2481     03AB  0784               	addwf	4,f
  2482     03AC  3001               	movlw	1
  2483     03AD  0280               	subwf	0,f
  2484     03AE  0384               	decf	4,f
  2485     03AF  3000               	movlw	0
  2486     03B0  3B80               	subwfb	0,f
  2487                           
  2488                           ;----------------------------------------------
  2489     03B1  3021               	movlw	33
  2490     03B2  0085               	movwf	5
  2491     03B3  3090               	movlw	144
  2492     03B4  0084               	movwf	4
  2493     03B5  3005               	movlw	5
  2494     03B6  0784               	addwf	4,f
  2495     03B7  3001               	movlw	1
  2496     03B8  0280               	subwf	0,f
  2497     03B9  0384               	decf	4,f
  2498     03BA  3000               	movlw	0
  2499     03BB  3B80               	subwfb	0,f
  2500     03BC  0008               	return
  2501     03BD                     MOTOR_1_CCW_IOC_SET_HI:
  2502     03BD  15BA               	bsf	58,3
  2503     03BE  2B81               	goto	MOTOR_1_WORK_CCW_LV1
  2504     03BF                     CHECKC_IOC_IS_HI:
  2505     03BF  190D               	btfsc	13,2
  2506     03C0  0008               	return
  2507     03C1  0846               	movf	70,w
  2508     03C2  1D03               	btfss	3,2
  2509     03C3  2BC9               	goto	MOTOR_1_WORK_CCW_LV5
  2510                           
  2511                           ;------
  2512     03C4  30FE               	movlw	254
  2513     03C5  0747               	addwf	71,w
  2514     03C6  1C03               	btfss	3,0
  2515     03C7  0008               	return
  2516     03C8  2BC9               	goto	MOTOR_1_WORK_CCW_LV5
  2517     03C9                     MOTOR_1_WORK_CCW_LV5:
  2518     03C9  11BA               	bcf	58,3
  2519     03CA  0008               	return
  2520     03CB                     CHECKC_IOC_IS_LO:
  2521     03CB  1D0D               	btfss	13,2
  2522     03CC  0008               	return
  2523     03CD  0846               	movf	70,w
  2524     03CE  1D03               	btfss	3,2
  2525     03CF  2B92               	goto	MOTOR_1_WORK_CCW_LV4
  2526                           
  2527                           ;------
  2528     03D0  30FE               	movlw	254
  2529     03D1  0747               	addwf	71,w
  2530     03D2  1C03               	btfss	3,0
  2531     03D3  0008               	return
  2532     03D4  2B92               	goto	MOTOR_1_WORK_CCW_LV4
  2533     03D5                     MOTOR_2_WORKING_LOOP:	
  2534                           ;========================================================
  2535                           ;================馬達2動作副程式=========================
  2536                           ;========================================================
  2537                           
  2538     03D5  1836               	btfsc	54,0	;馬達2目前正在復歸程序當中，直接離開
  2539     03D6  0008               	return
  2540     03D7  1CB2               	btfss	50,1	;馬達2的ENABLE被啟動
  2541     03D8  0008               	return
  2542     03D9  0020               	banksel	12
  2543     03DA  14B6               	bsf	54,1	;設定馬達2正在進行一般動作當中
  2544     03DB  1932               	btfsc	50,2	;判斷馬達是否正在執行CW
  2545     03DC  2BFE               	goto	MOTOR_2_WORK_CW_LV1
  2546     03DD  19B2               	btfsc	50,3	;判斷馬達是否正在執行CCW
  2547     03DE  2C3F               	goto	MOTOR_2_WORK_CCW_LV1
  2548                           
  2549                           ;----------------------------------
  2550                           ;第一次進入不確定是CW還是CCW，由判斷該執行步數決定是要執行CW還是CCW
  2551     03DF  3021               	movlw	33
  2552     03E0  0085               	movwf	5
  2553     03E1  3090               	movlw	144
  2554     03E2  0084               	movwf	4
  2555     03E3  3015               	movlw	21
  2556     03E4  0784               	addwf	4,f
  2557                           
  2558                           ;----------
  2559     03E5  0800               	movf	0,w
  2560     03E6  1D03               	btfss	3,2
  2561     03E7  2BF8               	goto	MOTOR_2_WORK_CW_LOOP
  2562                           
  2563                           ;-------------
  2564     03E8  0A84               	incf	4,f
  2565     03E9  0800               	movf	0,w
  2566     03EA  1D03               	btfss	3,2
  2567     03EB  2BF8               	goto	MOTOR_2_WORK_CW_LOOP
  2568                           
  2569                           ;-------------
  2570     03EC  0A84               	incf	4,f
  2571     03ED  0800               	movf	0,w
  2572     03EE  1D03               	btfss	3,2
  2573     03EF  2C39               	goto	MOTOR_2_WORK_CCW_LOOP
  2574                           
  2575                           ;-------------
  2576     03F0  0A84               	incf	4,f
  2577     03F1  0800               	movf	0,w
  2578     03F2  1D03               	btfss	3,2
  2579     03F3  2C39               	goto	MOTOR_2_WORK_CCW_LOOP
  2580     03F4                     MOTOR_2_IOC_STOP_LOOP:	
  2581                           ;-------------
  2582                           
  2583                           
  2584                           ;最後步數如果都為0的話表示動作結束關閉馬達
  2585     03F4  0020               	banksel	12
  2586     03F5  10B2               	bcf	50,1
  2587     03F6  10B6               	bcf	54,1
  2588                           
  2589                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2590                           ; MOVWF FSR0H
  2591                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2592                           ; MOVWF FSR0L
  2593                           ; MOVLW 0X15
  2594                           ; ADDWF FSR0L,F
  2595                           ; MOVLW 0X07
  2596                           ; ADDWF FSR0L,F
  2597                           ; MOVLW 0X00
  2598                           ; MOVWF INDF0
  2599 ;;----------
  2600                           ;
  2601                           ;BANKSEL BANK7
  2602                           ; MOVLW 0X00
  2603                           ; MOVWF ADR_81_L_DAT
  2604                           ;BANKSEL PORTA
  2605     03F7  0008               	return
  2606     03F8                     MOTOR_2_WORK_CW_LOOP:	
  2607                           ;========================================================
  2608                           ;================馬達2順時針副程式=======================
  2609                           ;========================================================
  2610                           
  2611     03F8  0022               	banksel	270
  2612     03F9  150E               	bsf	270,2
  2613     03FA  118E               	bcf	270,3
  2614     03FB  0020               	banksel	12
  2615                           
  2616                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2617                           ; MOVWF FSR0H
  2618                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2619                           ; MOVWF FSR0L
  2620                           ; MOVLW 0X15
  2621                           ; ADDWF FSR0L,F
  2622                           ; MOVLW 0X07
  2623                           ; ADDWF FSR0L,F
  2624                           ; MOVLW 0X01 ;MOTOR 2 IS WORKING
  2625                           ; MOVWF INDF0
  2626                           ;----------
  2627     03FC  01C1               	clrf	65
  2628     03FD  1532               	bsf	50,2
  2629     03FE                     MOTOR_2_WORK_CW_LV1:
  2630                           
  2631                           ;執行馬達動作前先確認光耦合的位置，如果已經碰觸到那就不進行馬達動作
  2632     03FE  1C10               	btfss	16,0
  2633     03FF  2C11               	goto	MOTOR_2_WORK_CW_FINISH
  2634     0400  0841               	movf	65,w
  2635     0401  1903               	btfsc	3,2
  2636     0402  0008               	return
  2637     0403  01C1               	clrf	65
  2638     0404  3021               	movlw	33
  2639     0405  0085               	movwf	5
  2640     0406  3090               	movlw	144
  2641     0407  0084               	movwf	4
  2642     0408  3015               	movlw	21
  2643     0409  0784               	addwf	4,f
  2644                           
  2645                           ;----------------------------------
  2646     040A  0800               	movf	0,w
  2647     040B  1D03               	btfss	3,2
  2648     040C  2C1F               	goto	MOTOR_2_WORK_CW_LV2
  2649     040D  0A84               	incf	4,f
  2650     040E  0800               	movf	0,w
  2651     040F  1D03               	btfss	3,2
  2652     0410  2C1F               	goto	MOTOR_2_WORK_CW_LV2
  2653     0411                     MOTOR_2_WORK_CW_FINISH:
  2654     0411  3021               	movlw	33
  2655     0412  0085               	movwf	5
  2656     0413  3090               	movlw	144
  2657     0414  0084               	movwf	4
  2658     0415  3015               	movlw	21
  2659     0416  0784               	addwf	4,f
  2660                           
  2661                           ;----------
  2662     0417  0180               	clrf	0
  2663     0418  0A84               	incf	4,f
  2664     0419  0180               	clrf	0
  2665                           
  2666                           ;-------------------------------
  2667     041A  0022               	banksel	270
  2668     041B  110E               	bcf	270,2
  2669     041C  0020               	banksel	12
  2670     041D  1132               	bcf	50,2
  2671     041E  0008               	return
  2672     041F                     MOTOR_2_WORK_CW_LV2:
  2673     041F  3021               	movlw	33
  2674     0420  0085               	movwf	5
  2675     0421  3090               	movlw	144
  2676     0422  0084               	movwf	4
  2677     0423  3015               	movlw	21
  2678     0424  0784               	addwf	4,f
  2679                           
  2680                           ;------------
  2681     0425  0A84               	incf	4,f
  2682     0426  3001               	movlw	1
  2683     0427  0280               	subwf	0,f
  2684     0428  0384               	decf	4,f
  2685     0429  3000               	movlw	0
  2686     042A  3B80               	subwfb	0,f
  2687                           
  2688                           ;------------------
  2689     042B  3021               	movlw	33
  2690     042C  0085               	movwf	5
  2691     042D  3090               	movlw	144
  2692     042E  0084               	movwf	4
  2693     042F  3015               	movlw	21
  2694     0430  0784               	addwf	4,f
  2695     0431  3005               	movlw	5
  2696     0432  0784               	addwf	4,f
  2697     0433  3001               	movlw	1
  2698     0434  0280               	subwf	0,f
  2699     0435  0384               	decf	4,f
  2700     0436  3000               	movlw	0
  2701     0437  3B80               	subwfb	0,f
  2702     0438  0008               	return
  2703     0439                     MOTOR_2_WORK_CCW_LOOP:	
  2704                           ;========================================================
  2705                           ;================馬達2逆時針副程式=======================
  2706                           ;========================================================
  2707                           
  2708     0439  0022               	banksel	270
  2709     043A  150E               	bsf	270,2
  2710     043B  158E               	bsf	270,3
  2711     043C  0020               	banksel	12
  2712                           
  2713                           ; MOVLW MODBUS_DAT_REAL_ADRH
  2714                           ; MOVWF FSR0H
  2715                           ; MOVLW MODBUS_DAT_REAL_ADRL
  2716                           ; MOVWF FSR0L
  2717                           ; MOVLW 0X15
  2718                           ; ADDWF FSR0L,F
  2719                           ; MOVLW 0X07
  2720                           ; ADDWF FSR0L,F
  2721                           ; MOVLW 0X01 ;馬達正在運作中
  2722                           ; MOVWF INDF0
  2723                           ;----------
  2724     043D  01C1               	clrf	65
  2725     043E  15B2               	bsf	50,3
  2726     043F                     MOTOR_2_WORK_CCW_LV1:
  2727     043F  0841               	movf	65,w
  2728     0440  1903               	btfsc	3,2
  2729     0441  0008               	return
  2730     0442  01C1               	clrf	65
  2731     0443  3021               	movlw	33
  2732     0444  0085               	movwf	5
  2733     0445  3090               	movlw	144
  2734     0446  0084               	movwf	4
  2735     0447  3015               	movlw	21
  2736     0448  0784               	addwf	4,f
  2737     0449  3002               	movlw	2
  2738     044A  0784               	addwf	4,f
  2739                           
  2740                           ;----------------------------------
  2741     044B  0800               	movf	0,w
  2742     044C  1D03               	btfss	3,2
  2743     044D  2C57               	goto	MOTOR_2_WORK_CCW_LV2
  2744     044E  0A84               	incf	4,f
  2745     044F  0800               	movf	0,w
  2746     0450  1D03               	btfss	3,2
  2747     0451  2C57               	goto	MOTOR_2_WORK_CCW_LV2
  2748     0452                     MOTOR_2_WORK_CCW_FINISH:
  2749     0452  0022               	banksel	270
  2750     0453  110E               	bcf	270,2
  2751     0454  0020               	banksel	12
  2752     0455  11B2               	bcf	50,3
  2753     0456  0008               	return
  2754     0457                     MOTOR_2_WORK_CCW_LV2:
  2755     0457  3021               	movlw	33
  2756     0458  0085               	movwf	5
  2757     0459  3090               	movlw	144
  2758     045A  0084               	movwf	4
  2759     045B  3015               	movlw	21
  2760     045C  0784               	addwf	4,f
  2761                           
  2762                           ;INCF FSR0L,F
  2763     045D  3003               	movlw	3
  2764     045E  0784               	addwf	4,f
  2765     045F  3001               	movlw	1
  2766     0460  0280               	subwf	0,f
  2767     0461  0384               	decf	4,f
  2768     0462  3000               	movlw	0
  2769     0463  3B80               	subwfb	0,f
  2770                           
  2771                           ;-------------------------
  2772     0464  3021               	movlw	33
  2773     0465  0085               	movwf	5
  2774     0466  3090               	movlw	144
  2775     0467  0084               	movwf	4
  2776     0468  3015               	movlw	21
  2777     0469  0784               	addwf	4,f
  2778     046A  3005               	movlw	5
  2779     046B  0784               	addwf	4,f
  2780     046C  3001               	movlw	1
  2781     046D  0780               	addwf	0,f
  2782     046E  0384               	decf	4,f
  2783     046F  3000               	movlw	0
  2784     0470  3D80               	addwfc	0,f
  2785     0471  0008               	return
  2786     0472                     PREPARE_TX_DATA_LOOP:	
  2787                           ;========================================================
  2788                           ;====================準備TX資料副程式====================
  2789                           ;========================================================
  2790                           
  2791     0472  2539               	call	DELAY_10ms
  2792     0473  3020               	movlw	32
  2793     0474  0087               	movwf	7
  2794     0475  30B0               	movlw	176
  2795     0476  0086               	movwf	6
  2796     0477  300A               	movlw	10
  2797     0478  0786               	addwf	6,f
  2798     0479  0027               	banksel	909
  2799     047A  158D               	bsf	909,3
  2800     047B  0020               	banksel	12
  2801     047C                     TEST_MAX485_LOOP1:	
  2802                           ;---------------------------------------------
  2803                           
  2804     047C  0029               	banksel	1174
  2805     047D  1C96               	btfss	1174,1
  2806     047E  2C7C               	goto	TEST_MAX485_LOOP1
  2807     047F  0029               	banksel	1170
  2808     0480  0801               	movf	1,w
  2809     0481  0092               	movwf	1170
  2810     0482  0020               	banksel	12
  2811     0483  0A86               	incf	6,f
  2812     0484  0BAD               	decfsz	45,f
  2813     0485  2C7C               	goto	TEST_MAX485_LOOP1
  2814     0486                     TEST_MAX485_LOOP1_LV1:
  2815     0486  0029               	banksel	1174
  2816     0487  1C96               	btfss	1174,1
  2817     0488  2C86               	goto	TEST_MAX485_LOOP1_LV1
  2818     0489  0027               	banksel	909
  2819     048A  118D               	bcf	909,3
  2820     048B  0029               	banksel	1173
  2821     048C  1615               	bsf	1173,4	;啟動UART RX功能
  2822     048D  0020               	banksel	12
  2823     048E  1030               	bcf	48,0
  2824     048F  0008               	return
  2825     0490                     ADC_TAKE_DATA_FUNCTION:	
  2826                           ;========================================================
  2827                           ;=====================ADC取資料副程式====================
  2828                           ;========================================================
  2829                           
  2830     0490  0021               	banksel	158
  2831     0491  3031               	movlw	49	;AN12啟動
  2832     0492  009D               	movwf	157
  2833     0493  30C0               	movlw	192
  2834     0494  009E               	movwf	158
  2835     0495  01FC               	clrf	124
  2836     0496  01FD               	clrf	125
  2837     0497  0020               	banksel	12
  2838     0498  2551               	call	DELAY_100us
  2839     0499  2551               	call	DELAY_100us
  2840     049A  2551               	call	DELAY_100us
  2841     049B  0021               	banksel	157
  2842                           
  2843 ;;------------------------ADC_RUN-------------------------------
  2844     049C  149D               	bsf	157,1
  2845     049D                     ADC_WORK:
  2846     049D  189D               	btfsc	157,1
  2847     049E  2C9D               	goto	ADC_WORK
  2848     049F  0021               	banksel	156
  2849     04A0  081C               	movf	156,w
  2850     04A1  00FC               	movwf	124
  2851     04A2  081B               	movf	155,w
  2852     04A3  00FD               	movwf	125
  2853     04A4  0020               	banksel	12
  2854     04A5  0008               	return
  2855     04A6                     WATCH_SUB_FUNCTION:	
  2856                           ;========================================================
  2857                           ;====================測試用將資料送出====================OK
  2858                           ;========================================================
  2859                           ;這個部分是顯示內部資料的副程式
  2860                           
  2861     04A6  3020               	movlw	32
  2862     04A7  0085               	movwf	5
  2863     04A8  30BA               	movlw	186
  2864     04A9  0084               	movwf	4
  2865     04AA  3008               	movlw	8
  2866     04AB  00F1               	movwf	113
  2867     04AC  0800               	movf	0,w
  2868     04AD  00F2               	movwf	114
  2869     04AE                     WATCH_SUB_FUNC_LV1:
  2870     04AE  0022               	banksel	272
  2871     04AF  1310               	bcf	272,6
  2872     04B0  1BF2               	btfsc	114,7
  2873     04B1  1690               	bsf	272,5
  2874     04B2  1FF2               	btfss	114,7
  2875     04B3  1290               	bcf	272,5
  2876     04B4  1710               	bsf	272,6
  2877     04B5  0DF2               	rlf	114,f
  2878     04B6  0BF1               	decfsz	113,f
  2879     04B7  2CAE               	goto	WATCH_SUB_FUNC_LV1
  2880                           
  2881                           ;----------
  2882     04B8  3008               	movlw	8
  2883     04B9  00F1               	movwf	113
  2884     04BA  0A84               	incf	4,f
  2885     04BB  0800               	movf	0,w
  2886     04BC  00F2               	movwf	114
  2887     04BD  0BF0               	decfsz	112,f
  2888     04BE  2CAE               	goto	WATCH_SUB_FUNC_LV1
  2889     04BF  1290               	bcf	272,5
  2890     04C0  1310               	bcf	272,6
  2891     04C1  0020               	banksel	12
  2892     04C2  0008               	return
  2893     04C3                     CRC_16_FUNCTION_LOOP:	
  2894                           ;========================================================
  2895                           ;====================CRC-16運算副程式====================OK
  2896                           ;========================================================
  2897                           ;做一個BYTE大概40-50uS
  2898                           
  2899     04C3  0020               	banksel	12
  2900     04C4  0827               	movf	39,w
  2901     04C5  06A9               	xorwf	41,f
  2902                           
  2903                           ;---------
  2904     04C6  3009               	movlw	9
  2905     04C7  00A6               	movwf	38
  2906     04C8                     CRC_16_FUNCTION_LV1:
  2907     04C8  03A6               	decf	38,f
  2908     04C9  0826               	movf	38,w
  2909     04CA  1903               	btfsc	3,2
  2910     04CB  2CD6               	goto	CRC_16_END_FUNCTION
  2911                           
  2912                           ;---------------------
  2913     04CC  1003               	bcf	3,0
  2914     04CD  0CA8               	rrf	40,f
  2915     04CE  0CA9               	rrf	41,f
  2916     04CF  1C03               	btfss	3,0
  2917     04D0  2CC8               	goto	CRC_16_FUNCTION_LV1
  2918                           
  2919                           ;---------------------
  2920     04D1  30A0               	movlw	160	;CRC-16運算的參數
  2921     04D2  06A8               	xorwf	40,f
  2922     04D3  3001               	movlw	1
  2923     04D4  06A9               	xorwf	41,f
  2924     04D5  2CC8               	goto	CRC_16_FUNCTION_LV1
  2925     04D6                     CRC_16_END_FUNCTION:
  2926     04D6  0020               	banksel	12
  2927     04D7  0008               	return
  2928     04D8                     AAAA_1800:	
  2929                           ;=======================================================
  2930                           ;===============測試將收到的資料顯示出==================OK
  2931                           ;=======================================================
  2932                           
  2933     04D8  3008               	movlw	8
  2934     04D9  00F0               	movwf	112
  2935     04DA                     AAAAN:
  2936     04DA  0027               	banksel	908
  2937     04DB  120C               	bcf	908,4
  2938                           
  2939                           ;----------------
  2940     04DC  1BF1               	btfsc	113,7
  2941     04DD  168C               	bsf	908,5
  2942     04DE  1FF1               	btfss	113,7
  2943     04DF  128C               	bcf	908,5
  2944                           
  2945                           ;----------------
  2946     04E0  160C               	bsf	908,4
  2947     04E1  0DF1               	rlf	113,f
  2948     04E2  0BF0               	decfsz	112,f
  2949     04E3  2CDA               	goto	AAAAN
  2950     04E4  120C               	bcf	908,4
  2951     04E5  128C               	bcf	908,5
  2952     04E6  0020               	banksel	12
  2953     04E7  0008               	return
  2954     04E8                     SET_TMR2_BASE_TIME:	
  2955                           ;=======================================================
  2956                           ;================TIMER2基礎時間設定=====================OK
  2957                           ;=======================================================
  2958                           ;TIMER2 BASE TIME IS 1mS
  2959                           
  2960     04E8  0020               	banksel	28
  2961     04E9  3015               	movlw	21
  2962     04EA  009C               	movwf	28
  2963     04EB  30A7               	movlw	167
  2964     04EC  009B               	movwf	27
  2965                           
  2966                           ;---------------------
  2967     04ED  3004               	movlw	4
  2968     04EE  00A3               	movwf	35
  2969     04EF  0020               	banksel	12
  2970     04F0  0008               	return
  2971     04F1                     SET_TMR2_INT_EN:	
  2972                           ;=======================================================
  2973                           ;===============TIMER2中斷參數設定======================OK
  2974                           ;=======================================================
  2975                           
  2976     04F1  0021               	banksel	145
  2977     04F2  1491               	bsf	145,1
  2978     04F3  0020               	banksel	12
  2979     04F4  0008               	return
  2980     04F5                     SET_TMR2_ON:	
  2981                           ;=======================================================
  2982                           ;===================TIMER2啟動==========================OK
  2983                           ;=======================================================
  2984                           
  2985     04F5  0020               	banksel	28
  2986     04F6  151C               	bsf	28,2
  2987     04F7  0020               	banksel	12
  2988     04F8  0008               	return
  2989     04F9                     CLEAN_ALL_REGISTER:	
  2990                           ;========================================================
  2991                           ;=================將REG內資料全部清空====================OK
  2992                           ;========================================================
  2993                           
  2994     04F9  3020               	movlw	32
  2995     04FA  0087               	movwf	7
  2996     04FB  3000               	movlw	0
  2997     04FC  0086               	movwf	6
  2998     04FD  3003               	movlw	3
  2999     04FE  00F1               	movwf	113
  3000     04FF  30FF               	movlw	255
  3001     0500  00F0               	movwf	112
  3002     0501                     CLEAN_ALL_REGISTER_LOOP:
  3003     0501  0181               	clrf	1
  3004     0502  1003               	bcf	3,0
  3005     0503  3001               	movlw	1
  3006     0504  0786               	addwf	6,f
  3007     0505  3000               	movlw	0
  3008     0506  3D87               	addwfc	7,f
  3009     0507  0BF0               	decfsz	112,f
  3010     0508  2D01               	goto	CLEAN_ALL_REGISTER_LOOP
  3011     0509  30FF               	movlw	255
  3012     050A  00F0               	movwf	112
  3013     050B  0BF1               	decfsz	113,f
  3014     050C  2D01               	goto	CLEAN_ALL_REGISTER_LOOP
  3015     050D  0020               	banksel	12
  3016     050E  0008               	return
  3017     050F                     READ_EEPROM:	
  3018                           ;=======================================================
  3019                           ;===================== 讀EEPROM ========================OK
  3020                           ;=======================================================
  3021                           
  3022     050F  0023               	banksel	401
  3023     0510  087E               	movf	126,w
  3024     0511  0091               	movwf	401
  3025     0512  1315               	bcf	405,6	;USER EEPROM
  3026     0513  1395               	bcf	405,7	;USER EEPROM
  3027     0514  1415               	bsf	405,0	;READ_EEPROM
  3028     0515  0813               	movf	403,w
  3029     0516  00FF               	movwf	127
  3030     0517  0020               	banksel	12
  3031     0518  0008               	return
  3032     0519                     WRITE_EEPROM:	
  3033                           ;=======================================================
  3034                           ;===================== 寫EEPROM ========================OK
  3035                           ;=======================================================
  3036                           
  3037     0519  138B               	bcf	11,7
  3038     051A  0023               	banksel	401
  3039     051B  087E               	movf	126,w
  3040     051C  0091               	movwf	401	;EEPROM ADDRESS
  3041     051D  087F               	movf	127,w
  3042     051E  0093               	movwf	403	;EEPROM DATA
  3043     051F                     WRITE_EEPROM_LOOP_1:	
  3044 ;;-----------------------
  3045                           
  3046     051F  1315               	bcf	405,6	;USER EEPROM
  3047     0520  1395               	bcf	405,7	;USER EEPROM
  3048     0521  1515               	bsf	405,2	;ENABLE WRITE
  3049     0522  3055               	movlw	85	;固定程序
  3050     0523  0096               	movwf	406
  3051     0524  30AA               	movlw	170
  3052     0525  0096               	movwf	406	;固定程序
  3053                           
  3054 ;;-----------------------
  3055     0526  1495               	bsf	405,1	;RUN WRITE EEPROM
  3056     0527                     WAIT_EEPROM_WRITE_OVER:
  3057     0527  1895               	btfsc	405,1
  3058     0528  2D27               	goto	WAIT_EEPROM_WRITE_OVER
  3059     0529  0023               	banksel	405
  3060     052A  1115               	bcf	405,2	;Disable writes
  3061     052B  0020               	banksel	12
  3062     052C  178B               	bsf	11,7
  3063     052D  0008               	return
  3064     052E                     DELAY_3000ms:	
  3065                           ;========================================================
  3066                           ;======================== DELAY =========================OK
  3067                           ;========================================================
  3068                           ;DEFINE IS 8MHZ
  3069                           
  3070     052E  2530               	call	DELAY_1000ms
  3071     052F  2530               	call	DELAY_1000ms
  3072     0530                     DELAY_1000ms:
  3073     0530  2531               	call	DELAY_500ms
  3074     0531                     DELAY_500ms:
  3075     0531  2535               	call	DELAY_100ms
  3076     0532  2535               	call	DELAY_100ms
  3077     0533  2535               	call	DELAY_100ms
  3078     0534  2535               	call	DELAY_100ms
  3079     0535                     DELAY_100ms:
  3080     0535  2538               	call	DELAY_20ms
  3081     0536  2537               	call	DELAY_40ms
  3082     0537                     DELAY_40ms:
  3083     0537  2538               	call	DELAY_20ms
  3084     0538                     DELAY_20ms:
  3085     0538  2539               	call	DELAY_10ms
  3086     0539                     DELAY_10ms:
  3087     0539  253A               	call	DELAY_5ms
  3088     053A                     DELAY_5ms:
  3089     053A  253E               	call	DELAY_1ms
  3090     053B                     DELAY_4ms:
  3091     053B  253E               	call	DELAY_1ms
  3092     053C                     DELAY_3ms:
  3093     053C  253E               	call	DELAY_1ms
  3094     053D                     DELAY_2ms:
  3095     053D  253E               	call	DELAY_1ms
  3096     053E                     DELAY_1ms:
  3097     053E  3031               	movlw	49
  3098     053F  00A0               	movwf	32	;49
  3099     0540  00A1               	movwf	33	;49
  3100     0541  300A               	movlw	10
  3101     0542  00A2               	movwf	34
  3102     0543  2D44               	goto	DELAY_LOOP_1
  3103     0544                     DELAY_LOOP_1:
  3104     0544  0000               	nop	;1
  3105     0545  0BA0               	decfsz	32,f	;2
  3106     0546  2D44               	goto	DELAY_LOOP_1	;3,4 (0.5*4*49 = 98us)
  3107     0547  0821               	movf	33,w	;4
  3108     0548  00A0               	movwf	32	;1
  3109     0549  0BA2               	decfsz	34,f	;2
  3110     054A  2D44               	goto	DELAY_LOOP_1	;3,4
  3111     054B  0008               	return
  3112     054C                     DELAY_600us:	
  3113                           ;==========================================
  3114                           
  3115     054C  2551               	call	DELAY_100us
  3116     054D                     DELAY_500us:
  3117     054D  2551               	call	DELAY_100us
  3118     054E                     DELAY_400us:
  3119     054E  2551               	call	DELAY_100us
  3120     054F                     DELAY_300us:
  3121     054F  2551               	call	DELAY_100us
  3122     0550                     DELAY_200us:
  3123     0550  2551               	call	DELAY_100us
  3124     0551                     DELAY_100us:
  3125     0551  255A               	call	DELAY_10us
  3126     0552                     DELAY_90us:
  3127     0552  255A               	call	DELAY_10us
  3128     0553  255A               	call	DELAY_10us
  3129     0554  255A               	call	DELAY_10us
  3130     0555                     DELAY_60us:
  3131     0555  255A               	call	DELAY_10us
  3132     0556                     DELAY_50us:
  3133     0556  255A               	call	DELAY_10us
  3134     0557                     DELAY_40us:
  3135     0557  255A               	call	DELAY_10us
  3136     0558                     DELAY_30us:
  3137     0558  255A               	call	DELAY_10us
  3138     0559                     DELAY_20us:
  3139     0559  255A               	call	DELAY_10us
  3140     055A                     DELAY_10us:
  3141     055A  0000               	nop
  3142     055B  0000               	nop
  3143     055C                     DELAY_9us:
  3144     055C  0000               	nop
  3145     055D  0000               	nop
  3146     055E                     DELAY_8us:
  3147     055E  0000               	nop
  3148     055F  0000               	nop
  3149     0560                     DELAY_7us:
  3150     0560  0000               	nop
  3151     0561  0000               	nop
  3152     0562                     DELAY_6us:
  3153     0562  0000               	nop
  3154     0563  0000               	nop
  3155     0564                     DELAY_5us:
  3156     0564  0000               	nop
  3157     0565  0000               	nop
  3158     0566                     DELAY_4us:
  3159     0566  0000               	nop
  3160     0567  0000               	nop
  3161     0568                     DELAY_3us:
  3162     0568  0000               	nop
  3163     0569  0000               	nop
  3164     056A                     DELAY_2us:
  3165     056A  0008               	return
  3166                           
  3167                           	psect	config
  3168                           
  3169                           ;Config register CONFIG1 @ 0x8007
  3170                           ;	Oscillator Selection
  3171                           ;	FOSC = INTOSC, INTOSC oscillator: I/O function on CLKIN pin
  3172                           ;	Watchdog Timer Enable
  3173                           ;	WDTE = OFF, WDT disabled
  3174                           ;	Power-up Timer Enable
  3175                           ;	PWRTE = OFF, PWRT disabled
  3176                           ;	MCLR Pin Function Select
  3177                           ;	MCLRE = OFF, MCLR/VPP pin function is digital input
  3178                           ;	Flash Program Memory Code Protection
  3179                           ;	CP = OFF, Program memory code protection is disabled
  3180                           ;	Data Memory Code Protection
  3181                           ;	CPD = OFF, Data memory code protection is disabled
  3182                           ;	Brown-out Reset Enable
  3183                           ;	BOREN = OFF, Brown-out Reset disabled
  3184                           ;	Clock Out Enable
  3185                           ;	CLKOUTEN = OFF, CLKOUT function is disabled. I/O or oscillator function on the CLKOUT pin
  3186                           ;	Internal/External Switchover
  3187                           ;	IESO = OFF, Internal/External Switchover mode is disabled
  3188                           ;	Fail-Safe Clock Monitor Enable
  3189                           ;	FCMEN = OFF, Fail-Safe Clock Monitor is disabled
  3190     8007                     	org	32775
  3191     8007  09A4               	dw	2468
  3192                           
  3193                           ;Config register CONFIG2 @ 0x8008
  3194                           ;	Flash Memory Self-Write Protection
  3195                           ;	WRT = OFF, Write protection off
  3196                           ;	Voltage Regulator Capacitor Enable
  3197                           ;	VCAPEN = OFF, VCAP pin functionality is disabled
  3198                           ;	PLL Enable
  3199                           ;	PLLEN = OFF, 4x PLL disabled
  3200                           ;	Stack Overflow/Underflow Reset Enable
  3201                           ;	STVREN = OFF, Stack Overflow or Underflow will not cause a Reset
  3202                           ;	Brown-out Reset Voltage Selection
  3203                           ;	BORV = HI, Brown-out Reset Voltage (Vbor), high trip point selected.
  3204                           ;	Low-Voltage Programming Enable
  3205                           ;	LVP = OFF, High-voltage on MCLR/VPP must be used for programming
  3206     8008                     	org	32776
  3207     8008  18FF               	dw	6399


Microchip Technology PIC Macro Assembler V2.40 build 20220703182018 
Symbol Table                                                                                               Fri Oct 06 11:40:38 2023

                            C 0000               CRC_COUNTER_TEMP 0026                              Z 0002  
                           RD 0000                             WR 0001                            GIE 0007  
                          PR2 001B                            PR4 0416              MODBUS_ERROR_FLAG 003B  
                         CFGS 0006                           CREN 0004                           LATA 010C  
                         LATB 010D                           LATC 010E                           LATD 010F  
                         LATE 0110                           LATF 038C                           LATG 038D  
                         PIE1 0091                           PIE2 0092                           PIE3 0093  
                         PIE4 0094                           INTE 0004                           INTF 0001  
                         PIR1 0011                           PIR4 0014                           M_OE 0004  
                         TRMT 0001                           WREN 0002              STRONG_STOP_TEMP1 0042  
            STRONG_STOP_TEMP2 0043            CRC_16_END_FUNCTION 04D6                          AAAAN 04DA  
                        BANK7 038C                          EEPGD 0007                          M1_FR 0001  
                        M2_FR 0003                          T2CON 001C                          INDF0 0000  
                        INDF1 0001                          M1_ST 0000                          M2_ST 0002  
                        RC2IE 0005                          RC2IF 0005                          T4CON 0417  
                        IOCBF 0396                          IOCBN 0395                          IOCBP 0394  
                        FSR0H 0005                          FSR1H 0007                          IOCIE 0003  
                        IOCIF 0000                          FSR0L 0004                          FSR1L 0006  
                        PORTA 000C                          PORTB 000D                          PORTC 000E  
                        PORTD 000F                          PORTE 0010                          PORTF 028C  
                        PORTG 028D                          TRISA 008C                          TRISB 008D  
                        TRISC 008E                          TRISD 008F                          TRISE 0090  
                        TRISF 030C                          TRISG 030D                          M_RST 0005  
    MODBUS_ERROR_CODE_01_LOOP 0277      MODBUS_ERROR_CODE_02_LOOP 028B      MODBUS_ERROR_CODE_03_LOOP 0299  
    MODBUS_ERROR_CODE_04_LOOP 02A7      MODBUS_ERROR_CODE_05_LOOP 02B5      MODBUS_ERROR_CODE_06_LOOP 02C3  
         CHECK_CRC16_IS_RIGHT 006E                         ADCON0 009D                         ADCON1 009E  
                       ADRESH 009C                         ADRESL 009B                         EEADRL 0191  
                       EEDATL 0193                         CCPR3L 0311                         EECON1 0195  
                       EECON2 0196                         ANSELA 018C                         ANSELE 0190  
                       ANSELF 040C                         ANSELG 040D                         RC2STA 0495  
                       INTCON 000B            MOTOR_1_WORK_CW_LV1 0318            MOTOR_1_WORK_CW_LV2 0339  
          MOTOR_1_WORK_CW_LV3 0324            MOTOR_1_WORK_CW_LV4 0327            MOTOR_1_WORK_CW_LV5 035C  
                       OSCCON 0099                         TMR2IE 0001                         TMR2IF 0001  
                       TMR2ON 0002                         TX2REG 0492                         TX2STA 0496  
                       STATUS 0003           TMR2IF_FUNCTION_LOOP 00B0               RTU_COUNTER_DATA 002A  
            MOTOR_OE_RST_PORT 010C           MOTOR_1_WORKING_LOOP 02D4               SYSTEM_START_LV1 01AC  
         MODBUS_ERROR_COUNTER 0049                PWM_1_COUNT_DAT 0040                        CCP3CON 0313  
          MOTOR_2_WORK_CW_LV1 03FE            MOTOR_2_WORK_CW_LV2 041F           MOTOR_1_WORK_CCW_LV1 0381  
         MOTOR_1_WORK_CCW_LV2 03A5           MOTOR_1_WORK_CCW_LV3 038F           MOTOR_1_WORK_CCW_LV4 0392  
         MOTOR_1_WORK_CCW_LV5 03C9                PWM_2_COUNT_DAT 0041           MOTOR_1_WORK_CW_LOOP 0301  
                      OSCSTAT 009A                        TP0_PIN 0000                        OSCTUNE 0098  
          CRC_16_FUNCTION_LV1 04C8         MOTOR_2_WORK_CW_FINISH 0411                     DELAY_10ms 0539  
                   DELAY_20ms 0538                     DELAY_10us 055A                     DELAY_20us 0559  
                   DELAY_40ms 0537                     DELAY_30us 0558                     DELAY_40us 0557  
                   DELAY_50us 0556                     DELAY_60us 0555                     DELAY_90us 0552  
          MOTOR1_IN_ROAT_FLAG 0001           TEN_MS_FUNCTION_LOOP 00EA         WAIT_EEPROM_WRITE_OVER 0527  
             CAN_SEND_TX_FLAG 0000        MOTOR_1_WORK_CCW_FINISH 03A0          ROAT_MOTOR_IS_HI_FLAG 0003  
        MODBUS_DAT_EXTRA_ADRH 0020          MODBUS_DAT_EXTRA_ADRL 00B0             INTERRUPT_SUB_AREA 0006  
                   M1_ENCODER 0001          MOTOR_1_ZERO_FUNCTION 0231         SET_MODBUS_MODE_ENABLE 0D08  
                   EEPROM_ADR 007E            MOTOR1_IN_ZERO_FLAG 0000                     EEPROM_DAT 007F  
                   M2_ENCODER 0002            M1_NOT_COUNTER_TEMP 0053         MOTOR1_ZERO_IN_HI_LOOP 0213  
                   CRC_HIBYTE 0028            RC2IF_FUNCTION_LOOP 00AC                     CRC_LOBYTE 0029  
       MOTOR1_ZERO_IN_LO_LOOP 01E9           MOTOR_2_WORKING_LOOP 03D5          MODBUS_ERROR_CODE_END 0284  
            INT_INTF_FUNCTION 00FE                     ERROR_01_F 0000                     ERROR_02_F 0001  
                   ERROR_03_F 0002                     ERROR_04_F 0003                     ERROR_05_F 0004  
                   ERROR_06_F 0005     MOTOR1_ZERO_IN_HI_LOOP_LV1 0225       MODBUS_RTU_READ_CRC_LOOP 010F  
        MOTOR1_TIME_ZERO_LOOP 0228             WATCH_SUB_FUNCTION 04A6        MOTOR_2_WORK_CCW_FINISH 0452  
           WATCH_SUB_FUNC_LV1 04AE           MOTOR_2_WORK_CCW_LV1 043F           MOTOR_2_WORK_CCW_LV2 0457  
                     ADC_WORK 049D         MODBUS_INTPUT_FUNCTION 0D1F           MOTOR_2_WORK_CW_LOOP 03F8  
                     CCPTMRS0 029E                       CCPTMRS1 029F          MOTOR_1_WORK_CCW_LOOP 036B  
                 MOTOR1_FLAG0 0031                   MOTOR1_FLAG1 0035                BOOTLOADER_LOOP 0005  
                 MOTOR2_FLAG0 0032                   MOTOR2_FLAG1 0036                    ADC_HI_DATA 007C  
             MODULE_WORK_LOOP 02D1            MOTOR2_IN_ROAT_FLAG 0001                 ID_SELECT_LOOP 018B  
                   MOTOR_1_CW 0002                     MOTOR_2_CW 0002           CRC_16_FUNCTION_LOOP 04C3  
                 MOTOR_1_WORK 0001                   MOTOR_2_WORK 0001             CLEAN_ALL_REGISTER 04F9  
                   WATCH_TEMP 0072                     OPTION_REG 0095            MOTOR2_IN_ZERO_FLAG 0000  
             MOTOR_1_ING_ZERO 0005                     TEN_MS_NUM 0002              STANDBY_HBYTE_DAT 004C  
             MOTOR_2_ING_ZERO 0005                 TIMER2_INT_LV1 00D4                    DELAY_100ms 0535  
                  DELAY_100us 0551                    DELAY_200us 0550                    DELAY_300us 054F  
                  DELAY_400us 054E                    DELAY_500ms 0531                    DELAY_500us 054D  
                  DELAY_600us 054C          MOTOR_1_CW_IOC_SET_HI 0350              STANDBY_LBYTE_DAT 004D  
                  DELAY_TEMP1 0020                    DELAY_TEMP2 0021                    DELAY_TEMP3 0022  
            COPY_485_DATA_LV1 0037     MOTOR1_ZERO_IN_LO_LOOP_LV1 01FB                    FLAG1_BANK0 0030  
                   PWR_DECTET 0005                    FLAG3_BANK0 003A                    FLAG5_BANK0 003C  
           MOTOR_1_IOC_FINISH 0007                  MODULE_ID_DAT 0025                  CAL_DATA_TEMP 0027  
           SET_TMR2_BASE_TIME 04E8          MODBUS_TABLE_ADR_TEMP 004A      POWER_LED_OUTPUT_FUNCTION 018D  
              SET_TMR2_INT_EN 04F1         MOTOR_1_CCW_IOC_SET_HI 03BD                 IOC_HW_SETTING 0186  
     MODBUS_BUS_01_ERROR_LOOP 0055                    MAX485_PORT 038D               MODBUS_DAT_COUNT 002F  
                INT_TIMER_NUM 0004          MOTOR_2_ZERO_FUNCTION 025B          M1_ZERO_COUNTER_HBYTE 0050  
        M1_ZERO_COUNTER_LBYTE 0051        ANAY_MODBUS_CMD_10_LOOP 008E        ANAY_MODBUS_CMD_03_LOOP 0089  
      ANAY_MODBUS_CMD_06_LOOP 0093       MODBUS_BUS_02_ERROR_LOOP 0057               TMR2_DIVIDER_SET 0015  
       CHECK_MOTOR2_ZERO_LOOP 01C2    ANAY_MODBUS_CMD_COMMON_LOOP 0097       MODBUS_BUS_03_ERROR_LOOP 0059  
        MOTOR_2_IOC_STOP_LOOP 03F4            TMR2IF_FUNCTION_LV0 00B7                CHECK_IOC_IS_HI 0352  
              CHECK_IOC_IS_LO 0361           RESET_IN_NORMAL_FALG 0000                      AAAA_1800 04D8  
          WRITE_EEPROM_LOOP_1 051F         ADC_TAKE_DATA_FUNCTION 0490       MODBUS_BUS_04_ERROR_LOOP 005B  
                  READ_EEPROM 050F                IOCBF1_INT_LOOP 00F8          MOTOR_2_WORK_CCW_LOOP 0439  
              IOCBF2_INT_LOOP 00FB             WATCH_DAT_BUF_ADRH 0020             WATCH_DAT_BUF_ADRL 00BA  
                    DELAY_1ms 053E                      DELAY_2ms 053D                      DELAY_3ms 053C  
                    DELAY_4ms 053B                      DELAY_5ms 053A                      DELAY_2us 056A  
                    DELAY_3us 0568                      DELAY_4us 0566                      DELAY_5us 0564  
                    DELAY_6us 0562                      DELAY_7us 0560                      DELAY_8us 055E  
                    DELAY_9us 055C       MODBUS_BUS_05_ERROR_LOOP 005D           MODBUS_DAT_REAL_ADRH 0021  
         MODBUS_DAT_REAL_ADRL 0090                 TMR2_BASE_TEMP 0023            MODBUS_RTU_READ_LV2 0104  
            TEST_MAX485_LOOP1 047C                 MODBUS_IN_10_F 0003                 MODBUS_IN_03_F 0001  
               MODBUS_IN_06_F 0002                 ADC_HW_SETTING 016B                   WRITE_EEPROM 0519  
     MODBUS_BUS_06_ERROR_LOOP 005F         MOTOR_1_WORK_CW_FINISH 0334                   ADC_LOW_DATA 007D  
         MODBUS_DAT_WORK_ADRH 0021           MODBUS_DAT_WORK_ADRL 0040          TEST_MAX485_LOOP1_LV1 0486  
                  MOTOR_1_CCW 0003                    MOTOR_2_CCW 0003               IOC_INT_FUNCTION 00F1  
                MOTOR_1_RESET 0004                  MOTOR_2_RESET 0004                MOTOR_1_HI_ZERO 0006  
                    TEST_PORT 038C                    WATCH_OUT_P 0110                   SYSTEM_START 01AB  
                  TEN_TIME_EN 0001                    TEN_MS_TEMP 0048                   ADR_81_L_DAT 00A3  
      CHECK_PWM_FREQ_FUCNTION 018B          POWER_LED_OUTPUT_EXIT 0192                    SET_TMR2_ON 04F5  
          MODBUS_ADR_FUNCTION 0800                   DELAY_1000ms 0530                   DELAY_3000ms 052E  
                WATCH_COUNTER 0070               POWER_CHECK_PORT 000D              MOTOR_1_NOW_IS_HI 0251  
            MOTOR_1_NOW_IS_LO 0247  MODBUS_TIMEOUT_IS_FINISH_LOOP 0011                  WATCH_OUT_DAT 0005  
                WATCH_OUT_CLK 0006                   DELAY_LOOP_1 0544             COPY_485_DATA_LOOP 002B  
     MODBUS_CRC16_CHECK_IS_OK 003E               CHECKC_IOC_IS_HI 03BF               CHECKC_IOC_IS_LO 03CB  
         PREPARE_TX_DATA_LOOP 0472       MODBUS_BUS_ID_ERROR_LOOP 0061                  TMR2_BASE_SET 00A7  
                TMR2_BASE_NUM 0004             MOTOR_CONTROL_PORT 010E            SETTING_PWM_HW_LOOP 0175  
              TX_DATA_COUNTER 002D       CHECK_CRC16_IS_RIGHT_LV1 0079                  MAX485_SELECT 0003  
            IOC_COUNTER_HBYTE 0046              IOC_COUNTER_LBYTE 0047        CLEAN_ALL_REGISTER_LOOP 0501  
      MODBUS_BUS_ID_ERROR_LV1 0067       RESET_END_IN_NORMAL_LOOP 02EF          DEAL_WITH_MODBUS_FLAG 0005  
        DEAL_WITH_MODBUS_LOOP 01BD            ALL_MOTOR_STOP_FLAG 0004  RESET_MODBUS_TIMEOUT_FUNCTION 00D0  
         SYSTEM_START_SETTING 011B                WATCH_BIT_COUNT 0071                 INT_TIMER_TEMP 0024  
               INT_HW_SETTING 0193                TMR2IF_FUNC_LV1 00BD             INT_TRIG_TIME_FLAG 0004  
