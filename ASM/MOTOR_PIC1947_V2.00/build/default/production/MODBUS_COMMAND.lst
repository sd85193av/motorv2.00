

Microchip MPLAB XC8 Assembler V2.40 build 20220703182018 
                                                                                                           Thu Oct 05 13:54:13 2023


     1                           	processor	16F1947
     2                           	pagewidth 132
     3                           	psect	udata_shr,global,class=COMMON,space=1,delta=1,noexec
     4                           	psect	udata,global,class=RAM,space=1,delta=1,noexec
     5                           	psect	udata_bank0,global,class=BANK0,space=1,delta=1,noexec
     6                           	psect	udata_bank1,global,class=BANK1,space=1,delta=1,noexec
     7                           	psect	udata_bank2,global,class=BANK2,space=1,delta=1,noexec
     8                           	psect	udata_bank3,global,class=BANK3,space=1,delta=1,noexec
     9                           	psect	udata_bank4,global,class=BANK4,space=1,delta=1,noexec
    10                           	psect	udata_bank5,global,class=BANK5,space=1,delta=1,noexec
    11                           	psect	udata_bank6,global,class=BANK6,space=1,delta=1,noexec
    12                           	psect	udata_bank7,global,class=BANK7,space=1,delta=1,noexec
    13                           	psect	udata_bank8,global,class=BANK8,space=1,delta=1,noexec
    14                           	psect	udata_bank9,global,class=BANK9,space=1,delta=1,noexec
    15                           	psect	udata_bank10,global,class=BANK10,space=1,delta=1,noexec
    16                           	psect	udata_bank11,global,class=BANK11,space=1,delta=1,noexec
    17                           	psect	udata_bank12,global,class=BANK12,space=1,delta=1,noexec
    18                           	psect	code,global,class=CODE,delta=2
    19                           	psect	data,global,class=STRCODE,delta=2,noexec
    20                           	psect	edata,global,class=EEDATA,space=3,delta=2,noexec
    21                           	psect	cmd,global,class=CODE,delta=2
    22                           
    23                           ;========================================================
    24                           ;================ Project Information ===================
    25                           ;========================================================
    26                           ;Project Name : MODBUS_COMMAND
    27                           ;-------------------------------------------------------
    28                           ;Project Version: 2.00
    29                           ;Edit Date : 2023/09/28
    30                           ;Function Info :
    31                           ; :
    32                           ; :
    33                           ;-------------------------------------------------------
    34                           ;==========================================================================
    35                           ; MPASM PIC16LF1947 processor include
    36                           ;
    37                           ; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
    38                           ;==========================================================================
    39                           ;==========================================================================
    40                           ; This header file defines configurations, registers, and other useful
    41                           ; bits of information for the PIC16LF1947 microcontroller. These names
    42                           ; are taken to match the data sheets as closely as possible.
    43                           ;
    44                           ; Note that the processor must be selected before this file is included.
    45                           ; The processor may be selected the following ways:
    46                           ;
    47                           ; 1. Command line switch:
    48                           ; C:\MPASM MYFILE.ASM /PIC16LF1947
    49                           ; 2. LIST directive in the source file
    50                           ; LIST P=PIC16LF1947
    51                           ; 3. Processor Type entry in the MPASM full-screen interface
    52                           ; 4. Setting the processor in the MPLAB Project Dialog
    53                           ;==========================================================================
    54                           ;==========================================================================
    55                           ;
    56                           ; Verify Processor
    57                           ;
    58                           ;==========================================================================
    59                           ; IFNDEF __16LF1947
    60                           ; MESSG "Processor-header file mismatch.  Verify selected processor."
    61                           ; ENDIF
    62                           ;==========================================================================
    63                           ;
    64                           ; Register Definitions
    65                           ;
    66                           ;==========================================================================
    67                           ;W EQU 0000H
    68                           ;F EQU 0001H
    69                           ;----- Register Files -----------------------------------------------------
    70                           ;-----Bank0------------------
    71     0003                     
    72                           ;FSR0 EQU 0004H
    73     0005                     
    74                           ;FSR1 EQU 0006H
    75     001F                     
    76                           ;-----Bank1------------------
    77     009E                     
    78                           ;-----Bank2------------------
    79     011F                     
    80                           ;-----Bank3------------------
    81     019F                     
    82                           ;-----Bank4------------------
    83     021F                     
    84                           ;-----Bank5------------------
    85     029F                     
    86                           ;-----Bank6------------------
    87     031E                     
    88                           ;-----Bank7------------------
    89     0396                     
    90                           ;-----Bank8------------------
    91     041E                     
    92                           ;-----Bank9------------------
    93     0497                     
    94                           ;-----Bank15------------------
    95     07B7                     
    96                           ;-----Bank31------------------
    97     0FEF                     
    98                           ;----- STATUS Bits -----------------------------------------------------
    99     0004                     
   100                           ;----- BSR Bits -----------------------------------------------------
   101     0004                     
   102                           ;----- INTCON Bits -----------------------------------------------------
   103     0005                     
   104                           ;----- PORTA Bits -----------------------------------------------------
   105     0007                     
   106                           ;----- PORTB Bits -----------------------------------------------------
   107     0000                     
   108                           ;----- PORTC Bits -----------------------------------------------------
   109     0002                     
   110                           ;----- PORTD Bits -----------------------------------------------------
   111     0006                     
   112                           ;----- PORTE Bits -----------------------------------------------------
   113     0007                     
   114                           ;----- PIR1 Bits -----------------------------------------------------
   115     0005                     
   116                           ;----- PIR2 Bits -----------------------------------------------------
   117     0007                     
   118                           ;----- PIR3 Bits -----------------------------------------------------
   119     0006                     
   120                           ;----- PIR4 Bits -----------------------------------------------------
   121     0005                     
   122                           ;----- T1CON Bits -----------------------------------------------------
   123     0007                     
   124                           ;----- T1GCON Bits -----------------------------------------------------
   125     0003                     
   126                           ;----- T2CON Bits -----------------------------------------------------
   127     0006                     
   128                           ;----- CPSCON0 Bits -----------------------------------------------------
   129     0007                     
   130                           ;----- CPSCON1 Bits -----------------------------------------------------
   131     0004                     
   132                           ;----- TRISA Bits -----------------------------------------------------
   133     0007                     
   134                           ;----- TRISB Bits -----------------------------------------------------
   135     0007                     
   136                           ;----- TRISC Bits -----------------------------------------------------
   137     0007                     
   138                           ;----- TRISD Bits -----------------------------------------------------
   139     0007                     
   140                           ;----- TRISE Bits -----------------------------------------------------
   141     0007                     
   142                           ;----- PIE1 Bits -----------------------------------------------------
   143     0005                     
   144                           ;----- PIE2 Bits -----------------------------------------------------
   145     0007                     
   146                           ;----- PIE3 Bits -----------------------------------------------------
   147     0006                     
   148                           ;----- PIE4 Bits -----------------------------------------------------
   149     0005                     
   150                           ;----- OPTION_REG Bits -----------------------------------------------------
   151     0005                     
   152                           ;----- PCON Bits -----------------------------------------------------
   153     0007                     
   154                           ;----- WDTCON Bits -----------------------------------------------------
   155     0005                     
   156                           ;----- OSCTUNE Bits -----------------------------------------------------
   157     0005                     
   158                           ;----- OSCCON Bits -----------------------------------------------------
   159     0007                     
   160                           ;----- OSCSTAT Bits -----------------------------------------------------
   161     0007                     
   162                           ;----- ADCON0 Bits -----------------------------------------------------
   163     0001                     
   164                           ;----- ADCON1 Bits -----------------------------------------------------
   165     0007                     
   166                           ;----- LATA Bits -----------------------------------------------------
   167     0007                     
   168                           ;----- LATB Bits -----------------------------------------------------
   169     0007                     
   170                           ;----- LATC Bits -----------------------------------------------------
   171     0007                     
   172                           ;----- LATD Bits -----------------------------------------------------
   173     0007                     
   174                           ;----- LATE Bits -----------------------------------------------------
   175     0007                     
   176                           ;----- CM1CON0 Bits -----------------------------------------------------
   177     0007                     
   178                           ;----- CM1CON1 Bits -----------------------------------------------------
   179     0007                     
   180                           ;----- CM2CON0 Bits -----------------------------------------------------
   181     0007                     
   182                           ;----- CM2CON1 Bits -----------------------------------------------------
   183     0007                     
   184                           ;----- CMOUT Bits -----------------------------------------------------
   185     0002                     
   186                           ;----- BORCON Bits -----------------------------------------------------
   187     0007                     
   188                           ;----- FVRCON Bits -----------------------------------------------------
   189     0007                     
   190                           ;----- DACCON0 Bits -----------------------------------------------------
   191     0007                     
   192                           ;----- DACCON1 Bits -----------------------------------------------------
   193     0004                     
   194                           ;----- SRCON0 Bits -----------------------------------------------------
   195     0007                     
   196                           ;----- SRCON1 Bits -----------------------------------------------------
   197     0007                     
   198                           ;----- APFCON Bits -----------------------------------------------------
   199     0007                     
   200                           ;----- CM3CON0 Bits -----------------------------------------------------
   201     0007                     
   202                           ;----- CM3CON1 Bits -----------------------------------------------------
   203     0007                     
   204                           ;----- ANSELA Bits -----------------------------------------------------
   205     0005                     
   206                           ;----- ANSELE Bits -----------------------------------------------------
   207     0002                     
   208                           ;----- EECON1 Bits -----------------------------------------------------
   209     0007                     
   210                           ;----- RC1STA Bits -----------------------------------------------------
   211     0007                     
   212                           ;----- RCSTA Bits -----------------------------------------------------
   213     0007                     
   214                           ;----- TX1STA Bits -----------------------------------------------------
   215     0007                     
   216                           ;----- TXSTA Bits -----------------------------------------------------
   217     0007                     
   218                           ;----- BAUD1CON Bits -----------------------------------------------------
   219     0007                     
   220                           ;----- WPUB Bits -----------------------------------------------------
   221     0007                     
   222                           ;----- SSP1STAT Bits -----------------------------------------------------
   223     0007                     
   224                           ;----- SSPSTAT Bits -----------------------------------------------------
   225     0007                     
   226                           ;----- SSP1CON1 Bits -----------------------------------------------------
   227     0007                     
   228                           ;----- SSPCON Bits -----------------------------------------------------
   229     0007                     
   230                           ;----- SSPCON1 Bits -----------------------------------------------------
   231     0007                     
   232                           ;----- SSP1CON2 Bits -----------------------------------------------------
   233     0007                     
   234                           ;----- SSPCON2 Bits -----------------------------------------------------
   235     0007                     
   236                           ;----- SSP1CON3 Bits -----------------------------------------------------
   237     0007                     
   238                           ;----- SSPCON3 Bits -----------------------------------------------------
   239     0007                     
   240                           ;----- SSP2STAT Bits -----------------------------------------------------
   241     0007                     
   242                           ;----- SSP2CON1 Bits -----------------------------------------------------
   243     0007                     
   244                           ;----- SSP2CON2 Bits -----------------------------------------------------
   245     0007                     
   246                           ;----- SSP2CON3 Bits -----------------------------------------------------
   247     0007                     
   248                           ;----- PORTF Bits -----------------------------------------------------
   249     0007                     
   250                           ;----- PORTG Bits -----------------------------------------------------
   251     0004                     
   252                           ;----- CCP1CON Bits -----------------------------------------------------
   253     0007                     
   254                           ;----- PWM1CON Bits -----------------------------------------------------
   255     0007                     
   256                           ;----- CCP1AS Bits -----------------------------------------------------
   257     0007                     
   258                           ;----- ECCP1AS Bits -----------------------------------------------------
   259     0007                     
   260                           ;----- PSTR1CON Bits -----------------------------------------------------
   261     0004                     
   262                           ;----- CCP2CON Bits -----------------------------------------------------
   263     0007                     
   264                           ;----- PWM2CON Bits -----------------------------------------------------
   265     0007                     
   266                           ;----- CCP2AS Bits -----------------------------------------------------
   267     0007                     
   268                           ;----- ECCP2AS Bits -----------------------------------------------------
   269     0007                     
   270                           ;----- PSTR2CON Bits -----------------------------------------------------
   271     0004                     
   272                           ;----- CCPTMRS0 Bits -----------------------------------------------------
   273     0007                     
   274                           ;----- CCPTMRS1 Bits -----------------------------------------------------
   275     0001                     
   276                           ;----- TRISF Bits -----------------------------------------------------
   277     0007                     
   278                           ;----- TRISG Bits -----------------------------------------------------
   279     0005                     
   280                           ;----- CCP3CON Bits -----------------------------------------------------
   281     0007                     
   282                           ;----- PWM3CON Bits -----------------------------------------------------
   283     0007                     
   284                           ;----- CCP3AS Bits -----------------------------------------------------
   285     0007                     
   286                           ;----- ECCP3AS Bits -----------------------------------------------------
   287     0007                     
   288                           ;----- PSTR3CON Bits -----------------------------------------------------
   289     0004                     
   290                           ;----- CCP4CON Bits -----------------------------------------------------
   291     0005                     
   292                           ;----- CCP5CON Bits -----------------------------------------------------
   293     0005                     
   294                           ;----- LATF Bits -----------------------------------------------------
   295     0007                     
   296                           ;----- LATG Bits -----------------------------------------------------
   297     0005                     
   298                           ;----- IOCBP Bits -----------------------------------------------------
   299     0007                     
   300                           ;----- IOCBN Bits -----------------------------------------------------
   301     0007                     
   302                           ;----- IOCBF Bits -----------------------------------------------------
   303     0007                     
   304                           ;----- ANSELF Bits -----------------------------------------------------
   305     0007                     
   306                           ;----- ANSELG Bits -----------------------------------------------------
   307     0004                     
   308                           ;----- T4CON Bits -----------------------------------------------------
   309     0006                     
   310                           ;----- T6CON Bits -----------------------------------------------------
   311     0006                     
   312                           ;----- WPUG Bits -----------------------------------------------------
   313     0005                     
   314                           ;----- RC2STA Bits -----------------------------------------------------
   315     0007                     
   316                           ;----- TX2STA Bits -----------------------------------------------------
   317     0007                     
   318                           ;----- BAUD2CON Bits -----------------------------------------------------
   319     0007                     
   320                           ;----- LCDCON Bits -----------------------------------------------------
   321     0007                     
   322                           ;----- LCDPS Bits -----------------------------------------------------
   323     0007                     
   324                           ;----- LCDREF Bits -----------------------------------------------------
   325     0007                     
   326                           ;----- LCDCST Bits -----------------------------------------------------
   327     0002                     
   328                           ;----- LCDRL Bits -----------------------------------------------------
   329     0007                     
   330                           ;----- LCDSE0 Bits -----------------------------------------------------
   331     0007                     
   332                           ;----- LCDSE1 Bits -----------------------------------------------------
   333     0007                     
   334                           ;----- LCDSE2 Bits -----------------------------------------------------
   335     0007                     
   336                           ;----- LCDSE3 Bits -----------------------------------------------------
   337     0007                     
   338                           ;----- LCDSE4 Bits -----------------------------------------------------
   339     0007                     
   340                           ;----- LCDSE5 Bits -----------------------------------------------------
   341     0005                     
   342                           ;----- LCDDATA0 Bits -----------------------------------------------------
   343     0007                     
   344                           ;----- LCDDATA1 Bits -----------------------------------------------------
   345     0007                     
   346                           ;----- LCDDATA2 Bits -----------------------------------------------------
   347     0007                     
   348                           ;----- LCDDATA3 Bits -----------------------------------------------------
   349     0007                     
   350                           ;----- LCDDATA4 Bits -----------------------------------------------------
   351     0007                     
   352                           ;----- LCDDATA5 Bits -----------------------------------------------------
   353     0007                     
   354                           ;----- LCDDATA6 Bits -----------------------------------------------------
   355     0007                     
   356                           ;----- LCDDATA7 Bits -----------------------------------------------------
   357     0007                     
   358                           ;----- LCDDATA8 Bits -----------------------------------------------------
   359     0007                     
   360                           ;----- LCDDATA9 Bits -----------------------------------------------------
   361     0007                     
   362                           ;----- LCDDATA10 Bits -----------------------------------------------------
   363     0007                     
   364                           ;----- LCDDATA11 Bits -----------------------------------------------------
   365     0007                     
   366                           ;----- LCDDATA12 Bits -----------------------------------------------------
   367     0007                     
   368                           ;----- LCDDATA13 Bits -----------------------------------------------------
   369     0007                     
   370                           ;----- LCDDATA14 Bits -----------------------------------------------------
   371     0005                     
   372                           ;----- LCDDATA15 Bits -----------------------------------------------------
   373     0007                     
   374                           ;----- LCDDATA16 Bits -----------------------------------------------------
   375     0007                     
   376                           ;----- LCDDATA17 Bits -----------------------------------------------------
   377     0005                     
   378                           ;----- LCDDATA18 Bits -----------------------------------------------------
   379     0007                     
   380                           ;----- LCDDATA19 Bits -----------------------------------------------------
   381     0007                     
   382                           ;----- LCDDATA20 Bits -----------------------------------------------------
   383     0005                     
   384                           ;----- LCDDATA21 Bits -----------------------------------------------------
   385     0007                     
   386                           ;----- LCDDATA22 Bits -----------------------------------------------------
   387     0007                     
   388                           ;----- LCDDATA23 Bits -----------------------------------------------------
   389     0005                     
   390                           ;----- STATUS_SHAD Bits -----------------------------------------------------
   391     0002                     
   392                           	psect	edata
   393                           
   394                           ;==========================================================================
   395                           ;
   396                           ; Configuration Bits
   397                           ;
   398                           ; NAME Address
   399                           ; CONFIG1 8007h
   400                           ; CONFIG2 8008h
   401                           ;
   402                           ;==========================================================================
   403                           ;========================================================
   404                           ;================ Project Information ===================
   405                           ;========================================================
   406                           ;Pin Assignment :
   407                           ;Project Name :
   408                           ;Project Version: V2.00 (Bate00)
   409                           ;Project object :
   410                           ;Project number :
   411                           ;Edit Date : 2023/04/18
   412                           ;--------------------------------------------------------
   413                           ;========================================================
   414                           ;========================================================
   415                           ;INCLUDE TITLE
   416                           ;========================================================
   417                           ;================ Project Information ===================
   418                           ;========================================================
   419                           ;Project Name : MODBUS RTU BASE
   420                           ;-------------------------------------------------------
   421                           ;Project Version: 2.00
   422                           ;Edit Date : 2023/09/28
   423                           ;Function Info :
   424                           ;-------------------------------------------------------
   425                           ;Description of Register Informatione (use FSR)
   426                           ;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
   427                           ;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
   428                           ;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
   429                           ;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
   430                           ;MODBUS_DAT_BUF_ADRL+4 : CRC counter
   431                           ;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
   432                           ;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
   433                           ;MODBUS_DAT_BUF_ADRL+7 : time out count
   434                           ;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG
   435                           ;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
   436                           ;-------------------------------------------------------
   437                           ;-------------------------------------------------------
   438                           ;-------------------------------------------------------
   439                           ;須被定義的部分
   440     0003                     
   441                           ;-------------------------------------------------------
   442     00B0                     
   443                           ;========================================================
   444                           ;================ Project Information ===================
   445                           ;========================================================
   446                           ;Project Name : MODBUS RTU BASE
   447                           ;-------------------------------------------------------
   448                           ;Project Version: 2.00
   449                           ;Edit Date : 2023/09/28
   450                           ;Function Info :
   451                           ;-------------------------------------------------------
   452                           ;-------------------------------------------------------
   453                           ;========================================================
   454                           ;========================================================
   455     0074                     
   456                           ;-------------------------------------------------------
   457     038C                     
   458                           ;-------------------------------------------------------
   459                           ;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
   460     00B0                     	;存放從485送進來的資料
   461     0040                     	;將485送的資料複製出來，之後的判斷都使用這個地方
   462                           
   463                           ;這邊主要是因為有4個馬達，可以直接選擇要使用哪個資料
   464                           ;注射泵2.00來說，轉向馬達是MOTOR1 活塞馬達是MOTOR2
   465     0090                     
   466                           ;MOTOR1 0X2190-0X21AF
   467                           ;CW:4BYTE
   468                           ;CCW:4BYTE
   469                           ;-----------------------------------------------
   470                           ;MOTOR2 0X21B0-0X21CF
   471                           ;MOTOR3 0X21D0-0X21EF
   472                           ;MOTOR4 0X21F0-0X220F
   473                           ;0X21 0X40-0X21 0X54 MOTOR1
   474                           ;0X21 0X55-0X21 0X69 MOTOR2
   475                           ;0X21 0X6A-0X21 0X7E MOTOR3
   476                           ;0X21 0X7F-0X21 0X93 MOTOR4
   477                           ;-------------------------------------------------------
   478                           ;--------------------------------------------------------
   479                           ;WATCH用的暫存器設定
   480     0006                     
   481                           ;--------------------------------------------------------
   482                           ;--------------------------------------------------------
   483                           ;mcu腳位定義
   484                           ;Pin assignment definition
   485     0003                     	;0->往光遮端方向 1->反方向
   486     0005                     	;0->表示電源沒有進入 1->表示有電源
   487     0002                     
   488                           ;--------------------------------------------------------
   489                           ;--------------------------------------------------------
   490                           ;========================================================
   491                           ;==================== 0X20 ~ 0X2F =======================
   492                           ;========================================================
   493                           ;Register definition
   494     002A                     	;用來計算MODBUS RTU
   495     002D                     	;整理UART TX傳送的資料數量
   496     002F                     
   497                           ;========================================================
   498                           ;==================== 0X30 ~ 0X3F =======================
   499                           ;========================================================
   500                           ;Register definition
   501                           ;--------------------------------------
   502     0000                     	;可以回傳資料FLAG
   503     0001                     	;表示目前馬達可以動作
   504     0002                     	;RX資料有錯誤
   505     0003                     	;強制命令執行後SET
   506     0004                     	;表示INT地一次觸發啟動INT_TIMER功能
   507     0005                     
   508                           ;--------------------------------------------------------
   509                           ;馬達1為轉向馬達(目前使用在注射泵)
   510     0001                     	;馬達1收到指令可以進行運作
   511     0002                     	;馬達1順時針
   512     0003                     	;馬達1逆時針
   513     0038                     
   514                           ;--------------------------------------------------------馬達參數設定
   515     0039                     	;在通訊判斷使用哪個馬達的情況下使用
   516     0003                     
   517                           ;--------------------------------------------------------
   518     0004                     	;CMD 0X83全部停止動作
   519                           
   520                           ;--------------------------------------------------------
   521     0001                     	;0表示沒有在功能碼03/1表示有在
   522     0002                     	;0表示沒有在功能碼06/1表示有在
   523     0003                     	;0表示沒有在功能碼10/1表示有在
   524     003D                     	;FLAG6_BANK0，為MODBUS動作前FLAG
   525     0000                     	;恢復出廠設定
   526     0001                     	;整機初始化
   527     0002                     	;換向閥初始化
   528     0003                     	;活塞初始化
   529     0004                     	;進入醒目提示_F
   530     0000                     	;未初始化
   531     0001                     	;設備在線
   532     0002                     	;安全模式
   533     0003                     	;設備異常
   534     0004                     	;醒目提示
   535                           
   536                           ; 0X3F
   537                           ;========================================================
   538                           ;==================== 0X40 ~ 0X4F =======================
   539                           ;========================================================
   540                           ;Register definition
   541     0040                     	;每次一個PWM就+1
   542     0041                     	;每次一個PWM就+1
   543     0045                     
   544                           ;-----------------------------------------------
   545     004D                     	;用來暫存MODBUS中運算的資料
   546     00A0                     
   547                           ;--------------------------------------------------------------
   548                           ;------------------------BANK7參數設定-------------------------
   549                           ;--------------------------------------------------------------
   550     00A9                     
   551                           	psect	cmd
   552     0800                     MODBUS_ADR_FUNCTION:	
   553                           ;========================================================
   554                           ;================ Project Information ===================
   555                           ;========================================================
   556                           ;Project Name : MODBUS RTU BASE
   557                           ;-------------------------------------------------------
   558                           ;Project Version: 2.00
   559                           ;Edit Date : 2023/09/28
   560                           ;Function Info :
   561                           ;-------------------------------------------------------
   562                           ;-------------------------------------------------------
   563                           ;******************************************************************************
   564                           ;****************************TABLE表區域***************************************
   565                           ;******************************************************************************
   566                           ;========================================================
   567                           ;==================中斷UART2 FUNCTION====================
   568                           ;========================================================
   569                           
   570     0800  0020               	banksel	12
   571     0801  3008               	movlw	8
   572     0802  008A               	movwf	10
   573     0803  084A               	movf	74,w
   574     0804  000B               	brw
   575     0805  2861               	goto	MODBUS_ADR_A0_FUNCTION	;00
   576     0806  2894               	goto	MODBUS_ADR_A1_FUNCTION	;01
   577     0807  28C7               	goto	MODBUS_ADR_A2_FUNCTION	;02
   578     0808  28FA               	goto	MODBUS_ADR_A3_FUNCTION	;03
   579     0809  292D               	goto	MODBUS_ADR_A4_FUNCTION	;04
   580     080A  2857               	goto	MODBUS_BUS_02_ERROR_0800	;05
   581     080B  2857               	goto	MODBUS_BUS_02_ERROR_0800	;06
   582     080C  2857               	goto	MODBUS_BUS_02_ERROR_0800	;07
   583     080D  2857               	goto	MODBUS_BUS_02_ERROR_0800	;08
   584     080E  2857               	goto	MODBUS_BUS_02_ERROR_0800	;09
   585     080F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0A
   586     0810  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0B
   587     0811  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0C
   588     0812  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0D
   589     0813  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0E
   590     0814  2857               	goto	MODBUS_BUS_02_ERROR_0800	;0F
   591                           
   592                           ;-----------------------------
   593     0815  2960               	goto	MODBUS_ADR_B0_FUNCTION	;10
   594     0816  2983               	goto	MODBUS_ADR_B1_FUNCTION	;11
   595     0817  2983               	goto	MODBUS_ADR_B2_FUNCTION	;12
   596     0818  2983               	goto	MODBUS_ADR_B3_FUNCTION	;13
   597     0819  2983               	goto	MODBUS_ADR_B4_FUNCTION	;14
   598     081A  2983               	goto	MODBUS_ADR_B5_FUNCTION	;15
   599     081B  2983               	goto	MODBUS_ADR_B6_FUNCTION	;16
   600     081C  2983               	goto	MODBUS_ADR_B7_FUNCTION	;17
   601     081D  2983               	goto	MODBUS_ADR_B8_FUNCTION	;18
   602     081E  2983               	goto	MODBUS_ADR_B9_FUNCTION	;19
   603     081F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1A
   604     0820  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1B
   605     0821  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1C
   606     0822  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1D
   607     0823  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1E
   608     0824  2857               	goto	MODBUS_BUS_02_ERROR_0800	;1F
   609                           
   610                           ;-----------------------------
   611     0825  2983               	goto	MODBUS_ADR_C0_FUNCTION	;20
   612     0826  2983               	goto	MODBUS_ADR_C1_FUNCTION	;21
   613     0827  2983               	goto	MODBUS_ADR_C2_FUNCTION	;22
   614     0828  2983               	goto	MODBUS_ADR_C3_FUNCTION	;23
   615     0829  2983               	goto	MODBUS_ADR_C4_FUNCTION	;24
   616     082A  2983               	goto	MODBUS_ADR_C5_FUNCTION	;25
   617     082B  2983               	goto	MODBUS_ADR_C6_FUNCTION	;26
   618     082C  2983               	goto	MODBUS_ADR_C7_FUNCTION	;27
   619     082D  2857               	goto	MODBUS_BUS_02_ERROR_0800	;28
   620     082E  2857               	goto	MODBUS_BUS_02_ERROR_0800	;29
   621     082F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2A
   622     0830  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2B
   623     0831  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2C
   624     0832  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2D
   625     0833  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2E
   626     0834  2857               	goto	MODBUS_BUS_02_ERROR_0800	;2F
   627                           
   628                           ;-----------------------------
   629     0835  2983               	goto	MODBUS_ADR_D0_FUNCTION	;30
   630     0836  2983               	goto	MODBUS_ADR_D1_FUNCTION	;31
   631     0837  2983               	goto	MODBUS_ADR_D2_FUNCTION	;32
   632     0838  2983               	goto	MODBUS_ADR_D3_FUNCTION	;33
   633     0839  2983               	goto	MODBUS_ADR_D4_FUNCTION	;34
   634     083A  2983               	goto	MODBUS_ADR_D5_FUNCTION	;35
   635     083B  2983               	goto	MODBUS_ADR_D6_FUNCTION	;36
   636     083C  2857               	goto	MODBUS_BUS_02_ERROR_0800	;37
   637     083D  2857               	goto	MODBUS_BUS_02_ERROR_0800	;38
   638     083E  2857               	goto	MODBUS_BUS_02_ERROR_0800	;39
   639     083F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3A
   640     0840  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3B
   641     0841  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3C
   642     0842  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3D
   643     0843  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3E
   644     0844  2857               	goto	MODBUS_BUS_02_ERROR_0800	;3F
   645                           
   646                           ;-----------------------------
   647     0845  2983               	goto	MODBUS_ADR_E0_FUNCTION	;40
   648     0846  2983               	goto	MODBUS_ADR_E1_FUNCTION	;41
   649     0847  2983               	goto	MODBUS_ADR_E2_FUNCTION	;42
   650     0848  2983               	goto	MODBUS_ADR_E3_FUNCTION	;43
   651     0849  2983               	goto	MODBUS_ADR_E4_FUNCTION	;44
   652     084A  2983               	goto	MODBUS_ADR_E5_FUNCTION	;45
   653     084B  2983               	goto	MODBUS_ADR_E6_FUNCTION	;46
   654     084C  2857               	goto	MODBUS_BUS_02_ERROR_0800	;47
   655     084D  2857               	goto	MODBUS_BUS_02_ERROR_0800	;48
   656     084E  2857               	goto	MODBUS_BUS_02_ERROR_0800	;49
   657     084F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4A
   658     0850  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4B
   659     0851  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4C
   660     0852  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4D
   661     0853  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4E
   662     0854  2857               	goto	MODBUS_BUS_02_ERROR_0800	;4F
   663     0855                     MODBUS_BUS_01_ERROR_0800:	
   664                           ;-----------------------------
   665                           ;-----------------------------
   666                           ;===================================================
   667                           ;============MODBUS的功能碼錯誤=====================OK
   668                           ;===================================================
   669                           ;MODBUS RTU ERROR CODE 01
   670                           ;非法功能，表示非授權的功能碼
   671                           
   672     0855  143B               	bsf	59,0
   673     0856  0008               	return
   674     0857                     MODBUS_BUS_02_ERROR_0800:	
   675                           ;----------------------------------------
   676                           ;MODBUS RTU ERROR CODE 02
   677                           ;非法暫存器地址
   678                           
   679     0857  14BB               	bsf	59,1
   680     0858  0008               	return
   681     0859                     MODBUS_BUS_03_ERROR_0800:	
   682                           ;----------------------------------------
   683                           ;MODBUS RTU ERROR CODE 03
   684                           ;非法資料數值
   685                           
   686     0859  153B               	bsf	59,2
   687     085A  0008               	return
   688     085B                     MODBUS_BUS_04_ERROR_0800:	
   689                           ;----------------------------------------
   690                           ;MODBUS RTU ERROR CODE 04
   691                           ;裝置故障，像是自我檢測出現異常
   692                           
   693     085B  15BB               	bsf	59,3
   694     085C  0008               	return
   695     085D                     MODBUS_BUS_05_ERROR_0800:	
   696                           ;----------------------------------------
   697                           ;MODBUS RTU ERROR CODE 05
   698                           ;確認，有收到指令並且立即執行
   699                           
   700     085D  163B               	bsf	59,4
   701     085E  0008               	return
   702     085F                     MODBUS_BUS_06_ERROR_0800:	
   703                           ;----------------------------------------
   704                           ;MODBUS RTU ERROR CODE 06
   705                           ;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
   706                           
   707     085F  16BB               	bsf	59,5
   708     0860  0008               	return
   709     0861                     MODBUS_ADR_A0_FUNCTION:	
   710                           ;******************************************************************
   711                           ;******************************************************************
   712                           ;========================================================
   713                           ;==================MODBUS 恢復出廠設定===================
   714                           ;========================================================
   715                           
   716     0861  0020               	banksel	12
   717     0862  18BC               	btfsc	60,1
   718     0863  2857               	goto	MODBUS_BUS_02_ERROR_0800	;這邊只能用寫，讀的話算是異常碼02
   719                           
   720                           ;--------------------------------
   721     0864  19BC               	btfsc	60,3
   722     0865  287B               	goto	MODBUS_ADR_A0_LV0
   723                           
   724                           ;--------------------------------
   725     0866  1D3C               	btfss	60,2
   726     0867  2855               	goto	MODBUS_BUS_01_ERROR_0800	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
   727                           
   728                           ;--------------------------------
   729                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   730     0868  0020               	banksel	12
   731     0869  3021               	movlw	33	;21
   732     086A  0087               	movwf	7
   733     086B  3040               	movlw	64	;E0
   734     086C  0086               	movwf	6
   735     086D  3004               	movlw	4
   736     086E  0786               	addwf	6,f
   737     086F  0801               	movf	1,w
   738     0870  1D03               	btfss	3,2
   739     0871  2876               	goto	MODBUS_ADR_A0_LV1	;資料不為0
   740                           
   741                           ;-----------------------
   742     0872  0A86               	incf	6,f
   743     0873  0801               	movf	1,w
   744     0874  1903               	btfsc	3,2
   745     0875  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   746     0876                     MODBUS_ADR_A0_LV1:
   747                           
   748                           ;將所有參數設定為預設值
   749                           ;直接設定TX輸出暫存器就直接使用RX陣列
   750     0876  1430               	bsf	48,0
   751     0877  3008               	movlw	8
   752     0878  00AD               	movwf	45
   753                           
   754                           ;------------------------------------------
   755                           ;實際要做的事:
   756     0879  143D               	bsf	61,0
   757     087A  0008               	return
   758     087B                     MODBUS_ADR_A0_LV0:	
   759                           ;--------------------------------------------------
   760                           ;----ADR 0XA0功能碼0X10 先確認輸入的資料是否合法---
   761                           ;--------------------------------------------------
   762                           
   763     087B  0020               	banksel	12
   764     087C  3021               	movlw	33	;21
   765     087D  0087               	movwf	7
   766     087E  3040               	movlw	64	;E0
   767     087F  0086               	movwf	6
   768     0880  3005               	movlw	5
   769     0881  0786               	addwf	6,f
   770     0882  30FE               	movlw	254
   771     0883  0701               	addwf	1,w
   772     0884  1803               	btfsc	3,0
   773     0885  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料數量大於1個WORD
   774                           
   775                           ;----------------------------------------
   776     0886  0A86               	incf	6,f
   777     0887  3002               	movlw	2
   778     0888  0601               	xorwf	1,w
   779     0889  1D03               	btfss	3,2
   780     088A  2859               	goto	MODBUS_BUS_03_ERROR_0800	;BYTE數和WORD數不符合
   781                           
   782                           ;-----------------------------------------
   783     088B  0A86               	incf	6,f
   784     088C  0801               	movf	1,w
   785     088D  1D03               	btfss	3,2
   786     088E  2876               	goto	MODBUS_ADR_A0_LV1	;資料不為0
   787                           
   788                           ;-----------------------
   789     088F  0A86               	incf	6,f
   790     0890  0801               	movf	1,w
   791     0891  1903               	btfsc	3,2
   792     0892  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   793     0893  2876               	goto	MODBUS_ADR_A0_LV1
   794     0894                     MODBUS_ADR_A1_FUNCTION:	
   795                           ;========================================================
   796                           ;==================MODBUS 整機初始化=====================
   797                           ;========================================================
   798                           
   799     0894  0020               	banksel	12
   800     0895  18BC               	btfsc	60,1
   801     0896  2857               	goto	MODBUS_BUS_02_ERROR_0800	;這邊只能用寫，讀的話算是異常碼02
   802                           
   803                           ;--------------------------------
   804     0897  19BC               	btfsc	60,3
   805     0898  28AE               	goto	MODBUS_ADR_A1_LV0
   806                           
   807                           ;--------------------------------
   808     0899  1D3C               	btfss	60,2
   809     089A  2855               	goto	MODBUS_BUS_01_ERROR_0800	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
   810                           
   811                           ;--------------------------------
   812                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   813     089B  0020               	banksel	12
   814     089C  3021               	movlw	33	;21
   815     089D  0087               	movwf	7
   816     089E  3040               	movlw	64	;E0
   817     089F  0086               	movwf	6
   818     08A0  3004               	movlw	4
   819     08A1  0786               	addwf	6,f
   820     08A2  0801               	movf	1,w
   821     08A3  1D03               	btfss	3,2
   822     08A4  28A9               	goto	MODBUS_ADR_A1_LV1	;資料不為0
   823                           
   824                           ;-----------------------
   825     08A5  0A86               	incf	6,f
   826     08A6  0801               	movf	1,w
   827     08A7  1903               	btfsc	3,2
   828     08A8  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   829     08A9                     MODBUS_ADR_A1_LV1:
   830                           
   831                           ;將所有參數設定為預設值
   832                           ;直接設定TX輸出暫存器就直接使用RX陣列
   833     08A9  1430               	bsf	48,0
   834     08AA  3008               	movlw	8
   835     08AB  00AD               	movwf	45
   836                           
   837                           ;------------------------------------------
   838                           ;實際要做的事:
   839     08AC  14BD               	bsf	61,1
   840     08AD  0008               	return
   841     08AE                     MODBUS_ADR_A1_LV0:	
   842                           ;--------------------------------------------------
   843                           ;----ADR 0XA1功能碼0X10 先確認輸入的資料是否合法---
   844                           ;--------------------------------------------------
   845                           
   846     08AE  0020               	banksel	12
   847     08AF  3021               	movlw	33	;21
   848     08B0  0087               	movwf	7
   849     08B1  3040               	movlw	64	;E0
   850     08B2  0086               	movwf	6
   851     08B3  3005               	movlw	5
   852     08B4  0786               	addwf	6,f
   853     08B5  30FE               	movlw	254
   854     08B6  0701               	addwf	1,w
   855     08B7  1803               	btfsc	3,0
   856     08B8  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料數量大於1個WORD
   857                           
   858                           ;----------------------------------------
   859     08B9  0A86               	incf	6,f
   860     08BA  3002               	movlw	2
   861     08BB  0601               	xorwf	1,w
   862     08BC  1D03               	btfss	3,2
   863     08BD  2859               	goto	MODBUS_BUS_03_ERROR_0800	;BYTE數和WORD數不符合
   864                           
   865                           ;-----------------------------------------
   866     08BE  0A86               	incf	6,f
   867     08BF  0801               	movf	1,w
   868     08C0  1D03               	btfss	3,2
   869     08C1  28A9               	goto	MODBUS_ADR_A1_LV1	;資料不為0
   870                           
   871                           ;-----------------------
   872     08C2  0A86               	incf	6,f
   873     08C3  0801               	movf	1,w
   874     08C4  1903               	btfsc	3,2
   875     08C5  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   876     08C6  28A9               	goto	MODBUS_ADR_A1_LV1
   877     08C7                     MODBUS_ADR_A2_FUNCTION:	
   878                           ;========================================================
   879                           ;==================MODBUS 換向閥初始化===================
   880                           ;========================================================
   881                           
   882     08C7  0020               	banksel	12
   883     08C8  18BC               	btfsc	60,1
   884     08C9  2857               	goto	MODBUS_BUS_02_ERROR_0800	;這邊只能用寫，讀的話算是異常碼02
   885                           
   886                           ;--------------------------------
   887     08CA  19BC               	btfsc	60,3
   888     08CB  28E1               	goto	MODBUS_ADR_A2_LV0
   889                           
   890                           ;--------------------------------
   891     08CC  1D3C               	btfss	60,2
   892     08CD  2855               	goto	MODBUS_BUS_01_ERROR_0800	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
   893                           
   894                           ;--------------------------------
   895                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   896     08CE  0020               	banksel	12
   897     08CF  3021               	movlw	33	;21
   898     08D0  0087               	movwf	7
   899     08D1  3040               	movlw	64	;E0
   900     08D2  0086               	movwf	6
   901     08D3  3004               	movlw	4
   902     08D4  0786               	addwf	6,f
   903     08D5  0801               	movf	1,w
   904     08D6  1D03               	btfss	3,2
   905     08D7  28DC               	goto	MODBUS_ADR_A2_LV1	;資料不為0
   906                           
   907                           ;-----------------------
   908     08D8  0A86               	incf	6,f
   909     08D9  0801               	movf	1,w
   910     08DA  1903               	btfsc	3,2
   911     08DB  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   912     08DC                     MODBUS_ADR_A2_LV1:
   913                           
   914                           ;將所有參數設定為預設值
   915                           ;直接設定TX輸出暫存器就直接使用RX陣列
   916     08DC  1430               	bsf	48,0
   917     08DD  3008               	movlw	8
   918     08DE  00AD               	movwf	45
   919                           
   920                           ;------------------------------------------
   921                           ;實際要做的事:
   922     08DF  153D               	bsf	61,2
   923     08E0  0008               	return
   924     08E1                     MODBUS_ADR_A2_LV0:	
   925                           ;--------------------------------------------------
   926                           ;----ADR 0XA2功能碼0X10 先確認輸入的資料是否合法---
   927                           ;--------------------------------------------------
   928                           
   929     08E1  0020               	banksel	12
   930     08E2  3021               	movlw	33	;21
   931     08E3  0087               	movwf	7
   932     08E4  3040               	movlw	64	;E0
   933     08E5  0086               	movwf	6
   934     08E6  3005               	movlw	5
   935     08E7  0786               	addwf	6,f
   936     08E8  30FE               	movlw	254
   937     08E9  0701               	addwf	1,w
   938     08EA  1803               	btfsc	3,0
   939     08EB  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料數量大於1個WORD
   940                           
   941                           ;----------------------------------------
   942     08EC  0A86               	incf	6,f
   943     08ED  3002               	movlw	2
   944     08EE  0601               	xorwf	1,w
   945     08EF  1D03               	btfss	3,2
   946     08F0  2859               	goto	MODBUS_BUS_03_ERROR_0800	;BYTE數和WORD數不符合
   947                           
   948                           ;-----------------------------------------
   949     08F1  0A86               	incf	6,f
   950     08F2  0801               	movf	1,w
   951     08F3  1D03               	btfss	3,2
   952     08F4  28DC               	goto	MODBUS_ADR_A2_LV1	;資料不為0
   953                           
   954                           ;-----------------------
   955     08F5  0A86               	incf	6,f
   956     08F6  0801               	movf	1,w
   957     08F7  1903               	btfsc	3,2
   958     08F8  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   959     08F9  28DC               	goto	MODBUS_ADR_A2_LV1
   960     08FA                     MODBUS_ADR_A3_FUNCTION:	
   961                           ;========================================================
   962                           ;==================MODBUS 活塞初始化=====================
   963                           ;========================================================
   964                           
   965     08FA  0020               	banksel	12
   966     08FB  18BC               	btfsc	60,1
   967     08FC  2857               	goto	MODBUS_BUS_02_ERROR_0800	;這邊只能用寫，讀的話算是異常碼02
   968                           
   969                           ;--------------------------------
   970     08FD  19BC               	btfsc	60,3
   971     08FE  2914               	goto	MODBUS_ADR_A3_LV0
   972                           
   973                           ;--------------------------------
   974     08FF  1D3C               	btfss	60,2
   975     0900  2855               	goto	MODBUS_BUS_01_ERROR_0800	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
   976                           
   977                           ;--------------------------------
   978                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
   979     0901  0020               	banksel	12
   980     0902  3021               	movlw	33	;21
   981     0903  0087               	movwf	7
   982     0904  3040               	movlw	64	;E0
   983     0905  0086               	movwf	6
   984     0906  3004               	movlw	4
   985     0907  0786               	addwf	6,f
   986     0908  0801               	movf	1,w
   987     0909  1D03               	btfss	3,2
   988     090A  290F               	goto	MODBUS_ADR_A3_LV1	;資料不為0
   989                           
   990                           ;-----------------------
   991     090B  0A86               	incf	6,f
   992     090C  0801               	movf	1,w
   993     090D  1903               	btfsc	3,2
   994     090E  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
   995     090F                     MODBUS_ADR_A3_LV1:
   996                           
   997                           ;將所有參數設定為預設值
   998                           ;直接設定TX輸出暫存器就直接使用RX陣列
   999     090F  1430               	bsf	48,0
  1000     0910  3008               	movlw	8
  1001     0911  00AD               	movwf	45
  1002                           
  1003                           ;------------------------------------------
  1004                           ;實際要做的事:
  1005     0912  15BD               	bsf	61,3
  1006     0913  0008               	return
  1007     0914                     MODBUS_ADR_A3_LV0:	
  1008                           ;--------------------------------------------------
  1009                           ;----ADR 0XA3功能碼0X10 先確認輸入的資料是否合法---
  1010                           ;--------------------------------------------------
  1011                           
  1012     0914  0020               	banksel	12
  1013     0915  3021               	movlw	33	;21
  1014     0916  0087               	movwf	7
  1015     0917  3040               	movlw	64	;E0
  1016     0918  0086               	movwf	6
  1017     0919  3005               	movlw	5
  1018     091A  0786               	addwf	6,f
  1019     091B  30FE               	movlw	254
  1020     091C  0701               	addwf	1,w
  1021     091D  1803               	btfsc	3,0
  1022     091E  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料數量大於1個WORD
  1023                           
  1024                           ;----------------------------------------
  1025     091F  0A86               	incf	6,f
  1026     0920  3002               	movlw	2
  1027     0921  0601               	xorwf	1,w
  1028     0922  1D03               	btfss	3,2
  1029     0923  2859               	goto	MODBUS_BUS_03_ERROR_0800	;BYTE數和WORD數不符合
  1030                           
  1031                           ;-----------------------------------------
  1032     0924  0A86               	incf	6,f
  1033     0925  0801               	movf	1,w
  1034     0926  1D03               	btfss	3,2
  1035     0927  290F               	goto	MODBUS_ADR_A3_LV1	;資料不為0
  1036                           
  1037                           ;-----------------------
  1038     0928  0A86               	incf	6,f
  1039     0929  0801               	movf	1,w
  1040     092A  1903               	btfsc	3,2
  1041     092B  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
  1042     092C  290F               	goto	MODBUS_ADR_A3_LV1
  1043     092D                     MODBUS_ADR_A4_FUNCTION:	
  1044                           ;========================================================
  1045                           ;==================MODBUS 醒目提示=======================
  1046                           ;========================================================
  1047                           
  1048     092D  0020               	banksel	12
  1049     092E  18BC               	btfsc	60,1
  1050     092F  2857               	goto	MODBUS_BUS_02_ERROR_0800	;這邊只能用寫，讀的話算是異常碼02
  1051                           
  1052                           ;--------------------------------
  1053     0930  19BC               	btfsc	60,3
  1054     0931  2947               	goto	MODBUS_ADR_A4_LV0
  1055                           
  1056                           ;--------------------------------
  1057     0932  1D3C               	btfss	60,2
  1058     0933  2855               	goto	MODBUS_BUS_01_ERROR_0800	;這邊主要是確保功能碼的部分只能有0X03和0X06之外的
  1059                           
  1060                           ;--------------------------------
  1061                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
  1062     0934  0020               	banksel	12
  1063     0935  3021               	movlw	33	;21
  1064     0936  0087               	movwf	7
  1065     0937  3040               	movlw	64	;E0
  1066     0938  0086               	movwf	6
  1067     0939  3004               	movlw	4
  1068     093A  0786               	addwf	6,f
  1069     093B  0801               	movf	1,w
  1070     093C  1D03               	btfss	3,2
  1071     093D  2942               	goto	MODBUS_ADR_A4_LV1	;資料不為0
  1072                           
  1073                           ;-----------------------
  1074     093E  0A86               	incf	6,f
  1075     093F  0801               	movf	1,w
  1076     0940  1903               	btfsc	3,2
  1077     0941  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
  1078     0942                     MODBUS_ADR_A4_LV1:
  1079                           
  1080                           ;將所有參數設定為預設值
  1081                           ;直接設定TX輸出暫存器就直接使用RX陣列
  1082     0942  1430               	bsf	48,0
  1083     0943  3008               	movlw	8
  1084     0944  00AD               	movwf	45
  1085                           
  1086                           ;------------------------------------------
  1087                           ;實際要做的事:
  1088     0945  163D               	bsf	61,4
  1089     0946  0008               	return
  1090     0947                     MODBUS_ADR_A4_LV0:	
  1091                           ;--------------------------------------------------
  1092                           ;----ADR 0XA4功能碼0X10 先確認輸入的資料是否合法---
  1093                           ;--------------------------------------------------
  1094                           
  1095     0947  0020               	banksel	12
  1096     0948  3021               	movlw	33	;21
  1097     0949  0087               	movwf	7
  1098     094A  3040               	movlw	64	;E0
  1099     094B  0086               	movwf	6
  1100     094C  3005               	movlw	5
  1101     094D  0786               	addwf	6,f
  1102     094E  30FE               	movlw	254
  1103     094F  0701               	addwf	1,w
  1104     0950  1803               	btfsc	3,0
  1105     0951  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料數量大於1個WORD
  1106                           
  1107                           ;----------------------------------------
  1108     0952  0A86               	incf	6,f
  1109     0953  3002               	movlw	2
  1110     0954  0601               	xorwf	1,w
  1111     0955  1D03               	btfss	3,2
  1112     0956  2859               	goto	MODBUS_BUS_03_ERROR_0800	;BYTE數和WORD數不符合
  1113                           
  1114                           ;-----------------------------------------
  1115     0957  0A86               	incf	6,f
  1116     0958  0801               	movf	1,w
  1117     0959  1D03               	btfss	3,2
  1118     095A  2942               	goto	MODBUS_ADR_A4_LV1	;資料不為0
  1119                           
  1120                           ;-----------------------
  1121     095B  0A86               	incf	6,f
  1122     095C  0801               	movf	1,w
  1123     095D  1903               	btfsc	3,2
  1124     095E  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料都是0X00表示異常
  1125     095F  2942               	goto	MODBUS_ADR_A4_LV1
  1126     0960                     MODBUS_ADR_B0_FUNCTION:	
  1127                           ;========================================================
  1128                           ;==================MODBUS 閥換向=========================
  1129                           ;========================================================
  1130                           
  1131     0960  18BC               	btfsc	60,1
  1132     0961  2982               	goto	MODBUS_ADR_B0_03_LOOP	;ADR 為閥換向，使用READ 1 BYTE 功能碼
  1133                           
  1134                           ;--------------------------------
  1135     0962  193C               	btfsc	60,2
  1136     0963  2967               	goto	MODBUS_ADR_B0_06_LOOP	;ADR 為閥換向，使用WRITE 1 BYTE 功能碼
  1137                           
  1138                           ;--------------------------------
  1139     0964  19BC               	btfsc	60,3
  1140     0965  2967               	goto	MODBUS_ADR_B0_10_LOOP	;寫MORE BYTE
  1141                           
  1142                           ;--------------------------------
  1143     0966  2855               	goto	MODBUS_BUS_01_ERROR_0800	;表示功能碼都不是
  1144     0967                     MODBUS_ADR_B0_10_LOOP:
  1145     0967                     MODBUS_ADR_B0_06_LOOP:	
  1146                           ;-----------------------------------------------------------
  1147                           ;--------------------MODBUS B0 寫1BYTE----------------------
  1148                           ;-----------------------------------------------------------
  1149                           
  1150                           
  1151                           ;前面確認過暫存器位址，後面要確認資料格式是否符合
  1152     0967  0020               	banksel	12
  1153     0968  3021               	movlw	33	;21
  1154     0969  0087               	movwf	7
  1155     096A  3040               	movlw	64	;E0
  1156     096B  0086               	movwf	6
  1157     096C  3004               	movlw	4
  1158     096D  0786               	addwf	6,f
  1159     096E  0801               	movf	1,w
  1160     096F  1D03               	btfss	3,2
  1161     0970  2859               	goto	MODBUS_BUS_03_ERROR_0800	;DATA的HBYTE必須為0X00
  1162                           
  1163                           ;-----------------------
  1164     0971  0A86               	incf	6,f
  1165     0972  30FE               	movlw	254
  1166     0973  0701               	addwf	1,w
  1167     0974  1803               	btfsc	3,0
  1168     0975  2859               	goto	MODBUS_BUS_03_ERROR_0800	;資料不是0X00就是0X01，超過範圍就算是異常碼03
  1169                           
  1170                           ;------------------------
  1171                           ;資料範圍正確，將資料存放到相應的馬達模組存放資料地方，並回覆485
  1172     0976  3021               	movlw	33
  1173     0977  0085               	movwf	5
  1174     0978  3090               	movlw	144
  1175     0979  0084               	movwf	4
  1176     097A  3004               	movlw	4
  1177     097B  0784               	addwf	4,f
  1178     097C  0801               	movf	1,w
  1179     097D  0080               	movwf	0
  1180                           
  1181                           ;------------------------
  1182     097E  1430               	bsf	48,0
  1183     097F  3008               	movlw	8
  1184     0980  00AD               	movwf	45
  1185     0981  0009               	retfie
  1186     0982                     MODBUS_ADR_B0_03_LOOP:	
  1187                           ;-----------------------------------------------------------
  1188                           ;--------------------MODBUS B0 讀1BYTE----------------------
  1189                           ;-----------------------------------------------------------
  1190                           
  1191                           
  1192                           ;設定好要讀取的位置之後用485功能碼0X03就可以了
  1193     0982  0009               	retfie
  1194     0983                     MODBUS_ADR_B1_FUNCTION:	
  1195                           ;========================================================
  1196                           ;==================MODBUS 活塞移動-絕對位置==============
  1197                           ;========================================================
  1198                           ;這邊的資料主要是4個BYTE，所以要執行動作的話，需要等到ADR_B2被寫入才會動作
  1199                           
  1200     0983                     MODBUS_ADR_B2_FUNCTION:
  1201     0983                     MODBUS_ADR_B3_FUNCTION:	
  1202                           ;========================================================
  1203                           ;==================MODBUS 活塞移動-相對位置==============
  1204                           ;========================================================
  1205                           
  1206     0983                     MODBUS_ADR_B4_FUNCTION:
  1207     0983                     MODBUS_ADR_B5_FUNCTION:	
  1208                           ;========================================================
  1209                           ;==================MODBUS 活塞移動-向量-CW===============
  1210                           ;========================================================
  1211                           
  1212     0983                     MODBUS_ADR_B6_FUNCTION:
  1213     0983                     MODBUS_ADR_B7_FUNCTION:	
  1214                           ;========================================================
  1215                           ;==================MODBUS 活塞移動-向量-CCW==============
  1216                           ;========================================================
  1217                           
  1218     0983                     MODBUS_ADR_B8_FUNCTION:
  1219     0983                     MODBUS_ADR_B9_FUNCTION:	
  1220                           ;========================================================
  1221                           ;==================MODBUS 活塞移動-極限==================
  1222                           ;========================================================
  1223                           
  1224     0983                     MODBUS_ADR_C0_FUNCTION:	
  1225                           ;========================================================
  1226                           ;==================MODBUS 零點偏移量設定=================
  1227                           ;========================================================
  1228                           
  1229     0983                     MODBUS_ADR_C1_FUNCTION:	
  1230                           ;========================================================
  1231                           ;==================MODBUS 累計步數=======================
  1232                           ;========================================================
  1233                           
  1234     0983                     MODBUS_ADR_C2_FUNCTION:
  1235     0983                     MODBUS_ADR_C3_FUNCTION:	
  1236                           ;========================================================
  1237                           ;==================MODBUS 相對零點設定===================
  1238                           ;========================================================
  1239                           
  1240     0983                     MODBUS_ADR_C4_FUNCTION:
  1241     0983                     MODBUS_ADR_C5_FUNCTION:	
  1242                           ;========================================================
  1243                           ;==================MODBUS 反向間隙設定-CW===============
  1244                           ;========================================================
  1245                           
  1246     0983                     MODBUS_ADR_C6_FUNCTION:	
  1247                           ;========================================================
  1248                           ;==================MODBUS 反向間隙設定-CCW==============
  1249                           ;========================================================
  1250                           
  1251     0983                     MODBUS_ADR_C7_FUNCTION:	
  1252                           ;========================================================
  1253                           ;==================MODBUS 自動校正反向間隙==============
  1254                           ;========================================================
  1255                           
  1256     0983                     MODBUS_ADR_D0_FUNCTION:	
  1257                           ;========================================================
  1258                           ;==================MODBUS 安全模式======================
  1259                           ;========================================================
  1260                           
  1261     0983                     MODBUS_ADR_D1_FUNCTION:	
  1262                           ;========================================================
  1263                           ;==================MODBUS 設備狀態======================
  1264                           ;========================================================
  1265                           
  1266     0983                     MODBUS_ADR_D2_FUNCTION:	
  1267                           ;========================================================
  1268                           ;==================MODBUS 設備辨識資料==================
  1269                           ;========================================================
  1270                           
  1271     0983                     MODBUS_ADR_D3_FUNCTION:	
  1272                           ;========================================================
  1273                           ;==================MODBUS 溫度檢測======================
  1274                           ;========================================================
  1275                           
  1276     0983                     MODBUS_ADR_D4_FUNCTION:	
  1277                           ;========================================================
  1278                           ;==================MODBUS 電流檢測======================
  1279                           ;========================================================
  1280                           
  1281     0983                     MODBUS_ADR_D5_FUNCTION:	
  1282                           ;========================================================
  1283                           ;==================MODBUS 電壓檢測======================
  1284                           ;========================================================
  1285                           
  1286     0983                     MODBUS_ADR_D6_FUNCTION:	
  1287                           ;========================================================
  1288                           ;==================MODBUS 上電初始化設定================
  1289                           ;========================================================
  1290                           
  1291     0983                     MODBUS_ADR_E0_FUNCTION:	
  1292                           ;========================================================
  1293                           ;==================MODBUS 開發人員權限啟動==============
  1294                           ;========================================================
  1295                           
  1296     0983                     MODBUS_ADR_E1_FUNCTION:	
  1297                           ;========================================================
  1298                           ;==================MODBUS 活塞最大行程設定==============
  1299                           ;========================================================
  1300                           
  1301     0983                     MODBUS_ADR_E2_FUNCTION:
  1302     0983                     MODBUS_ADR_E3_FUNCTION:	
  1303                           ;========================================================
  1304                           ;==================MODBUS 微步進模式====================
  1305                           ;========================================================
  1306                           
  1307     0983                     MODBUS_ADR_E4_FUNCTION:	
  1308                           ;========================================================
  1309                           ;==================MODBUS 活塞移動-光耦合===============
  1310                           ;========================================================
  1311                           
  1312     0983                     MODBUS_ADR_E5_FUNCTION:	
  1313                           ;========================================================
  1314                           ;==================MODBUS 速度設定======================
  1315                           ;========================================================
  1316                           
  1317     0983                     MODBUS_ADR_E6_FUNCTION:	
  1318                           ;========================================================
  1319                           ;==================MODBUS 速度==========================
  1320                           ;========================================================
  1321                           
  1322     0983  0009               	retfie


Microchip Technology PIC Macro Assembler V2.40 build 20220703182018 
Symbol Table                                                                                               Thu Oct 05 13:54:13 2023

                       C 0000                         Z 0002         MODBUS_ERROR_FLAG 003B                      A0_F 0000  
                    A1_F 0001                      A2_F 0002                      A3_F 0003                      A4_F 0004  
                    LATA 010C                      LATC 010E                      LATE 0110                      LATF 038C  
                    LATG 038D                     INDF0 0000                     INDF1 0001                     FSR0H 0005  
                   FSR1H 0007                     FSR0L 0004                     FSR1L 0006                     PORTA 000C  
                   PORTB 000D                     PORTD 000F                    PCLATH 000A                    STATUS 0003  
        CAN_SEND_TX_FLAG 0000    SET_MODBUS_MODE_ENABLE 0D08                ERROR_01_F 0000                ERROR_02_F 0001  
              ERROR_03_F 0002                ERROR_04_F 0003                ERROR_05_F 0004                ERROR_06_F 0005  
  MODBUS_INTPUT_FUNCTION 0D1F               FLAG1_BANK0 0030               FLAG5_BANK0 003C               FLAG6_BANK0 003D  
   MODBUS_TABLE_ADR_TEMP 004A  MODBUS_BUS_01_ERROR_0800 0855  MODBUS_BUS_02_ERROR_0800 0857    MODBUS_ADR_A0_FUNCTION 0861  
  MODBUS_ADR_A1_FUNCTION 0894    MODBUS_ADR_B0_FUNCTION 0960    MODBUS_ADR_A2_FUNCTION 08C7  MODBUS_BUS_03_ERROR_0800 0859  
  MODBUS_ADR_B1_FUNCTION 0983    MODBUS_ADR_A3_FUNCTION 08FA    MODBUS_ADR_C0_FUNCTION 0983    MODBUS_ADR_B2_FUNCTION 0983  
  MODBUS_ADR_A4_FUNCTION 092D    MODBUS_ADR_C1_FUNCTION 0983    MODBUS_ADR_B3_FUNCTION 0983    MODBUS_ADR_D0_FUNCTION 0983  
  MODBUS_ADR_C2_FUNCTION 0983    MODBUS_ADR_B4_FUNCTION 0983  MODBUS_BUS_04_ERROR_0800 085B    MODBUS_ADR_D1_FUNCTION 0983  
  MODBUS_ADR_C3_FUNCTION 0983    MODBUS_ADR_B5_FUNCTION 0983    MODBUS_ADR_E0_FUNCTION 0983    MODBUS_ADR_D2_FUNCTION 0983  
  MODBUS_ADR_C4_FUNCTION 0983    MODBUS_ADR_B6_FUNCTION 0983    MODBUS_ADR_E1_FUNCTION 0983    MODBUS_ADR_D3_FUNCTION 0983  
  MODBUS_ADR_C5_FUNCTION 0983    MODBUS_ADR_B7_FUNCTION 0983    MODBUS_ADR_E2_FUNCTION 0983    MODBUS_ADR_D4_FUNCTION 0983  
  MODBUS_ADR_C6_FUNCTION 0983    MODBUS_ADR_B8_FUNCTION 0983  MODBUS_BUS_05_ERROR_0800 085D    MODBUS_ADR_E3_FUNCTION 0983  
  MODBUS_ADR_D5_FUNCTION 0983    MODBUS_ADR_C7_FUNCTION 0983    MODBUS_ADR_B9_FUNCTION 0983      MODBUS_DAT_REAL_ADRH 0021  
    MODBUS_DAT_REAL_ADRL 0090    MODBUS_ADR_E4_FUNCTION 0983    MODBUS_ADR_D6_FUNCTION 0983    MODBUS_ADR_E5_FUNCTION 0983  
  MODBUS_ADR_E6_FUNCTION 0983  MODBUS_BUS_06_ERROR_0800 085F            MODBUS_IN_10_F 0003            MODBUS_IN_03_F 0001  
          MODBUS_IN_06_F 0002      MODBUS_DAT_WORK_ADRH 0021      MODBUS_DAT_WORK_ADRL 0040     MODBUS_ADR_B0_10_LOOP 0967  
   MODBUS_ADR_B0_03_LOOP 0982     MODBUS_ADR_B0_06_LOOP 0967       MODBUS_ADR_FUNCTION 0800           TX_DATA_COUNTER 002D  
       MODBUS_ADR_A0_LV0 087B         MODBUS_ADR_A0_LV1 0876         MODBUS_ADR_A1_LV0 08AE         MODBUS_ADR_A1_LV1 08A9  
       MODBUS_ADR_A2_LV0 08E1         MODBUS_ADR_A2_LV1 08DC         MODBUS_ADR_A3_LV0 0914         MODBUS_ADR_A3_LV1 090F  
       MODBUS_ADR_A4_LV0 0947         MODBUS_ADR_A4_LV1 0942  
