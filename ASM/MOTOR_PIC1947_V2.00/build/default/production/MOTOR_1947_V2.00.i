# 1 "MOTOR_1947_V2.00.s"
# 1 "<built-in>" 1
# 1 "MOTOR_1947_V2.00.s" 2
;========================================================
;================ Project Information ===================
;========================================================
;Project Name : MOTOR-MODULE_V2.00
;Project Version:
;Project object :
;Project number :
;Edit Date :
;--------------------------------------------------------
;========================================================
;========================================================
;========================================================
;========================================================
;======== PIC16F1947 Configuration Bit Settings =========
;========================================================
; PIC16F1947 Configuration Bit Settings
; Assembly source line config statements
; CONFIG1
  CONFIG FOSC = INTOSC ; Oscillator Selection (INTOSC oscillator: I/O function on CLKIN pin)
  CONFIG WDTE = OFF ; Watchdog Timer Enable (WDT disabled)
  CONFIG PWRTE = OFF ; Power-up Timer Enable (PWRT disabled)
  CONFIG MCLRE = OFF ; MCLR Pin Function Select (MCLR/VPP pin function is digital input)
  CONFIG CP = OFF ; Flash Program Memory Code Protection (Program memory code protection is disabled)
  CONFIG CPD = OFF ; Data Memory Code Protection (Data memory code protection is disabled)
  CONFIG BOREN = OFF ; Brown-out Reset Enable (Brown-out Reset disabled)
  CONFIG CLKOUTEN = OFF ; Clock Out Enable (CLKOUT function is disabled. I/O or oscillator function on the CLKOUT pin)
  CONFIG IESO = OFF ; Internal/External Switchover (Internal/External Switchover mode is disabled)
  CONFIG FCMEN = OFF ; Fail-Safe Clock Monitor Enable (Fail-Safe Clock Monitor is disabled)

; CONFIG2
  CONFIG WRT = OFF ; Flash Memory Self-Write Protection (Write protection off)
  CONFIG VCAPEN = OFF ; Voltage Regulator Capacitor Enable (VCAP pin functionality is disabled)
  CONFIG PLLEN = OFF ; PLL Enable (4x PLL disabled)
  CONFIG STVREN = OFF ; Stack Overflow/Underflow Reset Enable (Stack Overflow or Underflow will not cause a Reset)
  CONFIG BORV = HI ; Brown-out Reset Voltage Selection (Brown-out Reset Voltage (Vbor), high trip point selected.)
  CONFIG LVP = OFF ; Low-Voltage Programming Enable (High-voltage on MCLR/VPP must be used for programming)
;** ***************************************************************************************

# 1 "./p16f1947.inc" 1
PROCESSOR 16F1947
        LIST

;==========================================================================
; MPASM PIC16LF1947 processor include
;
; (c) Copyright 1999-2013 Microchip Technology, All rights reserved
;==========================================================================

        NOLIST

;==========================================================================
; This header file defines configurations, registers, and other useful
; bits of information for the PIC16LF1947 microcontroller. These names
; are taken to match the data sheets as closely as possible.
;
; Note that the processor must be selected before this file is included.
; The processor may be selected the following ways:
;
; 1. Command line switch:
; C:\MPASM MYFILE.ASM /PIC16LF1947
; 2. LIST directive in the source file
; LIST P=PIC16LF1947
; 3. Processor Type entry in the MPASM full-screen interface
; 4. Setting the processor in the MPLAB Project Dialog
;==========================================================================

;==========================================================================
;
; Verify Processor
;
;==========================================================================
     ; IFNDEF __16LF1947
     ; MESSG "Processor-header file mismatch.  Verify selected processor."
     ; ENDIF



;==========================================================================
;
; Register Definitions
;
;==========================================================================

;W EQU 0000H
;F EQU 0001H

;----- Register Files -----------------------------------------------------

;-----Bank0------------------
INDF0 EQU 0000H
INDF1 EQU 0001H
PCL EQU 0002H
STATUS EQU 0003H
;FSR0 EQU 0004H
FSR0L EQU 0004H
FSR0H EQU 0005H
;FSR1 EQU 0006H
FSR1L EQU 0006H
FSR1H EQU 0007H
BSR EQU 0008H
WREG EQU 0009H
PCLATH EQU 000AH
INTCON EQU 000BH
PORTA EQU 000CH
PORTB EQU 000DH
PORTC EQU 000EH
PORTD EQU 000FH
PORTE EQU 0010H
PIR1 EQU 0011H
PIR2 EQU 0012H
PIR3 EQU 0013H
PIR4 EQU 0014H
TMR0 EQU 0015H
TMR1 EQU 0016H
TMR1L EQU 0016H
TMR1H EQU 0017H
T1CON EQU 0018H
T1GCON EQU 0019H
TMR2 EQU 001AH
PR2 EQU 001BH
T2CON EQU 001CH
CPSCON0 EQU 001EH
CPSCON1 EQU 001FH

;-----Bank1------------------
TRISA EQU 008CH
TRISB EQU 008DH
TRISC EQU 008EH
TRISD EQU 008FH
TRISE EQU 0090H
PIE1 EQU 0091H
PIE2 EQU 0092H
PIE3 EQU 0093H
PIE4 EQU 0094H
OPTION_REG EQU 0095H
PCON EQU 0096H
WDTCON EQU 0097H
OSCTUNE EQU 0098H
OSCCON EQU 0099H
OSCSTAT EQU 009AH
ADRES EQU 009BH
ADRESL EQU 009BH
ADRESH EQU 009CH
ADCON0 EQU 009DH
ADCON1 EQU 009EH

;-----Bank2------------------
LATA EQU 010CH
LATB EQU 010DH
LATC EQU 010EH
LATD EQU 010FH
LATE EQU 0110H
CM1CON0 EQU 0111H
CM1CON1 EQU 0112H
CM2CON0 EQU 0113H
CM2CON1 EQU 0114H
CMOUT EQU 0115H
BORCON EQU 0116H
FVRCON EQU 0117H
DACCON0 EQU 0118H
DACCON1 EQU 0119H
SRCON0 EQU 011AH
SRCON1 EQU 011BH
APFCON EQU 011DH
CM3CON0 EQU 011EH
CM3CON1 EQU 011FH

;-----Bank3------------------
ANSELA EQU 018CH
ANSELE EQU 0190H
EEADR EQU 0191H
EEADRL EQU 0191H
EEADRH EQU 0192H
EEDAT EQU 0193H
EEDATL EQU 0193H
EEDATH EQU 0194H
EECON1 EQU 0195H
EECON2 EQU 0196H
RC1REG EQU 0199H
RCREG EQU 0199H
TX1REG EQU 019AH
TXREG EQU 019AH
SP1BRGL EQU 019BH
SPBRG EQU 019BH
SPBRGL EQU 019BH
SP1BRGH EQU 019CH
SPBRGH EQU 019CH
RC1STA EQU 019DH
RCSTA EQU 019DH
TX1STA EQU 019EH
TXSTA EQU 019EH
BAUD1CON EQU 019FH

;-----Bank4------------------
WPUB EQU 020DH
SSP1BUF EQU 0211H
SSPBUF EQU 0211H
SSP1ADD EQU 0212H
SSPADD EQU 0212H
SSP1MSK EQU 0213H
SSPMSK EQU 0213H
SSP1STAT EQU 0214H
SSPSTAT EQU 0214H
SSP1CON1 EQU 0215H
SSPCON EQU 0215H
SSPCON1 EQU 0215H
SSP1CON2 EQU 0216H
SSPCON2 EQU 0216H
SSP1CON3 EQU 0217H
SSPCON3 EQU 0217H
SSP2BUF EQU 0219H
SSP2ADD EQU 021AH
SSP2MSK EQU 021BH
SSP2STAT EQU 021CH
SSP2CON1 EQU 021DH
SSP2CON2 EQU 021EH
SSP2CON3 EQU 021FH

;-----Bank5------------------
PORTF EQU 028CH
PORTG EQU 028DH
CCPR1L EQU 0291H
CCPR1H EQU 0292H
CCP1CON EQU 0293H
PWM1CON EQU 0294H
CCP1AS EQU 0295H
ECCP1AS EQU 0295H
PSTR1CON EQU 0296H
CCPR2L EQU 0298H
CCPR2H EQU 0299H
CCP2CON EQU 029AH
PWM2CON EQU 029BH
CCP2AS EQU 029CH
ECCP2AS EQU 029CH
PSTR2CON EQU 029DH
CCPTMRS0 EQU 029EH
CCPTMRS1 EQU 029FH

;-----Bank6------------------
TRISF EQU 030CH
TRISG EQU 030DH
CCPR3L EQU 0311H
CCPR3H EQU 0312H
CCP3CON EQU 0313H
PWM3CON EQU 0314H
CCP3AS EQU 0315H
ECCP3AS EQU 0315H
PSTR3CON EQU 0316H
CCPR4L EQU 0318H
CCPR4H EQU 0319H
CCP4CON EQU 031AH
CCPR5L EQU 031CH
CCPR5H EQU 031DH
CCP5CON EQU 031EH

;-----Bank7------------------
LATF EQU 038CH
LATG EQU 038DH
IOCBP EQU 0394H
IOCBN EQU 0395H
IOCBF EQU 0396H

;-----Bank8------------------
ANSELF EQU 040CH
ANSELG EQU 040DH
TMR4 EQU 0415H
PR4 EQU 0416H
T4CON EQU 0417H
TMR6 EQU 041CH
PR6 EQU 041DH
T6CON EQU 041EH

;-----Bank9------------------
WPUG EQU 048DH
RC2REG EQU 0491H
TX2REG EQU 0492H
SP2BRGL EQU 0493H
SPBRG2 EQU 0493H
SP2BRGH EQU 0494H
RC2STA EQU 0495H
TX2STA EQU 0496H
BAUD2CON EQU 0497H

;-----Bank15------------------
LCDCON EQU 0791H
LCDPS EQU 0792H
LCDREF EQU 0793H
LCDCST EQU 0794H
LCDRL EQU 0795H
LCDSE0 EQU 0798H
LCDSE1 EQU 0799H
LCDSE2 EQU 079AH
LCDSE3 EQU 079BH
LCDSE4 EQU 079CH
LCDSE5 EQU 079DH
LCDDATA0 EQU 07A0H
LCDDATA1 EQU 07A1H
LCDDATA2 EQU 07A2H
LCDDATA3 EQU 07A3H
LCDDATA4 EQU 07A4H
LCDDATA5 EQU 07A5H
LCDDATA6 EQU 07A6H
LCDDATA7 EQU 07A7H
LCDDATA8 EQU 07A8H
LCDDATA9 EQU 07A9H
LCDDATA10 EQU 07AAH
LCDDATA11 EQU 07ABH
LCDDATA12 EQU 07ACH
LCDDATA13 EQU 07ADH
LCDDATA14 EQU 07AEH
LCDDATA15 EQU 07AFH
LCDDATA16 EQU 07B0H
LCDDATA17 EQU 07B1H
LCDDATA18 EQU 07B2H
LCDDATA19 EQU 07B3H
LCDDATA20 EQU 07B4H
LCDDATA21 EQU 07B5H
LCDDATA22 EQU 07B6H
LCDDATA23 EQU 07B7H

;-----Bank31------------------
STATUS_SHAD EQU 0FE4H
WREG_SHAD EQU 0FE5H
BSR_SHAD EQU 0FE6H
PCLATH_SHAD EQU 0FE7H
FSR0L_SHAD EQU 0FE8H
FSR0H_SHAD EQU 0FE9H
FSR1L_SHAD EQU 0FEAH
FSR1H_SHAD EQU 0FEBH
STKPTR EQU 0FEDH
TOSL EQU 0FEEH
TOSH EQU 0FEFH

;----- STATUS Bits -----------------------------------------------------
C EQU 0000H
DC EQU 0001H
Z EQU 0002H
NOT_PD EQU 0003H
NOT_TO EQU 0004H


;----- BSR Bits -----------------------------------------------------
BSR0 EQU 0000H
BSR1 EQU 0001H
BSR2 EQU 0002H
BSR3 EQU 0003H
BSR4 EQU 0004H



;----- INTCON Bits -----------------------------------------------------
IOCIF EQU 0000H
INTF EQU 0001H
TMR0IF EQU 0002H
IOCIE EQU 0003H
INTE EQU 0004H
TMR0IE EQU 0005H
PEIE EQU 0006H
GIE EQU 0007H

T0IF EQU 0002H
T0IE EQU 0005H


;----- PORTA Bits -----------------------------------------------------
RA0 EQU 0000H
RA1 EQU 0001H
RA2 EQU 0002H
RA3 EQU 0003H
RA4 EQU 0004H
RA5 EQU 0005H
RA6 EQU 0006H
RA7 EQU 0007H

AN0 EQU 0000H
AN1 EQU 0001H
AN2 EQU 0002H
AN3 EQU 0003H
AN4 EQU 0005H

CPS0 EQU 0000H
CPS1 EQU 0001H
CPS2 EQU 0002H
CPS3 EQU 0003H
CPS4 EQU 0005H

SEG33 EQU 0000H
SEG18 EQU 0001H
SEG34 EQU 0002H
SEG35 EQU 0003H
SEG14 EQU 0004H
SEG15 EQU 0005H
SEG36 EQU 0006H
SEG37 EQU 0007H

VREFM EQU 0002H
VREFP EQU 0003H
T0CKI EQU 0004H
OSC2 EQU 0006H
OSC1 EQU 0007H

CLKOUT EQU 0006H
CLKIN EQU 0007H


;----- PORTB Bits -----------------------------------------------------
RB0 EQU 0000H
RB1 EQU 0001H
RB2 EQU 0002H
RB3 EQU 0003H
RB4 EQU 0004H
RB5 EQU 0005H
RB6 EQU 0006H
RB7 EQU 0007H

SEG30 EQU 0000H
SEG8 EQU 0001H
SEG9 EQU 0002H
SEG10 EQU 0003H
SEG11 EQU 0004H
SEG29 EQU 0005H
SEG38 EQU 0006H
SEG39 EQU 0007H

SRI EQU 0000H
T1G EQU 0005H

FLT0 EQU 0000H


;----- PORTC Bits -----------------------------------------------------
RC0 EQU 0000H
RC1 EQU 0001H
RC2 EQU 0002H
RC3 EQU 0003H
RC4 EQU 0004H
RC5 EQU 0005H
RC6 EQU 0006H
RC7 EQU 0007H

SEG40 EQU 0000H
SEG32 EQU 0001H
SEG13 EQU 0002H
SEG17 EQU 0003H
SEG16 EQU 0004H
SEG12 EQU 0005H
SEG27 EQU 0006H
SEG28 EQU 0007H

T1OSO EQU 0000H
T1OSI EQU 0001H
SCK1 EQU 0003H
SDI1 EQU 0004H
SDO1 EQU 0005H
TX1 EQU 0006H
RX1 EQU 0007H

T1CKI EQU 0000H
CCP2_PORTC EQU 0001H
CCP1 EQU 0002H
SCL1 EQU 0003H
SDA1 EQU 0004H
CK1 EQU 0006H
DT1 EQU 0007H

P2A_PORTC EQU 0001H
P1A EQU 0002H


;----- PORTD Bits -----------------------------------------------------
RD0 EQU 0000H
RD1 EQU 0001H
RD2 EQU 0002H
RD3 EQU 0003H
RD4 EQU 0004H
RD5 EQU 0005H
RD6 EQU 0006H
RD7 EQU 0007H

SEG0 EQU 0000H
SEG1 EQU 0001H
SEG2 EQU 0002H
SEG3 EQU 0003H
SEG4 EQU 0004H
SEG5 EQU 0005H
SEG6 EQU 0006H
SEG7 EQU 0007H

P2D EQU 0000H
P2C EQU 0001H
P2B EQU 0002H
P3C EQU 0003H
P3B EQU 0004H
P1C EQU 0005H
P1B EQU 0006H

SDO2 EQU 0004H
SDI2 EQU 0005H
SCK2 EQU 0006H
NOT_SS2 EQU 0007H

SDA2 EQU 0005H
SCL2 EQU 0006H


;----- PORTE Bits -----------------------------------------------------
RE0 EQU 0000H
RE1 EQU 0001H
RE2 EQU 0002H
RE3 EQU 0003H
RE4 EQU 0004H
RE5 EQU 0005H
RE6 EQU 0006H
RE7 EQU 0007H

VLCD1 EQU 0000H
VLCD2 EQU 0001H
VLCD3 EQU 0002H
COM0 EQU 0003H
COM1 EQU 0004H
COM2 EQU 0005H
COM3 EQU 0006H
SEG31 EQU 0007H

P2D EQU 0000H
P2C EQU 0001H
P2B EQU 0002H
P3C EQU 0003H
P3B EQU 0004H
P1C EQU 0005H
P1B EQU 0006H
P2A_PORTE EQU 0007H

CCP2_PORTE EQU 0007H


;----- PIR1 Bits -----------------------------------------------------
TMR1IF EQU 0000H
TMR2IF EQU 0001H
CCP1IF EQU 0002H
SSP1IF EQU 0003H
TX1IF EQU 0004H
RC1IF EQU 0005H
ADIF EQU 0006H
TMR1GIF EQU 0007H

SSPIF EQU 0003H
TXIF EQU 0004H
RCIF EQU 0005H


;----- PIR2 Bits -----------------------------------------------------
CCP2IF EQU 0000H
C3IF EQU 0001H
LCDIF EQU 0002H
BCLIF EQU 0003H
EEIF EQU 0004H
C1IF EQU 0005H
C2IF EQU 0006H
OSFIF EQU 0007H


;----- PIR3 Bits -----------------------------------------------------
TMR4IF EQU 0001H
TMR6IF EQU 0003H
CCP3IF EQU 0004H
CCP4IF EQU 0005H
CCP5IF EQU 0006H


;----- PIR4 Bits -----------------------------------------------------
SSP2IF EQU 0000H
BCL2IF EQU 0001H
TX2IF EQU 0004H
RC2IF EQU 0005H


;----- T1CON Bits -----------------------------------------------------
TMR1ON EQU 0000H
NOT_T1SYNC EQU 0002H
T1OSCEN EQU 0003H
T1CKPS0 EQU 0004H
T1CKPS1 EQU 0005H
TMR1CS0 EQU 0006H
TMR1CS1 EQU 0007H



;----- T1GCON Bits -----------------------------------------------------
T1GSS0 EQU 0000H
T1GSS1 EQU 0001H
T1GVAL EQU 0002H
T1GGO_NOT_DONE EQU 0003H
T1GSPM EQU 0004H
T1GTM EQU 0005H
T1GPOL EQU 0006H
TMR1GE EQU 0007H

T1GGO EQU 0003H


;----- T2CON Bits -----------------------------------------------------
T2CKPS0 EQU 0000H
T2CKPS1 EQU 0001H
TMR2ON EQU 0002H
T2OUTPS0 EQU 0003H
T2OUTPS1 EQU 0004H
T2OUTPS2 EQU 0005H
T2OUTPS3 EQU 0006H



;----- CPSCON0 Bits -----------------------------------------------------
T0XCS EQU 0000H
CPSOUT EQU 0001H
CPSRNG0 EQU 0002H
CPSRNG1 EQU 0003H
CPSRM EQU 0006H
CPSON EQU 0007H



;----- CPSCON1 Bits -----------------------------------------------------
CPSCH0 EQU 0000H
CPSCH1 EQU 0001H
CPSCH2 EQU 0002H
CPSCH3 EQU 0003H
CPSCH4 EQU 0004H



;----- TRISA Bits -----------------------------------------------------
TRISA0 EQU 0000H
TRISA1 EQU 0001H
TRISA2 EQU 0002H
TRISA3 EQU 0003H
TRISA4 EQU 0004H
TRISA5 EQU 0005H
TRISA6 EQU 0006H
TRISA7 EQU 0007H


;----- TRISB Bits -----------------------------------------------------
TRISB0 EQU 0000H
TRISB1 EQU 0001H
TRISB2 EQU 0002H
TRISB3 EQU 0003H
TRISB4 EQU 0004H
TRISB5 EQU 0005H
TRISB6 EQU 0006H
TRISB7 EQU 0007H


;----- TRISC Bits -----------------------------------------------------
TRISC0 EQU 0000H
TRISC1 EQU 0001H
TRISC2 EQU 0002H
TRISC3 EQU 0003H
TRISC4 EQU 0004H
TRISC5 EQU 0005H
TRISC6 EQU 0006H
TRISC7 EQU 0007H


;----- TRISD Bits -----------------------------------------------------
TRISD0 EQU 0000H
TRISD1 EQU 0001H
TRISD2 EQU 0002H
TRISD3 EQU 0003H
TRISD4 EQU 0004H
TRISD5 EQU 0005H
TRISD6 EQU 0006H
TRISD7 EQU 0007H


;----- TRISE Bits -----------------------------------------------------
TRISE0 EQU 0000H
TRISE1 EQU 0001H
TRISE2 EQU 0002H
TRISE3 EQU 0003H
TRISE4 EQU 0004H
TRISE5 EQU 0005H
TRISE6 EQU 0006H
TRISE7 EQU 0007H


;----- PIE1 Bits -----------------------------------------------------
TMR1IE EQU 0000H
TMR2IE EQU 0001H
CCP1IE EQU 0002H
SSP1IE EQU 0003H
TX1IE EQU 0004H
RC1IE EQU 0005H
ADIE EQU 0006H
TMR1GIE EQU 0007H

SSPIE EQU 0003H
TXIE EQU 0004H
RCIE EQU 0005H


;----- PIE2 Bits -----------------------------------------------------
CCP2IE EQU 0000H
C3IE EQU 0001H
LCDIE EQU 0002H
BCLIE EQU 0003H
EEIE EQU 0004H
C1IE EQU 0005H
C2IE EQU 0006H
OSFIE EQU 0007H


;----- PIE3 Bits -----------------------------------------------------
TMR4IE EQU 0001H
TMR6IE EQU 0003H
CCP3IE EQU 0004H
CCP4IE EQU 0005H
CCP5IE EQU 0006H


;----- PIE4 Bits -----------------------------------------------------
SSP2IE EQU 0000H
BCL2IE EQU 0001H
TX2IE EQU 0004H
RC2IE EQU 0005H


;----- OPTION_REG Bits -----------------------------------------------------
PS0 EQU 0000H
PS1 EQU 0001H
PS2 EQU 0002H
PSA EQU 0003H
T0SE EQU 0004H
T0CS EQU 0005H
INTEDG EQU 0006H
NOT_WPUEN EQU 0007H

TMR0SE EQU 0004H
TMR0CS EQU 0005H


;----- PCON Bits -----------------------------------------------------
NOT_BOR EQU 0000H
NOT_POR EQU 0001H
NOT_RI EQU 0002H
NOT_RMCLR EQU 0003H
STKUNF EQU 0006H
STKOVF EQU 0007H


;----- WDTCON Bits -----------------------------------------------------
SWDTEN EQU 0000H
WDTPS0 EQU 0001H
WDTPS1 EQU 0002H
WDTPS2 EQU 0003H
WDTPS3 EQU 0004H
WDTPS4 EQU 0005H



;----- OSCTUNE Bits -----------------------------------------------------
TUN0 EQU 0000H
TUN1 EQU 0001H
TUN2 EQU 0002H
TUN3 EQU 0003H
TUN4 EQU 0004H
TUN5 EQU 0005H



;----- OSCCON Bits -----------------------------------------------------
SCS0 EQU 0000H
SCS1 EQU 0001H
IRCF0 EQU 0003H
IRCF1 EQU 0004H
IRCF2 EQU 0005H
IRCF3 EQU 0006H
SPLLEN EQU 0007H



;----- OSCSTAT Bits -----------------------------------------------------
HFIOFS EQU 0000H
LFIOFR EQU 0001H
MFIOFR EQU 0002H
HFIOFL EQU 0003H
HFIOFR EQU 0004H
OSTS EQU 0005H
PLLR EQU 0006H
T1OSCR EQU 0007H


;----- ADCON0 Bits -----------------------------------------------------
ADON EQU 0000H
GO_NOT_DONE EQU 0001H
CHS0 EQU 0002H
CHS1 EQU 0003H
CHS2 EQU 0004H
CHS3 EQU 0005H
CHS4 EQU 0006H

ADGO EQU 0001H

GO EQU 0001H

NOT_DONE EQU 0001H


;----- ADCON1 Bits -----------------------------------------------------
ADPREF0 EQU 0000H
ADPREF1 EQU 0001H
ADNREF EQU 0002H
ADCS0 EQU 0004H
ADCS1 EQU 0005H
ADCS2 EQU 0006H
ADFM EQU 0007H



;----- LATA Bits -----------------------------------------------------
LATA0 EQU 0000H
LATA1 EQU 0001H
LATA2 EQU 0002H
LATA3 EQU 0003H
LATA4 EQU 0004H
LATA5 EQU 0005H
LATA6 EQU 0006H
LATA7 EQU 0007H


;----- LATB Bits -----------------------------------------------------
LATB0 EQU 0000H
LATB1 EQU 0001H
LATB2 EQU 0002H
LATB3 EQU 0003H
LATB4 EQU 0004H
LATB5 EQU 0005H
LATB6 EQU 0006H
LATB7 EQU 0007H


;----- LATC Bits -----------------------------------------------------
LATC0 EQU 0000H
LATC1 EQU 0001H
LATC2 EQU 0002H
LATC3 EQU 0003H
LATC4 EQU 0004H
LATC5 EQU 0005H
LATC6 EQU 0006H
LATC7 EQU 0007H


;----- LATD Bits -----------------------------------------------------
LATD0 EQU 0000H
LATD1 EQU 0001H
LATD2 EQU 0002H
LATD3 EQU 0003H
LATD4 EQU 0004H
LATD5 EQU 0005H
LATD6 EQU 0006H
LATD7 EQU 0007H



;----- LATE Bits -----------------------------------------------------
LATE0 EQU 0000H
LATE1 EQU 0001H
LATE2 EQU 0002H
LATE3 EQU 0003H
LATE4 EQU 0004H
LATE5 EQU 0005H
LATE6 EQU 0006H
LATE7 EQU 0007H


;----- CM1CON0 Bits -----------------------------------------------------
C1SYNC EQU 0000H
C1HYS EQU 0001H
C1SP EQU 0002H
C1POL EQU 0004H
C1OE EQU 0005H
C1OUT_CM1CON0 EQU 0006H
C1ON EQU 0007H


;----- CM1CON1 Bits -----------------------------------------------------
C1NCH0 EQU 0000H
C1NCH1 EQU 0001H
C1PCH0 EQU 0004H
C1PCH1 EQU 0005H
C1INTN EQU 0006H
C1INTP EQU 0007H



;----- CM2CON0 Bits -----------------------------------------------------
C2SYNC EQU 0000H
C2HYS EQU 0001H
C2SP EQU 0002H
C2POL EQU 0004H
C2OE EQU 0005H
C2OUT_CM2CON0 EQU 0006H
C2ON EQU 0007H


;----- CM2CON1 Bits -----------------------------------------------------
C2NCH0 EQU 0000H
C2NCH1 EQU 0001H
C2PCH0 EQU 0004H
C2PCH1 EQU 0005H
C2INTN EQU 0006H
C2INTP EQU 0007H



;----- CMOUT Bits -----------------------------------------------------
MC1OUT EQU 0000H
MC2OUT EQU 0001H
MC3OUT EQU 0002H


;----- BORCON Bits -----------------------------------------------------
BORRDY EQU 0000H
SBOREN EQU 0007H


;----- FVRCON Bits -----------------------------------------------------
ADFVR0 EQU 0000H
ADFVR1 EQU 0001H
CDAFVR0 EQU 0002H
CDAFVR1 EQU 0003H
FVRRDY EQU 0006H
FVREN EQU 0007H



;----- DACCON0 Bits -----------------------------------------------------
DACNSS EQU 0000H
DACPSS0 EQU 0002H
DACPSS1 EQU 0003H
DACOE EQU 0005H
DACLPS EQU 0006H
DACEN EQU 0007H



;----- DACCON1 Bits -----------------------------------------------------
DACR0 EQU 0000H
DACR1 EQU 0001H
DACR2 EQU 0002H
DACR3 EQU 0003H
DACR4 EQU 0004H



;----- SRCON0 Bits -----------------------------------------------------
SRPR EQU 0000H
SRPS EQU 0001H
SRNQEN EQU 0002H
SRQEN EQU 0003H
SRCLK0 EQU 0004H
SRCLK1 EQU 0005H
SRCLK2 EQU 0006H
SRLEN EQU 0007H



;----- SRCON1 Bits -----------------------------------------------------
SRRC1E EQU 0000H
SRRC2E EQU 0001H
SRRCKE EQU 0002H
SRRPE EQU 0003H
SRSC1E EQU 0004H
SRSC2E EQU 0005H
SRSCKE EQU 0006H
SRSPE EQU 0007H


;----- APFCON Bits -----------------------------------------------------
P1BSEL EQU 0000H
P1CSEL EQU 0001H
CCP2SEL EQU 0002H
P2BSEL EQU 0003H
P2CSEL EQU 0004H
P2DSEL EQU 0005H
P3BSEL EQU 0006H
P3CSEL EQU 0007H


;----- CM3CON0 Bits -----------------------------------------------------
C3SYNC EQU 0000H
C3HYS EQU 0001H
C3SP EQU 0002H
C3POL EQU 0004H
C3OE EQU 0005H
C3OUT_CM3CON0 EQU 0006H
C3ON EQU 0007H


;----- CM3CON1 Bits -----------------------------------------------------
C3NCH0 EQU 0000H
C3NCH1 EQU 0001H
C3PCH0 EQU 0004H
C3PCH1 EQU 0005H
C3INTN EQU 0006H
C3INTP EQU 0007H



;----- ANSELA Bits -----------------------------------------------------
ANSA0 EQU 0000H
ANSA1 EQU 0001H
ANSA2 EQU 0002H
ANSA3 EQU 0003H
ANSA5 EQU 0005H



;----- ANSELE Bits -----------------------------------------------------
ANSE0 EQU 0000H
ANSE1 EQU 0001H
ANSE2 EQU 0002H



;----- EECON1 Bits -----------------------------------------------------
RD EQU 0000H
WR EQU 0001H
WREN EQU 0002H
WRERR EQU 0003H
FREE EQU 0004H
LWLO EQU 0005H
CFGS EQU 0006H
EEPGD EQU 0007H


;----- RC1STA Bits -----------------------------------------------------
RX9D EQU 0000H
OERR EQU 0001H
FERR EQU 0002H
ADDEN EQU 0003H
CREN EQU 0004H
SREN EQU 0005H
RX9 EQU 0006H
SPEN EQU 0007H


;----- RCSTA Bits -----------------------------------------------------
RX9D EQU 0000H
OERR EQU 0001H
FERR EQU 0002H
ADDEN EQU 0003H
CREN EQU 0004H
SREN EQU 0005H
RX9 EQU 0006H
SPEN EQU 0007H


;----- TX1STA Bits -----------------------------------------------------
TX9D EQU 0000H
TRMT EQU 0001H
BRGH EQU 0002H
SENDB EQU 0003H
SYNC EQU 0004H
TXEN EQU 0005H
TX9 EQU 0006H
CSRC EQU 0007H


;----- TXSTA Bits -----------------------------------------------------
TX9D EQU 0000H
TRMT EQU 0001H
BRGH EQU 0002H
SENDB EQU 0003H
SYNC EQU 0004H
TXEN EQU 0005H
TX9 EQU 0006H
CSRC EQU 0007H


;----- BAUD1CON Bits -----------------------------------------------------
ABDEN EQU 0000H
WUE EQU 0001H
BRG16 EQU 0003H
SCKP EQU 0004H
RCIDL EQU 0006H
ABDOVF EQU 0007H


;----- WPUB Bits -----------------------------------------------------
WPUB0 EQU 0000H
WPUB1 EQU 0001H
WPUB2 EQU 0002H
WPUB3 EQU 0003H
WPUB4 EQU 0004H
WPUB5 EQU 0005H
WPUB6 EQU 0006H
WPUB7 EQU 0007H



;----- SSP1STAT Bits -----------------------------------------------------
BF EQU 0000H
UA EQU 0001H
R_NOT_W EQU 0002H
S EQU 0003H
P EQU 0004H
D_NOT_A EQU 0005H
CKE EQU 0006H
SMP EQU 0007H


;----- SSPSTAT Bits -----------------------------------------------------
BF EQU 0000H
UA EQU 0001H
R_NOT_W EQU 0002H
S EQU 0003H
P EQU 0004H
D_NOT_A EQU 0005H
CKE EQU 0006H
SMP EQU 0007H


;----- SSP1CON1 Bits -----------------------------------------------------
SSPM0 EQU 0000H
SSPM1 EQU 0001H
SSPM2 EQU 0002H
SSPM3 EQU 0003H
CKP EQU 0004H
SSPEN EQU 0005H
SSPOV EQU 0006H
WCOL EQU 0007H


;----- SSPCON Bits -----------------------------------------------------
SSPM0 EQU 0000H
SSPM1 EQU 0001H
SSPM2 EQU 0002H
SSPM3 EQU 0003H
CKP EQU 0004H
SSPEN EQU 0005H
SSPOV EQU 0006H
WCOL EQU 0007H


;----- SSPCON1 Bits -----------------------------------------------------
SSPM0 EQU 0000H
SSPM1 EQU 0001H
SSPM2 EQU 0002H
SSPM3 EQU 0003H
CKP EQU 0004H
SSPEN EQU 0005H
SSPOV EQU 0006H
WCOL EQU 0007H


;----- SSP1CON2 Bits -----------------------------------------------------
SEN EQU 0000H
RSEN EQU 0001H
PEN EQU 0002H
RCEN EQU 0003H
ACKEN EQU 0004H
ACKDT EQU 0005H
ACKSTAT EQU 0006H
GCEN EQU 0007H


;----- SSPCON2 Bits -----------------------------------------------------
SEN EQU 0000H
RSEN EQU 0001H
PEN EQU 0002H
RCEN EQU 0003H
ACKEN EQU 0004H
ACKDT EQU 0005H
ACKSTAT EQU 0006H
GCEN EQU 0007H


;----- SSP1CON3 Bits -----------------------------------------------------
DHEN EQU 0000H
AHEN EQU 0001H
SBCDE EQU 0002H
SDAHT EQU 0003H
BOEN EQU 0004H
SCIE EQU 0005H
PCIE EQU 0006H
ACKTIM EQU 0007H


;----- SSPCON3 Bits -----------------------------------------------------
DHEN EQU 0000H
AHEN EQU 0001H
SBCDE EQU 0002H
SDAHT EQU 0003H
BOEN EQU 0004H
SCIE EQU 0005H
PCIE EQU 0006H
ACKTIM EQU 0007H


;----- SSP2STAT Bits -----------------------------------------------------
BF EQU 0000H
UA EQU 0001H
R_NOT_W EQU 0002H
S EQU 0003H
P EQU 0004H
D_NOT_A EQU 0005H
CKE EQU 0006H
SMP EQU 0007H


;----- SSP2CON1 Bits -----------------------------------------------------
SSPM0 EQU 0000H
SSPM1 EQU 0001H
SSPM2 EQU 0002H
SSPM3 EQU 0003H
CKP EQU 0004H
SSPEN EQU 0005H
SSPOV EQU 0006H
WCOL EQU 0007H


;----- SSP2CON2 Bits -----------------------------------------------------
SEN EQU 0000H
RSEN EQU 0001H
PEN EQU 0002H
RCEN EQU 0003H
ACKEN EQU 0004H
ACKDT EQU 0005H
ACKSTAT EQU 0006H
GCEN EQU 0007H


;----- SSP2CON3 Bits -----------------------------------------------------
DHEN EQU 0000H
AHEN EQU 0001H
SBCDE EQU 0002H
SDAHT EQU 0003H
BOEN EQU 0004H
SCIE EQU 0005H
PCIE EQU 0006H
ACKTIM EQU 0007H


;----- PORTF Bits -----------------------------------------------------
RF0 EQU 0000H
RF1 EQU 0001H
RF2 EQU 0002H
RF3 EQU 0003H
RF4 EQU 0004H
RF5 EQU 0005H
RF6 EQU 0006H
RF7 EQU 0007H

AN16 EQU 0000H
AN6 EQU 0001H
AN7 EQU 0002H
AN8 EQU 0003H
AN9 EQU 0004H
AN10 EQU 0005H
AN11 EQU 0006H
AN5 EQU 0007H

SEG41 EQU 0000H
SEG19 EQU 0001H
SEG20 EQU 0002H
SEG21 EQU 0003H
SEG22 EQU 0004H
SEG23 EQU 0005H
SEG24 EQU 0006H
SEG25 EQU 0007H

CPS16 EQU 0000H
CPS6 EQU 0001H
CPS7 EQU 0002H
CPS8 EQU 0003H
CPS9 EQU 0004H
CPS10 EQU 0005H
CPS11 EQU 0006H
CPS5 EQU 0007H

C1IN0N EQU 0000H
C2OUT_PORTF EQU 0001H
C1OUT_PORTF EQU 0002H
C1IN2N EQU 0003H
C2INP EQU 0004H
C1IN1N EQU 0005H
C1INP EQU 0006H
C1IN3N EQU 0007H

C2IN0N EQU 0000H
SRNQ EQU 0001H
SRQ EQU 0002H
C2IN2N EQU 0003H
C2IN1N EQU 0005H
C2IN3N EQU 0007H

C3IN2N EQU 0003H
DACOUT EQU 0005H
C3IN3N EQU 0007H


;----- PORTG Bits -----------------------------------------------------
RG0 EQU 0000H
RG1 EQU 0001H
RG2 EQU 0002H
RG3 EQU 0003H
RG4 EQU 0004H
RG5 EQU 0005H

AN15 EQU 0001H
AN14 EQU 0002H
AN13 EQU 0003H
AN12 EQU 0004H
NOT_MCLR EQU 0005H

SEG42 EQU 0000H
SEG43 EQU 0001H
SEG44 EQU 0002H
SEG45 EQU 0003H
SEG26 EQU 0004H

CPS15 EQU 0001H
CPS14 EQU 0002H
CPS13 EQU 0003H
CPS12 EQU 0004H

C3OUT_PORTG EQU 0001H
C3INP EQU 0002H
C3IN0N EQU 0003H
C3IN1N EQU 0004H

CCP3 EQU 0000H
TX2 EQU 0001H
RX2 EQU 0002H
CCP4 EQU 0003H
CCP5 EQU 0004H

P3A EQU 0000H
CK2 EQU 0001H
DT2 EQU 0002H
P3D EQU 0003H
P1D EQU 0004H


;----- CCP1CON Bits -----------------------------------------------------
CCP1M0 EQU 0000H
CCP1M1 EQU 0001H
CCP1M2 EQU 0002H
CCP1M3 EQU 0003H
DC1B0 EQU 0004H
DC1B1 EQU 0005H
P1M0 EQU 0006H
P1M1 EQU 0007H



;----- PWM1CON Bits -----------------------------------------------------
P1DC0 EQU 0000H
P1DC1 EQU 0001H
P1DC2 EQU 0002H
P1DC3 EQU 0003H
P1DC4 EQU 0004H
P1DC5 EQU 0005H
P1DC6 EQU 0006H
P1RSEN EQU 0007H


;----- CCP1AS Bits -----------------------------------------------------
PSS1BD0 EQU 0000H
PSS1BD1 EQU 0001H
PSS1AC0 EQU 0002H
PSS1AC1 EQU 0003H
CCP1AS0 EQU 0004H
CCP1AS1 EQU 0005H
CCP1AS2 EQU 0006H
CCP1ASE EQU 0007H


;----- ECCP1AS Bits -----------------------------------------------------
PSS1BD0 EQU 0000H
PSS1BD1 EQU 0001H
PSS1AC0 EQU 0002H
PSS1AC1 EQU 0003H
CCP1AS0 EQU 0004H
CCP1AS1 EQU 0005H
CCP1AS2 EQU 0006H
CCP1ASE EQU 0007H


;----- PSTR1CON Bits -----------------------------------------------------
STR1A EQU 0000H
STR1B EQU 0001H
STR1C EQU 0002H
STR1D EQU 0003H
STR1SYNC EQU 0004H


;----- CCP2CON Bits -----------------------------------------------------
CCP2M0 EQU 0000H
CCP2M1 EQU 0001H
CCP2M2 EQU 0002H
CCP2M3 EQU 0003H
DC2B0 EQU 0004H
DC2B1 EQU 0005H
P2M0 EQU 0006H
P2M1 EQU 0007H



;----- PWM2CON Bits -----------------------------------------------------
P2DC0 EQU 0000H
P2DC1 EQU 0001H
P2DC2 EQU 0002H
P2DC3 EQU 0003H
P2DC4 EQU 0004H
P2DC5 EQU 0005H
P2DC6 EQU 0006H
P2RSEN EQU 0007H


;----- CCP2AS Bits -----------------------------------------------------
PSS2BD0 EQU 0000H
PSS2BD1 EQU 0001H
PSS2AC0 EQU 0002H
PSS2AC1 EQU 0003H
CCP2AS0 EQU 0004H
CCP2AS1 EQU 0005H
CCP2AS2 EQU 0006H
CCP2ASE EQU 0007H


;----- ECCP2AS Bits -----------------------------------------------------
PSS2BD0 EQU 0000H
PSS2BD1 EQU 0001H
PSS2AC0 EQU 0002H
PSS2AC1 EQU 0003H
CCP2AS0 EQU 0004H
CCP2AS1 EQU 0005H
CCP2AS2 EQU 0006H
CCP2ASE EQU 0007H


;----- PSTR2CON Bits -----------------------------------------------------
STR2A EQU 0000H
STR2B EQU 0001H
STR2C EQU 0002H
STR2D EQU 0003H
STR2SYNC EQU 0004H


;----- CCPTMRS0 Bits -----------------------------------------------------
C1TSEL0 EQU 0000H
C1TSEL1 EQU 0001H
C2TSEL0 EQU 0002H
C2TSEL1 EQU 0003H
C3TSEL0 EQU 0004H
C3TSEL1 EQU 0005H
C4TSEL0 EQU 0006H
C4TSEL1 EQU 0007H



;----- CCPTMRS1 Bits -----------------------------------------------------
C5TSEL0 EQU 0000H
C5TSEL1 EQU 0001H



;----- TRISF Bits -----------------------------------------------------
TRISF0 EQU 0000H
TRISF1 EQU 0001H
TRISF2 EQU 0002H
TRISF3 EQU 0003H
TRISF4 EQU 0004H
TRISF5 EQU 0005H
TRISF6 EQU 0006H
TRISF7 EQU 0007H


;----- TRISG Bits -----------------------------------------------------
TRISG0 EQU 0000H
TRISG1 EQU 0001H
TRISG2 EQU 0002H
TRISG3 EQU 0003H
TRISG4 EQU 0004H
TRISG5 EQU 0005H


;----- CCP3CON Bits -----------------------------------------------------
CCP3M0 EQU 0000H
CCP3M1 EQU 0001H
CCP3M2 EQU 0002H
CCP3M3 EQU 0003H
DC3B0 EQU 0004H
DC3B1 EQU 0005H
P3M0 EQU 0006H
P3M1 EQU 0007H


;----- PWM3CON Bits -----------------------------------------------------
P3DC0 EQU 0000H
P3DC1 EQU 0001H
P3DC2 EQU 0002H
P3DC3 EQU 0003H
P3DC4 EQU 0004H
P3DC5 EQU 0005H
P3DC6 EQU 0006H
P3RSEN EQU 0007H


;----- CCP3AS Bits -----------------------------------------------------
PSS3BD0 EQU 0000H
PSS3BD1 EQU 0001H
PSS3AC0 EQU 0002H
PSS3AC1 EQU 0003H
CCP3AS0 EQU 0004H
CCP3AS1 EQU 0005H
CCP3AS2 EQU 0006H
CCP3ASE EQU 0007H


;----- ECCP3AS Bits -----------------------------------------------------
PSS3BD0 EQU 0000H
PSS3BD1 EQU 0001H
PSS3AC0 EQU 0002H
PSS3AC1 EQU 0003H
CCP3AS0 EQU 0004H
CCP3AS1 EQU 0005H
CCP3AS2 EQU 0006H
CCP3ASE EQU 0007H


;----- PSTR3CON Bits -----------------------------------------------------
STR3A EQU 0000H
STR3B EQU 0001H
STR3C EQU 0002H
STR3D EQU 0003H
STR3SYNC EQU 0004H


;----- CCP4CON Bits -----------------------------------------------------
CCP4M0 EQU 0000H
CCP4M1 EQU 0001H
CCP4M2 EQU 0002H
CCP4M3 EQU 0003H
DC4B0 EQU 0004H
DC4B1 EQU 0005H


;----- CCP5CON Bits -----------------------------------------------------
CCP5M0 EQU 0000H
CCP5M1 EQU 0001H
CCP5M2 EQU 0002H
CCP5M3 EQU 0003H
DC5B0 EQU 0004H
DC5B1 EQU 0005H


;----- LATF Bits -----------------------------------------------------
LATF0 EQU 0000H
LATF1 EQU 0001H
LATF2 EQU 0002H
LATF3 EQU 0003H
LATF4 EQU 0004H
LATF5 EQU 0005H
LATF6 EQU 0006H
LATF7 EQU 0007H


;----- LATG Bits -----------------------------------------------------
LATG0 EQU 0000H
LATG1 EQU 0001H
LATG2 EQU 0002H
LATG3 EQU 0003H
LATG4 EQU 0004H
LATG5 EQU 0005H


;----- IOCBP Bits -----------------------------------------------------
IOCBP0 EQU 0000H
IOCBP1 EQU 0001H
IOCBP2 EQU 0002H
IOCBP3 EQU 0003H
IOCBP4 EQU 0004H
IOCBP5 EQU 0005H
IOCBP6 EQU 0006H
IOCBP7 EQU 0007H



;----- IOCBN Bits -----------------------------------------------------
IOCBN0 EQU 0000H
IOCBN1 EQU 0001H
IOCBN2 EQU 0002H
IOCBN3 EQU 0003H
IOCBN4 EQU 0004H
IOCBN5 EQU 0005H
IOCBN6 EQU 0006H
IOCBN7 EQU 0007H



;----- IOCBF Bits -----------------------------------------------------
IOCBF0 EQU 0000H
IOCBF1 EQU 0001H
IOCBF2 EQU 0002H
IOCBF3 EQU 0003H
IOCBF4 EQU 0004H
IOCBF5 EQU 0005H
IOCBF6 EQU 0006H
IOCBF7 EQU 0007H



;----- ANSELF Bits -----------------------------------------------------
ANSF0 EQU 0000H
ANSF1 EQU 0001H
ANSF2 EQU 0002H
ANSF3 EQU 0003H
ANSF4 EQU 0004H
ANSF5 EQU 0005H
ANSF6 EQU 0006H
ANSF7 EQU 0007H



;----- ANSELG Bits -----------------------------------------------------
ANSG1 EQU 0001H
ANSG2 EQU 0002H
ANSG3 EQU 0003H
ANSG4 EQU 0004H



;----- T4CON Bits -----------------------------------------------------
T4CKPS0 EQU 0000H
T4CKPS1 EQU 0001H
TMR4ON EQU 0002H
T4OUTPS0 EQU 0003H
T4OUTPS1 EQU 0004H
T4OUTPS2 EQU 0005H
T4OUTPS3 EQU 0006H



;----- T6CON Bits -----------------------------------------------------
T6CKPS0 EQU 0000H
T6CKPS1 EQU 0001H
TMR6ON EQU 0002H
T6OUTPS0 EQU 0003H
T6OUTPS1 EQU 0004H
T6OUTPS2 EQU 0005H
T6OUTPS3 EQU 0006H



;----- WPUG Bits -----------------------------------------------------
WPUG5 EQU 0005H


;----- RC2STA Bits -----------------------------------------------------
RX9D EQU 0000H
OERR EQU 0001H
FERR EQU 0002H
ADDEN EQU 0003H
CREN EQU 0004H
SREN EQU 0005H
RX9 EQU 0006H
SPEN EQU 0007H


;----- TX2STA Bits -----------------------------------------------------
TX9D EQU 0000H
TRMT EQU 0001H
BRGH EQU 0002H
SENDB EQU 0003H
SYNC EQU 0004H
TXEN EQU 0005H
TX9 EQU 0006H
CSRC EQU 0007H


;----- BAUD2CON Bits -----------------------------------------------------
ABDEN EQU 0000H
WUE EQU 0001H
BRG16 EQU 0003H
SCKP EQU 0004H
RCIDL EQU 0006H
ABDOVF EQU 0007H


;----- LCDCON Bits -----------------------------------------------------
LMUX0 EQU 0000H
LMUX1 EQU 0001H
CS0 EQU 0002H
CS1 EQU 0003H
WERR EQU 0005H
SLPEN EQU 0006H
LCDEN EQU 0007H



;----- LCDPS Bits -----------------------------------------------------
LP0 EQU 0000H
LP1 EQU 0001H
LP2 EQU 0002H
LP3 EQU 0003H
WA EQU 0004H
LCDA EQU 0005H
BIASMD EQU 0006H
WFT EQU 0007H



;----- LCDREF Bits -----------------------------------------------------
VLCD1PE EQU 0001H
VLCD2PE EQU 0002H
VLCD3PE EQU 0003H
LCDIRI EQU 0005H
LCDIRS EQU 0006H
LCDIRE EQU 0007H


;----- LCDCST Bits -----------------------------------------------------
LCDCST0 EQU 0000H
LCDCST1 EQU 0001H
LCDCST2 EQU 0002H



;----- LCDRL Bits -----------------------------------------------------
LRLAT0 EQU 0000H
LRLAT1 EQU 0001H
LRLAT2 EQU 0002H
LRLBP0 EQU 0004H
LRLBP1 EQU 0005H
LRLAP0 EQU 0006H
LRLAP1 EQU 0007H



;----- LCDSE0 Bits -----------------------------------------------------
SE0 EQU 0000H
SE1 EQU 0001H
SE2 EQU 0002H
SE3 EQU 0003H
SE4 EQU 0004H
SE5 EQU 0005H
SE6 EQU 0006H
SE7 EQU 0007H


;----- LCDSE1 Bits -----------------------------------------------------
SE8 EQU 0000H
SE9 EQU 0001H
SE10 EQU 0002H
SE11 EQU 0003H
SE12 EQU 0004H
SE13 EQU 0005H
SE14 EQU 0006H
SE15 EQU 0007H


;----- LCDSE2 Bits -----------------------------------------------------
SE16 EQU 0000H
SE17 EQU 0001H
SE18 EQU 0002H
SE19 EQU 0003H
SE20 EQU 0004H
SE21 EQU 0005H
SE22 EQU 0006H
SE23 EQU 0007H


;----- LCDSE3 Bits -----------------------------------------------------
SE24 EQU 0000H
SE25 EQU 0001H
SE26 EQU 0002H
SE27 EQU 0003H
SE28 EQU 0004H
SE29 EQU 0005H
SE30 EQU 0006H
SE31 EQU 0007H


;----- LCDSE4 Bits -----------------------------------------------------
SE32 EQU 0000H
SE33 EQU 0001H
SE34 EQU 0002H
SE35 EQU 0003H
SE36 EQU 0004H
SE37 EQU 0005H
SE38 EQU 0006H
SE39 EQU 0007H


;----- LCDSE5 Bits -----------------------------------------------------
SE40 EQU 0000H
SE41 EQU 0001H
SE42 EQU 0002H
SE43 EQU 0003H
SE44 EQU 0004H
SE45 EQU 0005H


;----- LCDDATA0 Bits -----------------------------------------------------
SEG0COM0 EQU 0000H
SEG1COM0 EQU 0001H
SEG2COM0 EQU 0002H
SEG3COM0 EQU 0003H
SEG4COM0 EQU 0004H
SEG5COM0 EQU 0005H
SEG6COM0 EQU 0006H
SEG7COM0 EQU 0007H


;----- LCDDATA1 Bits -----------------------------------------------------
SEG8COM0 EQU 0000H
SEG9COM0 EQU 0001H
SEG10COM0 EQU 0002H
SEG11COM0 EQU 0003H
SEG12COM0 EQU 0004H
SEG13COM0 EQU 0005H
SEG14COM0 EQU 0006H
SEG15COM0 EQU 0007H


;----- LCDDATA2 Bits -----------------------------------------------------
SEG16COM0 EQU 0000H
SEG17COM0 EQU 0001H
SEG18COM0 EQU 0002H
SEG19COM0 EQU 0003H
SEG20COM0 EQU 0004H
SEG21COM0 EQU 0005H
SEG22COM0 EQU 0006H
SEG23COM0 EQU 0007H


;----- LCDDATA3 Bits -----------------------------------------------------
SEG0COM1 EQU 0000H
SEG1COM1 EQU 0001H
SEG2COM1 EQU 0002H
SEG3COM1 EQU 0003H
SEG4COM1 EQU 0004H
SEG5COM1 EQU 0005H
SEG6COM1 EQU 0006H
SEG7COM1 EQU 0007H


;----- LCDDATA4 Bits -----------------------------------------------------
SEG8COM1 EQU 0000H
SEG9COM1 EQU 0001H
SEG10COM1 EQU 0002H
SEG11COM1 EQU 0003H
SEG12COM1 EQU 0004H
SEG13COM1 EQU 0005H
SEG14COM1 EQU 0006H
SEG15COM1 EQU 0007H


;----- LCDDATA5 Bits -----------------------------------------------------
SEG16COM1 EQU 0000H
SEG17COM1 EQU 0001H
SEG18COM1 EQU 0002H
SEG19COM1 EQU 0003H
SEG20COM1 EQU 0004H
SEG21COM1 EQU 0005H
SEG22COM1 EQU 0006H
SEG23COM1 EQU 0007H


;----- LCDDATA6 Bits -----------------------------------------------------
SEG0COM2 EQU 0000H
SEG1COM2 EQU 0001H
SEG2COM2 EQU 0002H
SEG3COM2 EQU 0003H
SEG4COM2 EQU 0004H
SEG5COM2 EQU 0005H
SEG6COM2 EQU 0006H
SEG7COM2 EQU 0007H


;----- LCDDATA7 Bits -----------------------------------------------------
SEG8COM2 EQU 0000H
SEG9COM2 EQU 0001H
SEG10COM2 EQU 0002H
SEG11COM2 EQU 0003H
SEG12COM2 EQU 0004H
SEG13COM2 EQU 0005H
SEG14COM2 EQU 0006H
SEG15COM2 EQU 0007H


;----- LCDDATA8 Bits -----------------------------------------------------
SEG16COM2 EQU 0000H
SEG17COM2 EQU 0001H
SEG18COM2 EQU 0002H
SEG19COM2 EQU 0003H
SEG20COM2 EQU 0004H
SEG21COM2 EQU 0005H
SEG22COM2 EQU 0006H
SEG23COM2 EQU 0007H


;----- LCDDATA9 Bits -----------------------------------------------------
SEG0COM3 EQU 0000H
SEG1COM3 EQU 0001H
SEG2COM3 EQU 0002H
SEG3COM3 EQU 0003H
SEG4COM3 EQU 0004H
SEG5COM3 EQU 0005H
SEG6COM3 EQU 0006H
SEG7COM3 EQU 0007H


;----- LCDDATA10 Bits -----------------------------------------------------
SEG8COM3 EQU 0000H
SEG9COM3 EQU 0001H
SEG10COM3 EQU 0002H
SEG11COM3 EQU 0003H
SEG12COM3 EQU 0004H
SEG13COM3 EQU 0005H
SEG14COM3 EQU 0006H
SEG15COM3 EQU 0007H


;----- LCDDATA11 Bits -----------------------------------------------------
SEG16COM3 EQU 0000H
SEG17COM3 EQU 0001H
SEG18COM3 EQU 0002H
SEG19COM3 EQU 0003H
SEG20COM3 EQU 0004H
SEG21COM3 EQU 0005H
SEG22COM3 EQU 0006H
SEG23COM3 EQU 0007H


;----- LCDDATA12 Bits -----------------------------------------------------
SEG24COM0 EQU 0000H
SEG25COM0 EQU 0001H
SEG26COM0 EQU 0002H
SEG27COM0 EQU 0003H
SEG28COM0 EQU 0004H
SEG29COM0 EQU 0005H
SEG30COM0 EQU 0006H
SEG31COM0 EQU 0007H


;----- LCDDATA13 Bits -----------------------------------------------------
SEG32COM0 EQU 0000H
SEG33COM0 EQU 0001H
SEG34COM0 EQU 0002H
SEG35COM0 EQU 0003H
SEG36COM0 EQU 0004H
SEG37COM0 EQU 0005H
SEG38COM0 EQU 0006H
SEG39COM0 EQU 0007H


;----- LCDDATA14 Bits -----------------------------------------------------
SEG40COM0 EQU 0000H
SEG41COM0 EQU 0001H
SEG42COM0 EQU 0002H
SEG43COM0 EQU 0003H
SEG44COM0 EQU 0004H
SEG45COM0 EQU 0005H


;----- LCDDATA15 Bits -----------------------------------------------------
SEG24COM1 EQU 0000H
SEG25COM1 EQU 0001H
SEG26COM1 EQU 0002H
SEG27COM1 EQU 0003H
SEG28COM1 EQU 0004H
SEG29COM1 EQU 0005H
SEG30COM1 EQU 0006H
SEG31COM1 EQU 0007H


;----- LCDDATA16 Bits -----------------------------------------------------
SEG32COM1 EQU 0000H
SEG33COM1 EQU 0001H
SEG34COM1 EQU 0002H
SEG35COM1 EQU 0003H
SEG36COM1 EQU 0004H
SEG37COM1 EQU 0005H
SEG38COM1 EQU 0006H
SEG39COM1 EQU 0007H


;----- LCDDATA17 Bits -----------------------------------------------------
SEG40COM1 EQU 0000H
SEG41COM1 EQU 0001H
SEG42COM1 EQU 0002H
SEG43COM1 EQU 0003H
SEG44COM1 EQU 0004H
SEG45COM1 EQU 0005H


;----- LCDDATA18 Bits -----------------------------------------------------
SEG24COM2 EQU 0000H
SEG25COM2 EQU 0001H
SEG26COM2 EQU 0002H
SEG27COM2 EQU 0003H
SEG28COM2 EQU 0004H
SEG29COM2 EQU 0005H
SEG30COM2 EQU 0006H
SEG31COM2 EQU 0007H


;----- LCDDATA19 Bits -----------------------------------------------------
SEG32COM2 EQU 0000H
SEG33COM2 EQU 0001H
SEG34COM2 EQU 0002H
SEG35COM2 EQU 0003H
SEG36COM2 EQU 0004H
SEG37COM2 EQU 0005H
SEG38COM2 EQU 0006H
SEG39COM2 EQU 0007H


;----- LCDDATA20 Bits -----------------------------------------------------
SEG40COM2 EQU 0000H
SEG41COM2 EQU 0001H
SEG42COM2 EQU 0002H
SEG43COM2 EQU 0003H
SEG44COM2 EQU 0004H
SEG45COM2 EQU 0005H


;----- LCDDATA21 Bits -----------------------------------------------------
SEG24COM3 EQU 0000H
SEG25COM3 EQU 0001H
SEG26COM3 EQU 0002H
SEG27COM3 EQU 0003H
SEG28COM3 EQU 0004H
SEG29COM3 EQU 0005H
SEG30COM3 EQU 0006H
SEG31COM3 EQU 0007H


;----- LCDDATA22 Bits -----------------------------------------------------
SEG32COM3 EQU 0000H
SEG33COM3 EQU 0001H
SEG34COM3 EQU 0002H
SEG35COM3 EQU 0003H
SEG36COM3 EQU 0004H
SEG37COM3 EQU 0005H
SEG38COM3 EQU 0006H
SEG39COM3 EQU 0007H


;----- LCDDATA23 Bits -----------------------------------------------------
SEG40COM3 EQU 0000H
SEG41COM3 EQU 0001H
SEG42COM3 EQU 0002H
SEG43COM3 EQU 0003H
SEG44COM3 EQU 0004H
SEG45COM3 EQU 0005H


;----- STATUS_SHAD Bits -----------------------------------------------------
C_SHAD EQU 0000H
DC_SHAD EQU 0001H
Z_SHAD EQU 0002H





;==========================================================================
;
; Configuration Bits
;
; NAME Address
; CONFIG1 8007h
; CONFIG2 8008h
;
;==========================================================================


        LIST
# 2054 "./p16f1947.inc"
psect udata_shr,class=COMMON,space=1,noexec
psect udata,class=RAM,space=1,noexec
psect udata_bank0,class=BANK0,space=1,noexec
psect udata_bank1,class=BANK1,space=1,noexec
psect udata_bank2,class=BANK2,space=1,noexec
psect udata_bank3,class=BANK3,space=1,noexec
psect udata_bank4,class=BANK4,space=1,noexec
psect udata_bank5,class=BANK5,space=1,noexec
psect udata_bank6,class=BANK6,space=1,noexec
psect udata_bank7,class=BANK7,space=1,noexec
psect udata_bank8,class=BANK8,space=1,noexec
psect udata_bank9,class=BANK9,space=1,noexec
psect udata_bank10,class=BANK10,space=1,noexec
psect udata_bank11,class=BANK11,space=1,noexec
psect udata_bank12,class=BANK12,space=1,noexec
psect code,class=CODE,space=0,delta=2
psect data,class=STRCODE,space=0,delta=2,noexec
psect edata,class=EEDATA,space=3,delta=2,noexec
# 39 "MOTOR_1947_V2.00.s" 2
# 1 "./MOTOR_16F1947_PA.inc" 1
;========================================================
;================ Project Information ===================
;========================================================
;Pin Assignment :
;Project Name :
;Project Version: V2.00 (Bate00)
;Project object :
;Project number :
;Edit Date : 2023/04/18
;--------------------------------------------------------
;========================================================
;========================================================
;INCLUDE TITLE

# 1 "./MODBUS-RTU.inc" 1
;========================================================
;================ Project Information ===================
;========================================================
;Project Name : MODBUS RTU BASE
;-------------------------------------------------------
;Project Version: 2.00
;Edit Date : 2023/09/28
;Function Info :
;-------------------------------------------------------
;Description of Register Informatione (use FSR)

;MODBUS_DAT_BUF_ADRL+0 : set output byte count ( min = 1 )
;MODBUS_DAT_BUF_ADRL+1 : set input byte count ( min = 0 )
;MODBUS_DAT_BUF_ADRL+2 : BSR temporary(把進入前的BANK存起來)
;MODBUS_DAT_BUF_ADRL+3 : Data offset temporary
;MODBUS_DAT_BUF_ADRL+4 : CRC counter
;MODBUS_DAT_BUF_ADRL+5 : CRC HBYTE
;MODBUS_DAT_BUF_ADRL+6 : CRC LBYTE
;MODBUS_DAT_BUF_ADRL+7 : time out count
;MODBUS_DAT_BUF_ADRL+8 : MODBUS_FLAG

;MODBUS_DAT_BUF_ADRL+A~n : Output buffer serial addressing
;-------------------------------------------------------
;-------------------------------------------------------
GLOBAL SET_MODBUS_MODE_ENABLE
GLOBAL MODBUS_INTPUT_FUNCTION
;-------------------------------------------------------
;須被定義的部分
MODBUS_OUT_P EQU LATG
MODBUS_EN EQU 0X03
;-------------------------------------------------------
MODBUS_DAT_BUF_ADRH EQU 0X20
MODBUS_DAT_BUF_ADRL EQU 0XB0
# 15 "./MOTOR_16F1947_PA.inc" 2
# 1 "./MODBUS_COMMAND.inc" 1
;========================================================
;================ Project Information ===================
;========================================================
;Project Name : MODBUS RTU BASE
;-------------------------------------------------------
;Project Version: 2.00
;Edit Date : 2023/09/28
;Function Info :

;-------------------------------------------------------
;-------------------------------------------------------
GLOBAL MODBUS_ADR_FUNCTION
# 16 "./MOTOR_16F1947_PA.inc" 2
;========================================================
;========================================================
EEPROM_ADR EQU 0X7E
EEPROM_DAT EQU 0X7F
ADC_HI_DATA EQU 0X7C
ADC_LOW_DATA EQU 0X7D

ACK_COUNTER_TEMP EQU 0X74
;-------------------------------------------------------
BANK0 EQU PORTA
BANK7 EQU LATF


;-------------------------------------------------------
;暫存器ONLY NUM(TIMER BASE TIME IS 1mS)
TMR2_DIVIDER_SET EQU 0X15
TMR2_BASE_SET EQU 0XA7
TMR2_BASE_NUM EQU 0X04


MODBUS_DAT_EXTRA_ADRH EQU 0X20
MODBUS_DAT_EXTRA_ADRL EQU 0XB0 ;存放從485送進來的資料

MODBUS_DAT_WORK_ADRH EQU 0X21
MODBUS_DAT_WORK_ADRL EQU 0X40 ;將485送的資料複製出來，之後的判斷都使用這個地方







;這邊主要是因為有4個馬達，可以直接選擇要使用哪個資料
;注射泵2.00來說，轉向馬達是MOTOR1 活塞馬達是MOTOR2
MODBUS_DAT_REAL_ADRH EQU 0X21
MODBUS_DAT_REAL_ADRL EQU 0X90
;MOTOR1 0X2190-0X21AF
;CW:4BYTE
;CCW:4BYTE
;-----------------------------------------------
;MOTOR2 0X21B0-0X21CF

;MOTOR3 0X21D0-0X21EF

;MOTOR4 0X21F0-0X220F






;0X21 0X40-0X21 0X54 MOTOR1
;0X21 0X55-0X21 0X69 MOTOR2
;0X21 0X6A-0X21 0X7E MOTOR3
;0X21 0X7F-0X21 0X93 MOTOR4





;-------------------------------------------------------
;--------------------------------------------------------
;WATCH用的暫存器設定
WATCH_DAT_BUF_ADRH EQU 0X20
WATCH_DAT_BUF_ADRL EQU 0XBA
WATCH_COUNTER EQU 0X70
WATCH_BIT_COUNT EQU 0X71
WATCH_TEMP EQU 0X72
WATCH_OUT_P EQU LATE
WATCH_OUT_DAT EQU 0X05
WATCH_OUT_CLK EQU 0X06

;--------------------------------------------------------
;--------------------------------------------------------
;mcu腳位定義
;Pin assignment definition
MOTOR_OE_RST_PORT EQU LATA
M_OE EQU 0X04
M_RST EQU 0X05

ADDR_4_5_PORT EQU PORTA
ADDSEL_4 EQU 0X06
ADDSEL_5 EQU 0X07
ADDR_6_7_PORT EQU PORTB
ADDSEL_7 EQU 0X06
ADDSEL_6 EQU 0X07


ADDR_0_1_2_3_PORT EQU PORTD
ADDSEL_0 EQU 0X00
ADDSEL_1 EQU 0X01
ADDSEL_2 EQU 0X02
ADDSEL_3 EQU 0X03

MAX485_PORT EQU LATG
MAX485_SELECT EQU 0X03

MOTOR_CONTROL_PORT EQU LATC
M1_ST EQU 0X00
M1_FR EQU 0X01
M2_ST EQU 0X02
M2_FR EQU 0X03 ;0->往光遮端方向 1->反方向
M3_ST EQU 0X04
M3_FR EQU 0X05
M4_ST EQU 0X06
M4_FR EQU 0X07
# 132 "./MOTOR_16F1947_PA.inc"
POWER_CHECK_PORT EQU PORTB
PWR_DECTET EQU 0X05 ;0->表示電源沒有進入 1->表示有電源

TEST_PORT EQU LATF
TP0_PIN EQU 0X00

ENCODER_PORT EQU PORTB
M1_ENCODER EQU 0X01
M2_ENCODER EQU 0X02
;--------------------------------------------------------
;--------------------------------------------------------
;========================================================
;==================== 0X20 ~ 0X2F =======================
;========================================================
;Register definition
DELAY_TEMP1 EQU 0X20
DELAY_TEMP2 EQU 0X21
DELAY_TEMP3 EQU 0X22

TMR2_BASE_TEMP EQU 0X23

INT_TIMER_TEMP EQU 0X24
INT_TIMER_NUM EQU 0X04

MODULE_ID_DAT EQU 0X25
CRC_COUNTER_TEMP EQU 0X26
CAL_DATA_TEMP EQU 0X27
CRC_HIBYTE EQU 0X28
CRC_LOBYTE EQU 0X29
RTU_COUNTER_DATA EQU 0X2A ;用來計算MODBUS RTU

CAL_TEMP_HBYTE EQU 0X2B
CAL_TEMP_LBYTE EQU 0X2C
TX_DATA_COUNTER EQU 0X2D ;整理UART TX傳送的資料數量
ADR_TEST_TEMP EQU 0X2E


MODBUS_DAT_COUNT EQU 0X2F
;========================================================
;==================== 0X30 ~ 0X3F =======================
;========================================================
;Register definition
;--------------------------------------
FLAG1_BANK0 EQU 0X30
CAN_SEND_TX_FLAG EQU 0X00 ;可以回傳資料FLAG
CAN_WORK_FLAG EQU 0X01 ;表示目前馬達可以動作
TX_DATA_ERROR_FLAG EQU 0X02 ;RX資料有錯誤
MANDATORY_WORK_FLAG EQU 0X03 ;強制命令執行後SET
INT_TRIG_TIME_FLAG EQU 0X04 ;表示INT地一次觸發啟動INT_TIMER功能
DEAL_WITH_MODBUS_FLAG EQU 0X05
;--------------------------------------------------------
;馬達1為轉向馬達(目前使用在注射泵)
MOTOR1_FLAG0 EQU 0X31
MOTOR_1_WORK EQU 0X01 ;馬達1收到指令可以進行運作
MOTOR_1_CW EQU 0X02 ;馬達1順時針
MOTOR_1_CCW EQU 0X03 ;馬達1逆時針
MOTOR_1_RESET EQU 0X04
MOTOR_1_ING_ZERO EQU 0X05
MOTOR_1_HI_ZERO EQU 0X06
MOTOR_1_IOC_FINISH EQU 0X07



MOTOR2_FLAG0 EQU 0X32
MOTOR_2_WORK EQU 0X01
MOTOR_2_CW EQU 0X02
MOTOR_2_CCW EQU 0X03
MOTOR_2_RESET EQU 0X04
MOTOR_2_ING_ZERO EQU 0X05


MOTOR3_FLAG0 EQU 0X33
MOTOR_3_EN EQU 0X00

MOTOR4_FLAG0 EQU 0X34
MOTOR_4_EN EQU 0X00



MOTOR1_FLAG1 EQU 0X35
MOTOR1_IN_ZERO_FLAG EQU 0X00
MOTOR1_IN_ROAT_FLAG EQU 0X01


MOTOR2_FLAG1 EQU 0X36
MOTOR2_IN_ZERO_FLAG EQU 0X00
MOTOR2_IN_ROAT_FLAG EQU 0X01

MOTOR3_FLAG1 EQU 0X37
MOTOR4_FLAG1 EQU 0X38
# 231 "./MOTOR_16F1947_PA.inc"
;--------------------------------------------------------馬達參數設定

FLAG2_BANK0 EQU 0X39 ;在通訊判斷使用哪個馬達的情況下使用
NOW_MOTOR_1_FLAG EQU 0X00
NOW_MOTOR_2_FLAG EQU 0X01
NOW_MOTOR_3_FLAG EQU 0X02
NOW_MOTOR_4_FLAG EQU 0X03
;--------------------------------------------------------
FLAG3_BANK0 EQU 0X3A
NOW_IS_LO_HI_STATUS EQU 0X00
TEN_TIME_EN EQU 0X01
MOTOR_IOC_ZERO_FLAG EQU 0X02
ROAT_MOTOR_IS_HI_FLAG EQU 0X03
ALL_MOTOR_STOP_FLAG EQU 0X04 ;CMD 0X83全部停止動作
;--------------------------------------------------------
MODBUS_ERROR_FLAG EQU 0X3B
ERROR_01_F EQU 0X00
ERROR_02_F EQU 0X01
ERROR_03_F EQU 0X02
ERROR_04_F EQU 0X03
ERROR_05_F EQU 0X04
ERROR_06_F EQU 0X05
# 261 "./MOTOR_16F1947_PA.inc"
FLAG5_BANK0 EQU 0X3C
RESET_IN_NORMAL_FALG EQU 0X00
MODBUS_IN_03_F EQU 0X01 ;0表示沒有在功能碼03/1表示有在
MODBUS_IN_06_F EQU 0X02 ;0表示沒有在功能碼06/1表示有在
MODBUS_IN_10_F EQU 0X03 ;0表示沒有在功能碼10/1表示有在


FLAG6_BANK0 EQU 0X3D ;FLAG6_BANK0，為MODBUS動作前FLAG
A0_F EQU 0X00 ;恢復出廠設定
A1_F EQU 0X01 ;整機初始化
A2_F EQU 0X02 ;換向閥初始化
A3_F EQU 0X03 ;活塞初始化
A4_F EQU 0X04 ;進入醒目提示_F

LED_WORK_FLAG EQU 0X3E
LED_00_F EQU 0X00 ;未初始化
LED_01_F EQU 0X01 ;設備在線
LED_02_F EQU 0X02 ;安全模式
LED_03_F EQU 0X03 ;設備異常
LED_04_F EQU 0X04 ;醒目提示



; 0X3F



;========================================================
;==================== 0X40 ~ 0X4F =======================
;========================================================
;Register definition
PWM_1_COUNT_DAT EQU 0X40 ;每次一個PWM就+1
PWM_2_COUNT_DAT EQU 0X41 ;每次一個PWM就+1
STRONG_STOP_TEMP1 EQU 0X42
STRONG_STOP_TEMP2 EQU 0X43
STRONG_STOP_TEMP3 EQU 0X44
STRONG_STOP_TEMP4 EQU 0X45
;-----------------------------------------------
IOC_COUNTER_HBYTE EQU 0X46
IOC_COUNTER_LBYTE EQU 0X47

TEN_MS_NUM EQU 0X02
TEN_MS_TEMP EQU 0X48
MODBUS_ERROR_COUNTER EQU 0X49

MODBUS_TABLE_ADR_TEMP EQU 0X4A
MODBUS_TABLE_DAT_TEMP EQU 0X4B

STANDBY_HBYTE_DAT EQU 0X4C
STANDBY_LBYTE_DAT EQU 0X4D ;用來暫存MODBUS中運算的資料





M1_ZERO_COUNTER_HBYTE EQU 0X50
M1_ZERO_COUNTER_LBYTE EQU 0X51
M1_NOT_COUNTER_TEMP EQU 0X53





TURN_RESET_HBYTE EQU 0X75
TURN_RESET_LBYTE EQU 0X76
TURN_HBYTE_NUM EQU 0X23
TURN_LBYTE_NUM EQU 0XA0





;--------------------------------------------------------------
;------------------------BANK7參數設定-------------------------
;--------------------------------------------------------------
COMMON_DATA_HBYTE EQU 0X22
COMMON_DATA_LBYTE EQU 0X30


ADR_80_H_DAT EQU 0XA0
ADR_80_L_DAT EQU 0XA1

ADR_81_H_DAT EQU 0XA2
ADR_81_L_DAT EQU 0XA3

ADR_82_H_DAT EQU 0XA4
ADR_82_L_DAT EQU 0XA5

ADR_83_H_DAT EQU 0XA6
ADR_83_L_DAT EQU 0XA7

ADR_84_H_DAT EQU 0XA8
ADR_84_L_DAT EQU 0XA9
# 40 "MOTOR_1947_V2.00.s" 2

PSECT main, class=CODE,delta=2,SIZE=0800H
   ORG 0X0000
   GOTO BOOTLOADER_LOOP
   ORG 0X0004
   GOTO INTERRUPT_SUB_AREA
;* ****************************************************************************************
;* Label Start
;*
;========================================================
;================== BOOTLOADER副程式 ====================
;========================================================
BOOTLOADER_LOOP:
    GOTO SYSTEM_START_SETTING
;========================================================
;================== 中斷副程式起始位址 ==================
;========================================================
INTERRUPT_SUB_AREA:
PAGESEL 0X0000
BANKSEL PORTA
;--------------------------
    BTFSC PIR4,RC2IF
    GOTO RC2IF_FUNCTION_LOOP ;硬體UART2收資料
;--------------------------
    BTFSC PIR1,TMR2IF
    GOTO TMR2IF_FUNCTION_LOOP ;TIMER2基準為1mS
;--------------------------





    BTFSC INTCON,INTF
    GOTO INT_INTF_FUNCTION ;PWM INT
;-----------
    BTFSC INTCON,IOCIF
    GOTO IOC_INT_FUNCTION ;光遮斷器觸發
    RETFIE


;========================================================
;=============MODBUS TIMEOUT到要進行分析的動作===========
;========================================================
;表示TIMEOUT到了，可以進行分析的動作
MODBUS_TIMEOUT_IS_FINISH_LOOP:
    MOVLW TMR2_BASE_NUM
    MOVWF TMR2_BASE_TEMP
BANKSEL RC2STA
    BCF RC2STA,CREN ;要進行分析資料前，先把UART RX關閉確保資料不會錯誤
BANKSEL PORTA
    MOVLW MODBUS_DAT_EXTRA_ADRH ;20B0
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X08 ;MODBUS_FLAG
    ADDWF FSR1L,F
    CLRF INDF1
;----------------------------------------------------------
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X03 ;MODBUS的DATA OFFSET
    ADDWF FSR1L,F
    MOVF INDF1,W
    MOVWF RTU_COUNTER_DATA ;得到這次MODBUS所有的資料數量
    MOVWF MODBUS_DAT_COUNT
    MOVWF MODBUS_ERROR_COUNTER
    MOVLW 0X02
    SUBWF RTU_COUNTER_DATA,F
    CLRF INDF1
;----------------------------------------------------------
; GOTO CHECK_CRC16_IS_RIGHT ;驗證收到CRC-16是否正確
GOTO MODBUS_CRC16_CHECK_IS_OK
;===================================================
;============複製485傳送的資料一份參考參考==========OK
;===================================================
COPY_485_DATA_LOOP:
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;-------------------------
    MOVLW MODBUS_DAT_WORK_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_WORK_ADRL
    MOVWF FSR0L
    MOVF MODBUS_DAT_COUNT,W
    MOVWF RTU_COUNTER_DATA ;確認資料總數量
;-------------------------
COPY_485_DATA_LV1:
    MOVF INDF1,W
    MOVWF INDF0
    INCF FSR1L,F
    INCF FSR0L,F
    DECFSZ RTU_COUNTER_DATA,F
    GOTO COPY_485_DATA_LV1
    RETURN
;===================================================
;============MODBUS的CRC16驗證正確==================OK
;===================================================
;這段的CRC16驗證已經通過了，先把資料做個複製的動作
MODBUS_CRC16_CHECK_IS_OK:
    CALL COPY_485_DATA_LOOP
BANKSEL PORTA
    MOVLW MODBUS_DAT_WORK_ADRH ;21
    MOVWF FSR1H
    MOVLW MODBUS_DAT_WORK_ADRL ;E0
    MOVWF FSR1L
;----------------------------------------------------------
    MOVF INDF1,W
    XORWF MODULE_ID_DAT,W
    BTFSS STATUS,Z
    GOTO MODBUS_BUS_ID_ERROR_LOOP
;----------------------------------------------------------表示DEVICE ID 不對
; MOVLW 0X08
; XORWF MODBUS_DAT_COUNT,W
; BTFSS STATUS,Z
; GOTO MODBUS_BUS_ID_ERROR_LOOP ;當今天收到的資料數量大於8表示異常
;---------------
    INCF FSR1L,F ;資料為功能碼
    MOVLW 0X03
    XORWF INDF1,W
    BTFSC STATUS,Z
    GOTO ANAY_MODBUS_CMD_03_LOOP ;功能碼是READ ONE BYTE
;---------------
    MOVLW 0X06
    XORWF INDF1,W
    BTFSC STATUS,Z
    GOTO ANAY_MODBUS_CMD_06_LOOP ;功能碼是WRITE ONE BYTE
;---------------
    MOVLW 0X10
    XORWF INDF1,W
    BTFSC STATUS,Z
    GOTO ANAY_MODBUS_CMD_10_LOOP ;功能碼是WRITE MORE BYTE
;目前功能碼只有接0X03 0X06 0X10，其他的算是ERROR CODE 0X01
;===================================================
;============MODBUS的功能碼錯誤=====================OK
;===================================================
;MODBUS RTU ERROR CODE 01
;非法功能，表示非授權的功能碼
MODBUS_BUS_01_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_01_F
    RETFIE
;----------------------------------------
;MODBUS RTU ERROR CODE 02
;非法暫存器地址
MODBUS_BUS_02_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_02_F
    RETFIE
;----------------------------------------
;MODBUS RTU ERROR CODE 03
;非法資料數值
MODBUS_BUS_03_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_03_F
    RETFIE
;----------------------------------------
;MODBUS RTU ERROR CODE 04
;裝置故障，像是自我檢測出現異常
MODBUS_BUS_04_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_04_F
    RETFIE
;----------------------------------------
;MODBUS RTU ERROR CODE 05
;確認，有收到指令並且立即執行
MODBUS_BUS_05_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_05_F
    RETFIE
;----------------------------------------
;MODBUS RTU ERROR CODE 06
;裝置BUSY，(有收到指令，但因為正在執行其他指令而無法執行)
MODBUS_BUS_06_ERROR_LOOP:
    BSF MODBUS_ERROR_FLAG,ERROR_06_F
    RETFIE
;===================================================
;============MODBUS的ID或是資料數錯誤===============OK
;===================================================
;將RX存放資料的空間清空
MODBUS_BUS_ID_ERROR_LOOP:
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
MODBUS_BUS_ID_ERROR_LV1:
    CLRF INDF1
    INCF FSR1L,F
    DECFSZ MODBUS_ERROR_COUNTER,F
    GOTO MODBUS_BUS_ID_ERROR_LV1
BANKSEL RC2STA
    BSF RC2STA,CREN ;重新啟動UART RX功能
    RETFIE
;===================================================
;================驗證CRC16是否正確?=================OK
;===================================================
;這段驗證CRC的時間大約為380uS
CHECK_CRC16_IS_RIGHT:
BANKSEL PORTA
    MOVLW 0XFF
    MOVWF CRC_HIBYTE
    MOVLW 0XFF
    MOVWF CRC_LOBYTE
    MOVLW MODBUS_DAT_EXTRA_ADRH ;0X20
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL ;0XB0
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F ;這裡是第一筆資料的位置
CHECK_CRC16_IS_RIGHT_LV1:
    MOVF INDF1,W
    MOVWF CAL_DATA_TEMP
    CALL CRC_16_FUNCTION_LOOP
    INCF FSR1L,F
    DECFSZ RTU_COUNTER_DATA,F
    GOTO CHECK_CRC16_IS_RIGHT_LV1
;----------------------------
    MOVF CRC_LOBYTE,W
    XORWF INDF1,W
    BTFSS STATUS,Z
    GOTO MODBUS_BUS_ID_ERROR_LOOP ;CRC16錯誤，模組不做回應
;----------------------------
    INCF FSR1L,F
    MOVF CRC_HIBYTE,W
    XORWF INDF1,W
    BTFSS STATUS,Z
    GOTO MODBUS_BUS_ID_ERROR_LOOP ;CRC16錯誤，模組不做回應
    GOTO MODBUS_CRC16_CHECK_IS_OK ;CRC16驗證正確

;========================================================
;=============MODBUS 功能碼為0X03========================
;========================================================
;功能碼:0X03表示要READ
;先確認ADR是否對應的合法
ANAY_MODBUS_CMD_03_LOOP:
BANKSEL PORTA
    MOVLW 0XF1
    ANDWF FLAG5_BANK0,F
    BSF FLAG5_BANK0,MODBUS_IN_03_F
    GOTO ANAY_MODBUS_CMD_COMMON_LOOP
;========================================================
;=============MODBUS 功能碼為0X10========================
;========================================================
;功能碼:0X10，這個部分有可能寫入一個WORD的資料和功能碼0X06相同
;所以要多確認是否合法
;先確認ADR是否對應的合法
ANAY_MODBUS_CMD_10_LOOP:
BANKSEL PORTA
    MOVLW 0XF1
    ANDWF FLAG5_BANK0,F
    BSF FLAG5_BANK0,MODBUS_IN_10_F
    GOTO ANAY_MODBUS_CMD_COMMON_LOOP
;========================================================
;=============MODBUS 功能碼為0X06========================
;========================================================
;功能碼:0X06表示要WRITE
;先確認ADR是否對應的合法
ANAY_MODBUS_CMD_06_LOOP:
BANKSEL PORTA
    MOVLW 0XF1
    ANDWF FLAG5_BANK0,F
    BSF FLAG5_BANK0,MODBUS_IN_06_F ;先將MODBUS FLAG重新設定為功能碼06
    ;GOTO ANAY_MODBUS_CMD_COMMON_LOOP
ANAY_MODBUS_CMD_COMMON_LOOP:
;----------------
BANKSEL PORTA
    MOVLW MODBUS_DAT_WORK_ADRH ;21
    MOVWF FSR1H
    MOVLW MODBUS_DAT_WORK_ADRL ;E0
    MOVWF FSR1L ;這裡是第一筆資料的位置
    MOVLW 0X02
    ADDWF FSR1L,F
;---------------------------------------------------
    MOVF INDF1,W
    MOVWF STANDBY_HBYTE_DAT ;ADR位置的HBYTE
    INCF FSR1L,F
    MOVF INDF1,W
    MOVWF STANDBY_LBYTE_DAT ;ADR位置的LBYTE
;---------------------------------------------------- 將位置資料先複製出來
    MOVLW 0XA0
    SUBWF STANDBY_LBYTE_DAT,F
    MOVLW 0X00
    SUBWFB STANDBY_HBYTE_DAT,F
;---------------------------------------------------- 由於後面會用TABLE，所以從0開始會比較好
    MOVF STANDBY_LBYTE_DAT,W
    MOVWF MODBUS_TABLE_ADR_TEMP
BANKSEL PORTA
    BSF FLAG1_BANK0,DEAL_WITH_MODBUS_FLAG
    RETFIE
;----------------------------------------------------------------------------------------------------


;下面是之前功能碼0X06的動作副程式
;;------------------------------------------------
; MOVLW 0X09
; XORWF CAL_TEMP_LBYTE,W
; BTFSC STATUS,Z
; GOTO STRONG_STOP_FUNCTION
;;------------------------
; MOVLW 0X00
; XORWF CAL_TEMP_LBYTE,W
; BTFSC STATUS,Z
; GOTO CW_STEP_FUNCTION
;;------------------------
; MOVLW 0X01
; XORWF CAL_TEMP_LBYTE,W
; BTFSC STATUS,Z
; GOTO CCW_STEP_FUNCTION
;;------------------------
; MOVLW 0X04
; XORWF CAL_TEMP_LBYTE,W
; BTFSC STATUS,Z
; GOTO RESET_STEP_FUNCTION
;
;;------------------------------------------------
;ANAY_MODBUS_CMD_06_EXIT:
; BCF FLAG2_BANK0,NOW_MOTOR_1_FLAG
; BCF FLAG2_BANK0,NOW_MOTOR_2_FLAG
; BCF FLAG2_BANK0,NOW_MOTOR_3_FLAG
; BCF FLAG2_BANK0,NOW_MOTOR_4_FLAG
; RETFIE
;
;
;
;;-------------------------------------------
;;-------------0X80以上的WRITE CMD-----------
;;-------------------------------------------
;ANAY_MODBUS_WRITE_0X80_LOOP:
; MOVLW 0X08
; MOVWF TX_DATA_COUNTER
; BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
; MOVLW 0X83
; XORWF INDF1,W
; BTFSC STATUS,Z
; CALL COMMON_CMD_0X83_LOOP
; GOTO ANAY_MODBUS_CMD_06_EXIT
;COMMON_CMD_0X83_LOOP:
; INCF FSR1L,F
; INCF FSR1L,F
; MOVF INDF1,W
; BTFSC STATUS,Z
; GOTO RECOVER_MODULE_LOOP
;BANKSEL BANK7
; MOVLW 0X02
; MOVWF ADR_83_L_DAT
; MOVLW 0X02
; MOVWF ADR_81_L_DAT
;
;
;RECOVER_MODULE_LOOP_LV1:
;BANKSEL MOTOR_CONTROL_PORT
; BCF MOTOR_CONTROL_PORT,M1_ST
; BCF MOTOR_CONTROL_PORT,M2_ST
;BANKSEL PORTA
; BSF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
; BCF MOTOR2_FLAG0,MOTOR_2_RESET
; BCF MOTOR1_FLAG0,MOTOR_1_RESET
; BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
; BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
; BCF FLAG1_BANK0,CAN_WORK_FLAG
;
; BCF MOTOR2_FLAG0,MOTOR_2_WORK
; BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
; BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
; BCF FLAG3_BANK0,TEN_TIME_EN
; BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
; BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
; BCF MOTOR1_FLAG0,MOTOR_1_WORK
;
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
; ADDWF FSR0L,F
; MOVLW 0X00
; MOVWF INDF0
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; MOVLW 0X07
; ADDWF FSR0L,F
; MOVLW 0X00
; MOVWF INDF0
;;---------------------------------------------------------------------------
;
;
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
;;=============================================
;
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; CLRF INDF0
; INCF FSR0L,F
;;-------------
; RETURN
;;-----------------------------------------------------
;;停止動作
;RECOVER_MODULE_LOOP:
;BANKSEL BANK7
; MOVLW 0X00
; MOVWF ADR_83_L_DAT
; MOVLW 0X00
; MOVWF ADR_81_L_DAT
;BANKSEL PORTA
;CALL RECOVER_MODULE_LOOP_LV1
; BCF FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
; RETURN
;
;
;
;
;
;;--------------------------------------------------------------------------
;;---------------------------------------------------------------------------
;;---------------------------------------------------------------------------
;;========================================================
;;=============ADDR IS 0X04===============================
;;========================================================
;RESET_STEP_FUNCTION:
; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
; CALL STRONG_RESET_MOTOR_1_FUNC
; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
; CALL STRONG_RESET_MOTOR_2_FUNC
; GOTO ANAY_MODBUS_CMD_06_EXIT
;STRONG_RESET_MOTOR_1_FUNC:
;BANKSEL MOTOR_CONTROL_PORT
;BCF MOTOR_CONTROL_PORT,M1_FR
;BANKSEL PORTA
; BSF MOTOR1_FLAG0,MOTOR_1_RESET
; RETURN
;STRONG_RESET_MOTOR_2_FUNC:
; BSF MOTOR2_FLAG0,MOTOR_2_RESET
; RETURN
;
;
;;========================================================
;;=============ADDR IS 0X00===============================
;;========================================================
;CW_STEP_FUNCTION:
; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
; CALL STRONG_CW_MOTOR_1_FUNC
; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
; CALL STRONG_CW_MOTOR_2_FUNC
; GOTO ANAY_MODBUS_CMD_06_EXIT
;STRONG_CW_MOTOR_1_FUNC:
;BANKSEL MOTOR_CONTROL_PORT
;BCF MOTOR_CONTROL_PORT,M1_FR
;BANKSEL PORTA
;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
; BSF MOTOR1_FLAG0,MOTOR_1_RESET
; BSF FLAG1_BANK0,CAN_WORK_FLAG
; BSF MOTOR1_FLAG0,MOTOR_1_WORK
; RETURN
;STRONG_CW_MOTOR_2_FUNC:
; BSF FLAG1_BANK0,CAN_WORK_FLAG
; BSF MOTOR2_FLAG0,MOTOR_2_WORK
; RETURN
;;========================================================
;;=============ADDR IS 0X01===============================
;;========================================================
;CCW_STEP_FUNCTION:
; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
; CALL STRONG_CCW_MOTOR_1_FUNC
; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
; CALL STRONG_CCW_MOTOR_2_FUNC
; GOTO ANAY_MODBUS_CMD_06_EXIT
;STRONG_CCW_MOTOR_1_FUNC:
;BANKSEL MOTOR_CONTROL_PORT
;BSF MOTOR_CONTROL_PORT,M1_FR
;BANKSEL PORTA
;BSF FLAG5_BANK0,RESET_IN_NORMAL_FALG
; BSF MOTOR1_FLAG0,MOTOR_1_RESET
; BSF FLAG1_BANK0,CAN_WORK_FLAG
; BSF MOTOR1_FLAG0,MOTOR_1_WORK
; RETURN
;STRONG_CCW_MOTOR_2_FUNC:
; BSF FLAG1_BANK0,CAN_WORK_FLAG
; BSF MOTOR2_FLAG0,MOTOR_2_WORK
; RETURN
;;========================================================
;;=============ADDR IS 0X09===============================
;;========================================================
;STRONG_STOP_FUNCTION:
; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
; CALL STRONG_STOP_MOTOR_1_FUNC
; BTFSC FLAG2_BANK0,NOW_MOTOR_2_FLAG
; CALL STRONG_STOP_MOTOR_2_FUNC
;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
;; CALL STRONG_STOP_MOTOR_1_FUNC
;; BTFSC FLAG2_BANK0,NOW_MOTOR_1_FLAG
;; CALL STRONG_STOP_MOTOR_1_FUNC
;
;
; GOTO ANAY_MODBUS_CMD_06_EXIT
;
;STRONG_STOP_MOTOR_1_FUNC:
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X07
; ADDWF FSR0L,F
; MOVLW 0X04
; MOVWF INDF0
;;----------
; MOVLW 0X01
; MOVWF STRONG_STOP_TEMP1
;BANKSEL MOTOR_CONTROL_PORT
; BCF MOTOR_CONTROL_PORT,M1_ST
;BANKSEL PORTA
; RETURN
;STRONG_STOP_MOTOR_2_FUNC:
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; MOVLW 0X07
; ADDWF FSR0L,F
; MOVLW 0X04
; MOVWF INDF0
;;----------
; MOVLW 0X01
; MOVWF STRONG_STOP_TEMP2
;BANKSEL MOTOR_CONTROL_PORT
; BCF MOTOR_CONTROL_PORT,M2_ST
;BANKSEL PORTA
; RETURN
;
;
;
;
;
;
;
;;----------------------------------------------------------
;WRITE_MOTOR_1_SOME_DATA:
; BSF FLAG2_BANK0,NOW_MOTOR_1_FLAG
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; GOTO ANAY_MODBUS_CMD_06_LEVEL1
;WRITE_MOTOR_2_SOME_DATA:
; BSF FLAG2_BANK0,NOW_MOTOR_2_FLAG
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; GOTO ANAY_MODBUS_CMD_06_LEVEL1
;WRITE_MOTOR_3_SOME_DATA:
; BSF FLAG2_BANK0,NOW_MOTOR_3_FLAG
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X2A
; ADDWF FSR0L,F
; GOTO ANAY_MODBUS_CMD_06_LEVEL1
;WRITE_MOTOR_4_SOME_DATA:
; BSF FLAG2_BANK0,NOW_MOTOR_4_FLAG
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X3F
; ADDWF FSR0L,F
; GOTO ANAY_MODBUS_CMD_06_LEVEL1
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
# 668 "MOTOR_1947_V2.00.s"
;******************************************************************************
;******************************************************************************

;========================================================
;==================中斷UART2 FUNCTION====================
;========================================================
RC2IF_FUNCTION_LOOP:
PAGESEL 0X0800
    CALL MODBUS_INTPUT_FUNCTION ;將資料存在INDF1
PAGESEL 0X0000
    RETFIE
;========================================================
;==================中斷TIMER2 FUNCTION===================
;========================================================
;TIMER2 BASE IS 1mS
TMR2IF_FUNCTION_LOOP:

    BCF PIR1,TMR2IF
;---------------------
    BTFSS FLAG3_BANK0,TEN_TIME_EN
    GOTO TMR2IF_FUNCTION_LV0
    MOVF TEN_MS_TEMP,W
    BTFSC STATUS,Z
    CALL TEN_MS_FUNCTION_LOOP
    DECF TEN_MS_TEMP,F
TMR2IF_FUNCTION_LV0:
    BTFSS FLAG1_BANK0,INT_TRIG_TIME_FLAG
    GOTO TMR2IF_FUNC_LV1
;---------
    MOVF INT_TIMER_TEMP,W
    BTFSC STATUS,Z
    GOTO TIMER2_INT_LV1
    DECF INT_TIMER_TEMP,F
TMR2IF_FUNC_LV1:
;判斷是否MODBUS RTU TIMEOUT 要啟動
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X08
    ADDWF FSR1L,F
    BTFSS INDF1,0X00
    RETFIE
BANKSEL PORTA
;-----------------------------------
    DECF FSR1L,F
    MOVF INDF1,W
    BTFSS STATUS,Z
    GOTO RESET_MODBUS_TIMEOUT_FUNCTION
;-----------------------------------
BANKSEL PORTA
    MOVF TMR2_BASE_TEMP,W
    BTFSC STATUS,Z
    GOTO MODBUS_TIMEOUT_IS_FINISH_LOOP
;----------------------------------=
    DECF TMR2_BASE_TEMP,F
    RETFIE
;-------------------------------------------------------
RESET_MODBUS_TIMEOUT_FUNCTION:
;表示還是持續有收到資料，TIME OUT 資料重製
    CLRF INDF1
    MOVLW TMR2_BASE_NUM
    MOVWF TMR2_BASE_TEMP
    RETFIE
;------------------------------------------------------
;INT 時間
TIMER2_INT_LV1:
    MOVLW INT_TIMER_NUM
    MOVWF INT_TIMER_TEMP

    INCF PWM_2_COUNT_DAT,F
    BCF FLAG1_BANK0,INT_TRIG_TIME_FLAG
    BCF INTCON,INTF
    BSF INTCON,INTE
BTFSS MOTOR2_FLAG0,MOTOR_2_ING_ZERO
RETFIE
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X05
    ADDWF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
    RETFIE




TEN_MS_FUNCTION_LOOP:
    MOVLW TEN_MS_NUM
    MOVWF TEN_MS_TEMP
    MOVLW 0X01
    ADDWF IOC_COUNTER_LBYTE,F
    MOVLW 0X00
    ADDWFC IOC_COUNTER_HBYTE,F
    RETURN




;========================================================
;==================中斷IOC FUNCTION====================
;========================================================
IOC_INT_FUNCTION:
    BCF INTCON,IOCIF
BANKSEL IOCBF
    BTFSC IOCBF,M1_ENCODER
    CALL IOCBF1_INT_LOOP
;--------
    BTFSC IOCBF,M2_ENCODER
    CALL IOCBF2_INT_LOOP
    RETFIE
;----------------------------------------------------------
IOCBF1_INT_LOOP:
    BCF IOCBF,M1_ENCODER
BANKSEL IOCBF
    RETURN
IOCBF2_INT_LOOP:
    BCF IOCBF,M2_ENCODER
BANKSEL PORTA
    RETURN
;========================================================
;==================中斷INT FUNCTION====================
;========================================================
INT_INTF_FUNCTION:
    BCF INTCON,INTF
    BTFSC FLAG1_BANK0,INT_TRIG_TIME_FLAG
    RETFIE
    BSF FLAG1_BANK0,INT_TRIG_TIME_FLAG
    BCF INTCON,INTE
    RETFIE



;========================================================
;=============MODBUS 計算其CRC 功能======================
;========================================================
MODBUS_RTU_READ_LV2:
BANKSEL PORTA
    MOVLW 0XFF
    MOVWF CRC_HIBYTE
    MOVLW 0XFF
    MOVWF CRC_LOBYTE
;---------
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F ;這裡是第一筆資料的位置
;---------
MODBUS_RTU_READ_CRC_LOOP:
    MOVF INDF1,W
    MOVWF CAL_DATA_TEMP
    CALL CRC_16_FUNCTION_LOOP
    INCF FSR1L,F
    DECFSZ RTU_COUNTER_DATA,F
    GOTO MODBUS_RTU_READ_CRC_LOOP
    MOVF CRC_LOBYTE,W
    MOVWF INDF1
    INCF FSR1L,F
    MOVF CRC_HIBYTE,W
    MOVWF INDF1
    RETURN
;========================================================
;================== 主程序前參數設定 ====================
;========================================================
SYSTEM_START_SETTING:
;========================================================
;=====================振盪器設定=========================
;========================================================
BANKSEL OSCCON
    MOVLW 0X72
    MOVWF OSCCON ;8MHZ
    MOVLW 0X00
    MOVWF OSCTUNE ;校正後頻率
    MOVLW 0X11
    MOVWF OSCSTAT ;高頻振盪精度0.5%
;========================================================
;=====================OPTION設定=========================
;========================================================
    MOVLW 0XC8
    MOVWF OPTION_REG ;BIT6 0->rising 1->falling
;========================================================
;======================中斷設定==========================
;========================================================
    MOVLW 0X40
    MOVWF INTCON
BANKSEL PIE1
    MOVLW 0X00
    MOVWF PIE1 ;BIT 3 = MSSP 1 INTERRUPT, BIT 5 = USART 1 RECIEVE INTERRUPT
    MOVLW 0X00
    MOVWF PIE2
    MOVLW 0X00
    MOVWF PIE3
    MOVLW 0X00
    MOVWF PIE4
;========================================================
;========================ADC設定=========================
;========================================================
BANKSEL ADCON0
    MOVLW 0X00
    MOVWF ADCON0
    MOVLW 0X00
    MOVWF ADCON1
BANKSEL ANSELA
    CLRF ANSELA
    CLRF ANSELE
BANKSEL ANSELF
    CLRF ANSELF
    CLRF ANSELG
BANKSEL PORTA
;========================================================
;=====================I/O設定============================
;========================================================
BANKSEL TRISA
    MOVLW 0XC0
    MOVWF TRISA
    MOVLW 0XFF
    MOVWF TRISB
    MOVLW 0X00
    MOVWF TRISC
    MOVLW 0X0F
    MOVWF TRISD
    MOVLW 0XFF
    MOVWF TRISE
BANKSEL TRISF
    MOVLW 0X00
    MOVWF TRISF
    MOVLW 0XF6
    MOVWF TRISG
;---------------
BANKSEL LATA
    MOVLW 0X00
    MOVWF LATA
    MOVLW 0X00
    MOVWF LATB
    MOVLW 0X00
    MOVWF LATC
    MOVLW 0X00
    MOVWF LATD
    MOVLW 0X00
    MOVWF LATE
BANKSEL LATF
    CLRF LATF
    CLRF LATG
;---------------
BANKSEL PORTA
    CLRF PORTA
    CLRF PORTB
    CLRF PORTC
    CLRF PORTD
    CLRF PORTE
;---------------
BANKSEL PORTF
    CLRF PORTF
    CLRF PORTG
BANKSEL PORTA
    CALL DELAY_1000ms
;========================================================
;=====================暫存器設定=========================
;========================================================
    CALL CLEAN_ALL_REGISTER
PAGESEL 0X0800
    CALL SET_MODBUS_MODE_ENABLE ;設定uart2硬體
PAGESEL 0X0000
;========================================================
;=====================TIMER2設定=========================
;========================================================
    CALL SET_TMR2_BASE_TIME ;設定TIMER2基礎時間
    CALL SET_TMR2_INT_EN ;TIMER2中斷啟動
    CALL SET_TMR2_ON ;啟動TIMER2功能
;========================================================
;=====================ADC設定============================
;========================================================
ADC_HW_SETTING:
BANKSEL ANSELG
    MOVLW 0X10
    MOVWF ANSELG
;-------------------------ADC_OPEN-------------------------
BANKSEL ADCON1
    MOVLW 0X31 ;AN12啟動
    MOVWF ADCON0
    MOVLW 0XC0
    MOVWF ADCON1
BANKSEL PORTA
    CALL DELAY_100ms
;========================================================
;=====================PWM輸出設定========================
;========================================================
SETTING_PWM_HW_LOOP:
;-------------------------------------設定相對應接腳TIMER
BANKSEL CCPTMRS0
    MOVLW 0XDF
    MOVWF CCPTMRS0
    MOVLW 0X0F
    MOVWF CCPTMRS1
;-------------------------------------決定週期
BANKSEL PR4
    MOVLW 0X9C
    MOVWF PR4
;-------------------------------------啟動TIMER
BANKSEL T4CON
   MOVLW 0X7F
   MOVWF T4CON
;-------------------------------------決定DUTY CYCLE
BANKSEL CCPR3L
    MOVLW 0X32
    MOVWF CCPR3L
;-------------------------------------啟動PWM
BANKSEL CCP3CON
    MOVLW 0X0C
    MOVWF CCP3CON
;========================================================
;=====================IOC設定============================
;========================================================
IOC_HW_SETTING:
BANKSEL IOCBP
    MOVLW 0X00
    MOVWF IOCBN
    MOVLW 0X00
    MOVWF IOCBP ;正緣觸發

;;========================================================
;;=====================DIP SWITCH判斷=====================
;;========================================================
;DIP_SWITCH_ADR_FUNCTION:
;BANKSEL ADDR_0_1_2_3_PORT
; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_0
; BSF MOTOR1_FLAG0,MOTOR_1_EN
;;---------
; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_1
; BSF MOTOR2_FLAG0,MOTOR_2_EN
;;---------
; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_2
; BSF MOTOR3_FLAG0,MOTOR_3_EN
;;---------
; BTFSC ADDR_0_1_2_3_PORT,ADDSEL_3
; BSF MOTOR4_FLAG0,MOTOR_4_EN
;---------
;========================================================
;=====================PWM頻率偵測========================
;========================================================
CHECK_PWM_FREQ_FUCNTION:
    ;CALL ADC_TAKE_DATA_FUNCTION


;========================================================
;=====================ID SELECT==========================
;========================================================
;這邊判斷ID的條件是由ADC RF0的數值來判斷
ID_SELECT_LOOP:
BANKSEL PORTA
    CLRF MODULE_ID_DAT

;========================================================
;===================POWER LED輸出========================
;========================================================
POWER_LED_OUTPUT_FUNCTION:
BANKSEL POWER_CHECK_PORT
    BTFSS POWER_CHECK_PORT,PWR_DECTET
    GOTO POWER_LED_OUTPUT_EXIT
BANKSEL TEST_PORT
    BSF TEST_PORT,TP0_PIN
POWER_LED_OUTPUT_EXIT:
BANKSEL PORTA
;--------------------------------------------------------
;--------------------------------------------------------
;========================================================
;=====================INT設定============================
;========================================================
INT_HW_SETTING:
BANKSEL MAX485_PORT
    BCF MAX485_PORT,MAX485_SELECT ;將MAX485設定為RX模式
    BSF INTCON,INTE
    BSF INTCON,IOCIE
BANKSEL PIE4
    BSF PIE4,RC2IE
    BSF PIE1,TMR2IE
    BSF INTCON,GIE
BANKSEL PORTA
    MOVLW TEN_MS_NUM
    MOVWF TEN_MS_TEMP
    MOVLW INT_TIMER_NUM
    MOVWF INT_TIMER_TEMP
BANKSEL MOTOR_OE_RST_PORT
    BSF MOTOR_OE_RST_PORT,M_OE
    BSF MOTOR_OE_RST_PORT,M_RST
    BCF MOTOR_CONTROL_PORT,M1_ST
    BCF MOTOR_CONTROL_PORT,M2_ST
    BCF MOTOR_CONTROL_PORT,M1_FR
    BCF MOTOR_CONTROL_PORT,M2_FR
BANKSEL PORTA
MOVLW 0X04
MOVWF MODULE_ID_DAT
;BCF INTCON,GIE







GOTO SYSTEM_START
# 1086 "MOTOR_1947_V2.00.s"
;********************************************************************************
;********************************************************************************
;========================================================
;=====================主程序迴圈=========================
;========================================================
SYSTEM_START:
BANKSEL PORTA
; BTFSC PORTE,0X00
; GOTO MOTOR_2_WORK1
; GOTO MOTOR_2_STOP
;BANKSEL PORTA
SYSTEM_START_LV1:
    BTFSC FLAG1_BANK0,DEAL_WITH_MODBUS_FLAG
    CALL DEAL_WITH_MODBUS_LOOP
;------------------------------------------- 傳送ERROR CODE的地方
    BTFSC MODBUS_ERROR_FLAG,ERROR_01_F
    CALL MODBUS_ERROR_CODE_01_LOOP
    BTFSC MODBUS_ERROR_FLAG,ERROR_02_F
    CALL MODBUS_ERROR_CODE_02_LOOP
    BTFSC MODBUS_ERROR_FLAG,ERROR_03_F
    CALL MODBUS_ERROR_CODE_03_LOOP
    BTFSC MODBUS_ERROR_FLAG,ERROR_04_F
    CALL MODBUS_ERROR_CODE_04_LOOP
    BTFSC MODBUS_ERROR_FLAG,ERROR_05_F
    CALL MODBUS_ERROR_CODE_05_LOOP
    BTFSC MODBUS_ERROR_FLAG,ERROR_06_F
    CALL MODBUS_ERROR_CODE_06_LOOP
;-------------------------------------------
    BTFSC FLAG1_BANK0,CAN_SEND_TX_FLAG
    CALL PREPARE_TX_DATA_LOOP ;UART TX傳送資料
;-------------------------------------------
    GOTO SYSTEM_START



;========================================================
;====================處理MODBUS指令=======================
;========================================================
DEAL_WITH_MODBUS_LOOP:
    BCF FLAG1_BANK0,DEAL_WITH_MODBUS_FLAG
PAGESEL 0X0800
    CALL MODBUS_ADR_FUNCTION
PAGESEL 0X0000
    RETURN





;;-----------
; BTFSC FLAG1_BANK0,CAN_WORK_FLAG
; CALL MODULE_WORK_LOOP ;順逆轉馬達動作
;;-----------
;
; BTFSC MOTOR2_FLAG0,MOTOR_2_RESET
; CALL MOTOR_2_ZERO_FUNCTION
; BTFSC MOTOR2_FLAG0,MOTOR_2_ING_ZERO
; CALL CHECK_MOTOR2_ZERO_LOOP
;;--------------------------------------
; BTFSC MOTOR1_FLAG0,MOTOR_1_RESET
; CALL MOTOR_1_ZERO_FUNCTION
; BTFSC MOTOR1_FLAG0,MOTOR_1_HI_ZERO
; CALL MOTOR1_ZERO_IN_HI_LOOP
; BTFSC MOTOR1_FLAG0,MOTOR_1_ING_ZERO
; CALL MOTOR1_ZERO_IN_LO_LOOP
; GOTO SYSTEM_START
;;--------------------------------------

;MOTOR_2_WORK1:
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; MOVLW 0X0F
; ADDWF FSR0L,F
; MOVLW 0X00
; MOVWF INDF0
; GOTO SYSTEM_START_LV1
;MOTOR_2_STOP:
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; MOVLW 0X0F
; ADDWF FSR0L,F
; MOVLW 0XFF
; MOVWF INDF0
; GOTO SYSTEM_START_LV1




;========================================================
;=====================注射馬達復位完成===================
;========================================================
CHECK_MOTOR2_ZERO_LOOP:
BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN
BTFSC MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
RETURN
    BTFSC PORTE,0X00
    RETURN
BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M2_ST
BANKSEL PORTA
    CLRF STRONG_STOP_TEMP2
BANKSEL PORTA
    BCF MOTOR2_FLAG0,MOTOR_2_ING_ZERO
    BCF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
;-----------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X04
    ADDWF FSR0L,F
    CLRF INDF0
    INCF FSR0L,F
    CLRF INDF0
;---------------------------------------------清除累加步數


    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X00
    MOVWF INDF0

BANKSEL BANK7
    MOVLW 0X00
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
    RETURN
;--------------------------------------------
MOTOR1_ZERO_IN_LO_LOOP:
BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN
BTFSC MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
RETURN
    BTFSS PORTB,0X02
    GOTO MOTOR1_TIME_ZERO_LOOP


MOVLW 0X01
ADDWF M1_ZERO_COUNTER_LBYTE,F
MOVLW 0X00
ADDWFC M1_ZERO_COUNTER_HBYTE,F
MOVLW 0XFD
ADDWF M1_ZERO_COUNTER_HBYTE,W
BTFSS STATUS,C
RETURN
MOVLW 0X0C
ADDWF M1_ZERO_COUNTER_LBYTE,W
BTFSS STATUS,C
RETURN

; MOVF IOC_COUNTER_HBYTE,W
; BTFSS STATUS,Z
; GOTO MOTOR1_ZERO_IN_LO_LOOP_LV1
;;------
; MOVLW 0XFE
; ADDWF IOC_COUNTER_LBYTE,W
; BTFSS STATUS,C
; RETURN
MOTOR1_ZERO_IN_LO_LOOP_LV1:
BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M1_ST
BANKSEL PORTA
    BCF MOTOR1_FLAG0,MOTOR_1_IOC_FINISH
    BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
    BCF FLAG3_BANK0,TEN_TIME_EN
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X00
    MOVWF INDF0
;----------
    MOVLW 0X00
    MOVWF STRONG_STOP_TEMP1
    BCF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
BANKSEL BANK7
    MOVLW 0X00
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
BTFSC FLAG5_BANK0,RESET_IN_NORMAL_FALG
GOTO RESET_END_IN_NORMAL_LOOP
;BANKSEL IOCBN
; BSF IOCBN,0X02
; BCF IOCBP,0X02
;BANKSEL PORTA


    RETURN
;-------------------------------------------------------------
;-------------------------------------------------------------
MOTOR1_ZERO_IN_HI_LOOP:

BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN


BTFSC MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
RETURN




    BTFSC PORTB,0X02
    GOTO MOTOR1_TIME_ZERO_LOOP
MOVLW 0X01
ADDWF M1_ZERO_COUNTER_LBYTE,F
MOVLW 0X00
ADDWFC M1_ZERO_COUNTER_HBYTE,F

MOVLW 0XFD
ADDWF M1_ZERO_COUNTER_HBYTE,W
BTFSS STATUS,C
RETURN
MOVLW 0X0C
ADDWF M1_ZERO_COUNTER_LBYTE,W
BTFSS STATUS,C
RETURN


; MOVF IOC_COUNTER_HBYTE,W
; BTFSS STATUS,Z
; GOTO MOTOR1_ZERO_IN_HI_LOOP_LV1
;;------
; MOVLW 0XFE
; ADDWF IOC_COUNTER_LBYTE,W
; BTFSS STATUS,C
; RETURN
MOTOR1_ZERO_IN_HI_LOOP_LV1:
    BCF MOTOR1_FLAG0,MOTOR_1_IOC_FINISH
    BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
    GOTO MOTOR_1_NOW_IS_LO

MOTOR1_TIME_ZERO_LOOP:
    ;CLRF IOC_COUNTER_HBYTE
    ;CLRF IOC_COUNTER_LBYTE
INCF M1_NOT_COUNTER_TEMP,F
MOVLW 0X9C
ADDWF M1_NOT_COUNTER_TEMP,W
BTFSS STATUS,C
RETURN
CLRF M1_NOT_COUNTER_TEMP
CLRF M1_ZERO_COUNTER_LBYTE
CLRF M1_ZERO_COUNTER_HBYTE
    RETURN
;========================================================
;=====================轉向馬達復位=======================
;========================================================
MOTOR_1_ZERO_FUNCTION:
BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN
BTFSC MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
RETURN
BSF MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
BANKSEL BANK7
    MOVLW 0X01
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
    BCF MOTOR1_FLAG0,MOTOR_1_RESET
;-----------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X04
    MOVWF INDF0
;----------
    MOVLW 0X01
    MOVWF STRONG_STOP_TEMP1
BANKSEL MOTOR_CONTROL_PORT
    BSF MOTOR_CONTROL_PORT,M1_ST
    ;BCF MOTOR_CONTROL_PORT,M1_FR
; BSF MOTOR_CONTROL_PORT,M1_FR
BANKSEL PORTA
    BTFSC PORTB,0X02
    GOTO MOTOR_1_NOW_IS_HI ;目前是HI
MOTOR_1_NOW_IS_LO: ;目前是LO
BANKSEL PORTA
    BSF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
    BCF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
    BSF FLAG3_BANK0,TEN_TIME_EN
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE
CLRF M1_ZERO_COUNTER_HBYTE
CLRF M1_ZERO_COUNTER_LBYTE
CLRF M1_NOT_COUNTER_TEMP
    RETURN
MOTOR_1_NOW_IS_HI:
BANKSEL PORTA
    BSF MOTOR1_FLAG0,MOTOR_1_HI_ZERO
    BCF MOTOR1_FLAG0,MOTOR_1_ING_ZERO
    BSF FLAG3_BANK0,TEN_TIME_EN
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE
CLRF M1_ZERO_COUNTER_HBYTE
CLRF M1_ZERO_COUNTER_LBYTE
CLRF M1_NOT_COUNTER_TEMP
    RETURN
# 1416 "MOTOR_1947_V2.00.s"
;========================================================
;=====================注射馬達復位進行中=================
;========================================================
MOTOR_2_ZERO_FUNCTION:
BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN
BTFSC MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
RETURN
    BCF MOTOR2_FLAG0,MOTOR_2_RESET
BTFSS PORTE,0X00
RETURN
BANKSEL BANK7
    MOVLW 0X01
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
BSF MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
; MOVLW MODBUS_DAT_REAL_ADRH
; MOVWF FSR0H
; MOVLW MODBUS_DAT_REAL_ADRL
; MOVWF FSR0L
; MOVLW 0X15
; ADDWF FSR0L,F
; MOVLW 0X0F
; ADDWF FSR0L,F
; MOVLW 0X00
; MOVWF INDF0
;------------------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X01
    MOVWF INDF0



BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M2_FR
    BSF MOTOR_CONTROL_PORT,M2_ST
BANKSEL PORTA
BSF MOTOR2_FLAG0,MOTOR_2_ING_ZERO
    RETURN







;========================================================
;===============MODBUS ERROR CODE IS 01==================
;========================================================
MODBUS_ERROR_CODE_01_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_01_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X01
    MOVWF INDF1
;--------------------
MODBUS_ERROR_CODE_END:
    MOVLW 0X03
    MOVWF RTU_COUNTER_DATA
    CALL MODBUS_RTU_READ_LV2
    MOVLW 0X05
    MOVWF TX_DATA_COUNTER
    BSF FLAG1_BANK0,CAN_SEND_TX_FLAG
    RETURN
;========================================================
;===============MODBUS ERROR CODE IS 02==================
;========================================================
MODBUS_ERROR_CODE_02_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_02_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X02
    MOVWF INDF1
;--------------------
    GOTO MODBUS_ERROR_CODE_END
;========================================================
;===============MODBUS ERROR CODE IS 03==================
;========================================================
MODBUS_ERROR_CODE_03_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_03_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X03
    MOVWF INDF1
;--------------------
    GOTO MODBUS_ERROR_CODE_END
;========================================================
;===============MODBUS ERROR CODE IS 04==================
;========================================================
MODBUS_ERROR_CODE_04_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_04_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X04
    MOVWF INDF1
;--------------------
    GOTO MODBUS_ERROR_CODE_END
;========================================================
;===============MODBUS ERROR CODE IS 05==================
;========================================================
MODBUS_ERROR_CODE_05_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_05_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X05
    MOVWF INDF1
;--------------------
    GOTO MODBUS_ERROR_CODE_END
;========================================================
;===============MODBUS ERROR CODE IS 06==================
;========================================================
MODBUS_ERROR_CODE_06_LOOP:
    BCF MODBUS_ERROR_FLAG,ERROR_06_F
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
;---------------------
    INCF FSR1L,F
    MOVLW 0X80
    IORWF INDF1,F
    INCF FSR1L,F
    MOVLW 0X06
    MOVWF INDF1
;--------------------
    GOTO MODBUS_ERROR_CODE_END
;********************************************************************************
;********************************************************************************
;========================================================
;================執行MODULE動作副程式====================
;========================================================
MODULE_WORK_LOOP:
BTFSC FLAG3_BANK0,ALL_MOTOR_STOP_FLAG
RETURN
; BTFSC MOTOR1_FLAG0,MOTOR_1_EN
; CALL MOTOR_1_WORKING_LOOP
;;-----
; BTFSC MOTOR2_FLAG0,MOTOR_2_EN
; CALL MOTOR_2_WORKING_LOOP
;-----
; BTFSC FLAG0_BANK0,MOTOR_1_EN
; CALL MOTOR_1_WORKING_LOOP
;;-----
; BTFSC FLAG0_BANK0,MOTOR_1_EN
; CALL MOTOR_1_WORKING_LOOP
;-----
    RETURN
;========================================================
;================馬達1動作副程式=========================
;========================================================
MOTOR_1_WORKING_LOOP:
;BTFSC MOTOR1_FLAG1,MOTOR1_IN_ZERO_FLAG
;RETURN
    BTFSS MOTOR1_FLAG0,MOTOR_1_WORK
    RETURN
;BSF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
BANKSEL BANK7
    MOVLW 0X01
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
    RETURN



    BTFSC MOTOR1_FLAG0,MOTOR_1_CW
    GOTO MOTOR_1_WORK_CW_LV1
    BTFSC MOTOR1_FLAG0,MOTOR_1_CCW
    GOTO MOTOR_1_WORK_CCW_LV1


;----------------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LOOP
;-------------
RESET_END_IN_NORMAL_LOOP:
    BCF MOTOR1_FLAG0,MOTOR_1_WORK
    BCF FLAG3_BANK0,TEN_TIME_EN
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X07 ;CMD 0X13詢問目前MOTOR1狀態
    ADDWF FSR0L,F
    MOVLW 0X00
    MOVWF INDF0
BCF MOTOR1_FLAG1,MOTOR1_IN_ROAT_FLAG
BANKSEL BANK7
    MOVLW 0X00
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
;----------
    RETURN
;========================================================
;================馬達1順時針副程式=======================
;========================================================
MOTOR_1_WORK_CW_LOOP:
BANKSEL PORTB
BTFSS PORTB,0X02
RETURN
BANKSEL MOTOR_CONTROL_PORT
    BSF MOTOR_CONTROL_PORT,M1_ST
    BCF MOTOR_CONTROL_PORT,M1_FR
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X01
    MOVWF INDF0
;----------

    CLRF PWM_1_COUNT_DAT
    BSF MOTOR1_FLAG0,MOTOR_1_CW
    BSF FLAG3_BANK0,TEN_TIME_EN
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE


BTFSC PORTB,0X02
GOTO MOTOR_1_CW_IOC_SET_HI
BCF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
;BTFSC PORTB,0X02
;GOTO MOTOR_1_CW_IOC_SET_HI
;BANKSEL IOCBN
; BCF IOCBN,0X02
; BSF IOCBP,0X02
;BANKSEL PORTA
MOTOR_1_WORK_CW_LV1:
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV3
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV3
    GOTO MOTOR_1_WORK_CW_FINISH
MOTOR_1_WORK_CW_LV3:
;BANKSEL PORTF
;BSF PORTF,0X01
;BCF PORTF,0X01
;BANKSEL PORTA
; MOVF PWM_1_COUNT_DAT,W
; BTFSC STATUS,Z
; RETURN
BTFSS FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
GOTO CHECK_IOC_IS_LO
GOTO CHECK_IOC_IS_HI
MOTOR_1_WORK_CW_LV4:
;BANKSEL PORTF
;BSF PORTF,0X01
;BCF PORTF,0X01
BANKSEL PORTA
    CLRF PWM_1_COUNT_DAT
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV2
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV2
MOTOR_1_WORK_CW_FINISH:
;BANKSEL PORTF
;BSF PORTF,0X00
;BCF PORTF,0X00
;BANKSEL PORTA
BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M1_ST
BANKSEL PORTA
    BCF MOTOR1_FLAG0,MOTOR_1_CW
    RETURN
MOTOR_1_WORK_CW_LV2:
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    INCF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
;----------------------------------------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X05
    ADDWF FSR0L,F
    MOVLW 0X01
    ADDWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    ADDWFC INDF0,F
    RETURN
;----------------------------------------------------------
MOTOR_1_CW_IOC_SET_HI:
    BSF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
    GOTO MOTOR_1_WORK_CW_LV1
CHECK_IOC_IS_HI:
    BTFSC PORTB,0X02
    RETURN

    MOVF IOC_COUNTER_HBYTE,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV5
;------
    MOVLW 0XFE
    ADDWF IOC_COUNTER_LBYTE,W
    BTFSS STATUS,C
    RETURN
    GOTO MOTOR_1_WORK_CW_LV5
MOTOR_1_WORK_CW_LV5:
;BANKSEL PORTF
;BSF PORTF,0X00
;BCF PORTF,0X00
BANKSEL PORTA
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE
    BCF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
    RETURN
;-----------------------------------------------
CHECK_IOC_IS_LO:
    BTFSS PORTB,0X02
    RETURN
    MOVF IOC_COUNTER_HBYTE,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CW_LV4
;------
    MOVLW 0XFE
    ADDWF IOC_COUNTER_LBYTE,W
    BTFSS STATUS,C
    RETURN
    GOTO MOTOR_1_WORK_CW_LV4

;========================================================
;================馬達1逆時針副程式=======================
;========================================================
MOTOR_1_WORK_CCW_LOOP:
BANKSEL MOTOR_CONTROL_PORT
    BSF MOTOR_CONTROL_PORT,M1_ST
    BSF MOTOR_CONTROL_PORT,M1_FR
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X01
    MOVWF INDF0
;----------
BTFSS PORTB,0X02
RETURN
    CLRF PWM_1_COUNT_DAT
    BSF MOTOR1_FLAG0,MOTOR_1_CCW
    BSF FLAG3_BANK0,TEN_TIME_EN
    CLRF IOC_COUNTER_HBYTE
    CLRF IOC_COUNTER_LBYTE

BTFSC PORTB,0X02
GOTO MOTOR_1_CCW_IOC_SET_HI
BCF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
MOTOR_1_WORK_CCW_LV1:
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X02
    ADDWF FSR0L,F
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV3
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV3
    GOTO MOTOR_1_WORK_CCW_FINISH
;----------------------------------
MOTOR_1_WORK_CCW_LV3:
; MOVF PWM_1_COUNT_DAT,W
; BTFSC STATUS,Z
; RETURN
BTFSS FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
GOTO CHECKC_IOC_IS_LO
GOTO CHECKC_IOC_IS_HI
MOTOR_1_WORK_CCW_LV4:
    CLRF PWM_1_COUNT_DAT
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X02
    ADDWF FSR0L,F
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV2
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV2
MOTOR_1_WORK_CCW_FINISH:

BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M1_ST
BANKSEL PORTA
    BCF MOTOR1_FLAG0,MOTOR_1_CCW
    RETURN
MOTOR_1_WORK_CCW_LV2:
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
MOVLW 0X03
ADDWF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
;----------------------------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X05
    ADDWF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
    RETURN


MOTOR_1_CCW_IOC_SET_HI:
BSF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
    GOTO MOTOR_1_WORK_CCW_LV1

CHECKC_IOC_IS_HI:
    BTFSC PORTB,0X02
    RETURN
    MOVF IOC_COUNTER_HBYTE,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV5
;------
    MOVLW 0XFE
    ADDWF IOC_COUNTER_LBYTE,W
    BTFSS STATUS,C
    RETURN
    GOTO MOTOR_1_WORK_CCW_LV5
MOTOR_1_WORK_CCW_LV5:
BCF FLAG3_BANK0,ROAT_MOTOR_IS_HI_FLAG
RETURN


CHECKC_IOC_IS_LO:
    BTFSS PORTB,0X02
    RETURN
    MOVF IOC_COUNTER_HBYTE,W
    BTFSS STATUS,Z
    GOTO MOTOR_1_WORK_CCW_LV4
;------
    MOVLW 0XFE
    ADDWF IOC_COUNTER_LBYTE,W
    BTFSS STATUS,C
    RETURN
    GOTO MOTOR_1_WORK_CCW_LV4
;========================================================
;================馬達2動作副程式=========================
;========================================================
MOTOR_2_WORKING_LOOP:
BTFSC MOTOR2_FLAG1,MOTOR2_IN_ZERO_FLAG
RETURN
    BTFSS MOTOR2_FLAG0,MOTOR_2_WORK
    RETURN
BANKSEL BANK7
    MOVLW 0X01
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
BSF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
    BTFSC MOTOR2_FLAG0,MOTOR_2_CW
    GOTO MOTOR_2_WORK_CW_LV1
    BTFSC MOTOR2_FLAG0,MOTOR_2_CCW
    GOTO MOTOR_2_WORK_CCW_LV1
;----------------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
;----------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CCW_LOOP
;-------------
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CCW_LOOP
;-------------
MOTOR_2_IOC_STOP_LOOP:
BANKSEL PORTA
    BCF MOTOR2_FLAG0,MOTOR_2_WORK
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X00
    MOVWF INDF0
;----------
BCF MOTOR2_FLAG1,MOTOR2_IN_ROAT_FLAG
BANKSEL BANK7
    MOVLW 0X00
    MOVWF ADR_81_L_DAT
BANKSEL PORTA
    RETURN


;========================================================
;================馬達2順時針副程式=======================
;========================================================
MOTOR_2_WORK_CW_LOOP:
BANKSEL MOTOR_CONTROL_PORT
    BSF MOTOR_CONTROL_PORT,M2_ST
    BCF MOTOR_CONTROL_PORT,M2_FR
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X01 ;MOTOR 2 IS WORKING
    MOVWF INDF0
;----------
    CLRF PWM_2_COUNT_DAT
    BSF MOTOR2_FLAG0,MOTOR_2_CW
MOTOR_2_WORK_CW_LV1:

    BTFSS PORTE,0X00
    GOTO MOTOR_2_WORK_CW_FINISH


    MOVF PWM_2_COUNT_DAT,W
    BTFSC STATUS,Z
    RETURN
    CLRF PWM_2_COUNT_DAT
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CW_LV2
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CW_LV2
MOTOR_2_WORK_CW_FINISH:
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
;----------
    CLRF INDF0
    INCF FSR0L,F
    CLRF INDF0
;-------------------------------
BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M2_ST
BANKSEL PORTA
    BCF MOTOR2_FLAG0,MOTOR_2_CW
    RETURN
MOTOR_2_WORK_CW_LV2:
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
;------------
    INCF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
;------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X05
    ADDWF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
    RETURN
;========================================================
;================馬達2逆時針副程式=======================
;========================================================
MOTOR_2_WORK_CCW_LOOP:
BANKSEL MOTOR_CONTROL_PORT
    BSF MOTOR_CONTROL_PORT,M2_ST
    BSF MOTOR_CONTROL_PORT,M2_FR
BANKSEL PORTA
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X07
    ADDWF FSR0L,F
    MOVLW 0X01 ;馬達正在運作中
    MOVWF INDF0
;----------
    CLRF PWM_2_COUNT_DAT
    BSF MOTOR2_FLAG0,MOTOR_2_CCW
MOTOR_2_WORK_CCW_LV1:

    MOVF PWM_2_COUNT_DAT,W
    BTFSC STATUS,Z
    RETURN
    CLRF PWM_2_COUNT_DAT
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X02
    ADDWF FSR0L,F
;----------------------------------
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CCW_LV2
    INCF FSR0L,F
    MOVF INDF0,W
    BTFSS STATUS,Z
    GOTO MOTOR_2_WORK_CCW_LV2
MOTOR_2_WORK_CCW_FINISH:
BANKSEL MOTOR_CONTROL_PORT
    BCF MOTOR_CONTROL_PORT,M2_ST
BANKSEL PORTA
    BCF MOTOR2_FLAG0,MOTOR_2_CCW
    RETURN
MOTOR_2_WORK_CCW_LV2:
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    ;INCF FSR0L,F
MOVLW 0X03
ADDWF FSR0L,F
    MOVLW 0X01
    SUBWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    SUBWFB INDF0,F
;-------------------------
    MOVLW MODBUS_DAT_REAL_ADRH
    MOVWF FSR0H
    MOVLW MODBUS_DAT_REAL_ADRL
    MOVWF FSR0L
    MOVLW 0X15
    ADDWF FSR0L,F
    MOVLW 0X05
    ADDWF FSR0L,F
    MOVLW 0X01
    ADDWF INDF0,F
    DECF FSR0L,F
    MOVLW 0X00
    ADDWFC INDF0,F
    RETURN
;========================================================
;====================準備TX資料副程式====================
;========================================================
PREPARE_TX_DATA_LOOP:
    CALL DELAY_10ms
    MOVLW MODBUS_DAT_EXTRA_ADRH
    MOVWF FSR1H
    MOVLW MODBUS_DAT_EXTRA_ADRL
    MOVWF FSR1L
    MOVLW 0X0A
    ADDWF FSR1L,F
BANKSEL MAX485_PORT
    BSF MAX485_PORT,MAX485_SELECT
BANKSEL PORTA
;---------------------------------------------
TEST_MAX485_LOOP1:
BANKSEL TX2STA
    BTFSS TX2STA,TRMT
    GOTO TEST_MAX485_LOOP1
BANKSEL TX2REG
    MOVF INDF1,W
    MOVWF TX2REG
BANKSEL PORTA
    INCF FSR1L,F
    DECFSZ TX_DATA_COUNTER,F
    GOTO TEST_MAX485_LOOP1
TEST_MAX485_LOOP1_LV1:
BANKSEL TX2STA
    BTFSS TX2STA,TRMT
    GOTO TEST_MAX485_LOOP1_LV1
BANKSEL MAX485_PORT
    BCF MAX485_PORT,MAX485_SELECT
BANKSEL RC2STA
    BSF RC2STA,CREN ;啟動UART RX功能
BANKSEL PORTA
    BCF FLAG1_BANK0,CAN_SEND_TX_FLAG
    RETURN
;========================================================
;=====================ADC取資料副程式====================
;========================================================
ADC_TAKE_DATA_FUNCTION:
BANKSEL ADCON1
    MOVLW 0X31 ;AN12啟動
    MOVWF ADCON0
    MOVLW 0XC0
    MOVWF ADCON1
    CLRF ADC_HI_DATA
    CLRF ADC_LOW_DATA
BANKSEL PORTA
    CALL DELAY_100us
    CALL DELAY_100us
    CALL DELAY_100us
BANKSEL ADCON0
;;------------------------ADC_RUN-------------------------------
   BSF ADCON0,0X01
ADC_WORK:
   BTFSC ADCON0,0X01
    GOTO ADC_WORK
BANKSEL ADRESH
    MOVF ADRESH,W
    MOVWF ADC_HI_DATA
    MOVF ADRESL,W
    MOVWF ADC_LOW_DATA
BANKSEL PORTA
    RETURN






;========================================================
;====================測試用將資料送出====================OK
;========================================================
;這個部分是顯示內部資料的副程式
WATCH_SUB_FUNCTION:
    MOVLW WATCH_DAT_BUF_ADRH
    MOVWF FSR0H
    MOVLW WATCH_DAT_BUF_ADRL
    MOVWF FSR0L
    MOVLW 0X08
    MOVWF WATCH_BIT_COUNT
    MOVF INDF0,W
    MOVWF WATCH_TEMP
WATCH_SUB_FUNC_LV1:
BANKSEL WATCH_OUT_P
    BCF WATCH_OUT_P,WATCH_OUT_CLK
    BTFSC WATCH_TEMP,0X07
    BSF WATCH_OUT_P,WATCH_OUT_DAT
    BTFSS WATCH_TEMP,0X07
    BCF WATCH_OUT_P,WATCH_OUT_DAT
    BSF WATCH_OUT_P,WATCH_OUT_CLK
    RLF WATCH_TEMP,F
    DECFSZ WATCH_BIT_COUNT,F
    GOTO WATCH_SUB_FUNC_LV1
;----------
    MOVLW 0X08
    MOVWF WATCH_BIT_COUNT
    INCF FSR0L,F
    MOVF INDF0,W
    MOVWF WATCH_TEMP
    DECFSZ WATCH_COUNTER,F
    GOTO WATCH_SUB_FUNC_LV1
    BCF WATCH_OUT_P,WATCH_OUT_DAT
    BCF WATCH_OUT_P,WATCH_OUT_CLK
BANKSEL PORTA
    RETURN
;========================================================
;====================CRC-16運算副程式====================OK
;========================================================
;做一個BYTE大概40-50uS
CRC_16_FUNCTION_LOOP:
BANKSEL PORTA
    MOVF CAL_DATA_TEMP,W
    XORWF CRC_LOBYTE,F
;---------
    MOVLW 0X09
    MOVWF CRC_COUNTER_TEMP
CRC_16_FUNCTION_LV1:
    DECF CRC_COUNTER_TEMP,F
    MOVF CRC_COUNTER_TEMP,W
    BTFSC STATUS,Z
    GOTO CRC_16_END_FUNCTION
;---------------------
    BCF STATUS,C
    RRF CRC_HIBYTE,F
    RRF CRC_LOBYTE,F
    BTFSS STATUS,C
    GOTO CRC_16_FUNCTION_LV1
;---------------------
    MOVLW 0XA0 ;CRC-16運算的參數
    XORWF CRC_HIBYTE,F
    MOVLW 0X01
    XORWF CRC_LOBYTE,F
    GOTO CRC_16_FUNCTION_LV1
CRC_16_END_FUNCTION:
BANKSEL PORTA
    RETURN


;=======================================================
;===============測試將收到的資料顯示出==================OK
;=======================================================
AAAA_1800:
MOVLW 0X08
MOVWF 0X70
AAAAN:
BANKSEL LATF
BCF LATF,0X04
;----------------
BTFSC 0X71,0X07
BSF LATF,0X05
BTFSS 0X71,0X07
BCF LATF,0X05
;----------------
BSF LATF,0X04
RLF 0X71,F
DECFSZ 0X70,F
GOTO AAAAN
BCF LATF,0X04
BCF LATF,0X05
BANKSEL PORTA
RETURN
;=======================================================
;================TIMER2基礎時間設定=====================OK
;=======================================================
;TIMER2 BASE TIME IS 1mS
SET_TMR2_BASE_TIME:
BANKSEL T2CON
    MOVLW TMR2_DIVIDER_SET
    MOVWF T2CON
    MOVLW TMR2_BASE_SET
    MOVWF PR2
;---------------------
    MOVLW TMR2_BASE_NUM
    MOVWF TMR2_BASE_TEMP
BANKSEL PORTA
    RETURN
;=======================================================
;===============TIMER2中斷參數設定======================OK
;=======================================================
SET_TMR2_INT_EN:
BANKSEL PIE1
    BSF PIE1,TMR2IE
BANKSEL PORTA
    RETURN
;=======================================================
;===================TIMER2啟動==========================OK
;=======================================================
SET_TMR2_ON:
BANKSEL T2CON
    BSF T2CON,TMR2ON
BANKSEL PORTA
    RETURN
;========================================================
;=================將REG內資料全部清空====================OK
;========================================================
CLEAN_ALL_REGISTER:
    MOVLW 0X20
    MOVWF FSR1H
    MOVLW 0X00
    MOVWF FSR1L
    MOVLW 0X03
    MOVWF 0X71
    MOVLW 0XFF
    MOVWF 0X70
CLEAN_ALL_REGISTER_LOOP:
    CLRF INDF1
    BCF STATUS,C
    MOVLW 0X01
    ADDWF FSR1L,F
    MOVLW 0X00
    ADDWFC FSR1H,F
    DECFSZ 0X70,F
    GOTO CLEAN_ALL_REGISTER_LOOP
    MOVLW 0XFF
    MOVWF 0X70
    DECFSZ 0X71,F
    GOTO CLEAN_ALL_REGISTER_LOOP
BANKSEL PORTA
    RETURN
;=======================================================
;===================== 讀EEPROM ========================OK
;=======================================================
READ_EEPROM:
BANKSEL EEADRL
    MOVF EEPROM_ADR,W
    MOVWF EEADRL
    BCF EECON1,CFGS ;USER EEPROM
    BCF EECON1,EEPGD ;USER EEPROM
    BSF EECON1,RD ;READ_EEPROM
    MOVF EEDATL,W
    MOVWF EEPROM_DAT
BANKSEL PORTA
    RETURN
;=======================================================
;===================== 寫EEPROM ========================OK
;=======================================================
WRITE_EEPROM:
    BCF INTCON,GIE
BANKSEL EEADRL
    MOVF EEPROM_ADR,W
    MOVWF EEADRL ;EEPROM ADDRESS
    MOVF EEPROM_DAT,W
    MOVWF EEDATL ;EEPROM DATA
;;-----------------------
WRITE_EEPROM_LOOP_1:
    BCF EECON1,CFGS ;USER EEPROM
    BCF EECON1,EEPGD ;USER EEPROM
    BSF EECON1,WREN ;ENABLE WRITE
    MOVLW 0X55 ;固定程序
    MOVWF EECON2
    MOVLW 0XAA
    MOVWF EECON2 ;固定程序
;;-----------------------
    BSF EECON1,WR ;RUN WRITE EEPROM
WAIT_EEPROM_WRITE_OVER:
    BTFSC EECON1,WR
    GOTO WAIT_EEPROM_WRITE_OVER
BANKSEL EECON1
    BCF EECON1,WREN ;Disable writes
BANKSEL PORTA
    BSF INTCON,GIE
    RETURN
;========================================================
;======================== DELAY =========================OK
;========================================================
;DEFINE IS 8MHZ
DELAY_3000ms:
    CALL DELAY_1000ms
    CALL DELAY_1000ms
DELAY_1000ms:
    CALL DELAY_500ms
DELAY_500ms:
    CALL DELAY_100ms
    CALL DELAY_100ms
    CALL DELAY_100ms
    CALL DELAY_100ms
DELAY_100ms:
    CALL DELAY_20ms
    CALL DELAY_40ms
DELAY_40ms:
    CALL DELAY_20ms
DELAY_20ms:
    CALL DELAY_10ms
DELAY_10ms:
    CALL DELAY_5ms
DELAY_5ms:
    CALL DELAY_1ms
DELAY_4ms:
    CALL DELAY_1ms
DELAY_3ms:
    CALL DELAY_1ms
DELAY_2ms:
    CALL DELAY_1ms
DELAY_1ms:
    MOVLW 0X31
    MOVWF DELAY_TEMP1 ;49
    MOVWF DELAY_TEMP2 ;49
    MOVLW 0X0A
    MOVWF DELAY_TEMP3
    GOTO DELAY_LOOP_1
DELAY_LOOP_1:
    NOP ;1
    DECFSZ DELAY_TEMP1,F ;2
    GOTO DELAY_LOOP_1 ;3,4 (0.5*4*49 = 98us)
    MOVF DELAY_TEMP2,W ;4
    MOVWF DELAY_TEMP1 ;1
    DECFSZ DELAY_TEMP3,F ;2
    GOTO DELAY_LOOP_1 ;3,4
    RETURN
;==========================================
DELAY_600us:
    CALL DELAY_100us
DELAY_500us:
    CALL DELAY_100us
DELAY_400us:
    CALL DELAY_100us
DELAY_300us:
    CALL DELAY_100us
DELAY_200us:
    CALL DELAY_100us
DELAY_100us:
    CALL DELAY_10us
DELAY_90us:
    CALL DELAY_10us
    CALL DELAY_10us
    CALL DELAY_10us
DELAY_60us:
    CALL DELAY_10us
DELAY_50us:
    CALL DELAY_10us
DELAY_40us:
    CALL DELAY_10us
DELAY_30us:
    CALL DELAY_10us
DELAY_20us:
    CALL DELAY_10us
DELAY_10us:
    NOP
    NOP
DELAY_9us:
    NOP
    NOP
DELAY_8us:
    NOP
    NOP
DELAY_7us:
    NOP
    NOP
DELAY_6us:
    NOP
    NOP
DELAY_5us:
    NOP
    NOP
DELAY_4us:
    NOP
    NOP
DELAY_3us:
    NOP
    NOP
DELAY_2us:
    RETURN
